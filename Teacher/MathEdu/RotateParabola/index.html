<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>회전하는 사각 물통의 포물선 탐구</title>

    <!-- Modern Design System -->
    <link rel="stylesheet" href="../css/main.css" />
    <link rel="stylesheet" href="../css/components/report.css" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+KR:wght@400;500;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/naen-nae/d2coding/d2coding-subset.css">

    <!-- Libs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <!-- Three.js Import Map -->
    <script type="importmap">
  {
    "imports": {
      "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
      "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
    }
  }
  </script>
</head>

<body>

    <!-- Back Button -->
    <a href="../index.html" class="m-back-btn" aria-label="Back">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2">
            <line x1="19" y1="12" x2="5" y2="12"></line>
            <polyline points="12 19 5 12 12 5"></polyline>
        </svg>
    </a>

    <div class="container pt-lg pb-lg">

        <!-- Header -->
        <header class="modern-header flex justify-between items-end flex-wrap gap-4">
            <div>
                <div class="mb-2">
                    <span class="m-badge" style="background:var(--grad-primary); color:white;">One-Page Report</span>
                </div>
                <h1>회전하는 사각 물통의 포물선 탐구</h1>
                <p>Physics & Math Integration: 자이로스코프 관측과 수학적 모델링</p>
            </div>
            <div class="flex gap-2 print-hidden">
                <button id="export-pdf" class="m-btn primary small">
                    <span>📄 PDF 저장</span>
                </button>
                <a href="overview.html" class="m-btn secondary small text-decoration-none">
                    <span>📚 탐구 개요</span>
                </a>
                <a href="theory.html" class="m-btn secondary small text-decoration-none">
                    <span>📘 이론 설명</span>
                </a>
            </div>
        </header>

        <main class="flex flex-col gap-6">

            <!-- Student Info -->
            <section class="m-card">
                <div class="m-grid" style="grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div>
                        <label for="student-id" class="font-bold text-sm block mb-1">학번</label>
                        <input id="student-id" class="m-input savable" placeholder="예: 30212">
                    </div>
                    <div>
                        <label for="student-name" class="font-bold text-sm block mb-1">이름</label>
                        <input id="student-name" class="m-input savable" placeholder="예: 홍길동">
                    </div>
                </div>
            </section>

            <!-- Navigation -->
            <nav class="flex flex-wrap gap-2 print-hidden">
                <a href="#step1" class="m-badge hover:bg-gray-200 cursor-pointer text-decoration-none">Step 1: 관찰</a>
                <a href="#step2" class="m-badge hover:bg-gray-200 cursor-pointer text-decoration-none">Step 2: 모델링</a>
                <a href="#step3" class="m-badge hover:bg-gray-200 cursor-pointer text-decoration-none">Step 3: 시뮬레이션</a>
                <a href="#step4" class="m-badge hover:bg-gray-200 cursor-pointer text-decoration-none">Step 4: 심화</a>
            </nav>

            <!-- Step 1: Observation -->
            <section id="step1" class="m-card">
                <h2 class="text-xl font-bold mb-4">Step 1: 현상 관찰 & 이론적 배경</h2>

                <div class="m-grid" style="grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
                    <div>
                        <strong class="block mb-2 text-sm text-neutral-600">연구 배경</strong>
                        <div class="bg-gray-50 p-4 rounded-lg text-sm">
                            <p class="mb-2"><strong>Monteiro et al. (2019)</strong>: 직사각형 물통 회전 시 자유수면 단면이 포물선임을 입증.</p>
                            <ul class="list-disc pl-5">
                                <li>결과: \( z(r) \propto r^2 \)</li>
                                <li>응용: 중력가속도 \( g \) 역추정 가능</li>
                            </ul>
                        </div>
                    </div>
                    <div>
                        <strong class="block mb-2 text-sm text-neutral-600">핵심 원리</strong>
                        <p class="text-sm">유체가 회전할 때 원심력과 중력의 합력이 수면에 수직으로 작용하여 포물면을 형성합니다. 일정 각속도 이상에서 바닥이 드러나는 Dry
                            Patch 현상이 발생합니다.</p>
                    </div>
                </div>
            </section>

            <!-- Step 2: Modeling -->
            <section id="step2" class="m-card">
                <h2 class="text-xl font-bold mb-4">Step 2: 수학적 모델링</h2>

                <div class="m-grid" style="grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                    <div class="prose">
                        <h3 class="text-lg font-bold">힘의 평형 방정식</h3>
                        $$ \frac{dp}{dr} = \rho \omega^2 r, \quad \frac{dp}{dz} = -\rho g $$
                        <p class="text-sm">적분 결과 (포물선):</p>
                        $$ z(r) = \frac{\omega^2}{2g} r^2 + C $$
                    </div>
                    <div class="p-4 rounded">
                        <h3 class="font-bold mb-2">부피 보존 조건</h3>
                        <p class="text-sm opacity-90 mb-2">회전 전후 물의 부피가 일정함을 이용하여 상수 C 결정:</p>
                        $$ z(r) = H - \frac{\omega^2}{2g} \left(\frac{L^2}{12} - r^2\right) $$
                        <p class="text-xs mt-2 opacity-80">\(H\): 초기높이, \(L\): 폭, \(\omega\): 각속도</p>
                    </div>
                </div>

                <div class="mt-4">
                    <label class="font-bold text-sm block mb-2">유도 과정 노트</label>
                    <div class="editable-container">
                        <textarea id="derivation-note" class="savable markdown-input"
                            placeholder="여기에 수식 유도 과정을 정리해보세요."></textarea>
                        <div class="markdown-preview"></div>
                    </div>
                </div>
            </section>

            <!-- Step 3: Simulation -->
            <section id="step3" class="m-card">
                <h2 class="text-xl font-bold mb-4">Step 3: 인터랙티브 시뮬레이션</h2>

                <div class="m-grid" style="grid-template-columns: 1fr 2fr; gap: 2rem;">
                    <!-- Controls -->
                    <div class="space-y-4">
                        <div>
                            <label class="font-bold text-sm block mb-1">각속도 \(\omega\) (rad/s)</label>
                            <input id="omegaSlider" type="range" min="0" max="10" step="0.1" value="3"
                                class="w-full savable">
                            <input id="omegaInput" type="number" step="0.1" value="3"
                                class="m-input text-right savable">
                        </div>
                        <div>
                            <label class="font-bold text-sm block mb-1">초기 물높이 \(H\) (m)</label>
                            <input id="HSlider" type="range" min="0.02" max="0.15" step="0.005" value="0.08"
                                class="w-full savable">
                            <input id="HInput" type="number" step="0.005" value="0.08"
                                class="m-input text-right savable">
                        </div>
                        <div>
                            <label class="font-bold text-sm block mb-1">물통 폭 \(L\) (m)</label>
                            <input id="LSlider" type="range" min="0.1" max="0.5" step="0.01" value="0.25"
                                class="w-full savable">
                            <input id="LInput" type="number" step="0.01" value="0.25"
                                class="m-input text-right savable">
                        </div>

                        <!-- Info Box -->
                        <div id="calcInfo" class="bg-gray-50 p-4 rounded border text-sm"
                            style="color: var(--text-main);"></div>
                    </div>

                    <!-- Visualization -->
                    <div class="flex flex-col gap-4">
                        <!-- 3D View -->
                        <div class="vis-container relative border rounded overflow-hidden bg-gray-50"
                            style="height: 400px;">
                            <div id="threeContainer" class="w-full h-full"></div>
                            <span class="m-badge absolute"
                                style="top: 1rem; left: 1rem; background: white; box-shadow: var(--shadow);">3D
                                Visualization</span>
                        </div>

                        <!-- 2D Profile -->
                        <div class="vis-container border rounded p-4 bg-white">
                            <div class="flex justify-between items-center mb-2">
                                <span class="font-bold text-sm">2D 단면 프로파일</span>
                            </div>
                            <canvas id="profileCanvas" style="width:100%; height:200px;"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Step 4: Advanced -->
            <section id="step4" class="m-card">
                <h2 class="text-xl font-bold mb-4">Step 4: 심화 탐구</h2>

                <div class="space-y-4">
                    <div>
                        <label class="font-bold text-sm block mb-1">결과 분석 및 결론</label>
                        <div class="editable-container">
                            <textarea id="conclusion" class="savable markdown-input"
                                placeholder="시뮬레이션 결과와 이론적 예측을 비교하여 결론을 작성하세요."></textarea>
                            <div class="markdown-preview"></div>
                        </div>
                    </div>

                    <div>
                        <label class="font-bold text-sm block mb-1">실험 결과 갤러리</label>
                        <div id="results-gallery-drop" class="dropzone p-4">분석 이미지를 업로드하세요.</div>
                        <div class="flex gap-2 mt-2">
                            <input id="results-gallery-input" type="file" accept="image/*" multiple class="hidden">
                            <button id="results-gallery-add" class="m-btn small secondary"
                                onclick="document.getElementById('results-gallery-input').click()">+ 추가</button>
                            <button id="results-gallery-clear" class="m-btn small secondary"
                                onclick="if(confirm('삭제?')) document.getElementById('results-gallery').innerHTML=''">초기화</button>
                        </div>
                        <div id="results-gallery" class="gallery-grid"></div>
                    </div>
                </div>
            </section>

        </main>

        <footer class="mt-8 text-center text-sm text-muted print-hidden">
            <div id="autosave-status" class="flex items-center justify-center gap-2 opacity-0 transition-opacity">
                <span id="autosave-icon-saving" class="hidden">💾 저장 중...</span>
                <span id="autosave-icon-saved" class="text-green-600 hidden">✅ 저장됨</span>
                <span id="autosave-text"></span>
            </div>
            <p class="mt-4">MathEdu Project 2025.</p>
        </footer>

    </div>

    <!-- Simulation Logic -->
    <script type="module" src="script.js"></script>

</body>

</html>