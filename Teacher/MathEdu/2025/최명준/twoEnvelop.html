<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ë‘ ë´‰íˆ¬ì˜ ì—­ì„¤ ì‹œë®¬ë ˆì´ì…˜</title>
    <script src="<https://cdn.jsdelivr.net/npm/chart.js>"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(
          135deg,
          #1a1a2e 0%,
          #16213e 50%,
          #0f3460 100%
        );
        min-height: 100vh;
        color: #fff;
        padding: 20px;
      }
      .container {
        max-width: 1400px;
        margin: 0 auto;
      }
      h1 {
        text-align: center;
        margin-bottom: 10px;
        font-size: 2.5em;
        background: linear-gradient(90deg, #e94560, #f39c12);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }
      .subtitle {
        text-align: center;
        color: #888;
        margin-bottom: 30px;
        font-size: 1.1em;
      }
      .explanation-box {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 30px;
        border: 1px solid rgba(233, 69, 96, 0.3);
      }
      .explanation-box h3 {
        color: #e94560;
        margin-bottom: 15px;
      }
      .explanation-box p {
        line-height: 1.8;
        color: #ccc;
      }
      .paradox-formula {
        background: rgba(0, 0, 0, 0.3);
        padding: 15px;
        border-radius: 10px;
        margin: 15px 0;
        font-family: "Courier New", monospace;
        text-align: center;
        font-size: 1.1em;
        color: #f39c12;
      }
      .main-grid {
        display: grid;
        grid-template-columns: 350px 1fr;
        gap: 30px;
      }
      .control-panel {
        background: rgba(255, 255, 255, 0.08);
        border-radius: 20px;
        padding: 25px;
        height: fit-content;
        position: sticky;
        top: 20px;
      }
      .control-panel h2 {
        color: #e94560;
        margin-bottom: 20px;
        font-size: 1.3em;
        border-bottom: 2px solid rgba(233, 69, 96, 0.3);
        padding-bottom: 10px;
      }
      .control-group {
        margin-bottom: 20px;
      }
      .control-group label {
        display: block;
        margin-bottom: 8px;
        color: #aaa;
        font-size: 0.9em;
      }
      .control-group input[type="number"],
      .control-group select {
        width: 100%;
        padding: 12px;
        border: none;
        border-radius: 10px;
        background: rgba(0, 0, 0, 0.3);
        color: #fff;
        font-size: 1em;
      }
      .control-group input[type="range"] {
        width: 100%;
        margin-top: 5px;
      }
      .range-value {
        text-align: center;
        color: #f39c12;
        font-weight: bold;
        margin-top: 5px;
      }
      .strategy-options {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .strategy-option {
        display: flex;
        align-items: center;
        padding: 12px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s;
      }
      .strategy-option:hover {
        background: rgba(233, 69, 96, 0.2);
      }
      .strategy-option input {
        margin-right: 10px;
      }
      .strategy-option.active {
        background: rgba(233, 69, 96, 0.3);
        border: 1px solid #e94560;
      }
      .threshold-input {
        margin-top: 15px;
        padding: 15px;
        background: rgba(243, 156, 18, 0.1);
        border-radius: 10px;
        border: 1px solid rgba(243, 156, 18, 0.3);
      }
      .btn {
        width: 100%;
        padding: 15px;
        border: none;
        border-radius: 12px;
        font-size: 1.1em;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s;
        margin-top: 10px;
      }
      .btn-primary {
        background: linear-gradient(135deg, #e94560, #f39c12);
        color: #fff;
      }
      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 30px rgba(233, 69, 96, 0.4);
      }
      .btn-secondary {
        background: rgba(255, 255, 255, 0.1);
        color: #fff;
      }
      .btn-compare {
        background: linear-gradient(135deg, #00b894, #00cec9);
      }
      .results-panel {
        display: flex;
        flex-direction: column;
        gap: 25px;
      }
      .envelope-visual {
        background: rgba(255, 255, 255, 0.08);
        border-radius: 20px;
        padding: 30px;
        text-align: center;
      }
      .envelopes-container {
        display: flex;
        justify-content: center;
        gap: 60px;
        margin: 30px 0;
      }
      .envelope {
        width: 150px;
        height: 100px;
        background: linear-gradient(135deg, #f39c12, #e74c3c);
        border-radius: 10px;
        position: relative;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5em;
        font-weight: bold;
      }
      .envelope::before {
        content: "";
        position: absolute;
        top: -20px;
        left: 0;
        right: 0;
        height: 40px;
        background: linear-gradient(135deg, #e74c3c, #c0392b);
        clip-path: polygon(0 100%, 50% 0, 100% 100%);
        border-radius: 10px 10px 0 0;
      }
      .envelope:hover {
        transform: scale(1.05);
      }
      .envelope.selected {
        box-shadow: 0 0 30px rgba(46, 204, 113, 0.8);
        border: 3px solid #2ecc71;
      }
      .envelope.revealed {
        background: linear-gradient(135deg, #2ecc71, #27ae60);
      }
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
      }
      .stat-card {
        background: rgba(255, 255, 255, 0.08);
        border-radius: 15px;
        padding: 20px;
        text-align: center;
      }
      .stat-card h3 {
        color: #888;
        font-size: 0.9em;
        margin-bottom: 10px;
      }
      .stat-card .value {
        font-size: 2em;
        font-weight: bold;
      }
      .stat-card .value.positive {
        color: #2ecc71;
      }
      .stat-card .value.negative {
        color: #e74c3c;
      }
      .stat-card .value.neutral {
        color: #f39c12;
      }
      .chart-container {
        background: rgba(255, 255, 255, 0.08);
        border-radius: 20px;
        padding: 25px;
      }
      .chart-container h3 {
        color: #e94560;
        margin-bottom: 20px;
      }
      .chart-wrapper {
        height: 300px;
        position: relative;
      }
      .comparison-results {
        background: rgba(255, 255, 255, 0.08);
        border-radius: 20px;
        padding: 25px;
      }
      .comparison-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
        margin-top: 20px;
      }
      .comparison-card {
        background: rgba(0, 0, 0, 0.3);
        border-radius: 15px;
        padding: 20px;
        text-align: center;
      }
      .comparison-card h4 {
        margin-bottom: 15px;
        font-size: 1.1em;
      }
      .comparison-card.never-switch h4 {
        color: #3498db;
      }
      .comparison-card.always-switch h4 {
        color: #e74c3c;
      }
      .comparison-card.threshold h4 {
        color: #2ecc71;
      }
      .comparison-stat {
        margin: 10px 0;
      }
      .comparison-stat .label {
        color: #888;
        font-size: 0.85em;
      }
      .comparison-stat .value {
        font-size: 1.3em;
        font-weight: bold;
      }
      .log-container {
        background: rgba(255, 255, 255, 0.08);
        border-radius: 20px;
        padding: 25px;
        max-height: 400px;
        overflow: hidden;
      }
      .log-container h3 {
        color: #e94560;
        margin-bottom: 15px;
      }
      .log-content {
        height: 320px;
        overflow-y: auto;
        font-family: "Courier New", monospace;
        font-size: 0.85em;
        background: rgba(0, 0, 0, 0.3);
        padding: 15px;
        border-radius: 10px;
      }
      .log-entry {
        padding: 5px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }
      .log-entry.gain {
        color: #2ecc71;
      }
      .log-entry.loss {
        color: #e74c3c;
      }
      .log-entry.neutral {
        color: #f39c12;
      }
      .progress-bar {
        width: 100%;
        height: 10px;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 5px;
        overflow: hidden;
        margin-top: 15px;
      }
      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #e94560, #f39c12);
        width: 0%;
        transition: width 0.1s;
      }
      .insight-box {
        background: linear-gradient(
          135deg,
          rgba(46, 204, 113, 0.2),
          rgba(39, 174, 96, 0.1)
        );
        border: 1px solid rgba(46, 204, 113, 0.3);
        border-radius: 15px;
        padding: 20px;
        margin-top: 20px;
      }
      .insight-box h4 {
        color: #2ecc71;
        margin-bottom: 10px;
      }
      .insight-box p {
        color: #ccc;
        line-height: 1.6;
      }
      @media (max-width: 1200px) {
        .main-grid {
          grid-template-columns: 1fr;
        }
        .control-panel {
          position: static;
        }
        .stats-grid,
        .comparison-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ­ ë‘ ë´‰íˆ¬ì˜ ì—­ì„¤ ì‹œë®¬ë ˆì´ì…˜</h1>
      <p class="subtitle">
        Decision Making Under Uncertainty and The Two-Envelope Paradox
      </p>
      <div class="explanation-box">
        <h3>ğŸ“š ì—­ì„¤ì˜ ìƒí™©</h3>
        <p>
          ë‘ ê°œì˜ ë´‰íˆ¬ê°€ ìˆë‹¤. í•˜ë‚˜ì—ëŠ” ë‹¤ë¥¸ í•˜ë‚˜ë³´ë‹¤
          <strong>2ë°°ì˜ ëˆ</strong>ì´ ë“¤ì–´ ìˆë‹¤. ë‹¹ì‹ ì€ í•˜ë‚˜ë¥¼ ê³¨ëê³ , ì—´ì–´ë³´ì§€
          ì•Šì€ ìƒíƒœì—ì„œ ë°”ê¿€ ê¸°íšŒë¥¼ ì–»ëŠ”ë‹¤.
        </p>
        <div class="paradox-formula">
          E(êµí™˜) = (1/2 Ã— 2z) + (1/2 Ã— z/2) = <strong>1.25z</strong> > z (í•­ìƒ
          êµí™˜ì´ ì´ë“?)
        </div>
        <p>
          ì´ ë…¼ë¦¬ì— ë”°ë¥´ë©´ í•­ìƒ ë°”ê¾¸ëŠ” ê²ƒì´ ì´ë“ì´ë‹¤. í•˜ì§€ë§Œ ë°”ê¾¼ í›„ì—ë„ ë˜‘ê°™ì€
          ë…¼ë¦¬ê°€ ì ìš©ë˜ì–´ ë‹¤ì‹œ ë°”ê¾¸ëŠ” ê²ƒì´ ì´ë“ì´ ë˜ëŠ”
          <strong>ë¬´í•œ ë£¨í”„ì˜ ëª¨ìˆœ</strong>ì´ ë°œìƒí•œë‹¤.
        </p>
      </div>
      <div class="main-grid">
        <div class="control-panel">
          <h2>âš™ï¸ ì‹œë®¬ë ˆì´ì…˜ ì„¤ì •</h2>
          <div class="control-group">
            <label>ì‹œë®¬ë ˆì´ì…˜ íšŸìˆ˜</label>
            <input
              type="number"
              id="simCount"
              value="10000"
              min="100"
              max="1000000"
            />
          </div>
          <div class="control-group">
            <label>í™•ë¥  ë¶„í¬ (kì˜ ìµœëŒ€ê°’)</label>
            <input type="range" id="maxK" value="30" min="10" max="50" />
            <div class="range-value">
              k_max: <span id="maxKValue">30</span> (ìµœëŒ€ê¸ˆì•¡: $<span
                id="maxAmount"
                >1,073,741,824</span
              >)
            </div>
          </div>
          <div class="control-group">
            <label>ì „ëµ ì„ íƒ</label>
            <div class="strategy-options">
              <div class="strategy-option active" data-strategy="never">
                <input type="radio" name="strategy" value="never" checked />
                <div>
                  <strong>ì ˆëŒ€ ë°”ê¾¸ì§€ ì•Šê¸°</strong>
                  <small style="display: block; color: #888">ê¸°ì¤€ ì „ëµ</small>
                </div>
              </div>
              <div class="strategy-option" data-strategy="always">
                <input type="radio" name="strategy" value="always" />
                <div>
                  <strong>í•­ìƒ ë°”ê¾¸ê¸°</strong>
                  <small style="display: block; color: #888">ì—­ì„¤ì  ì „ëµ</small>
                </div>
              </div>
              <div class="strategy-option" data-strategy="threshold">
                <input type="radio" name="strategy" value="threshold" />
                <div>
                  <strong>ì„ê³„ê°’ ì „ëµ</strong>
                  <small style="display: block; color: #888"
                    >ë…¼ë¬¸ ì œì•ˆ ì „ëµ</small
                  >
                </div>
              </div>
            </div>
            <div
              class="threshold-input"
              id="thresholdSection"
              style="display: none"
            >
              <label>ì„ê³„ê°’ (M) - ì´ ê°’ ì´í•˜ì¼ ë•Œë§Œ êµí™˜</label>
              <input type="number" id="threshold" value="10000" min="1" />
            </div>
          </div>
          <button class="btn btn-primary" onclick="runSimulation()">
            ğŸš€ ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰
          </button>
          <button class="btn btn-compare" onclick="runComparison()">
            ğŸ“Š 3ê°€ì§€ ì „ëµ ë¹„êµ
          </button>
          <button class="btn btn-secondary" onclick="playSingleGame()">
            ğŸ² ë‹¨ì¼ ê²Œì„ ì²´í—˜
          </button>
          <div class="progress-bar" id="progressBar" style="display: none">
            <div class="progress-fill" id="progressFill"></div>
          </div>
        </div>
        <div class="results-panel">
          <div class="envelope-visual" id="singleGameSection">
            <h3>ğŸ¯ ë‹¨ì¼ ê²Œì„ ì²´í—˜</h3>
            <p style="color: #888; margin-top: 10px">
              ë²„íŠ¼ì„ ëˆŒëŸ¬ ê²Œì„ì„ ì‹œì‘í•˜ì„¸ìš”
            </p>
            <div class="envelopes-container" id="envelopesContainer">
              <div class="envelope" id="envelope1" onclick="selectEnvelope(1)">
                ë´‰íˆ¬ A
              </div>
              <div class="envelope" id="envelope2" onclick="selectEnvelope(2)">
                ë´‰íˆ¬ B
              </div>
            </div>
            <div
              id="gameMessage"
              style="font-size: 1.2em; margin-top: 20px"
            ></div>
            <div id="gameActions" style="margin-top: 20px; display: none">
              <button
                class="btn btn-primary"
                style="width: auto; padding: 10px 30px; margin: 5px"
                onclick="makeDecision(true)"
              >
                êµí™˜í•˜ê¸°
              </button>
              <button
                class="btn btn-secondary"
                style="width: auto; padding: 10px 30px; margin: 5px"
                onclick="makeDecision(false)"
              >
                ìœ ì§€í•˜ê¸°
              </button>
            </div>
          </div>
          <div class="stats-grid">
            <div class="stat-card">
              <h3>ì´ ì‹œë®¬ë ˆì´ì…˜</h3>
              <div class="value neutral" id="totalSims">0</div>
            </div>
            <div class="stat-card">
              <h3>í‰ê·  ì†ìµ</h3>
              <div class="value neutral" id="avgGain">$0</div>
            </div>
            <div class="stat-card">
              <h3>ìŠ¹ë¥  (ì´ë“ ë¹„ìœ¨)</h3>
              <div class="value neutral" id="winRate">0%</div>
            </div>
          </div>
          <div class="chart-container">
            <h3>ğŸ“ˆ ëˆ„ì  í‰ê·  ì†ìµ ì¶”ì´</h3>
            <div class="chart-wrapper">
              <canvas id="gainChart"></canvas>
            </div>
          </div>
          <div
            class="comparison-results"
            id="comparisonSection"
            style="display: none"
          >
            <h3>ğŸ“Š ì „ëµ ë¹„êµ ê²°ê³¼</h3>
            <div class="comparison-grid">
              <div class="comparison-card never-switch">
                <h4>ğŸ”’ ì ˆëŒ€ ë°”ê¾¸ì§€ ì•Šê¸°</h4>
                <div class="comparison-stat">
                  <div class="label">í‰ê·  ì†ìµ</div>
                  <div class="value" id="neverAvg">$0</div>
                </div>
                <div class="comparison-stat">
                  <div class="label">í‘œì¤€í¸ì°¨</div>
                  <div class="value" id="neverStd">$0</div>
                </div>
                <div class="comparison-stat">
                  <div class="label">ìµœëŒ€ ì†ì‹¤</div>
                  <div class="value" id="neverMin">$0</div>
                </div>
              </div>
              <div class="comparison-card always-switch">
                <h4>ğŸ”„ í•­ìƒ ë°”ê¾¸ê¸°</h4>
                <div class="comparison-stat">
                  <div class="label">í‰ê·  ì†ìµ</div>
                  <div class="value" id="alwaysAvg">$0</div>
                </div>
                <div class="comparison-stat">
                  <div class="label">í‘œì¤€í¸ì°¨</div>
                  <div class="value" id="alwaysStd">$0</div>
                </div>
                <div class="comparison-stat">
                  <div class="label">ìµœëŒ€ ì†ì‹¤</div>
                  <div class="value" id="alwaysMin">$0</div>
                </div>
              </div>
              <div class="comparison-card threshold">
                <h4>ğŸ“ ì„ê³„ê°’ ì „ëµ</h4>
                <div class="comparison-stat">
                  <div class="label">í‰ê·  ì†ìµ</div>
                  <div class="value" id="thresholdAvg">$0</div>
                </div>
                <div class="comparison-stat">
                  <div class="label">í‘œì¤€í¸ì°¨</div>
                  <div class="value" id="thresholdStd">$0</div>
                </div>
                <div class="comparison-stat">
                  <div class="label">ìµœëŒ€ ì†ì‹¤</div>
                  <div class="value" id="thresholdMin">$0</div>
                </div>
              </div>
            </div>
            <div class="insight-box">
              <h4>ğŸ’¡ ë¶„ì„ ì¸ì‚¬ì´íŠ¸</h4>
              <p id="insightText">
                ì‹œë®¬ë ˆì´ì…˜ì„ ì‹¤í–‰í•˜ë©´ ë¶„ì„ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œëœë‹¤.
              </p>
            </div>
          </div>
          <div class="log-container">
            <h3>ğŸ“‹ ì‹œë®¬ë ˆì´ì…˜ ë¡œê·¸ (ìµœê·¼ 100ê°œ)</h3>
            <div class="log-content" id="logContent">
              <div class="log-entry neutral">ì‹œë®¬ë ˆì´ì…˜ì„ ì‹œì‘í•˜ì„¸ìš”...</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>
      // ì°¨íŠ¸ ì´ˆê¸°í™”
      let gainChart;
      const ctx = document.getElementById("gainChart").getContext("2d");
      function initChart() {
        if (gainChart) gainChart.destroy();
        gainChart = new Chart(ctx, {
          type: "line",
          data: {
            labels: [],
            datasets: [
              {
                label: "ëˆ„ì  í‰ê·  ì†ìµ",
                data: [],
                borderColor: "#e94560",
                backgroundColor: "rgba(233, 69, 96, 0.1)",
                fill: true,
                tension: 0.4,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                labels: { color: "#fff" },
              },
            },
            scales: {
              x: {
                ticks: { color: "#888" },
                grid: { color: "rgba(255,255,255,0.1)" },
              },
              y: {
                ticks: { color: "#888" },
                grid: { color: "rgba(255,255,255,0.1)" },
              },
            },
          },
        });
      }
      initChart();
      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
      document.querySelectorAll(".strategy-option").forEach((option) => {
        option.addEventListener("click", function () {
          document
            .querySelectorAll(".strategy-option")
            .forEach((o) => o.classList.remove("active"));
          this.classList.add("active");
          this.querySelector("input").checked = true;
          const strategy = this.dataset.strategy;
          document.getElementById("thresholdSection").style.display =
            strategy === "threshold" ? "block" : "none";
        });
      });
      document.getElementById("maxK").addEventListener("input", function () {
        const k = parseInt(this.value);
        document.getElementById("maxKValue").textContent = k;
        document.getElementById("maxAmount").textContent = Math.pow(
          2,
          k
        ).toLocaleString();
      });
      // ê¸ˆì•¡ ìƒì„± í•¨ìˆ˜ (ì—­ì„¤ì  ë¶„í¬: P(X = 2^k) = 1/2^k)
      function generateAmount(maxK) {
        const r = Math.random();
        let cumProb = 0;
        for (let k = 1; k <= maxK; k++) {
          cumProb += Math.pow(0.5, k);
          if (r < cumProb) {
            return Math.pow(2, k);
          }
        }
        return Math.pow(2, maxK);
      }
      // ë‹¨ì¼ ê²Œì„ ì‹¤í–‰
      function runSingleGame(strategy, threshold = 10000, maxK = 30) {
        const smallAmount = generateAmount(maxK);
        const largeAmount = smallAmount * 2;
        // ë‘ ë´‰íˆ¬ì— ë¬´ì‘ìœ„ë¡œ ë°°ì •
        const envelopes =
          Math.random() < 0.5
            ? [smallAmount, largeAmount]
            : [largeAmount, smallAmount];
        // í”Œë ˆì´ì–´ê°€ ì²« ë²ˆì§¸ ë´‰íˆ¬ ì„ íƒ (ë¬´ì‘ìœ„)
        const chosen = Math.random() < 0.5 ? 0 : 1;
        const myAmount = envelopes[chosen];
        const otherAmount = envelopes[1 - chosen];
        let finalAmount;
        let switched = false;
        switch (strategy) {
          case "never":
            finalAmount = myAmount;
            break;
          case "always":
            finalAmount = otherAmount;
            switched = true;
            break;
          case "threshold":
            if (myAmount <= threshold) {
              finalAmount = otherAmount;
              switched = true;
            } else {
              finalAmount = myAmount;
            }
            break;
        }
        const gain = finalAmount - myAmount;
        return {
          smallAmount,
          largeAmount,
          myAmount,
          otherAmount,
          finalAmount,
          gain,
          switched,
          hadSmaller: myAmount === smallAmount,
        };
      }
      // ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰
      async function runSimulation() {
        const simCount = parseInt(document.getElementById("simCount").value);
        const maxK = parseInt(document.getElementById("maxK").value);
        const strategy = document.querySelector(
          'input[name="strategy"]:checked'
        ).value;
        const threshold = parseInt(document.getElementById("threshold").value);
        const progressBar = document.getElementById("progressBar");
        const progressFill = document.getElementById("progressFill");
        progressBar.style.display = "block";
        const results = [];
        const logContent = document.getElementById("logContent");
        logContent.innerHTML = "";
        initChart();
        const labels = [];
        const data = [];
        let totalGain = 0;
        let wins = 0;
        const batchSize = 100;
        const sampleInterval = Math.max(1, Math.floor(simCount / 100));
        for (let i = 0; i < simCount; i++) {
          const result = runSingleGame(strategy, threshold, maxK);
          results.push(result);
          totalGain += result.gain;
          if (result.gain > 0) wins++;
          // ì°¨íŠ¸ ë°ì´í„° ìƒ˜í”Œë§
          if (i % sampleInterval === 0 || i === simCount - 1) {
            labels.push(i + 1);
            data.push(totalGain / (i + 1));
          }
          // ë¡œê·¸ ì¶”ê°€ (ìµœê·¼ 100ê°œë§Œ)
          if (i >= simCount - 100) {
            const logClass =
              result.gain > 0 ? "gain" : result.gain < 0 ? "loss" : "neutral";
            const switchText = result.switched ? "êµí™˜" : "ìœ ì§€";
            const hadText = result.hadSmaller ? "(ì‘ì€ê°’ ë³´ìœ )" : "(í°ê°’ ë³´ìœ )";
            logContent.innerHTML += `
<div class="log-entry ${logClass}">
[${
              i + 1
            }] ë³´ìœ : $${result.myAmount.toLocaleString()} ${hadText} â†’ ${switchText} â†’
ìµœì¢…: $${result.finalAmount.toLocaleString()}
(ì†ìµ: ${result.gain >= 0 ? "+" : ""}$${result.gain.toLocaleString()})
</div>
`;
          }
          // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
          if (i % batchSize === 0) {
            progressFill.style.width = (i / simCount) * 100 + "%";
            await new Promise((r) => setTimeout(r, 0));
          }
        }
        progressFill.style.width = "100%";
        // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        gainChart.data.labels = labels;
        gainChart.data.datasets[0].data = data;
        gainChart.update();
        // í†µê³„ ì—…ë°ì´íŠ¸
        const avgGain = totalGain / simCount;
        const winRate = (wins / simCount) * 100;
        document.getElementById("totalSims").textContent =
          simCount.toLocaleString();
        const avgGainEl = document.getElementById("avgGain");
        avgGainEl.textContent =
          (avgGain >= 0 ? "+" : "") + "$" + avgGain.toFixed(2).toLocaleString();
        avgGainEl.className =
          "value " +
          (avgGain > 0 ? "positive" : avgGain < 0 ? "negative" : "neutral");
        const winRateEl = document.getElementById("winRate");
        winRateEl.textContent = winRate.toFixed(2) + "%";
        winRateEl.className =
          "value " +
          (winRate > 50 ? "positive" : winRate < 50 ? "negative" : "neutral");
        setTimeout(() => (progressBar.style.display = "none"), 500);
      }
      // 3ê°€ì§€ ì „ëµ ë¹„êµ
      async function runComparison() {
        const simCount = parseInt(document.getElementById("simCount").value);
        const maxK = parseInt(document.getElementById("maxK").value);
        const threshold = parseInt(document.getElementById("threshold").value);
        const progressBar = document.getElementById("progressBar");
        const progressFill = document.getElementById("progressFill");
        progressBar.style.display = "block";
        const strategies = ["never", "always", "threshold"];
        const results = {
          never: { gains: [], total: 0 },
          always: { gains: [], total: 0 },
          threshold: { gains: [], total: 0 },
        };
        initChart();
        const chartData = {
          never: [],
          always: [],
          threshold: [],
        };
        const labels = [];
        const sampleInterval = Math.max(1, Math.floor(simCount / 100));
        for (let i = 0; i < simCount; i++) {
          // ë™ì¼í•œ ë´‰íˆ¬ ì„¤ì •ìœ¼ë¡œ 3ê°€ì§€ ì „ëµ ë¹„êµ
          const smallAmount = generateAmount(maxK);
          const largeAmount = smallAmount * 2;
          const envelopes =
            Math.random() < 0.5
              ? [smallAmount, largeAmount]
              : [largeAmount, smallAmount];
          const chosen = Math.random() < 0.5 ? 0 : 1;
          const myAmount = envelopes[chosen];
          const otherAmount = envelopes[1 - chosen];
          // ê° ì „ëµë³„ ê²°ê³¼
          strategies.forEach((strategy) => {
            let finalAmount;
            switch (strategy) {
              case "never":
                finalAmount = myAmount;
                break;
              case "always":
                finalAmount = otherAmount;
                break;
              case "threshold":
                finalAmount = myAmount <= threshold ? otherAmount : myAmount;
                break;
            }
            const gain = finalAmount - myAmount;
            results[strategy].gains.push(gain);
            results[strategy].total += gain;
          });
          if (i % sampleInterval === 0 || i === simCount - 1) {
            labels.push(i + 1);
            strategies.forEach((s) => {
              chartData[s].push(results[s].total / (i + 1));
            });
          }
          if (i % 100 === 0) {
            progressFill.style.width = (i / simCount) * 100 + "%";
            await new Promise((r) => setTimeout(r, 0));
          }
        }
        progressFill.style.width = "100%";
        // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        gainChart.data.labels = labels;
        gainChart.data.datasets = [
          {
            label: "ì ˆëŒ€ ë°”ê¾¸ì§€ ì•Šê¸°",
            data: chartData.never,
            borderColor: "#3498db",
            backgroundColor: "rgba(52, 152, 219, 0.1)",
            fill: false,
            tension: 0.4,
          },
          {
            label: "í•­ìƒ ë°”ê¾¸ê¸°",
            data: chartData.always,
            borderColor: "#e74c3c",
            backgroundColor: "rgba(231, 76, 60, 0.1)",
            fill: false,
            tension: 0.4,
          },
          {
            label: "ì„ê³„ê°’ ì „ëµ",
            data: chartData.threshold,
            borderColor: "#2ecc71",
            backgroundColor: "rgba(46, 204, 113, 0.1)",
            fill: false,
            tension: 0.4,
          },
        ];
        gainChart.update();
        // í†µê³„ ê³„ì‚°
        function calcStats(gains) {
          const avg = gains.reduce((a, b) => a + b, 0) / gains.length;
          const variance =
            gains.reduce((a, b) => a + Math.pow(b - avg, 2), 0) / gains.length;
          const std = Math.sqrt(variance);
          const min = Math.min(...gains);
          const max = Math.max(...gains);
          return { avg, std, min, max };
        }
        const stats = {
          never: calcStats(results.never.gains),
          always: calcStats(results.always.gains),
          threshold: calcStats(results.threshold.gains),
        };
        // ê²°ê³¼ í‘œì‹œ
        document.getElementById("comparisonSection").style.display = "block";
        function formatMoney(val) {
          return (
            (val >= 0 ? "+" : "") +
            "$" +
            val.toFixed(0).replace(/\\B(?=(\\d{3})+(?!\\d))/g, ",")
          );
        }
        document.getElementById("neverAvg").textContent = formatMoney(
          stats.never.avg
        );
        document.getElementById("neverStd").textContent =
          "$" +
          stats.never.std.toFixed(0).replace(/\\B(?=(\\d{3})+(?!\\d))/g, ",");
        document.getElementById("neverMin").textContent = formatMoney(
          stats.never.min
        );
        document.getElementById("alwaysAvg").textContent = formatMoney(
          stats.always.avg
        );
        document.getElementById("alwaysStd").textContent =
          "$" +
          stats.always.std.toFixed(0).replace(/\\B(?=(\\d{3})+(?!\\d))/g, ",");
        document.getElementById("alwaysMin").textContent = formatMoney(
          stats.always.min
        );
        document.getElementById("thresholdAvg").textContent = formatMoney(
          stats.threshold.avg
        );
        document.getElementById("thresholdStd").textContent =
          "$" +
          stats.threshold.std
            .toFixed(0)
            .replace(/\\B(?=(\\d{3})+(?!\\d))/g, ",");
        document.getElementById("thresholdMin").textContent = formatMoney(
          stats.threshold.min
        );
        // ì¸ì‚¬ì´íŠ¸ ìƒì„±
        let insight = "";
        if (Math.abs(stats.always.std) > Math.abs(stats.threshold.std) * 2) {
          insight += `<strong>í•µì‹¬ ë°œê²¬:</strong> 'í•­ìƒ ë°”ê¾¸ê¸°' ì „ëµì˜ í‘œì¤€í¸ì°¨($${stats.always.std.toFixed(
            0
          )})ê°€
ì„ê³„ê°’ ì „ëµ($${stats.threshold.std.toFixed(0)})ë³´ë‹¤ ${(
            stats.always.std / stats.threshold.std
          ).toFixed(1)}ë°° ë†’ë‹¤.
ì´ëŠ” ë…¼ë¬¸ì—ì„œ ì§€ì í•œ "ìˆ˜ë ´í•˜ì§€ ì•ŠëŠ” ê±°ëŒ€í•œ ë„ë°•"ì˜ íŠ¹ì„±ì„ ë³´ì—¬ì¤€ë‹¤.<br><br>`;
        }
        if (stats.threshold.avg > 0) {
          insight += `<strong>ì„ê³„ê°’ ì „ëµì˜ ìš°ìœ„:</strong> ì„ê³„ê°’(M=${threshold.toLocaleString()}) ì „ëµì€
í‰ê·  ${formatMoney(stats.threshold.avg)}ì˜ ì–‘ì˜ ìˆ˜ìµì„ ê¸°ë¡í–ˆë‹¤.
"ì´ ì •ë„ë©´ ì¶©ë¶„í•´"ë¼ëŠ” ê¸°ì¤€ì„ ê°€ì§€ê³  ê·¸ë³´ë‹¤ ì ì„ ë•Œë§Œ ë°”ê¾¸ëŠ” ê²ƒì´ í™•ì‹¤í•˜ê²Œ ìŠ¹ë¥ ì„ ë†’ì´ëŠ” ì „ëµì´ë‹¤.`;
        }
        if (stats.always.min < stats.threshold.min) {
          insight += `<br><br><strong>ìœ„í—˜ ê´€ë¦¬:</strong> 'í•­ìƒ ë°”ê¾¸ê¸°'ì˜ ìµœëŒ€ ì†ì‹¤(${formatMoney(
            stats.always.min
          )})ì´
ì„ê³„ê°’ ì „ëµ(${formatMoney(stats.threshold.min)})ë³´ë‹¤ í›¨ì”¬ í¬ë‹¤.
ì„ê³„ê°’ ì „ëµì€ í° ê¸ˆì•¡ì¼ ë•Œ êµí™˜í•˜ì§€ ì•ŠìŒìœ¼ë¡œì¨ í•˜ë°© ìœ„í—˜ì„ íš¨ê³¼ì ìœ¼ë¡œ ì œê±°í•œë‹¤.`;
        }
        document.getElementById("insightText").innerHTML =
          insight || "ì‹œë®¬ë ˆì´ì…˜ íšŸìˆ˜ë¥¼ ëŠ˜ë ¤ì„œ ë” ëª…í™•í•œ íŒ¨í„´ì„ í™•ì¸í•´ë³´ì„¸ìš”.";
        setTimeout(() => (progressBar.style.display = "none"), 500);
      }
      // ë‹¨ì¼ ê²Œì„ ì²´í—˜ ë³€ìˆ˜
      let currentGame = null;
      let selectedEnvelope = null;
      function playSingleGame() {
        const maxK = parseInt(document.getElementById("maxK").value);
        const smallAmount = generateAmount(maxK);
        const largeAmount = smallAmount * 2;
        currentGame = {
          envelopes:
            Math.random() < 0.5
              ? [smallAmount, largeAmount]
              : [largeAmount, smallAmount],
          revealed: false,
        };
        selectedEnvelope = null;
        document.getElementById("envelope1").textContent = "ë´‰íˆ¬ A";
        document.getElementById("envelope2").textContent = "ë´‰íˆ¬ B";
        document.getElementById("envelope1").className = "envelope";
        document.getElementById("envelope2").className = "envelope";
        document.getElementById("gameMessage").innerHTML =
          "ğŸ‘† ë´‰íˆ¬ë¥¼ ì„ íƒí•˜ì„¸ìš”!";
        document.getElementById("gameActions").style.display = "none";
      }
      function selectEnvelope(num) {
        if (!currentGame || currentGame.revealed) return;
        selectedEnvelope = num - 1;
        document.getElementById("envelope1").className =
          "envelope" + (num === 1 ? " selected" : "");
        document.getElementById("envelope2").className =
          "envelope" + (num === 2 ? " selected" : "");
        const myAmount = currentGame.envelopes[selectedEnvelope];
        document.getElementById("envelope" + num).textContent =
          "$" + myAmount.toLocaleString();
        document.getElementById("envelope" + num).classList.add("revealed");
        document.getElementById(
          "gameMessage"
        ).innerHTML = `ë‹¹ì‹ ì˜ ë´‰íˆ¬ì—ëŠ” <strong>$${myAmount.toLocaleString()}</strong>ì´ ìˆë‹¤.<br>êµí™˜í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;
        document.getElementById("gameActions").style.display = "block";
      }
      function makeDecision(doSwitch) {
        if (!currentGame || selectedEnvelope === null) return;
        currentGame.revealed = true;
        const myAmount = currentGame.envelopes[selectedEnvelope];
        const otherAmount = currentGame.envelopes[1 - selectedEnvelope];
        const finalAmount = doSwitch ? otherAmount : myAmount;
        const gain = finalAmount - myAmount;
        // ë‹¤ë¥¸ ë´‰íˆ¬ë„ ê³µê°œ
        const otherNum = selectedEnvelope === 0 ? 2 : 1;
        document.getElementById("envelope" + otherNum).textContent =
          "$" + otherAmount.toLocaleString();
        document
          .getElementById("envelope" + otherNum)
          .classList.add("revealed");
        const gainClass =
          gain > 0 ? "positive" : gain < 0 ? "negative" : "neutral";
        const gainText =
          gain >= 0
            ? "+$" + gain.toLocaleString()
            : "-$" + Math.abs(gain).toLocaleString();
        document.getElementById("gameMessage").innerHTML = `
${doSwitch ? "êµí™˜í–ˆë‹¤!" : "ìœ ì§€í–ˆë‹¤!"}<br>
ë‹¤ë¥¸ ë´‰íˆ¬: <strong>$${otherAmount.toLocaleString()}</strong><br>
<span style="color:${
          gain > 0 ? "#2ecc71" : gain < 0 ? "#e74c3c" : "#f39c12"
        };font-size:1.5em;">
ê²°ê³¼: ${gainText}
</span>
`;
        document.getElementById("gameActions").style.display = "none";
      }
      // ì´ˆê¸° ì‹¤í–‰
      playSingleGame();
    </script>
  </body>
</html>