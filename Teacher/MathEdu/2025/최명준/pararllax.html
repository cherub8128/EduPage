<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>VLBI ì—°ì£¼ ì‹œì°¨ ì¸¡ì • ì‹œë®¬ë ˆì´ì…˜</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(
          135deg,
          #0a0a2e 0%,
          #1a1a4e 50%,
          #0d0d3d 100%
        );
        min-height: 100vh;
        color: #e0e0ff;
        overflow-x: hidden;
      }
      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
      }
      header {
        text-align: center;
        padding: 30px 0;
        border-bottom: 2px solid rgba(100, 150, 255, 0.3);
        margin-bottom: 30px;
      }
      header h1 {
        font-size: 2.2em;
        background: linear-gradient(90deg, #6af, #f6a);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 10px;
      }
      header p {
        color: #8899cc;
        font-size: 1.1em;
      }
      .tabs {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 20px;
        justify-content: center;
      }
      .tab-btn {
        padding: 12px 24px;
        background: rgba(50, 80, 150, 0.3);
        border: 1px solid rgba(100, 150, 255, 0.3);
        color: #aaccff;
        cursor: pointer;
        border-radius: 8px;
        transition: all 0.3s;
        font-size: 0.95em;
      }
      .tab-btn:hover {
        background: rgba(80, 120, 200, 0.4);
        transform: translateY(-2px);
      }
      .tab-btn.active {
        background: linear-gradient(135deg, #3366cc, #6633cc);
        color: white;
        border-color: #66aaff;
        box-shadow: 0 4px 20px rgba(100, 150, 255, 0.3);
      }
      .simulation-panel {
        display: none;
        background: rgba(20, 30, 60, 0.8);
        border-radius: 16px;
        padding: 30px;
        border: 1px solid rgba(100, 150, 255, 0.2);
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
      }
      .simulation-panel.active {
        display: block;
        animation: fadeIn 0.5s ease;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .panel-title {
        font-size: 1.5em;
        color: #88ccff;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .panel-title::before {
        content: "";
        width: 4px;
        height: 30px;
        background: linear-gradient(180deg, #6af, #f6a);
        border-radius: 2px;
      }
      canvas {
        display: block;
        margin: 0 auto;
        border-radius: 12px;
        background: radial-gradient(
          ellipse at center,
          #0a0a1a 0%,
          #000010 100%
        );
        box-shadow: inset 0 0 50px rgba(0, 50, 100, 0.3);
      }
      .controls {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        margin-top: 20px;
        padding: 20px;
        background: rgba(30, 40, 80, 0.5);
        border-radius: 12px;
      }
      .control-group {
        flex: 1;
        min-width: 200px;
      }
      .control-group label {
        display: block;
        color: #aabbdd;
        margin-bottom: 8px;
        font-size: 0.9em;
      }
      .control-group input[type="range"] {
        width: 100%;
        height: 6px;
        border-radius: 3px;
        background: rgba(100, 150, 255, 0.2);
        outline: none;
        -webkit-appearance: none;
      }
      .control-group input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: linear-gradient(135deg, #6af, #a6f);
        cursor: pointer;
        box-shadow: 0 2px 10px rgba(100, 150, 255, 0.5);
      }
      .btn {
        padding: 12px 28px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1em;
        transition: all 0.3s;
        margin: 5px;
      }
      .btn-primary {
        background: linear-gradient(135deg, #3366cc, #6633cc);
        color: white;
      }
      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(100, 100, 255, 0.4);
      }
      .btn-secondary {
        background: rgba(80, 100, 150, 0.5);
        color: #aaccff;
        border: 1px solid rgba(100, 150, 255, 0.3);
      }
      .info-box {
        background: rgba(40, 60, 100, 0.4);
        border-left: 4px solid #6af;
        padding: 15px 20px;
        margin: 20px 0;
        border-radius: 0 8px 8px 0;
      }
      .info-box h4 {
        color: #88ccff;
        margin-bottom: 8px;
      }
      .info-box p {
        color: #aabbcc;
        line-height: 1.6;
        font-size: 0.95em;
      }
      .data-display {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 15px;
        margin-top: 20px;
      }
      .data-card {
        background: linear-gradient(
          135deg,
          rgba(40, 60, 120, 0.6),
          rgba(60, 40, 120, 0.6)
        );
        padding: 15px;
        border-radius: 10px;
        text-align: center;
        border: 1px solid rgba(100, 150, 255, 0.2);
      }
      .data-card .value {
        font-size: 1.8em;
        color: #6af;
        font-weight: bold;
      }
      .data-card .label {
        font-size: 0.85em;
        color: #8899bb;
        margin-top: 5px;
      }
      .legend {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        margin-top: 15px;
        justify-content: center;
      }
      .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.9em;
        color: #aabbcc;
      }
      .legend-color {
        width: 16px;
        height: 16px;
        border-radius: 50%;
      }
      .timeline {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 20px;
        background: rgba(30, 40, 70, 0.5);
        border-radius: 10px;
        margin: 20px 0;
        overflow-x: auto;
      }
      .timeline-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 10px;
        min-width: 80px;
      }
      .timeline-dot {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #4466aa;
        margin-bottom: 10px;
        transition: all 0.3s;
      }
      .timeline-dot.active {
        background: #6af;
        box-shadow: 0 0 15px rgba(100, 170, 255, 0.8);
        transform: scale(1.3);
      }
      .timeline-label {
        font-size: 0.8em;
        color: #8899bb;
        text-align: center;
      }
      .phase-display {
        font-family: monospace;
        font-size: 1.2em;
        color: #6f6;
        background: rgba(0, 50, 0, 0.3);
        padding: 10px 20px;
        border-radius: 8px;
        display: inline-block;
      }
      .warning {
        background: rgba(200, 100, 50, 0.2);
        border-left-color: #f80;
      }
      .grid-layout {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
      }
      @media (max-width: 900px) {
        .grid-layout {
          grid-template-columns: 1fr;
        }
      }
      .observation-sequence {
        display: flex;
        gap: 5px;
        flex-wrap: wrap;
        justify-content: center;
        margin: 15px 0;
      }
      .seq-block {
        padding: 8px 15px;
        border-radius: 5px;
        font-weight: bold;
        font-size: 0.9em;
      }
      .seq-c {
        background: linear-gradient(135deg, #446, #668);
        color: #aaf;
      }
      .seq-t {
        background: linear-gradient(135deg, #664, #886);
        color: #ffa;
      }
      .seq-active {
        box-shadow: 0 0 15px rgba(255, 255, 100, 0.5);
        transform: scale(1.1);
      }
      footer {
        text-align: center;
        padding: 30px;
        margin-top: 40px;
        border-top: 1px solid rgba(100, 150, 255, 0.2);
        color: #667799;
      }
      .formula {
        font-family: "Times New Roman", serif;
        font-style: italic;
        background: rgba(50, 70, 120, 0.4);
        padding: 15px 25px;
        border-radius: 8px;
        display: inline-block;
        margin: 10px 0;
        font-size: 1.1em;
      }
      .sub {
        vertical-align: sub;
        font-size: 0.8em;
      }
      .sup {
        vertical-align: super;
        font-size: 0.8em;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>ğŸ”­ VLBI ì—°ì£¼ ì‹œì°¨ ë° ê³ ìœ  ìš´ë™ ì¸¡ì • ì‹œë®¬ë ˆì´ì…˜</h1>
        <p>ì´ˆì¥ê¸°ì„  ê°„ì„­ê³„ë¥¼ ì´ìš©í•œ ì •ë°€ ì²œë¬¸í•™ ê¸°ìˆ </p>
      </header>
      <div class="tabs">
        <button class="tab-btn active" onclick="showPanel('parallax')">
          ğŸ“ ì—°ì£¼ ì‹œì°¨
        </button>
        <button class="tab-btn" onclick="showPanel('vlbi')">
          ğŸ“¡ VLBI ê¸°ì„ 
        </button>
        <button class="tab-btn" onclick="showPanel('phase')">
          ğŸ”„ ìœ„ìƒ ì°¸ì¡°
        </button>
        <button class="tab-btn" onclick="showPanel('multiview')">
          ğŸ¯ MultiView
        </button>
        <button class="tab-btn" onclick="showPanel('wrapping')">
          âš ï¸ ìœ„ìƒ ë©í•‘
        </button>
        <button class="tab-btn" onclick="showPanel('schedule')">
          ğŸ“… ê´€ì¸¡ ìŠ¤ì¼€ì¤„
        </button>
      </div>
      <!-- ì—°ì£¼ ì‹œì°¨ íŒ¨ë„ -->
      <div id="parallax" class="simulation-panel active">
        <div class="panel-title">ì—°ì£¼ ì‹œì°¨ (Parallax) ì›ë¦¬</div>
        <div class="info-box">
          <h4>ğŸ’¡ ì—°ì£¼ ì‹œì°¨ë€?</h4>
          <p>
            ì§€êµ¬ê°€ íƒœì–‘ ì£¼ìœ„ë¥¼ ê³µì „í•˜ë©´ì„œ, ê°€ê¹Œìš´ ë³„ì´ ë¨¼ ë°°ê²½ ë³„(í€˜ì´ì‚¬)ì— ëŒ€í•´
            ìƒëŒ€ì ìœ¼ë¡œ ì›€ì§ì´ëŠ” ê²ƒì²˜ëŸ¼ ë³´ì´ëŠ” í˜„ìƒì…ë‹ˆë‹¤. ì´ ê²‰ë³´ê¸° ìš´ë™ì˜
            í¬ê¸°ë¥¼ ì¸¡ì •í•˜ë©´ ë³„ê¹Œì§€ì˜ ê±°ë¦¬ë¥¼ ê³„ì‚°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
          </p>
        </div>
        <canvas id="parallaxCanvas" width="900" height="500"></canvas>
        <div class="controls">
          <div class="control-group">
            <label>ì‹œê°„ ì†ë„: <span id="speedValue">1</span>x</label>
            <input
              type="range"
              id="speedSlider"
              min="0.1"
              max="5"
              step="0.1"
              value="1"
            />
          </div>
          <div class="control-group">
            <label>ë³„ê¹Œì§€ ê±°ë¦¬: <span id="distValue">100</span> pc</label>
            <input
              type="range"
              id="distSlider"
              min="50"
              max="500"
              step="10"
              value="100"
            />
          </div>
          <div class="control-group">
            <label>ê³ ìœ  ìš´ë™: <span id="pmValue">0</span> mas/yr</label>
            <input
              type="range"
              id="pmSlider"
              min="0"
              max="50"
              step="1"
              value="0"
            />
          </div>
          <div style="display: flex; align-items: end">
            <button class="btn btn-primary" onclick="toggleParallax()">
              <span id="playBtn">â¸ ì¼ì‹œì •ì§€</span>
            </button>
            <button class="btn btn-secondary" onclick="resetParallax()">
              ğŸ”„ ì´ˆê¸°í™”
            </button>
          </div>
        </div>
        <div class="data-display">
          <div class="data-card">
            <div class="value" id="parallaxAngle">10.00</div>
            <div class="label">ì—°ì£¼ ì‹œì°¨ (mas)</div>
          </div>
          <div class="data-card">
            <div class="value" id="currentMonth">1ì›”</div>
            <div class="label">í˜„ì¬ ì‹œì </div>
          </div>
          <div class="data-card">
            <div class="value" id="ewDisp">0.00</div>
            <div class="label">ë™ì„œ ë³€ìœ„ (mas)</div>
          </div>
          <div class="data-card">
            <div class="value" id="nsDisp">0.00</div>
            <div class="label">ë‚¨ë¶ ë³€ìœ„ (mas)</div>
          </div>
        </div>
        <div class="legend">
          <div class="legend-item">
            <div class="legend-color" style="background: #ff0"></div>
            <span>íƒœì–‘</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: #4af"></div>
            <span>ì§€êµ¬</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: #f66"></div>
            <span>íƒ€ê²Ÿ ë³„ (ë©”ì´ì €)</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: #aaa"></div>
            <span>ë°°ê²½ í€˜ì´ì‚¬</span>
          </div>
        </div>
      </div>
      <!-- VLBI ê¸°ì„  íŒ¨ë„ -->
      <div id="vlbi" class="simulation-panel">
        <div class="panel-title">VLBI ê¸°ì„  ë° ê°„ì„­ ì›ë¦¬</div>
        <div class="info-box">
          <h4>ğŸ’¡ VLBI (ì´ˆì¥ê¸°ì„  ê°„ì„­ê³„)</h4>
          <p>
            ìˆ˜ì²œ km ë–¨ì–´ì§„ ì—¬ëŸ¬ ì „íŒŒë§ì›ê²½ì„ ì—°ê²°í•˜ì—¬ ë§ˆì¹˜ ì§€êµ¬ í¬ê¸°ì˜ ê±°ëŒ€í•œ
            ë§ì›ê²½ì²˜ëŸ¼ ì‘ë™ì‹œí‚¤ëŠ” ê¸°ìˆ ì…ë‹ˆë‹¤. ë‘ ì•ˆí…Œë‚˜ì— ë„ë‹¬í•˜ëŠ” ì „íŒŒì˜
            ì‹œê°„ì°¨(ì§€ì—°)ë¥¼ ì¸¡ì •í•˜ì—¬ ì²œì²´ì˜ ìœ„ì¹˜ë¥¼ ì •ë°€í•˜ê²Œ ê²°ì •í•©ë‹ˆë‹¤.
          </p>
        </div>
        <canvas id="vlbiCanvas" width="900" height="450"></canvas>
        <div class="controls">
          <div class="control-group">
            <label>ê¸°ì„  ê¸¸ì´: <span id="baselineValue">5000</span> km</label>
            <input
              type="range"
              id="baselineSlider"
              min="1000"
              max="10000"
              step="100"
              value="5000"
            />
          </div>
          <div class="control-group">
            <label>ê´€ì¸¡ ì£¼íŒŒìˆ˜: <span id="freqValue">22</span> GHz</label>
            <input
              type="range"
              id="freqSlider"
              min="1"
              max="43"
              step="1"
              value="22"
            />
          </div>
          <div class="control-group">
            <label>ì²œì²´ ê³ ë„ê°: <span id="elevValue">45</span>Â°</label>
            <input
              type="range"
              id="elevSlider"
              min="10"
              max="90"
              step="1"
              value="45"
            />
          </div>
        </div>
        <div class="data-display">
          <div class="data-card">
            <div class="value" id="resolution">0.9</div>
            <div class="label">ê°ë¶„í•´ëŠ¥ (mas)</div>
          </div>
          <div class="data-card">
            <div class="value" id="geoDelay">16.7</div>
            <div class="label">ê¸°í•˜í•™ì  ì§€ì—° (ms)</div>
          </div>
          <div class="data-card">
            <div class="value" id="wavelength">13.6</div>
            <div class="label">íŒŒì¥ (mm)</div>
          </div>
          <div class="data-card">
            <div class="value" id="fringeRate">-</div>
            <div class="label">ìœ„ìƒ ì •ë°€ë„ (Î¼as)</div>
          </div>
        </div>
        <div class="formula">
          Î¸ = Î» / B â‰ˆ <span id="formulaResult">0.9 mas</span>
        </div>
      </div>
      <!-- ìœ„ìƒ ì°¸ì¡° íŒ¨ë„ -->
      <div id="phase" class="simulation-panel">
        <div class="panel-title">ìœ„ìƒ ì°¸ì¡° (Phase Referencing) ê´€ì¸¡</div>
        <div class="info-box">
          <h4>ğŸ’¡ ìœ„ìƒ ì°¸ì¡° ê¸°ë²•</h4>
          <p>
            íƒ€ê²Ÿ(T)ê³¼ ê·¼ì²˜ êµì • ì²œì²´(C, í€˜ì´ì‚¬)ë¥¼ ë¹ ë¥´ê²Œ ë²ˆê°ˆì•„ ê´€ì¸¡í•©ë‹ˆë‹¤. êµì •
            ì²œì²´ì˜ ìœ„ìƒì„ íƒ€ê²Ÿì— ì „ë‹¬í•˜ì—¬ ëŒ€ê¸° ìš”ë™ìœ¼ë¡œ ì¸í•œ ì˜¤ì°¨ë¥¼ ìƒì‡„í•©ë‹ˆë‹¤.
            ê´€ì¸¡ ì£¼ê¸°ëŠ” ëŒ€ê¸° ê°€ê°„ì„­ ì‹œê°„(coherence time) ì´ë‚´ì—¬ì•¼ í•©ë‹ˆë‹¤.
          </p>
        </div>
        <canvas id="phaseCanvas" width="900" height="400"></canvas>
        <div class="observation-sequence" id="obsSequence">
          <!-- JSë¡œ ìƒì„± -->
        </div>
        <div class="controls">
          <div class="control-group">
            <label>ìŠ¤ìœ„ì¹­ ì£¼ê¸°: <span id="switchValue">40</span>ì´ˆ</label>
            <input
              type="range"
              id="switchSlider"
              min="20"
              max="120"
              step="5"
              value="40"
            />
          </div>
          <div class="control-group">
            <label>íƒ€ê²Ÿ-êµì •ì²´ ê±°ë¦¬: <span id="sepValue">1.0</span>Â°</label>
            <input
              type="range"
              id="sepSlider"
              min="0.1"
              max="3"
              step="0.1"
              value="1.0"
            />
          </div>
          <div class="control-group">
            <label>ëŒ€ê¸° ë‚œë¥˜ ê°•ë„: <span id="turbValue">50</span>%</label>
            <input
              type="range"
              id="turbSlider"
              min="10"
              max="100"
              step="5"
              value="50"
            />
          </div>
          <div style="display: flex; align-items: end">
            <button class="btn btn-primary" onclick="togglePhase()">
              <span id="phasePlayBtn">â–¶ ì‹œì‘</span>
            </button>
          </div>
        </div>
        <div class="data-display">
          <div class="data-card">
            <div class="value" id="coherenceTime">80</div>
            <div class="label">ê°€ê°„ì„­ ì‹œê°„ (ì´ˆ)</div>
          </div>
          <div class="data-card">
            <div class="value" id="phaseRMS">15</div>
            <div class="label">ìœ„ìƒ RMS (Â°)</div>
          </div>
          <div class="data-card">
            <div class="value" id="posError">25</div>
            <div class="label">ìœ„ì¹˜ ì˜¤ì°¨ (Î¼as)</div>
          </div>
          <div class="data-card">
            <div class="value phase-display" id="currentPhase">+0.0Â°</div>
            <div class="label">í˜„ì¬ ìœ„ìƒ</div>
          </div>
        </div>
      </div>
      <!-- MultiView íŒ¨ë„ -->
      <div id="multiview" class="simulation-panel">
        <div class="panel-title">MultiView ê¸°ë²• (ì „ë¦¬ì¸µ ë³´ì •)</div>
        <div class="info-box">
          <h4>ğŸ’¡ MultiView ê¸°ë²•ì´ë€?</h4>
          <p>
            10 GHz ì´í•˜ì˜ ì €ì£¼íŒŒì—ì„œëŠ” ì „ë¦¬ì¸µì— ì˜í•œ ì§€ì—° ì˜¤ì°¨ê°€ ì‹¬ê°í•©ë‹ˆë‹¤.
            íƒ€ê²Ÿ ì£¼ë³€ì˜ ì—¬ëŸ¬ êµì • ì²œì²´(3~4ê°œ)ë¥¼ ê´€ì¸¡í•˜ì—¬ ì „ë¦¬ì¸µ ìœ„ìƒ ë³€í™”ë¥¼
            2ì°¨ì› í‰ë©´(wedge)ìœ¼ë¡œ ëª¨ë¸ë§í•˜ê³  ë³´ì •í•©ë‹ˆë‹¤.
          </p>
        </div>
        <div class="grid-layout">
          <div>
            <canvas id="multiviewCanvas" width="430" height="430"></canvas>
          </div>
          <div>
            <canvas id="ionosphereCanvas" width="430" height="430"></canvas>
          </div>
        </div>
        <div class="controls">
          <div class="control-group">
            <label>ê´€ì¸¡ ì£¼íŒŒìˆ˜: <span id="mvFreqValue">5</span> GHz</label>
            <input
              type="range"
              id="mvFreqSlider"
              min="1"
              max="22"
              step="0.5"
              value="5"
            />
          </div>
          <div class="control-group">
            <label>êµì • ì²œì²´ ìˆ˜: <span id="calNumValue">3</span></label>
            <input
              type="range"
              id="calNumSlider"
              min="1"
              max="5"
              step="1"
              value="3"
            />
          </div>
          <div class="control-group">
            <label>ì „ë¦¬ì¸µ í™œë™: <span id="ionoValue">50</span>%</label>
            <input
              type="range"
              id="ionoSlider"
              min="10"
              max="100"
              step="5"
              value="50"
            />
          </div>
          <div style="display: flex; align-items: end">
            <button class="btn btn-primary" onclick="recalcMultiview()">
              ğŸ”„ ì¬ê³„ì‚°
            </button>
          </div>
        </div>
        <div class="data-display">
          <div class="data-card">
            <div class="value" id="ionoDelay">2.5</div>
            <div class="label">ì „ë¦¬ì¸µ ì§€ì—° (ns)</div>
          </div>
          <div class="data-card">
            <div class="value" id="ionoError">150</div>
            <div class="label">ë³´ì • ì „ ì˜¤ì°¨ (Î¼as)</div>
          </div>
          <div class="data-card">
            <div class="value" id="ionoCorrected">25</div>
            <div class="label">ë³´ì • í›„ ì˜¤ì°¨ (Î¼as)</div>
          </div>
          <div class="data-card">
            <div class="value" id="improvement">6x</div>
            <div class="label">ê°œì„  ë°°ìœ¨</div>
          </div>
        </div>
        <div class="info-box warning">
          <h4>âš ï¸ ì£¼ì˜ì‚¬í•­</h4>
          <p>
            ì „ë¦¬ì¸µ ì§€ì—°ì€ ì£¼íŒŒìˆ˜ì˜ ì œê³±ì— ë°˜ë¹„ë¡€í•©ë‹ˆë‹¤ (âˆ 1/f2). ë”°ë¼ì„œ ì €ì£¼íŒŒ
            ê´€ì¸¡ì—ì„œëŠ” MultiViewê°€ í•„ìˆ˜ì ì…ë‹ˆë‹¤. êµì • ì²œì²´ëŠ” íƒ€ê²Ÿì„ ë‘˜ëŸ¬ì‹¸ë„ë¡
            ë°°ì¹˜í•´ì•¼ ìµœì ì˜ ë³´ì •ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.
          </p>
        </div>
      </div>
      <!-- ìœ„ìƒ ë©í•‘ íŒ¨ë„ -->
      <div id="wrapping" class="simulation-panel">
        <div class="panel-title">ìœ„ìƒ ë©í•‘ (Phase Wrapping) ë¬¸ì œ</div>
        <div class="info-box">
          <h4>ğŸ’¡ ìœ„ìƒ ë©í•‘ì´ë€?</h4>
          <p>
            ìœ„ìƒì€ -180Â°ì—ì„œ +180Â° ì‚¬ì´ë¡œ ì¸¡ì •ë©ë‹ˆë‹¤. ì‹¤ì œ ìœ„ìƒì´ ì´ ë²”ìœ„ë¥¼
            ë„˜ì–´ê°€ë©´ ê°’ì´ "íŠ€ì–´" ë³´ì…ë‹ˆë‹¤. ì˜ˆ: +185Â°ëŠ” -175Â°ë¡œ ê¸°ë¡ë©ë‹ˆë‹¤. ì´
            ë¬¸ì œë¥¼ í•´ê²°í•˜ì§€ ì•Šìœ¼ë©´ ìœ„ì¹˜ ì¸¡ì •ì— ì‹¬ê°í•œ ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤.
          </p>
        </div>
        <canvas id="wrappingCanvas" width="900" height="350"></canvas>
        <div class="controls">
          <div class="control-group">
            <label>ì‹¤ì œ ìœ„ìƒ ë³€í™”: <span id="realPhaseValue">0</span>Â°</label>
            <input
              type="range"
              id="realPhaseSlider"
              min="-540"
              max="540"
              step="5"
              value="0"
            />
          </div>
          <div class="control-group">
            <label
              >ëŒ€ê¸° ë³€ë™ ì†ë„: <span id="atmRateValue">30</span>Â°/min</label
            >
            <input
              type="range"
              id="atmRateSlider"
              min="10"
              max="100"
              step="5"
              value="30"
            />
          </div>
          <div style="display: flex; align-items: end">
            <button class="btn btn-primary" onclick="toggleWrapping()">
              <span id="wrapPlayBtn">â–¶ ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘</span>
            </button>
            <button class="btn btn-secondary" onclick="unwrapPhase()">
              ğŸ”§ ìœ„ìƒ í•´ì œ
            </button>
          </div>
        </div>
        <div class="data-display">
          <div class="data-card">
            <div class="value phase-display" id="realPhase">+0Â°</div>
            <div class="label">ì‹¤ì œ ìœ„ìƒ</div>
          </div>
          <div class="data-card">
            <div class="value phase-display" id="measuredPhase">+0Â°</div>
            <div class="label">ì¸¡ì •ëœ ìœ„ìƒ</div>
          </div>
          <div class="data-card">
            <div class="value" id="wrapCount">0</div>
            <div class="label">ë©í•‘ íšŸìˆ˜</div>
          </div>
          <div class="data-card">
            <div class="value" id="unwrappedPhase">+0Â°</div>
            <div class="label">í•´ì œëœ ìœ„ìƒ</div>
          </div>
        </div>
        <div class="info-box warning">
          <h4>âš ï¸ í•´ê²° ë°©ë²•</h4>
          <p>
            1 ìŠ¤ìœ„ì¹­ ì£¼ê¸°ë¥¼ ì§§ê²Œ í•˜ì—¬ ìœ„ìƒ ë³€í™”ê°€ 180Â°ë¥¼ ë„˜ì§€ ì•Šë„ë¡ í•©ë‹ˆë‹¤.<br />
            2 ì—°ì†ì ì¸ ìœ„ìƒ ë³€í™”ë¥¼ ì¶”ì í•˜ì—¬ ë©í•‘ì„
            "ì–¸ë˜í•‘(unwrapping)"í•©ë‹ˆë‹¤.<br />
            3 MultiViewì—ì„œëŠ” ê° êµì •ì²´ì˜ ìœ„ìƒì„ ì¼ê´€ë˜ê²Œ ì–¸ë˜í•‘í•´ì•¼ í•©ë‹ˆë‹¤.
          </p>
        </div>
      </div>
      <!-- ê´€ì¸¡ ìŠ¤ì¼€ì¤„ íŒ¨ë„ -->
      <div id="schedule" class="simulation-panel">
        <div class="panel-title">ì—°ê°„ ê´€ì¸¡ ìŠ¤ì¼€ì¤„ ì „ëµ</div>
        <div class="info-box">
          <h4>ğŸ’¡ ìµœì ì˜ ê´€ì¸¡ ì „ëµ</h4>
          <p>
            ì—°ì£¼ ì‹œì°¨ë¥¼ ì •ë°€í•˜ê²Œ ì¸¡ì •í•˜ë ¤ë©´ 1ë…„ì— ê±¸ì³ ìµœì†Œ 4íšŒ(ê¶Œì¥ 8íšŒ)
            ê´€ì¸¡í•´ì•¼ í•©ë‹ˆë‹¤. ì§€êµ¬-íƒœì–‘-ì²œì²´ê°€ ì§ê°ì„ ì´ë£° ë•Œ ì‹œì°¨ íš¨ê³¼ê°€
            ìµœëŒ€ì´ë¯€ë¡œ, ì´ ì‹œì ì— ë§ì¶° ê´€ì¸¡í•©ë‹ˆë‹¤.
          </p>
        </div>
        <canvas id="scheduleCanvas" width="900" height="400"></canvas>
        <div class="timeline" id="scheduleTimeline">
          <!-- JSë¡œ ìƒì„± -->
        </div>
        <div class="controls">
          <div class="control-group">
            <label>íƒ€ê²Ÿ ì ê²½ (RA): <span id="raValue">12</span>h</label>
            <input
              type="range"
              id="raSlider"
              min="0"
              max="24"
              step="1"
              value="12"
            />
          </div>
          <div class="control-group">
            <label>íƒ€ê²Ÿ ì ìœ„ (Dec): <span id="decValue">0</span>Â°</label>
            <input
              type="range"
              id="decSlider"
              min="-60"
              max="60"
              step="5"
              value="0"
            />
          </div>
          <div class="control-group">
            <label>ê´€ì¸¡ íšŸìˆ˜: <span id="epochValue">8</span>íšŒ/ë…„</label>
            <input
              type="range"
              id="epochSlider"
              min="4"
              max="12"
              step="1"
              value="8"
            />
          </div>
          <div style="display: flex; align-items: end">
            <button class="btn btn-primary" onclick="animateYear()">
              ğŸ¬ ì—°ê°„ ì‹œë®¬ë ˆì´ì…˜
            </button>
          </div>
        </div>
        <div class="data-display">
          <div class="data-card">
            <div class="value" id="optimalEpochs">3ì›”, 9ì›”</div>
            <div class="label">ìµœì  ê´€ì¸¡ ì‹œê¸°</div>
          </div>
          <div class="data-card">
            <div class="value" id="maxParallax">Â±10.0</div>
            <div class="label">ìµœëŒ€ ì‹œì°¨ ë³€ìœ„ (mas)</div>
          </div>
          <div class="data-card">
            <div class="value" id="parallaxDir">E-W</div>
            <div class="label">ì£¼ìš” ì‹œì°¨ ë°©í–¥</div>
          </div>
          <div class="data-card">
            <div class="value" id="estPrecision">Â±5</div>
            <div class="label">ì˜ˆìƒ ì •ë°€ë„ (Î¼as)</div>
          </div>
        </div>
        <div class="info-box">
          <h4>ğŸ“Š ê´€ì¸¡ ì„¸ì…˜ êµ¬ì„±</h4>
          <p>
            <strong>Fringe Finder:</strong> ê°•í•œ ì „íŒŒì›ìœ¼ë¡œ ì‹œê³„ ì˜¤ì°¨ ë³´ì •
            (~5ë¶„)<br />
            <strong>ì¸¡ì§€ ë¸”ë¡:</strong> ì „ì²œì˜ 12ê°œ êµì •ì²´ë¡œ ëŒ€ë¥˜ê¶Œ ì§€ì—° ëª¨ë¸ë§
            (~30ë¶„)<br />
            <strong>ìœ„ìƒ ì°¸ì¡°:</strong> íƒ€ê²Ÿ-êµì •ì²´ ìŠ¤ìœ„ì¹­ ê´€ì¸¡ (~4ì‹œê°„)
          </p>
        </div>
      </div>
      <footer>
        <p>
          VLBI ì—°ì£¼ ì‹œì°¨ ì¸¡ì • ì‹œë®¬ë ˆì´ì…˜ | Based on "Techniques for Measuring
          Parallax and Proper Motion with VLBI" by Mark J. Reid
        </p>
        <p>BeSSeL Survey & VERA Project ê¸°ìˆ  ê¸°ë°˜</p>
      </footer>
    </div>
    <script>
      // ===== ì „ì—­ ë³€ìˆ˜ =====
      let parallaxRunning = true;
      let phaseRunning = false;
      let wrappingRunning = false;
      let time = 0;
      let phaseTime = 0;
      let wrapTime = 0;
      // ===== íƒ­ ì „í™˜ =====
      function showPanel(panelId) {
        document
          .querySelectorAll(".simulation-panel")
          .forEach((p) => p.classList.remove("active"));
        document
          .querySelectorAll(".tab-btn")
          .forEach((b) => b.classList.remove("active"));
        document.getElementById(panelId).classList.add("active");
        event.target.classList.add("active");
      }
      // ===== ì—°ì£¼ ì‹œì°¨ ì‹œë®¬ë ˆì´ì…˜ =====
      const parallaxCanvas = document.getElementById("parallaxCanvas");
      const pCtx = parallaxCanvas.getContext("2d");
      function drawParallax() {
        const width = parallaxCanvas.width;
        const height = parallaxCanvas.height;
        pCtx.clearRect(0, 0, width, height);
        // ë°°ê²½ ë³„
        pCtx.fillStyle = "#112";
        pCtx.fillRect(0, 0, width, height);
        for (let i = 0; i < 100; i++) {
          pCtx.beginPath();
          pCtx.arc(
            (Math.sin(i * 123.456) * 0.5 + 0.5) * width,
            (Math.cos(i * 654.321) * 0.5 + 0.5) * height,
            Math.random() * 1.5,
            0,
            Math.PI * 2
          );
          pCtx.fillStyle = `rgba(200, 200, 255, ${Math.random() * 0.5 + 0.2})`;
          pCtx.fill();
        }
        const speed = parseFloat(document.getElementById("speedSlider").value);
        const dist = parseFloat(document.getElementById("distSlider").value);
        const pm = parseFloat(document.getElementById("pmSlider").value);
        // ì™¼ìª½: íƒœì–‘ê³„ ë·°
        const solarCx = 180;
        const solarCy = 250;
        const earthOrbit = 80;
        // íƒœì–‘
        pCtx.beginPath();
        const sunGrad = pCtx.createRadialGradient(
          solarCx,
          solarCy,
          0,
          solarCx,
          solarCy,
          25
        );
        sunGrad.addColorStop(0, "#fff");
        sunGrad.addColorStop(0.5, "#ff0");
        sunGrad.addColorStop(1, "#f80");
        pCtx.fillStyle = sunGrad;
        pCtx.arc(solarCx, solarCy, 20, 0, Math.PI * 2);
        pCtx.fill();
        // ì§€êµ¬ ê¶¤ë„
        pCtx.beginPath();
        pCtx.strokeStyle = "rgba(100, 150, 255, 0.3)";
        pCtx.setLineDash([5, 5]);
        pCtx.arc(solarCx, solarCy, earthOrbit, 0, Math.PI * 2);
        pCtx.stroke();
        pCtx.setLineDash([]);
        // ì§€êµ¬ ìœ„ì¹˜
        const earthAngle = time * 0.02;
        const earthX = solarCx + Math.cos(earthAngle) * earthOrbit;
        const earthY = solarCy + Math.sin(earthAngle) * earthOrbit;
        // ì§€êµ¬
        pCtx.beginPath();
        const earthGrad = pCtx.createRadialGradient(
          earthX,
          earthY,
          0,
          earthX,
          earthY,
          12
        );
        earthGrad.addColorStop(0, "#6cf");
        earthGrad.addColorStop(1, "#248");
        pCtx.fillStyle = earthGrad;
        pCtx.arc(earthX, earthY, 10, 0, Math.PI * 2);
        pCtx.fill();
        // ì›” í‘œì‹œ
        const months = [
          "1ì›”",
          "2ì›”",
          "3ì›”",
          "4ì›”",
          "5ì›”",
          "6ì›”",
          "7ì›”",
          "8ì›”",
          "9ì›”",
          "10ì›”",
          "11ì›”",
          "12ì›”",
        ];
        const monthIdx = Math.floor(
          (((earthAngle % (Math.PI * 2)) / (Math.PI * 2)) * 12 + 9) % 12
        );
        document.getElementById("currentMonth").textContent = months[monthIdx];
        // ì˜¤ë¥¸ìª½: ì‹œì°¨ ë‹¤ì´ì–´ê·¸ë¨
        const viewCx = 650;
        const viewCy = 250;
        const parallaxAngle = 1000 / dist; // mas
        const scale = 5; // mas to pixels
        // ë°°ê²½ í€˜ì´ì‚¬ë“¤
        const quasars = [
          { x: viewCx - 80, y: viewCy - 100 },
          { x: viewCx + 100, y: viewCy - 80 },
          { x: viewCx + 60, y: viewCy + 120 },
          { x: viewCx - 100, y: viewCy + 90 },
        ];
        quasars.forEach((q) => {
          pCtx.beginPath();
          pCtx.arc(q.x, q.y, 4, 0, Math.PI * 2);
          pCtx.fillStyle = "#888";
          pCtx.fill();
        });
        // ì‹œì°¨ íƒ€ì› (ì§€êµ¬ ìœ„ì¹˜ì— ë”°ë¥¸ ê²‰ë³´ê¸° ìœ„ì¹˜)
        const ewMax = parallaxAngle * Math.abs(Math.cos(0)); // E-W ì„±ë¶„ (ì€í•˜í‰ë©´ ê°€ì •)
        const nsMax = parallaxAngle * 0.3; // N-S ì„±ë¶„ (ì¤„ì–´ë“¦)
        // ì‹œì°¨ íƒ€ì› ê·¸ë¦¬ê¸°
        pCtx.beginPath();
        pCtx.strokeStyle = "rgba(255, 100, 100, 0.4)";
        pCtx.setLineDash([3, 3]);
        pCtx.ellipse(
          viewCx,
          viewCy,
          ewMax * scale,
          nsMax * scale,
          0,
          0,
          Math.PI * 2
        );
        pCtx.stroke();
        pCtx.setLineDash([]);
        // ê³ ìœ  ìš´ë™ì— ì˜í•œ ì´ë™
        const pmOffset = ((pm * (time * 0.02)) / (Math.PI * 2)) * scale;
        // íƒ€ê²Ÿ ë³„ì˜ í˜„ì¬ ìœ„ì¹˜
        const targetX =
          viewCx + Math.cos(earthAngle) * ewMax * scale + pmOffset;
        const targetY = viewCy + Math.sin(earthAngle) * nsMax * scale;
        // íƒ€ê²Ÿ ë³„
        pCtx.beginPath();
        const starGrad = pCtx.createRadialGradient(
          targetX,
          targetY,
          0,
          targetX,
          targetY,
          12
        );
        starGrad.addColorStop(0, "#fff");
        starGrad.addColorStop(0.3, "#f88");
        starGrad.addColorStop(1, "rgba(255, 100, 100, 0)");
        pCtx.fillStyle = starGrad;
        pCtx.arc(targetX, targetY, 10, 0, Math.PI * 2);
        pCtx.fill();
        // ì‹œì„  ê·¸ë¦¬ê¸°
        pCtx.beginPath();
        pCtx.strokeStyle = "rgba(100, 200, 255, 0.5)";
        pCtx.moveTo(earthX, earthY);
        pCtx.lineTo(
          earthX + (targetX - viewCx) * 0.5,
          earthY + (targetY - viewCy) * 0.3
        );
        pCtx.stroke();
        // ê¶¤ì  í‘œì‹œ
        pCtx.beginPath();
        pCtx.strokeStyle = "rgba(255, 150, 100, 0.6)";
        pCtx.lineWidth = 2;
        for (let a = 0; a <= earthAngle; a += 0.1) {
          const tx =
            viewCx +
            Math.cos(a) * ewMax * scale +
            ((pm * a) / (Math.PI * 2)) * scale;
          const ty = viewCy + Math.sin(a) * nsMax * scale;
          if (a === 0) pCtx.moveTo(tx, ty);
          else pCtx.lineTo(tx, ty);
        }
        pCtx.stroke();
        pCtx.lineWidth = 1;
        // ë°ì´í„° ì—…ë°ì´íŠ¸
        document.getElementById("parallaxAngle").textContent =
          parallaxAngle.toFixed(2);
        document.getElementById("ewDisp").textContent = (
          Math.cos(earthAngle) * ewMax
        ).toFixed(2);
        document.getElementById("nsDisp").textContent = (
          Math.sin(earthAngle) * nsMax
        ).toFixed(2);
        // ë¼ë²¨
        pCtx.font = "14px sans-serif";
        pCtx.fillStyle = "#8af";
        pCtx.fillText("íƒœì–‘ê³„ ë·° (ìœ„ì—ì„œ ë³¸)", 100, 30);
        pCtx.fillText("í•˜ëŠ˜ì—ì„œ ë³¸ ê²‰ë³´ê¸° ì›€ì§ì„", 560, 30);
        // ì¶• í‘œì‹œ
        pCtx.fillStyle = "#666";
        pCtx.fillText("E", viewCx + 180, viewCy + 5);
        pCtx.fillText("W", viewCx - 190, viewCy + 5);
        pCtx.fillText("N", viewCx - 5, viewCy - 180);
        pCtx.fillText("S", viewCx - 5, viewCy + 195);
        if (parallaxRunning) {
          time += speed;
        }
        requestAnimationFrame(drawParallax);
      }
      function toggleParallax() {
        parallaxRunning = !parallaxRunning;
        document.getElementById("playBtn").textContent = parallaxRunning
          ? "â¸ ì¼ì‹œì •ì§€"
          : "â–¶ ì¬ìƒ";
      }
      function resetParallax() {
        time = 0;
      }
      // ìŠ¬ë¼ì´ë” ì´ë²¤íŠ¸
      document.getElementById("speedSlider").oninput = function () {
        document.getElementById("speedValue").textContent = this.value;
      };
      document.getElementById("distSlider").oninput = function () {
        document.getElementById("distValue").textContent = this.value;
      };
      document.getElementById("pmSlider").oninput = function () {
        document.getElementById("pmValue").textContent = this.value;
      };
      // ===== VLBI ì‹œë®¬ë ˆì´ì…˜ =====
      const vlbiCanvas = document.getElementById("vlbiCanvas");
      const vCtx = vlbiCanvas.getContext("2d");
      function drawVLBI() {
        const width = vlbiCanvas.width;
        const height = vlbiCanvas.height;
        vCtx.clearRect(0, 0, width, height);
        const baseline = parseFloat(
          document.getElementById("baselineSlider").value
        );
        const freq = parseFloat(document.getElementById("freqSlider").value);
        const elev = parseFloat(document.getElementById("elevSlider").value);
        // ë°°ê²½
        const skyGrad = vCtx.createLinearGradient(0, 0, 0, height);
        skyGrad.addColorStop(0, "#001");
        skyGrad.addColorStop(0.6, "#112");
        skyGrad.addColorStop(1, "#221");
        vCtx.fillStyle = skyGrad;
        vCtx.fillRect(0, 0, width, height);
        // ì§€êµ¬ ê³¡ì„ 
        vCtx.beginPath();
        vCtx.fillStyle = "#342";
        vCtx.ellipse(width / 2, height + 800, 1200, 900, 0, Math.PI, 0);
        vCtx.fill();
        // ì•ˆí…Œë‚˜ ìœ„ì¹˜
        const ant1X = 200;
        const ant2X = 700;
        const antY = 380;
        // ì•ˆí…Œë‚˜ ê·¸ë¦¬ê¸° í•¨ìˆ˜
        function drawAntenna(x, y, angle) {
          vCtx.save();
          vCtx.translate(x, y);
          // ë°›ì¹¨ëŒ€
          vCtx.fillStyle = "#555";
          vCtx.fillRect(-5, -30, 10, 30);
          // ì ‘ì‹œ
          vCtx.rotate((-angle * Math.PI) / 180 + Math.PI / 2);
          vCtx.beginPath();
          vCtx.fillStyle = "#789";
          vCtx.ellipse(0, -40, 35, 10, 0, 0, Math.PI * 2);
          vCtx.fill();
          vCtx.beginPath();
          vCtx.strokeStyle = "#9ab";
          vCtx.lineWidth = 2;
          vCtx.arc(0, -40, 35, Math.PI * 0.1, Math.PI * 0.9);
          vCtx.stroke();
          // Feed
          vCtx.beginPath();
          vCtx.fillStyle = "#456";
          vCtx.moveTo(-3, -40);
          vCtx.lineTo(0, -70);
          vCtx.lineTo(3, -40);
          vCtx.fill();
          vCtx.restore();
        }
        drawAntenna(ant1X, antY, elev);
        drawAntenna(ant2X, antY, elev);
        // ì²œì²´
        const sourceAngle = (elev * Math.PI) / 180;
        const sourceX = width / 2;
        const sourceY = 50;
        // ì „íŒŒ ì‹ í˜¸ (íŒŒë™)
        const wavePhase = Date.now() / 100;
        vCtx.strokeStyle = "rgba(100, 200, 255, 0.4)";
        vCtx.lineWidth = 2;
        for (let i = 0; i < 3; i++) {
          vCtx.beginPath();
          vCtx.arc(
            sourceX,
            sourceY,
            40 + i * 30 + (wavePhase % 30),
            0.3 * Math.PI,
            0.7 * Math.PI
          );
          vCtx.stroke();
        }
        // ì²œì²´
        vCtx.beginPath();
        const srcGrad = vCtx.createRadialGradient(
          sourceX,
          sourceY,
          0,
          sourceX,
          sourceY,
          15
        );
        srcGrad.addColorStop(0, "#fff");
        srcGrad.addColorStop(0.5, "#f84");
        srcGrad.addColorStop(1, "rgba(255, 100, 50, 0)");
        vCtx.fillStyle = srcGrad;
        vCtx.arc(sourceX, sourceY, 12, 0, Math.PI * 2);
        vCtx.fill();
        // ê¸°ì„  í‘œì‹œ
        vCtx.beginPath();
        vCtx.strokeStyle = "#6af";
        vCtx.setLineDash([10, 5]);
        vCtx.moveTo(ant1X, antY);
        vCtx.lineTo(ant2X, antY);
        vCtx.stroke();
        vCtx.setLineDash([]);
        // ê¸°ì„  ê¸¸ì´ ë¼ë²¨
        vCtx.fillStyle = "#6af";
        vCtx.font = "14px sans-serif";
        vCtx.fillText(
          `B = ${baseline} km`,
          (ant1X + ant2X) / 2 - 40,
          antY + 25
        );
        // ì‹œì„  ê²½ë¡œ
        vCtx.beginPath();
        vCtx.strokeStyle = "rgba(255, 200, 100, 0.3)";
        vCtx.moveTo(sourceX, sourceY);
        vCtx.lineTo(ant1X, antY - 50);
        vCtx.moveTo(sourceX, sourceY);
        vCtx.lineTo(ant2X, antY - 50);
        vCtx.stroke();
        // ì§€ì—° ê²½ë¡œ ì°¨ì´ ì‹œê°í™”
        const pathDiff = baseline * Math.sin(((90 - elev) * Math.PI) / 180);
        vCtx.fillStyle = "#fa6";
        vCtx.fillText(
          `ê²½ë¡œì°¨ â‰ˆ ${pathDiff.toFixed(0)} km`,
          ant2X - 50,
          antY - 70
        );
        // ê³„ì‚°
        const wavelength = 300 / freq; // mm
        const resolution = (206265 * wavelength) / 1000 / (baseline * 1000); // arcsec to mas
        const geoDelay = pathDiff / 299792.458; // ms
        const phasePrecision = ((resolution * 1000) / (2 * Math.PI)) * 0.01; // rough estimate
        document.getElementById("resolution").textContent =
          resolution.toFixed(2);
        document.getElementById("geoDelay").textContent = (
          geoDelay * 1000
        ).toFixed(1);
        document.getElementById("wavelength").textContent =
          wavelength.toFixed(1);
        document.getElementById("fringeRate").textContent =
          phasePrecision.toFixed(0);
        document.getElementById("formulaResult").textContent =
          resolution.toFixed(2) + " mas";
        requestAnimationFrame(drawVLBI);
      }
      document.getElementById("baselineSlider").oninput = function () {
        document.getElementById("baselineValue").textContent = this.value;
      };
      document.getElementById("freqSlider").oninput = function () {
        document.getElementById("freqValue").textContent = this.value;
      };
      document.getElementById("elevSlider").oninput = function () {
        document.getElementById("elevValue").textContent = this.value;
      };
      // ===== ìœ„ìƒ ì°¸ì¡° ì‹œë®¬ë ˆì´ì…˜ =====
      const phaseCanvas = document.getElementById("phaseCanvas");
      const phCtx = phaseCanvas.getContext("2d");
      let phaseData = [];
      let calPhaseData = [];
      let currentObs = 0;
      function initPhaseSequence() {
        const seq = document.getElementById("obsSequence");
        seq.innerHTML = "";
        for (let i = 0; i < 16; i++) {
          const block = document.createElement("div");
          block.className = `seq-block ${i % 2 === 0 ? "seq-c" : "seq-t"}`;
          block.textContent = i % 2 === 0 ? "C" : "T";
          block.id = `obs-${i}`;
          seq.appendChild(block);
        }
      }
      function drawPhase() {
        const width = phaseCanvas.width;
        const height = phaseCanvas.height;
        phCtx.clearRect(0, 0, width, height);
        const switchTime = parseFloat(
          document.getElementById("switchSlider").value
        );
        const separation = parseFloat(
          document.getElementById("sepSlider").value
        );
        const turbulence = parseFloat(
          document.getElementById("turbSlider").value
        );
        // ë°°ê²½
        phCtx.fillStyle = "#0a0a1a";
        phCtx.fillRect(0, 0, width, height);
        // ê·¸ë¦¬ë“œ
        phCtx.strokeStyle = "rgba(100, 150, 200, 0.2)";
        phCtx.beginPath();
        for (let y = 50; y < height - 50; y += 50) {
          phCtx.moveTo(80, y);
          phCtx.lineTo(width - 30, y);
        }
        phCtx.stroke();
        // Yì¶• ë¼ë²¨
        phCtx.fillStyle = "#668";
        phCtx.font = "12px sans-serif";
        phCtx.fillText("180Â°", 40, 55);
        phCtx.fillText("0Â°", 50, height / 2);
        phCtx.fillText("-180Â°", 35, height - 45);
        // ì¶•
        phCtx.strokeStyle = "#446";
        phCtx.beginPath();
        phCtx.moveTo(80, 50);
        phCtx.lineTo(80, height - 50);
        phCtx.lineTo(width - 30, height - 50);
        phCtx.stroke();
        // ë°ì´í„° ìƒì„±/ì—…ë°ì´íŠ¸
        if (phaseRunning && phaseTime % 2 === 0) {
          const atmPhase =
            turbulence * 2 * Math.sin(phaseTime * 0.05) +
            turbulence * Math.sin(phaseTime * 0.13) * 0.5 +
            (Math.random() - 0.5) * turbulence * 0.5;
          const targetPhase =
            atmPhase + separation * 10 * Math.sin(phaseTime * 0.02);
          const calPhase = atmPhase;
          if (phaseData.length > 200) phaseData.shift();
          if (calPhaseData.length > 200) calPhaseData.shift();
          phaseData.push(targetPhase);
          calPhaseData.push(calPhase);
          currentObs = Math.floor(phaseTime / (switchTime / 2)) % 16;
          document.querySelectorAll(".seq-block").forEach((b, i) => {
            b.classList.toggle("seq-active", i === currentObs);
          });
        }
        // êµì •ì²´ ìœ„ìƒ (íŒŒë€ìƒ‰)
        if (calPhaseData.length > 1) {
          phCtx.beginPath();
          phCtx.strokeStyle = "#66f";
          phCtx.lineWidth = 2;
          calPhaseData.forEach((p, i) => {
            const x = 80 + (i * (width - 110)) / 200;
            const y = height / 2 - (p * (height - 100)) / 360;
            if (i === 0) phCtx.moveTo(x, y);
            else phCtx.lineTo(x, y);
          });
          phCtx.stroke();
        }
        // íƒ€ê²Ÿ ìœ„ìƒ (ë…¸ë€ìƒ‰)
        if (phaseData.length > 1) {
          phCtx.beginPath();
          phCtx.strokeStyle = "#ff6";
          phCtx.lineWidth = 2;
          phaseData.forEach((p, i) => {
            const x = 80 + (i * (width - 110)) / 200;
            const y = height / 2 - (p * (height - 100)) / 360;
            if (i === 0) phCtx.moveTo(x, y);
            else phCtx.lineTo(x, y);
          });
          phCtx.stroke();
        }
        // ë³´ì •ëœ ìœ„ìƒ (ë…¹ìƒ‰)
        if (phaseData.length > 1 && calPhaseData.length > 1) {
          phCtx.beginPath();
          phCtx.strokeStyle = "#6f6";
          phCtx.lineWidth = 2;
          const minLen = Math.min(phaseData.length, calPhaseData.length);
          for (let i = 0; i < minLen; i++) {
            const corrected = phaseData[i] - calPhaseData[i];
            const x = 80 + (i * (width - 110)) / 200;
            const y = height / 2 - (corrected * (height - 100)) / 360;
            if (i === 0) phCtx.moveTo(x, y);
            else phCtx.lineTo(x, y);
          }
          phCtx.stroke();
        }
        // ë²”ë¡€
        phCtx.font = "12px sans-serif";
        phCtx.fillStyle = "#66f";
        phCtx.fillText("â— êµì •ì²´ ìœ„ìƒ", 100, 30);
        phCtx.fillStyle = "#ff6";
        phCtx.fillText("â— íƒ€ê²Ÿ ìœ„ìƒ", 220, 30);
        phCtx.fillStyle = "#6f6";
        phCtx.fillText("â— ë³´ì •ëœ ìœ„ìƒ", 340, 30);
        // ê°€ê°„ì„­ ì‹œê°„ ê³„ì‚°
        const coherence = (200 / turbulence) * 40;
        document.getElementById("coherenceTime").textContent =
          Math.round(coherence);
        // ìœ„ìƒ RMS
        if (phaseData.length > 10) {
          const recent = phaseData.slice(-20);
          const mean = recent.reduce((a, b) => a + b, 0) / recent.length;
          const rms = Math.sqrt(
            recent.reduce((a, b) => a + (b - mean) ** 2, 0) / recent.length
          );
          document.getElementById("phaseRMS").textContent = rms.toFixed(0);
          document.getElementById("posError").textContent = (rms * 3).toFixed(
            0
          );
          document.getElementById("currentPhase").textContent =
            (phaseData[phaseData.length - 1] > 0 ? "+" : "") +
            phaseData[phaseData.length - 1].toFixed(1) +
            "Â°";
        }
        if (phaseRunning) phaseTime++;
        requestAnimationFrame(drawPhase);
      }
      function togglePhase() {
        phaseRunning = !phaseRunning;
        document.getElementById("phasePlayBtn").textContent = phaseRunning
          ? "â¸ ì •ì§€"
          : "â–¶ ì‹œì‘";
      }
      document.getElementById("switchSlider").oninput = function () {
        document.getElementById("switchValue").textContent = this.value;
      };
      document.getElementById("sepSlider").oninput = function () {
        document.getElementById("sepValue").textContent = this.value;
      };
      document.getElementById("turbSlider").oninput = function () {
        document.getElementById("turbValue").textContent = this.value;
      };
      // ===== MultiView ì‹œë®¬ë ˆì´ì…˜ =====
      const mvCanvas = document.getElementById("multiviewCanvas");
      const mvCtx = mvCanvas.getContext("2d");
      const ionoCanvas = document.getElementById("ionosphereCanvas");
      const ionoCtx = ionoCanvas.getContext("2d");
      let calibrators = [];
      function drawMultiview() {
        const width = mvCanvas.width;
        const height = mvCanvas.height;
        mvCtx.clearRect(0, 0, width, height);
        const calNum = parseInt(document.getElementById("calNumSlider").value);
        const ionoLevel = parseFloat(
          document.getElementById("ionoSlider").value
        );
        // ë°°ê²½
        mvCtx.fillStyle = "#0a0a1a";
        mvCtx.fillRect(0, 0, width, height);
        // ì‹œì•¼ ì›
        mvCtx.beginPath();
        mvCtx.strokeStyle = "rgba(100, 150, 255, 0.3)";
        mvCtx.arc(width / 2, height / 2, 180, 0, Math.PI * 2);
        mvCtx.stroke();
        mvCtx.fillStyle = "#446";
        mvCtx.font = "12px sans-serif";
        mvCtx.fillText("2Â° ì‹œì•¼", width / 2 - 20, height / 2 + 195);
        // íƒ€ê²Ÿ (ì¤‘ì•™)
        mvCtx.beginPath();
        const targetGrad = mvCtx.createRadialGradient(
          width / 2,
          height / 2,
          0,
          width / 2,
          height / 2,
          15
        );
        targetGrad.addColorStop(0, "#fff");
        targetGrad.addColorStop(0.5, "#f66");
        targetGrad.addColorStop(1, "rgba(255, 100, 100, 0)");
        mvCtx.fillStyle = targetGrad;
        mvCtx.arc(width / 2, height / 2, 12, 0, Math.PI * 2);
        mvCtx.fill();
        mvCtx.fillStyle = "#f88";
        mvCtx.fillText("íƒ€ê²Ÿ", width / 2 - 15, height / 2 + 30);
        // êµì • ì²œì²´ë“¤
        calibrators = [];
        for (let i = 0; i < calNum; i++) {
          const angle = (i / calNum) * Math.PI * 2 - Math.PI / 2;
          const r = 100 + (i % 2) * 50;
          const x = width / 2 + Math.cos(angle) * r;
          const y = height / 2 + Math.sin(angle) * r;
          calibrators.push({ x, y, angle });
          mvCtx.beginPath();
          mvCtx.arc(x, y, 8, 0, Math.PI * 2);
          mvCtx.fillStyle = "#88f";
          mvCtx.fill();
          mvCtx.fillStyle = "#aaf";
          mvCtx.fillText(`C${i + 1}`, x - 8, y + 25);
          // ì—°ê²°ì„ 
          mvCtx.beginPath();
          mvCtx.strokeStyle = "rgba(100, 150, 255, 0.4)";
          mvCtx.setLineDash([3, 3]);
          mvCtx.moveTo(width / 2, height / 2);
          mvCtx.lineTo(x, y);
          mvCtx.stroke();
          mvCtx.setLineDash([]);
        }
        // ì œëª©
        mvCtx.fillStyle = "#8af";
        mvCtx.font = "14px sans-serif";
        mvCtx.fillText("í•˜ëŠ˜ ë·°: íƒ€ê²Ÿê³¼ êµì • ì²œì²´ë“¤", 120, 25);
        requestAnimationFrame(drawMultiview);
      }
      function drawIonosphere() {
        const width = ionoCanvas.width;
        const height = ionoCanvas.height;
        ionoCtx.clearRect(0, 0, width, height);
        const ionoLevel = parseFloat(
          document.getElementById("ionoSlider").value
        );
        const calNum = parseInt(document.getElementById("calNumSlider").value);
        const freq = parseFloat(document.getElementById("mvFreqSlider").value);
        // ë°°ê²½
        ionoCtx.fillStyle = "#0a0a1a";
        ionoCtx.fillRect(0, 0, width, height);
        // ì „ë¦¬ì¸µ êµ¬ë°° ì‹œê°í™” (ê·¸ë¼ë””ì–¸íŠ¸)
        const time = Date.now() / 2000;
        const wedgeAngle = Math.sin(time) * 0.5;
        for (let x = 0; x < width; x += 10) {
          for (let y = 0; y < height; y += 10) {
            const ionoDensity =
              (((x * Math.cos(wedgeAngle) + y * Math.sin(wedgeAngle)) /
                (width + height)) *
                ionoLevel) /
              50;
            ionoCtx.fillStyle = `rgba(100, 50, 200, ${
              0.1 + ionoDensity * 0.3
            })`;
            ionoCtx.fillRect(x, y, 10, 10);
          }
        }
        // íƒ€ê²Ÿ ìœ„ì¹˜
        const tcx = width / 2;
        const tcy = height / 2;
        // ë³´ì • í‰ë©´ (êµì •ì²´ë“¤ì„ ì‡ëŠ” ì‚¼ê°í˜•/ë‹¤ê°í˜•)
        if (calNum >= 3) {
          ionoCtx.beginPath();
          ionoCtx.fillStyle = "rgba(100, 200, 100, 0.2)";
          calibrators.forEach((c, i) => {
            const x = c.x - (mvCanvas.width - ionoCanvas.width) / 2;
            const y = c.y;
            if (i === 0) ionoCtx.moveTo(x, y);
            else ionoCtx.lineTo(x, y);
          });
          ionoCtx.closePath();
          ionoCtx.fill();
        }
        // êµì •ì²´ ìœ„ì¹˜
        calibrators.forEach((c, i) => {
          const x = c.x - (mvCanvas.width - ionoCanvas.width) / 2;
          const y = c.y;
          ionoCtx.beginPath();
          ionoCtx.arc(x, y, 6, 0, Math.PI * 2);
          ionoCtx.fillStyle = "#88f";
          ionoCtx.fill();
        });
        // íƒ€ê²Ÿ
        ionoCtx.beginPath();
        ionoCtx.arc(tcx, tcy, 10, 0, Math.PI * 2);
        ionoCtx.fillStyle = "#f66";
        ionoCtx.fill();
        // ì œëª©
        ionoCtx.fillStyle = "#a6f";
        ionoCtx.font = "14px sans-serif";
        ionoCtx.fillText("ì „ë¦¬ì¸µ ìœ„ìƒ êµ¬ë°° (Wedge ëª¨ë¸)", 100, 25);
        // ë³´ì • íš¨ê³¼ ê³„ì‚°
        const ionoDelay = ((40 / (freq * freq)) * ionoLevel) / 50;
        const errorBefore = ionoDelay * 60; // Î¼as
        const improvement = calNum >= 3 ? calNum + 1 : calNum;
        const errorAfter = errorBefore / improvement;
        document.getElementById("ionoDelay").textContent = ionoDelay.toFixed(2);
        document.getElementById("ionoError").textContent =
          Math.round(errorBefore);
        document.getElementById("ionoCorrected").textContent =
          Math.round(errorAfter);
        document.getElementById("improvement").textContent = improvement + "x";
        requestAnimationFrame(drawIonosphere);
      }
      function recalcMultiview() {
        // ì¬ê³„ì‚° íŠ¸ë¦¬ê±° (ì´ë¯¸ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ë¨)
      }
      document.getElementById("mvFreqSlider").oninput = function () {
        document.getElementById("mvFreqValue").textContent = this.value;
      };
      document.getElementById("calNumSlider").oninput = function () {
        document.getElementById("calNumValue").textContent = this.value;
      };
      document.getElementById("ionoSlider").oninput = function () {
        document.getElementById("ionoValue").textContent = this.value;
      };
      // ===== ìœ„ìƒ ë©í•‘ ì‹œë®¬ë ˆì´ì…˜ =====
      const wrapCanvas = document.getElementById("wrappingCanvas");
      const wCtx = wrapCanvas.getContext("2d");
      let realPhaseHistory = [];
      let measuredPhaseHistory = [];

      let unwrappedHistory = [];
      function drawWrapping() {
        const width = wrapCanvas.width;
        const height = wrapCanvas.height;
        wCtx.clearRect(0, 0, width, height);
        const realPhase = parseFloat(
          document.getElementById("realPhaseSlider").value
        );
        const atmRate = parseFloat(
          document.getElementById("atmRateSlider").value
        );
        // ë°°ê²½
        wCtx.fillStyle = "#0a0a1a";
        wCtx.fillRect(0, 0, width, height);
        // Â±180Â° ë²”ìœ„ í‘œì‹œ
        wCtx.fillStyle = "rgba(255, 100, 100, 0.1)";
        wCtx.fillRect(80, height / 2 - 100, width - 110, 200);
        // ê·¸ë¦¬ë“œ
        wCtx.strokeStyle = "rgba(100, 150, 200, 0.2)";
        wCtx.beginPath();
        for (let y = 50; y <= height - 50; y += (height - 100) / 8) {
          wCtx.moveTo(80, y);
          wCtx.lineTo(width - 30, y);
        }
        wCtx.stroke();
        // Yì¶• ë¼ë²¨
        wCtx.fillStyle = "#668";
        wCtx.font = "11px sans-serif";
        const yScale = (height - 100) / 720; // -360 to +360
        wCtx.fillText("+360Â°", 35, 50);
        wCtx.fillText("+180Â°", 35, 50 + 180 * yScale);
        wCtx.fillText("0Â°", 55, height / 2);
        wCtx.fillText("-180Â°", 35, height - 50 - 180 * yScale);
        wCtx.fillText("-360Â°", 35, height - 50);
        // ì¶•
        wCtx.strokeStyle = "#446";
        wCtx.lineWidth = 1;
        wCtx.beginPath();
        wCtx.moveTo(80, 50);
        wCtx.lineTo(80, height - 50);
        wCtx.lineTo(width - 30, height - 50);
        wCtx.stroke();
        // ì‹¤ì‹œê°„ ë°ì´í„° ì—…ë°ì´íŠ¸
        if (wrappingRunning) {
          const currentReal =
            realPhase + Math.sin(wrapTime * 0.05) * atmRate * 2;
          let measured = currentReal % 360;
          if (measured > 180) measured -= 360;
          if (measured < -180) measured += 360;
          realPhaseHistory.push(currentReal);
          measuredPhaseHistory.push(measured);
          // ì–¸ë˜í•‘ ë¡œì§
          let unwrapped = measured;
          if (unwrappedHistory.length > 0) {
            const prev = unwrappedHistory[unwrappedHistory.length - 1];
            const diff =
              measured - (prev % 360 > 180 ? (prev % 360) - 360 : prev % 360);
            if (diff > 180) unwrapped = prev + diff - 360;
            else if (diff < -180) unwrapped = prev + diff + 360;
            else unwrapped = prev + diff;
          }
          unwrappedHistory.push(unwrapped);
          if (realPhaseHistory.length > 300) {
            realPhaseHistory.shift();
            measuredPhaseHistory.shift();
            unwrappedHistory.shift();
          }
          wrapTime++;
        }
        // ìŠ¬ë¼ì´ë” ì§ì ‘ ì¡°ì‘ì‹œ
        if (!wrappingRunning) {
          const currentReal = realPhase;
          let measured = currentReal % 360;
          if (measured > 180) measured -= 360;
          if (measured < -180) measured += 360;
          document.getElementById("realPhase").textContent =
            (currentReal > 0 ? "+" : "") + currentReal.toFixed(0) + "Â°";
          document.getElementById("measuredPhase").textContent =
            (measured > 0 ? "+" : "") + measured.toFixed(0) + "Â°";
          document.getElementById("wrapCount").textContent = Math.abs(
            Math.floor(currentReal / 360)
          );
        }
        // ì‹¤ì œ ìœ„ìƒ (í°ìƒ‰)
        if (realPhaseHistory.length > 1) {
          wCtx.beginPath();
          wCtx.strokeStyle = "#fff";
          wCtx.lineWidth = 2;
          realPhaseHistory.forEach((p, i) => {
            const x = 80 + (i * (width - 110)) / 300;
            const y = height / 2 - p * yScale;
            if (i === 0) wCtx.moveTo(x, y);
            else wCtx.lineTo(x, y);
          });
          wCtx.stroke();
        }
        // ì¸¡ì •ëœ ìœ„ìƒ (ë¹¨ê°„ìƒ‰, ë©í•‘ë¨)
        if (measuredPhaseHistory.length > 1) {
          wCtx.beginPath();
          wCtx.strokeStyle = "#f44";
          wCtx.lineWidth = 2;
          let prevY = null;
          measuredPhaseHistory.forEach((p, i) => {
            const x = 80 + (i * (width - 110)) / 300;
            const y = height / 2 - p * yScale;
            if (i === 0) {
              wCtx.moveTo(x, y);
            } else {
              // ì í”„ ê°ì§€
              if (prevY && Math.abs(y - prevY) > 100) {
                wCtx.stroke();
                wCtx.beginPath();
                wCtx.moveTo(x, y);
              } else {
                wCtx.lineTo(x, y);
              }
            }
            prevY = y;
          });
          wCtx.stroke();
        }
        // ì–¸ë˜í•‘ëœ ìœ„ìƒ (ë…¹ìƒ‰)
        if (unwrappedHistory.length > 1) {
          wCtx.beginPath();
          wCtx.strokeStyle = "#4f4";
          wCtx.lineWidth = 2;
          wCtx.setLineDash([5, 3]);
          unwrappedHistory.forEach((p, i) => {
            const x = 80 + (i * (width - 110)) / 300;
            const y = height / 2 - p * yScale;
            if (i === 0) wCtx.moveTo(x, y);
            else wCtx.lineTo(x, y);
          });
          wCtx.stroke();
          wCtx.setLineDash([]);
        }
        // Â±180 ê²½ê³„ì„ 
        wCtx.strokeStyle = "rgba(255, 100, 100, 0.5)";
        wCtx.setLineDash([5, 5]);
        wCtx.beginPath();
        wCtx.moveTo(80, height / 2 - 180 * yScale);
        wCtx.lineTo(width - 30, height / 2 - 180 * yScale);
        wCtx.moveTo(80, height / 2 + 180 * yScale);
        wCtx.lineTo(width - 30, height / 2 + 180 * yScale);
        wCtx.stroke();
        wCtx.setLineDash([]);
        // ë²”ë¡€
        wCtx.font = "12px sans-serif";
        wCtx.fillStyle = "#fff";
        wCtx.fillText("â” ì‹¤ì œ ìœ„ìƒ", 100, 30);
        wCtx.fillStyle = "#f44";
        wCtx.fillText("â” ì¸¡ì •ëœ ìœ„ìƒ (ë©í•‘)", 230, 30);
        wCtx.fillStyle = "#4f4";
        wCtx.fillText("â”… ì–¸ë˜í•‘ëœ ìœ„ìƒ", 400, 30);
        // í˜„ì¬ ê°’ ì—…ë°ì´íŠ¸
        if (realPhaseHistory.length > 0) {
          const lastReal = realPhaseHistory[realPhaseHistory.length - 1];
          const lastMeas =
            measuredPhaseHistory[measuredPhaseHistory.length - 1];
          const lastUnwrap = unwrappedHistory[unwrappedHistory.length - 1];
          document.getElementById("realPhase").textContent =
            (lastReal > 0 ? "+" : "") + lastReal.toFixed(0) + "Â°";
          document.getElementById("measuredPhase").textContent =
            (lastMeas > 0 ? "+" : "") + lastMeas.toFixed(0) + "Â°";
          document.getElementById("wrapCount").textContent = Math.abs(
            Math.floor(lastReal / 360)
          );
          document.getElementById("unwrappedPhase").textContent =
            (lastUnwrap > 0 ? "+" : "") + lastUnwrap.toFixed(0) + "Â°";
        }
        requestAnimationFrame(drawWrapping);
      }
      function toggleWrapping() {
        wrappingRunning = !wrappingRunning;
        document.getElementById("wrapPlayBtn").textContent = wrappingRunning
          ? "â¸ ì •ì§€"
          : "â–¶ ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘";
        if (wrappingRunning) {
          realPhaseHistory = [];
          measuredPhaseHistory = [];
          unwrappedHistory = [];
          wrapTime = 0;
        }
      }
      function unwrapPhase() {
        // ì–¸ë˜í•‘ ë°ëª¨ - ì´ë¯¸ ë…¹ìƒ‰ìœ¼ë¡œ í‘œì‹œë¨
        alert(
          "ë…¹ìƒ‰ ì ì„ ì´ ì–¸ë˜í•‘ëœ ìœ„ìƒì„ ë³´ì—¬ì¤ë‹ˆë‹¤.\n" +
            "ì•Œê³ ë¦¬ì¦˜ì€ ì—°ì†ì ì¸ ìœ„ìƒ ë³€í™”ë¥¼ ì¶”ì í•˜ì—¬\n" +
            "180Â° ì í”„ë¥¼ ê°ì§€í•˜ê³  ë³´ì •í•©ë‹ˆë‹¤."
        );
      }
      document.getElementById("realPhaseSlider").oninput = function () {
        document.getElementById("realPhaseValue").textContent = this.value;
      };
      document.getElementById("atmRateSlider").oninput = function () {
        document.getElementById("atmRateValue").textContent = this.value;
      };
      // ===== ê´€ì¸¡ ìŠ¤ì¼€ì¤„ ì‹œë®¬ë ˆì´ì…˜ =====
      const schedCanvas = document.getElementById("scheduleCanvas");
      const sCtx = schedCanvas.getContext("2d");
      let scheduleAnim = null;
      let animMonth = 0;
      function initScheduleTimeline() {
        const timeline = document.getElementById("scheduleTimeline");
        timeline.innerHTML = "";
        const epochs = parseInt(document.getElementById("epochSlider").value);
        const months = [
          "1ì›”",
          "2ì›”",
          "3ì›”",
          "4ì›”",
          "5ì›”",
          "6ì›”",
          "7ì›”",
          "8ì›”",
          "9ì›”",
          "10ì›”",
          "11ì›”",
          "12ì›”",
        ];
        const spacing = 12 / epochs;
        for (let i = 0; i < epochs; i++) {
          const monthIdx = Math.floor(i * spacing) % 12;
          const item = document.createElement("div");
          item.className = "timeline-item";
          item.innerHTML = `
<div class="timeline-dot" id="epoch-${i}"></div>
<div class="timeline-label">Epoch ${i + 1}<br>${months[monthIdx]}</div>
`;
          timeline.appendChild(item);
        }
      }
      function drawSchedule() {
        const width = schedCanvas.width;
        const height = schedCanvas.height;
        sCtx.clearRect(0, 0, width, height);
        const ra = parseFloat(document.getElementById("raSlider").value);
        const dec = parseFloat(document.getElementById("decSlider").value);
        const epochs = parseInt(document.getElementById("epochSlider").value);
        // ë°°ê²½
        sCtx.fillStyle = "#0a0a1a";
        sCtx.fillRect(0, 0, width, height);
        // ì§€êµ¬ ê¶¤ë„
        const cx = width / 2;
        const cy = height / 2;
        const orbitR = 150;
        // íƒœì–‘
        sCtx.beginPath();
        const sunGrad = sCtx.createRadialGradient(cx, cy, 0, cx, cy, 30);
        sunGrad.addColorStop(0, "#fff");
        sunGrad.addColorStop(0.5, "#ff0");
        sunGrad.addColorStop(1, "#f80");
        sCtx.fillStyle = sunGrad;
        sCtx.arc(cx, cy, 25, 0, Math.PI * 2);
        sCtx.fill();
        // ê¶¤ë„
        sCtx.beginPath();
        sCtx.strokeStyle = "rgba(100, 150, 255, 0.3)";
        sCtx.setLineDash([5, 5]);
        sCtx.arc(cx, cy, orbitR, 0, Math.PI * 2);
        sCtx.stroke();
        sCtx.setLineDash([]);
        // ì›” í‘œì‹œ
        const months = [
          "1ì›”",
          "2ì›”",
          "3ì›”",
          "4ì›”",
          "5ì›”",
          "6ì›”",
          "7ì›”",
          "8ì›”",
          "9ì›”",
          "10ì›”",
          "11ì›”",
          "12ì›”",
        ];
        sCtx.font = "11px sans-serif";
        sCtx.fillStyle = "#668";
        for (let i = 0; i < 12; i++) {
          const angle = (i * Math.PI) / 6 - Math.PI / 2;
          const x = cx + Math.cos(angle) * (orbitR + 25);
          const y = cy + Math.sin(angle) * (orbitR + 25);
          sCtx.fillText(months[i], x - 15, y + 4);
        }
        // íƒ€ê²Ÿ ë°©í–¥ (RAì— ë”°ë¼)
        const targetAngle = (ra / 24) * Math.PI * 2 - Math.PI / 2;
        const targetX = cx + Math.cos(targetAngle) * 250;
        const targetY = cy + Math.sin(targetAngle) * 250;
        // íƒ€ê²Ÿ ë°©í–¥ í™”ì‚´í‘œ
        sCtx.beginPath();
        sCtx.strokeStyle = "rgba(255, 100, 100, 0.5)";
        sCtx.lineWidth = 2;
        sCtx.moveTo(cx, cy);
        sCtx.lineTo(targetX, targetY);
        sCtx.stroke();
        sCtx.lineWidth = 1;
        // íƒ€ê²Ÿ ë³„
        sCtx.beginPath();
        const starGrad = sCtx.createRadialGradient(
          targetX,
          targetY,
          0,
          targetX,
          targetY,
          15
        );
        starGrad.addColorStop(0, "#fff");
        starGrad.addColorStop(0.5, "#f88");
        starGrad.addColorStop(1, "rgba(255, 100, 100, 0)");
        sCtx.fillStyle = starGrad;
        sCtx.arc(targetX, targetY, 12, 0, Math.PI * 2);
        sCtx.fill();
        sCtx.fillStyle = "#f88";
        sCtx.fillText("íƒ€ê²Ÿ", targetX - 12, targetY + 28);
        // ìµœì  ê´€ì¸¡ ì‹œê¸° (ì‹œì°¨ ìµœëŒ€)
        const optAngle1 = targetAngle + Math.PI / 2;
        const optAngle2 = targetAngle - Math.PI / 2;
        // ìµœì  ì‹œê¸° í‘œì‹œ
        [optAngle1, optAngle2].forEach((angle, idx) => {
          const ex = cx + Math.cos(angle) * orbitR;
          const ey = cy + Math.sin(angle) * orbitR;
          sCtx.beginPath();
          sCtx.arc(ex, ey, 8, 0, Math.PI * 2);
          sCtx.fillStyle = idx === 0 ? "#6f6" : "#6ff";
          sCtx.fill();
        });
        // ê´€ì¸¡ ì—í¬í¬ë“¤
        const epochSpacing = (Math.PI * 2) / epochs;
        for (let i = 0; i < epochs; i++) {
          const angle = i * epochSpacing - Math.PI / 2;
          const ex = cx + Math.cos(angle) * orbitR;
          const ey = cy + Math.sin(angle) * orbitR;
          sCtx.beginPath();
          sCtx.arc(ex, ey, 5, 0, Math.PI * 2);
          sCtx.fillStyle = "#aaf";
          sCtx.fill();
        }
        // í˜„ì¬ ì§€êµ¬ ìœ„ì¹˜ (ì• ë‹ˆë©”ì´ì…˜)
        const earthAngle = (animMonth * Math.PI) / 6 - Math.PI / 2;
        const earthX = cx + Math.cos(earthAngle) * orbitR;
        const earthY = cy + Math.sin(earthAngle) * orbitR;
        sCtx.beginPath();
        const earthGrad = sCtx.createRadialGradient(
          earthX,
          earthY,
          0,
          earthX,
          earthY,
          15
        );
        earthGrad.addColorStop(0, "#6cf");
        earthGrad.addColorStop(1, "#248");
        sCtx.fillStyle = earthGrad;
        sCtx.arc(earthX, earthY, 12, 0, Math.PI * 2);
        sCtx.fill();
        // ì‹œì„  í‘œì‹œ
        sCtx.beginPath();
        sCtx.strokeStyle = "rgba(100, 200, 255, 0.3)";
        sCtx.moveTo(earthX, earthY);
        sCtx.lineTo(targetX, targetY);
        sCtx.stroke();
        // ì‹œì°¨ íš¨ê³¼ í‘œì‹œ (ì§€êµ¬ ìœ„ì¹˜ì— ë”°ë¥¸ ê²‰ë³´ê¸° ê°ë„ ì°¨ì´)
        const parallaxEffect = Math.sin(earthAngle - targetAngle);
        const parallaxText = (parallaxEffect * 10).toFixed(2);
        sCtx.fillStyle = "#8af";
        sCtx.font = "12px sans-serif";
        sCtx.fillText(
          `í˜„ì¬ ì‹œì°¨ íš¨ê³¼: ${parallaxEffect > 0 ? "+" : ""}${parallaxText} mas`,
          20,
          30
        );
        sCtx.fillText(`íƒ€ê²Ÿ RA: ${ra}h`, 20, 50);
        // ìµœì  ê´€ì¸¡ ì‹œê¸° ê³„ì‚°
        const optMonth1 = Math.floor(
          (((targetAngle + Math.PI / 2 + Math.PI / 2) / (Math.PI * 2)) * 12 +
            12) %
            12
        );
        const optMonth2 = Math.floor(
          (((targetAngle - Math.PI / 2 + Math.PI / 2) / (Math.PI * 2)) * 12 +
            12) %
            12
        );
        document.getElementById(
          "optimalEpochs"
        ).textContent = `${months[optMonth1]}, ${months[optMonth2]}`;
        document.getElementById("parallaxDir").textContent =
          Math.abs(dec) < 30 ? "E-W ìš°ì„¸" : "E-W/N-S í˜¼í•©";
        requestAnimationFrame(drawSchedule);
      }
      function animateYear() {
        if (scheduleAnim) clearInterval(scheduleAnim);
        animMonth = 0;
        scheduleAnim = setInterval(() => {
          animMonth = (animMonth + 0.1) % 12;
          // íƒ€ì„ë¼ì¸ ì—…ë°ì´íŠ¸
          const epochs = parseInt(document.getElementById("epochSlider").value);
          const spacing = 12 / epochs;
          for (let i = 0; i < epochs; i++) {
            const epochMonth = i * spacing;
            const dot = document.getElementById(`epoch-${i}`);
            if (dot) {
              dot.classList.toggle(
                "active",
                Math.abs(animMonth - epochMonth) < 0.5 ||
                  Math.abs(animMonth - epochMonth + 12) < 0.5
              );
            }
          }
        }, 100);
      }
      document.getElementById("raSlider").oninput = function () {
        document.getElementById("raValue").textContent = this.value;
        initScheduleTimeline();
      };
      document.getElementById("decSlider").oninput = function () {
        document.getElementById("decValue").textContent = this.value;
      };
      document.getElementById("epochSlider").oninput = function () {
        document.getElementById("epochValue").textContent = this.value;
        initScheduleTimeline();
      };
      // ===== ì´ˆê¸°í™” =====
      window.onload = function () {
        drawParallax();
        drawVLBI();
        initPhaseSequence();
        drawPhase();
        drawMultiview();
        drawIonosphere();
        drawWrapping();
        initScheduleTimeline();
        drawSchedule();
      };
    </script>
  </body>
</html>
