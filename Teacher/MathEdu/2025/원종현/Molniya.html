<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Molniya ê¶¤ë„ ì‹œë®¬ë ˆì´ì…˜ - ì´ì°¨ê³¡ì„  ìˆ˜í•™ íƒêµ¬</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1d3a 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: #a0a0a0;
            font-size: 1.1em;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .panel h2 {
            color: #4facfe;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid rgba(79, 172, 254, 0.3);
            padding-bottom: 10px;
        }

        #orbitCanvas {
            width: 100%;
            height: 500px;
            background: radial-gradient(circle at center, #0f1535 0%, #050818 100%);
            border-radius: 10px;
            cursor: crosshair;
            box-shadow: inset 0 0 50px rgba(0, 0, 0, 0.5);
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .control-group label {
            color: #4facfe;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .value-display {
            color: #00f2fe;
            font-family: 'Courier New', monospace;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            cursor: pointer;
            box-shadow: 0 0 10px rgba(79, 172, 254, 0.5);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            cursor: pointer;
            border: none;
            box-shadow: 0 0 10px rgba(79, 172, 254, 0.5);
        }

        .button-group {
            display: flex;
            gap: 10px;
        }

        button {
            flex: 1;
            padding: 12px 24px;
            font-size: 1em;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(79, 172, 254, 0.3);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(79, 172, 254, 0.5);
        }

        button:active {
            transform: translateY(0);
        }

        button.secondary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        button.secondary:hover {
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: rgba(79, 172, 254, 0.1);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(79, 172, 254, 0.2);
        }

        .stat-label {
            color: #a0a0a0;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .stat-value {
            color: #00f2fe;
            font-size: 1.3em;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }

        .chart-container {
            width: 100%;
            height: 300px;
            margin-top: 20px;
            position: relative;
        }

        canvas.chart {
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }

        .legend {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 20px;
            height: 3px;
            border-radius: 2px;
        }

        .info-section {
            background: rgba(79, 172, 254, 0.05);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #4facfe;
            margin-top: 20px;
        }

        .info-section h3 {
            color: #4facfe;
            margin-bottom: 10px;
        }

        .info-section p {
            line-height: 1.6;
            color: #c0c0c0;
        }

        .formula-box {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 3px solid #00f2fe;
        }

        .formula-box code {
            color: #ffd93d;
            font-family: 'Courier New', monospace;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 2em;
            }
        }

        .highlight {
            color: #00f2fe;
            font-weight: bold;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .satellite-marker {
            animation: pulse 2s ease-in-out infinite;
        }

        .equation {
            text-align: center;
            margin: 15px 0;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            font-family: 'Times New Roman', serif;
            font-size: 1.1em;
            color: #ffffff;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ›°ï¸ Molniya ê¶¤ë„ ì‹œë®¬ë ˆì´ì…˜</h1>
            <p class="subtitle">ì´ì°¨ê³¡ì„ (íƒ€ì›)ê³¼ ì¼€í”ŒëŸ¬ ë²•ì¹™ì„ í†µí•œ ê³ íƒ€ì› ê¶¤ë„ì˜ ìˆ˜í•™ì  ë¶„ì„</p>
        </header>

        <div class="main-content">
            <!-- ì™¼ìª½: ê¶¤ë„ ì‹œê°í™” -->
            <div class="panel">
                <h2>ğŸ“Š ê¶¤ë„ ì‹œê°í™”</h2>
                <canvas id="orbitCanvas"></canvas>
                
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #4facfe; width: 30px; height: 30px; border-radius: 50%;"></div>
                        <span>ì§€êµ¬ (ì´ˆì )</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ff6b6b; width: 20px; height: 20px; border-radius: 50%;"></div>
                        <span>ìœ„ì„±</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #00f2fe;"></div>
                        <span>íƒ€ì› ê¶¤ë„</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ffd93d;"></div>
                        <span>ì†ë„ ë²¡í„°</span>
                    </div>
                </div>

                <div class="info-section">
                    <h3>ğŸ’¡ ì¼€í”ŒëŸ¬ ì œ2ë²•ì¹™ (ë©´ì  ì†ë„ ì¼ì •)</h3>
                    <p>ìœ„ì„±ê³¼ ì§€êµ¬ë¥¼ ì‡ëŠ” ì„ ë¶„ì€ ê°™ì€ ì‹œê°„ ë™ì•ˆ ê°™ì€ ë„“ì´ë¥¼ íœ©ì“¸ê³  ì§€ë‚˜ê°‘ë‹ˆë‹¤.</p>
                    <div class="equation">dA/dt = L/(2m) = ìƒìˆ˜</div>
                    <p style="margin-top: 10px;">
                    ë”°ë¼ì„œ <span class="highlight">ì›ì§€ì (ë¨¼ ê³³)</span>ì—ì„œëŠ” ëŠë¦¬ê²Œ, 
                    <span class="highlight">ê·¼ì§€ì (ê°€ê¹Œìš´ ê³³)</span>ì—ì„œëŠ” ë¹ ë¥´ê²Œ ì›€ì§ì…ë‹ˆë‹¤.
                    </p>
                    <div class="formula-box">
                        <code>ê°ì†ë„ Ï‰ âˆ 1/rÂ²</code>
                    </div>
                </div>
            </div>

            <!-- ì˜¤ë¥¸ìª½: ì œì–´íŒ -->
            <div class="panel">
                <h2>ğŸ® ì œì–´íŒ</h2>
                
                <div class="controls">
                    <div class="control-group">
                        <label>
                            <span>ì´ì‹¬ë¥  (e)</span>
                            <span class="value-display" id="eccentricityValue">0.74</span>
                        </label>
                        <input type="range" id="eccentricity" min="0" max="0.95" step="0.01" value="0.74">
                        <small style="color: #a0a0a0;">
                            e = 0: ì›í˜• ê¶¤ë„ | e = 0.74: Molniya ê¶¤ë„ | e â†’ 1: í¬ë¬¼ì„  ê¶¤ë„
                        </small>
                    </div>

                    <div class="control-group">
                        <label>
                            <span>ì• ë‹ˆë©”ì´ì…˜ ì†ë„</span>
                            <span class="value-display" id="speedValue">1.0x</span>
                        </label>
                        <input type="range" id="animSpeed" min="0.1" max="5" step="0.1" value="1">
                    </div>

                    <div class="button-group">
                        <button id="playPause">â¸ï¸ ì¼ì‹œì •ì§€</button>
                        <button id="reset" class="secondary">ğŸ”„ ë¦¬ì…‹</button>
                    </div>

                    <div class="button-group">
                        <button id="showTrail" class="secondary">âœ¨ ê¶¤ì  í‘œì‹œ</button>
                        <button id="showVectors" class="secondary">ğŸ“ ë²¡í„° í‘œì‹œ</button>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">ì›ì§€ì  ì†ë„ (v_a)</div>
                        <div class="stat-value" id="apogeeSpeed">1.50 km/s</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">ê·¼ì§€ì  ì†ë„ (v_p)</div>
                        <div class="stat-value" id="perigeeSpeed">10.01 km/s</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">í˜„ì¬ ì†ë„</div>
                        <div class="stat-value" id="currentSpeed">0.00 km/s</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">í˜„ì¬ ê³ ë„</div>
                        <div class="stat-value" id="currentAltitude">0 km</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">ì§„ê·¼ì  ì´ê° (Î½)</div>
                        <div class="stat-value" id="trueAnomaly">0Â°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">ê¶¤ë„ ì£¼ê¸° (T)</div>
                        <div class="stat-value" id="orbitalPeriod">12.0 h</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">ì¥ë°˜ê²½ (a)</div>
                        <div class="stat-value" id="semiMajorAxis">26,562 km</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">ì†ë„ ë¹„ìœ¨ (v_p/v_a)</div>
                        <div class="stat-value" id="speedRatio">6.69</div>
                    </div>
                </div>

                <div class="info-section">
                    <h3>ğŸ“ Vis-viva ë°©ì •ì‹</h3>
                    <div class="equation">vÂ² = Î¼(2/r - 1/a)</div>
                    <p style="margin-top: 10px;">
                        ê°ìš´ë™ëŸ‰ ë³´ì¡´: <code>r_p Ã— v_p = r_a Ã— v_a</code><br>
                        ì†ë„ ë¹„ìœ¨: <code>v_p/v_a = (1+e)/(1-e)</code>
                    </p>
                </div>
            </div>
        </div>

        <!-- ê·¸ë˜í”„ ì„¹ì…˜ -->
        <div class="main-content">
            <div class="panel">
                <h2>ğŸ“ˆ ì§„ê·¼ì  ì´ê° ë³€í™” (ì‹œê°„ vs ê°ë„)</h2>
                <div class="chart-container">
                    <canvas id="angleChart" class="chart"></canvas>
                </div>
                <p style="margin-top: 10px; color: #a0a0a0; text-align: center;">
                    ê·¸ë˜í”„ê°€ í‰íƒ„í•œ êµ¬ê°„ = ê°ì†ë„ê°€ ëŠë¦° êµ¬ê°„ = <span class="highlight">ì²´ê³µì‹œê°„ì´ ê¸´ êµ¬ê°„</span>
                </p>
                <div class="info-section">
                    <h3>ë¶„ì„</h3>
                    <p>ì›ì§€ì (180Â° ê·¼ì²˜)ì—ì„œ ê·¸ë˜í”„ì˜ ê¸°ìš¸ê¸°ê°€ ì™„ë§Œí•¨ â†’ ê°™ì€ ì‹œê°„ ë™ì•ˆ ê°ë„ ë³€í™”ê°€ ì ìŒ â†’ ê¸´ ì²´ê³µì‹œê°„</p>
                </div>
            </div>

            <div class="panel">
                <h2>ğŸ“‰ ì†ë„ ë³€í™” (ê¶¤ë„ ìœ„ì¹˜ë³„)</h2>
                <div class="chart-container">
                    <canvas id="velocityChart" class="chart"></canvas>
                </div>
                <p style="margin-top: 10px; color: #a0a0a0; text-align: center;">
                    ì›ì§€ì (180Â°) ê·¼ì²˜ì—ì„œ ì†ë„ ìµœì†Œ, ê·¼ì§€ì (0Â°)ì—ì„œ ì†ë„ ìµœëŒ€
                </p>
                <div class="info-section">
                    <h3>ë¶„ì„</h3>
                    <p>ì´ì‹¬ë¥  e = 0.74ì¼ ë•Œ, ê·¼ì§€ì ê³¼ ì›ì§€ì ì˜ ì†ë„ ì°¨ì´ëŠ” ì•½ 6.7ë°°ì— ë‹¬í•©ë‹ˆë‹¤.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // ë¬¼ë¦¬ ìƒìˆ˜ ì •ì˜
        // ============================================
        const MU = 3.986e14;        // ì§€êµ¬ í‘œì¤€ ì¤‘ë ¥ ë³€ìˆ˜ (mÂ³/sÂ²)
        const EARTH_RADIUS = 6371;  // ì§€êµ¬ ë°˜ì§€ë¦„ (km)
        const T_PERIOD = 12 * 3600; // ê¶¤ë„ ì£¼ê¸°: 12ì‹œê°„ì„ ì´ˆë¡œ ë³€í™˜

        // ============================================
        // ì¼€í”ŒëŸ¬ ì œ3ë²•ì¹™: TÂ² = (4Ï€Â²/Î¼) Ã— aÂ³
        // ============================================
        function calculateSemiMajorAxis(period) {
            return Math.pow((MU * period * period) / (4 * Math.PI * Math.PI), 1/3) / 1000; // km
        }

        // ============================================
        // ì¼€í”ŒëŸ¬ ë°©ì •ì‹ í’€ì´: M = E - eÂ·sin(E)
        // Newton-Raphson ë°˜ë³µë²• ì‚¬ìš©
        // ============================================
        function solveKeplerEquation(M, e, tolerance = 1e-8) {
            let E = M; // ì´ˆê¸°ê°’
            for (let i = 0; i < 30; i++) {
                const dE = (E - e * Math.sin(E) - M) / (1 - e * Math.cos(E));
                E -= dE;
                if (Math.abs(dE) < tolerance) break;
            }
            return E;
        }

        // ============================================
        // ì´ì‹¬ ê·¼ì  ì´ê° â†’ ì§„ê·¼ì  ì´ê° ë³€í™˜
        // ============================================
        function eccentricToTrueAnomaly(E, e) {
            return 2 * Math.atan2(
                Math.sqrt(1 + e) * Math.sin(E / 2),
                Math.sqrt(1 - e) * Math.cos(E / 2)
            );
        }

        // ============================================
        // Vis-viva ë°©ì •ì‹: vÂ² = Î¼(2/r - 1/a)
        // ============================================
        function calculateVelocity(r, a, mu = MU) {
            return Math.sqrt(mu * (2 / (r * 1000) - 1 / (a * 1000))) / 1000; // km/s
        }

        // ============================================
        // ë©”ì¸ ì‹œë®¬ë ˆì´ì…˜ í´ë˜ìŠ¤
        // ============================================
        class OrbitSimulation {
            constructor() {
                this.canvas = document.getElementById('orbitCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.angleChartCanvas = document.getElementById('angleChart');
                this.angleChartCtx = this.angleChartCanvas.getContext('2d');
                this.velocityChartCanvas = document.getElementById('velocityChart');
                this.velocityChartCtx = this.velocityChartCanvas.getContext('2d');
                
                this.setupCanvas();
                
                // ê¶¤ë„ íŒŒë¼ë¯¸í„°
                this.e = 0.74;  // ì´ì‹¬ë¥ 
                this.a = calculateSemiMajorAxis(T_PERIOD); // ì¥ë°˜ê²½ (km)
                this.t = 0;     // í˜„ì¬ ì‹œê°„ (ì´ˆ)
                this.animSpeed = 1.0;
                this.isPlaying = true;
                this.showTrail = false;
                this.showVectors = true;
                this.trail = [];
                
                // ì°¨íŠ¸ ë°ì´í„°
                this.angleData = [];
                this.velocityData = [];
                
                this.initControls();
                this.generateChartData();
                this.animate();
            }

            setupCanvas() {
                const resizeCanvas = () => {
                    const rect = this.canvas.getBoundingClientRect();
                    this.canvas.width = rect.width * window.devicePixelRatio;
                    this.canvas.height = rect.height * window.devicePixelRatio;
                    this.ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
                    this.canvasWidth = rect.width;
                    this.canvasHeight = rect.height;

                    // Angle chart
                    const angleRect = this.angleChartCanvas.getBoundingClientRect();
                    this.angleChartCanvas.width = angleRect.width * window.devicePixelRatio;
                    this.angleChartCanvas.height = angleRect.height * window.devicePixelRatio;
                    this.angleChartCtx.scale(window.devicePixelRatio, window.devicePixelRatio);

                    // Velocity chart
                    const velRect = this.velocityChartCanvas.getBoundingClientRect();
                    this.velocityChartCanvas.width = velRect.width * window.devicePixelRatio;
                    this.velocityChartCanvas.height = velRect.height * window.devicePixelRatio;
                    this.velocityChartCtx.scale(window.devicePixelRatio, window.devicePixelRatio);
                };
                
                resizeCanvas();
                window.addEventListener('resize', resizeCanvas);
            }

            initControls() {
                // ì´ì‹¬ë¥  ì¡°ì ˆ
                document.getElementById('eccentricity').addEventListener('input', (e) => {
                    this.e = parseFloat(e.target.value);
                    document.getElementById('eccentricityValue').textContent = this.e.toFixed(2);
                    this.updateStats();
                    this.generateChartData();
                    this.trail = [];
                });

                // ì• ë‹ˆë©”ì´ì…˜ ì†ë„
                document.getElementById('animSpeed').addEventListener('input', (e) => {
                    this.animSpeed = parseFloat(e.target.value);
                    document.getElementById('speedValue').textContent = this.animSpeed.toFixed(1) + 'x';
                });

                // ì¬ìƒ/ì¼ì‹œì •ì§€
                document.getElementById('playPause').addEventListener('click', (e) => {
                    this.isPlaying = !this.isPlaying;
                    e.target.textContent = this.isPlaying ? 'â¸ï¸ ì¼ì‹œì •ì§€' : 'â–¶ï¸ ì¬ìƒ';
                });

                // ë¦¬ì…‹
                document.getElementById('reset').addEventListener('click', () => {
                    this.t = 0;
                    this.trail = [];
                });

                // ê¶¤ì  í‘œì‹œ
                document.getElementById('showTrail').addEventListener('click', (e) => {
                    this.showTrail = !this.showTrail;
                    if (!this.showTrail) this.trail = [];
                    e.target.textContent = this.showTrail ? 'âœ¨ ê¶¤ì  ìˆ¨ê¹€' : 'âœ¨ ê¶¤ì  í‘œì‹œ';
                });

                // ë²¡í„° í‘œì‹œ
                document.getElementById('showVectors').addEventListener('click', (e) => {
                    this.showVectors = !this.showVectors;
                    e.target.textContent = this.showVectors ? 'ğŸ“ ë²¡í„° ìˆ¨ê¹€' : 'ğŸ“ ë²¡í„° í‘œì‹œ';
                });
            }

            updateStats() {
                const r_p = this.a * (1 - this.e);
                const r_a = this.a * (1 + this.e);
                const v_p = calculateVelocity(r_p, this.a);
                const v_a = calculateVelocity(r_a, this.a);
                const ratio = v_p / v_a;

                document.getElementById('apogeeSpeed').textContent = v_a.toFixed(2) + ' km/s';
                document.getElementById('perigeeSpeed').textContent = v_p.toFixed(2) + ' km/s';
                document.getElementById('speedRatio').textContent = ratio.toFixed(2);
                document.getElementById('orbitalPeriod').textContent = (T_PERIOD / 3600).toFixed(1) + ' h';
                document.getElementById('semiMajorAxis').textContent = this.a.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",") + ' km';
            }

            // ============================================
            // ì°¨íŠ¸ ë°ì´í„° ìƒì„±
            // ============================================
            generateChartData() {
                this.angleData = [];
                this.velocityData = [];
                
                const steps = 200;
                for (let i = 0; i <= steps; i++) {
                    const t = (i / steps) * T_PERIOD;
                    const M = (2 * Math.PI * t) / T_PERIOD;
                    const E = solveKeplerEquation(M, this.e);
                    const nu = eccentricToTrueAnomaly(E, this.e);
                    const r = this.a * (1 - this.e * this.e) / (1 + this.e * Math.cos(nu));
                    const v = calculateVelocity(r, this.a);
                    
                    this.angleData.push({ t: t / 3600, nu: nu * 180 / Math.PI });
                    this.velocityData.push({ nu: nu * 180 / Math.PI, v: v });
                }
                
                this.drawCharts();
            }

            drawCharts() {
                this.drawAngleChart();
                this.drawVelocityChart();
            }

            // ============================================
            // ì§„ê·¼ì  ì´ê° vs ì‹œê°„ ì°¨íŠ¸
            // ============================================
            drawAngleChart() {
                const ctx = this.angleChartCtx;
                const rect = this.angleChartCanvas.getBoundingClientRect();
                const width = rect.width;
                const height = rect.height;
                const padding = 50;

                ctx.clearRect(0, 0, width, height);

                // ë°°ê²½ ê·¸ë¦¬ë“œ
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
                ctx.lineWidth = 1;
                for (let i = 0; i <= 5; i++) {
                    const y = padding + (height - 2 * padding) * i / 5;
                    ctx.beginPath();
                    ctx.moveTo(padding, y);
                    ctx.lineTo(width - padding, y);
                    ctx.stroke();
                }

                // ì¶•
                ctx.strokeStyle = '#4facfe';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(padding, padding);
                ctx.lineTo(padding, height - padding);
                ctx.lineTo(width - padding, height - padding);
                ctx.stroke();

                // ë ˆì´ë¸”
                ctx.fillStyle = '#a0a0a0';
                ctx.font = '12px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('ì‹œê°„ (h)', width / 2, height - 10);
                ctx.save();
                ctx.translate(15, height / 2);
                ctx.rotate(-Math.PI / 2);
                ctx.fillText('ì§„ê·¼ì  ì´ê° (Â°)', 0, 0);
                ctx.restore();

                // ëˆˆê¸ˆ
                ctx.font = '10px sans-serif';
                ctx.fillStyle = '#808080';
                for (let i = 0; i <= 12; i += 3) {
                    const x = padding + (width - 2 * padding) * (i / 12);
                    ctx.fillText(i + 'h', x, height - padding + 20);
                }

                // ë°ì´í„°
                if (this.angleData.length < 2) return;

                const maxT = Math.max(...this.angleData.map(d => d.t));
                const minNu = Math.min(...this.angleData.map(d => d.nu));
                const maxNu = Math.max(...this.angleData.map(d => d.nu));

                ctx.strokeStyle = '#00f2fe';
                ctx.lineWidth = 3;
                ctx.beginPath();
                
                this.angleData.forEach((point, i) => {
                    const x = padding + (width - 2 * padding) * (point.t / maxT);
                    const y = height - padding - (height - 2 * padding) * ((point.nu - minNu) / (maxNu - minNu));
                    
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                });
                
                ctx.stroke();

                // í˜„ì¬ ìœ„ì¹˜
                const currentT = (this.t / T_PERIOD) * maxT;
                const currentIdx = Math.floor((currentT / maxT) * this.angleData.length);
                if (currentIdx < this.angleData.length) {
                    const point = this.angleData[currentIdx];
                    const x = padding + (width - 2 * padding) * (point.t / maxT);
                    const y = height - padding - (height - 2 * padding) * ((point.nu - minNu) / (maxNu - minNu));
                    
                    ctx.fillStyle = '#ff6b6b';
                    ctx.beginPath();
                    ctx.arc(x, y, 5, 0, 2 * Math.PI);
                    ctx.fill();
                }
            }

            // ============================================
            // ì†ë„ vs ì§„ê·¼ì  ì´ê° ì°¨íŠ¸
            // ============================================
            drawVelocityChart() {
                const ctx = this.velocityChartCtx;
                const rect = this.velocityChartCanvas.getBoundingClientRect();
                const width = rect.width;
                const height = rect.height;
                const padding = 50;

                ctx.clearRect(0, 0, width, height);

                // ë°°ê²½ ê·¸ë¦¬ë“œ
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
                ctx.lineWidth = 1;
                for (let i = 0; i <= 5; i++) {
                    const y = padding + (height - 2 * padding) * i / 5;
                    ctx.beginPath();
                    ctx.moveTo(padding, y);
                    ctx.lineTo(width - padding, y);
                    ctx.stroke();
                }

                // ì¶•
                ctx.strokeStyle = '#4facfe';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(padding, padding);
                ctx.lineTo(padding, height - padding);
                ctx.lineTo(width - padding, height - padding);
                ctx.stroke();

                // ë ˆì´ë¸”
                ctx.fillStyle = '#a0a0a0';
                ctx.font = '12px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('ì§„ê·¼ì  ì´ê° (Â°)', width / 2, height - 10);
                ctx.save();
                ctx.translate(15, height / 2);
                ctx.rotate(-Math.PI / 2);
                ctx.fillText('ì†ë„ (km/s)', 0, 0);
                ctx.restore();

                // ë°ì´í„°
                if (this.velocityData.length < 2) return;

                const minNu = -180;
                const maxNu = 180;
                const maxV = Math.max(...this.velocityData.map(d => d.v));

                ctx.strokeStyle = '#ffd93d';
                ctx.lineWidth = 3;
                ctx.beginPath();
                
                this.velocityData.forEach((point, i) => {
                    const x = padding + (width - 2 * padding) * ((point.nu - minNu) / (maxNu - minNu));
                    const y = height - padding - (height - 2 * padding) * (point.v / maxV);
                    
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                });
                
                ctx.stroke();

                // ì›ì§€ì /ê·¼ì§€ì  í‘œì‹œ
                const apogeeIdx = Math.floor(this.velocityData.length / 2);
                const perigeeIdx = 0;

                // ì›ì§€ì 
                let point = this.velocityData[apogeeIdx];
                let x = padding + (width - 2 * padding) * ((point.nu - minNu) / (maxNu - minNu));
                let y = height - padding - (height - 2 * padding) * (point.v / maxV);
                ctx.fillStyle = '#4facfe';
                ctx.beginPath();
                ctx.arc(x, y, 6, 0, 2 * Math.PI);
                ctx.fill();
                ctx.fillText('ì›ì§€ì ', x, y - 15);

                // ê·¼ì§€ì 
                point = this.velocityData[perigeeIdx];
                x = padding + (width - 2 * padding) * ((point.nu - minNu) / (maxNu - minNu));
                y = height - padding - (height - 2 * padding) * (point.v / maxV);
                ctx.fillStyle = '#ff6b6b';
                ctx.beginPath();
                ctx.arc(x, y, 6, 0, 2 * Math.PI);
                ctx.fill();
                ctx.fillText('ê·¼ì§€ì ', x, y - 15);
            }

            // ============================================
            // í˜„ì¬ ìœ„ì„± ìœ„ì¹˜ ê³„ì‚°
            // ============================================
            getCurrentPosition() {
                const M = (2 * Math.PI * this.t) / T_PERIOD;
                const E = solveKeplerEquation(M, this.e);
                const nu = eccentricToTrueAnomaly(E, this.e);
                const r = this.a * (1 - this.e * this.e) / (1 + this.e * Math.cos(nu));
                const v = calculateVelocity(r, this.a);
                
                return { nu, r, v, E, M };
            }

            // ============================================
            // ê¶¤ë„ ê·¸ë¦¬ê¸° (ë©”ì¸ ì‹œê°í™”)
            // ============================================
            drawOrbit() {
                const ctx = this.ctx;
                ctx.clearRect(0, 0, this.canvasWidth, this.canvasHeight);

                const centerX = this.canvasWidth / 2;
                const centerY = this.canvasHeight / 2;
                const scale = Math.min(this.canvasWidth, this.canvasHeight) / (2.5 * this.a);

                // ì§€êµ¬ë¥¼ íƒ€ì›ì˜ ì´ˆì ì— ë°°ì¹˜
                const c = this.a * this.e; // ì´ˆì  ê±°ë¦¬
                const earthX = centerX - c * scale;
                const earthY = centerY;

                // íƒ€ì› ê¶¤ë„ ê·¸ë¦¬ê¸°
                const b = this.a * Math.sqrt(1 - this.e * this.e); // ë‹¨ë°˜ê²½
                
                ctx.strokeStyle = 'rgba(0, 242, 254, 0.3)';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.ellipse(centerX, centerY, this.a * scale, b * scale, 0, 0, 2 * Math.PI);
                ctx.stroke();

                // ê¶¤ì 
                if (this.showTrail && this.trail.length > 1) {
                    ctx.strokeStyle = 'rgba(255, 107, 107, 0.3)';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    this.trail.forEach((point, i) => {
                        const x = earthX + point.x;
                        const y = earthY - point.y;
                        if (i === 0) ctx.moveTo(x, y);
                        else ctx.lineTo(x, y);
                    });
                    ctx.stroke();
                }

                // ì§€êµ¬ ê·¸ë¦¬ê¸°
                const earthDisplayRadius = Math.max(EARTH_RADIUS * scale, 15);
                const gradient = ctx.createRadialGradient(earthX, earthY, 0, earthX, earthY, earthDisplayRadius);
                gradient.addColorStop(0, '#4facfe');
                gradient.addColorStop(0.7, '#2196f3');
                gradient.addColorStop(1, '#1565c0');
                
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(earthX, earthY, earthDisplayRadius, 0, 2 * Math.PI);
                ctx.fill();

                // ëŒ€ê¸° íš¨ê³¼
                ctx.strokeStyle = 'rgba(79, 172, 254, 0.3)';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(earthX, earthY, earthDisplayRadius * 1.2, 0, 2 * Math.PI);
                ctx.stroke();

                // ìœ„ì„± ìœ„ì¹˜ ê³„ì‚°
                const pos = this.getCurrentPosition();
                const satX = pos.r * Math.cos(pos.nu) * scale;
                const satY = pos.r * Math.sin(pos.nu) * scale;

                // ê¶¤ì ì— ì¶”ê°€
                if (this.showTrail) {
                    this.trail.push({ x: satX, y: satY });
                    if (this.trail.length > 500) this.trail.shift();
                }

                // ì§€êµ¬-ìœ„ì„± ì—°ê²°ì„ 
                if (this.showVectors) {
                    ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
                    ctx.lineWidth = 1;
                    ctx.setLineDash([5, 5]);
                    ctx.beginPath();
                    ctx.moveTo(earthX, earthY);
                    ctx.lineTo(earthX + satX, earthY - satY);
                    ctx.stroke();
                    ctx.setLineDash([]);
                }

                // ì†ë„ ë²¡í„°
                if (this.showVectors) {
                    const vAngle = pos.nu + Math.PI / 2;
                    const vScale = pos.v * 5;
                    const vx = vScale * Math.cos(vAngle) * scale;
                    const vy = vScale * Math.sin(vAngle) * scale;

                    ctx.strokeStyle = '#ffd93d';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.moveTo(earthX + satX, earthY - satY);
                    ctx.lineTo(earthX + satX + vx, earthY - satY - vy);
                    ctx.stroke();

                    // í™”ì‚´í‘œ
                    const arrowAngle = Math.atan2(-vy, vx);
                    const arrowSize = 10;
                    ctx.fillStyle = '#ffd93d';
                    ctx.beginPath();
                    ctx.moveTo(earthX + satX + vx, earthY - satY - vy);
                    ctx.lineTo(
                        earthX + satX + vx - arrowSize * Math.cos(arrowAngle - Math.PI / 6),
                        earthY - satY - vy - arrowSize * Math.sin(arrowAngle - Math.PI / 6)
                    );
                    ctx.lineTo(
                        earthX + satX + vx - arrowSize * Math.cos(arrowAngle + Math.PI / 6),
                        earthY - satY - vy - arrowSize * Math.sin(arrowAngle + Math.PI / 6)
                    );
                    ctx.closePath();
                    ctx.fill();
                }

                // ìœ„ì„±
                ctx.fillStyle = '#ff6b6b';
                ctx.shadowColor = '#ff6b6b';
                ctx.shadowBlur = 20;
                ctx.beginPath();
                ctx.arc(earthX + satX, earthY - satY, 8, 0, 2 * Math.PI);
                ctx.fill();
                ctx.shadowBlur = 0;

                // ê·¼ì§€ì /ì›ì§€ì  ë§ˆì»¤
                const r_p = this.a * (1 - this.e);
                const r_a = this.a * (1 + this.e);

                // ê·¼ì§€ì 
                ctx.fillStyle = 'rgba(255, 107, 107, 0.5)';
                ctx.beginPath();
                ctx.arc(earthX + r_p * scale, earthY, 5, 0, 2 * Math.PI);
                ctx.fill();
                ctx.fillStyle = '#ffffff';
                ctx.font = '12px sans-serif';
                ctx.textAlign = 'left';
                ctx.fillText('ê·¼ì§€ì ', earthX + r_p * scale + 10, earthY - 10);

                // ì›ì§€ì 
                ctx.fillStyle = 'rgba(79, 172, 254, 0.5)';
                ctx.beginPath();
                ctx.arc(earthX - r_a * scale, earthY, 5, 0, 2 * Math.PI);
                ctx.fill();
                ctx.fillStyle = '#ffffff';
                ctx.textAlign = 'right';
                ctx.fillText('ì›ì§€ì ', earthX - r_a * scale - 10, earthY - 10);

                // í†µê³„ ì—…ë°ì´íŠ¸
                document.getElementById('currentSpeed').textContent = pos.v.toFixed(2) + ' km/s';
                document.getElementById('currentAltitude').textContent = (pos.r - EARTH_RADIUS).toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",") + ' km';
                document.getElementById('trueAnomaly').textContent = (pos.nu * 180 / Math.PI).toFixed(1) + 'Â°';

                this.updateStats();
            }

            // ============================================
            // ì• ë‹ˆë©”ì´ì…˜ ë£¨í”„
            // ============================================
            animate() {
                if (this.isPlaying) {
                    this.t += 20 * this.animSpeed;
                    if (this.t > T_PERIOD) this.t -= T_PERIOD;
                }

                this.drawOrbit();
                requestAnimationFrame(() => this.animate());
            }
        }

        // ============================================
        // ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘
        // ============================================
        window.addEventListener('load', () => {
            new OrbitSimulation();
        });
    </script>
</body>
</html>