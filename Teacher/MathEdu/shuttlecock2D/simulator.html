<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>셔틀콕 2D 투사체 시뮬레이터</title>
    <style>
      :root {
        --primary: #2563eb;
        --bg: #f8fafc;
        --card: #ffffff;
        --text: #1e293b;
        --border: #e2e8f0;
      }
      body {
        font-family: "Inter", -apple-system, sans-serif;
        background: var(--bg);
        color: var(--text);
        margin: 0;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .container {
        max-width: 1000px;
        width: 100%;
      }
      .card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        margin-bottom: 20px;
      }
      .controls {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 16px;
        margin-bottom: 20px;
      }
      .control-group label {
        display: block;
        font-size: 13px;
        font-weight: 600;
        margin-bottom: 4px;
      }
      input {
        width: 100%;
        padding: 8px;
        border: 1px solid var(--border);
        border-radius: 6px;
        box-sizing: border-box;
      }
      button {
        background: var(--primary);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        font-weight: 600;
        cursor: pointer;
        transition: opacity 0.2s;
      }
      button:hover {
        opacity: 0.9;
      }
      canvas {
        width: 100%;
        height: 400px;
        background: white;
        border: 1px solid var(--border);
        border-radius: 8px;
      }
      .stats {
        margin-top: 16px;
        font-family: monospace;
        font-size: 14px;
        background: #1e293b;
        color: #10b981;
        padding: 12px;
        border-radius: 6px;
        white-space: pre-wrap;
      }
      h1 {
        font-size: 24px;
        margin-bottom: 8px;
      }
      p.desc {
        color: #64748b;
        margin-bottom: 24px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>셔틀콕 2차원 투사체 시뮬레이터</h1>
      <p class="desc">
        제곱 항력 모델 ($F_d = -kv|\vec{v}|$)을 이용한 수치해석 시뮬레이션
      </p>

      <div class="card">
        <div class="controls">
          <div class="control-group">
            <label>발사 속도 $v_0$ (m/s)</label>
            <input type="number" id="v0" value="15" step="0.5" />
          </div>
          <div class="control-group">
            <label>발사 각도 $\theta$ (deg)</label>
            <input type="number" id="angle" value="30" step="1" />
          </div>
          <div class="control-group">
            <label>항력 계수 $k$</label>
            <input type="number" id="k" value="0.15" step="0.01" />
          </div>
          <div class="control-group">
            <label>중력 $g$ (m/s²)</label>
            <input type="number" id="g" value="9.8" step="0.1" />
          </div>
        </div>
        <button onclick="runSimulation()">시뮬레이션 실행</button>
      </div>

      <div class="card">
        <canvas id="simCanvas"></canvas>
        <div id="stats" class="stats">결과가 여기 표시됩니다.</div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      let chart;
      function runSimulation() {
        const v0 = parseFloat(document.getElementById("v0").value);
        const angleDeg = parseFloat(document.getElementById("angle").value);
        const k = parseFloat(document.getElementById("k").value);
        const g = parseFloat(document.getElementById("g").value);

        const angleRad = (angleDeg * Math.PI) / 180;
        let vx = v0 * Math.cos(angleRad);
        let vy = v0 * Math.sin(angleRad);
        let x = 0,
          y = 0,
          t = 0;
        const dt = 0.005;

        const traj = [{ x: 0, y: 0 }];
        const trajIdeal = [];
        const vx0 = vx,
          vy0 = vy;

        // Resistance simulation
        while (t < 20) {
          const v = Math.sqrt(vx * vx + vy * vy);
          const ax = -k * v * vx;
          const ay = -g - k * v * vy;

          vx += ax * dt;
          vy += ay * dt;
          x += vx * dt;
          y += vy * dt;
          t += dt;

          if (y < 0) break;
          traj.push({ x, y });
        }

        // Ideal simulation
        for (let it = 0; it < 20; it += 0.05) {
          const ix = vx0 * it;
          const iy = vy0 * it - 0.5 * g * it * it;
          if (iy < 0 && it > 0) break;
          trajIdeal.push({ x: ix, y: iy });
        }

        updateChart(traj, trajIdeal);

        const maxH = Math.max(...traj.map((p) => p.y));
        const range = traj[traj.length - 1].x;
        document.getElementById("stats").innerText =
          `[시뮬레이션 결과]\n` +
          `- 비행 시간: ${t.toFixed(3)} s\n` +
          `- 수평 사거리: ${range.toFixed(3)} m\n` +
          `- 최고 높이: ${maxH.toFixed(3)} m\n` +
          `- 종단 속도 추정(v_T = sqrt(g/k)): ${Math.sqrt(g / k).toFixed(
            2
          )} m/s`;
      }

      function updateChart(res, ideal) {
        const ctx = document.getElementById("simCanvas").getContext("2d");
        if (chart) chart.destroy();

        chart = new Chart(ctx, {
          type: "scatter",
          data: {
            datasets: [
              {
                label: "공기저항 모델 (셔틀콕)",
                data: res,
                borderColor: "#2563eb",
                showLine: true,
                pointRadius: 0,
              },
              {
                label: "무저항 모델 (포물선)",
                data: ideal,
                borderColor: "#94a3b8",
                borderDash: [5, 5],
                showLine: true,
                pointRadius: 0,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              x: { title: { display: true, text: "거리 x (m)" } },
              y: { title: { display: true, text: "높이 y (m)" }, min: 0 },
            },
          },
        });
      }

      window.onload = runSimulation;
    </script>
  </body>
</html>
