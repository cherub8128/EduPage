<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>셔틀콕 낙하 운동 탐구 보고서</title>

    <!-- Modern Design System -->
    <link rel="stylesheet" href="../css/main.css" />
    <link rel="stylesheet" href="../css/components/report.css" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+KR:wght@400;500;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/naen-nae/d2coding/d2coding-subset.css">

    <!-- Libs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

    <style>
        .chart-container {
            position: relative;
            height: 300px;
            background: white;
            border: 1px solid var(--border-light);
            border-radius: var(--radius-md);
            padding: 1rem;
        }
    </style>
</head>

<body>

    <!-- Back Button -->
    <a href="../index.html" class="m-back-btn" aria-label="Back">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2">
            <line x1="19" y1="12" x2="5" y2="12"></line>
            <polyline points="12 19 5 12 12 5"></polyline>
        </svg>
    </a>

    <div class="container pt-lg pb-lg">

        <!-- Header -->
        <header class="modern-header flex justify-between items-end flex-wrap gap-4">
            <div>
                <div class="mb-2">
                    <span class="m-badge" style="background:var(--grad-primary); color:white;">One-Page Report</span>
                </div>
                <h1>셔틀콕 낙하 운동</h1>
                <p>종단속도와 공기저항 모델링</p>
            </div>
            <div class="flex gap-2 print-hidden">
                <button id="export-pdf" class="m-btn primary small">
                    <span>📄 PDF 저장</span>
                </button>
            </div>
        </header>

        <main class="flex flex-col gap-6">

            <!-- Student Info -->
            <section class="m-card">
                <div class="m-grid" style="grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div>
                        <label for="student-id" class="font-bold text-sm block mb-1">학번</label>
                        <input id="student-id" class="m-input savable" placeholder="예: 30212">
                    </div>
                    <div>
                        <label for="student-name" class="font-bold text-sm block mb-1">이름</label>
                        <input id="student-name" class="m-input savable" placeholder="예: 홍길동">
                    </div>
                </div>
            </section>

            <!-- Navigation -->
            <nav class="flex flex-wrap gap-2 print-hidden">
                <a href="#step1" class="m-badge hover:bg-gray-200 cursor-pointer text-decoration-none">Step 1: 관찰</a>
                <a href="#step2" class="m-badge hover:bg-gray-200 cursor-pointer text-decoration-none">Step 2: 모델링</a>
                <a href="#step3" class="m-badge hover:bg-gray-200 cursor-pointer text-decoration-none">Step 3: 데이터
                    분석</a>
                <a href="#step4" class="m-badge hover:bg-gray-200 cursor-pointer text-decoration-none">Step 4: 시뮬레이션</a>
                <a href="#step5" class="m-badge hover:bg-gray-200 cursor-pointer text-decoration-none">Step 5: 심화</a>
            </nav>

            <!-- Step 1: Observation -->
            <section id="step1" class="m-card">
                <h2 class="text-xl font-bold mb-4">Step 1: 현상 관찰</h2>
                <div class="m-grid" style="grid-template-columns: 1fr 1fr; gap: 2rem;">
                    <div>
                        <strong class="block mb-2 text-sm text-neutral-600">관찰 사진</strong>
                        <div id="gallery1-drop" class="dropzone p-4">분석할 사진을 추가하세요.</div>
                        <div class="flex gap-2 mt-2">
                            <input id="gallery1-input" type="file" accept="image/*" multiple class="hidden">
                            <button id="gallery1-add" class="m-btn small secondary"
                                onclick="document.getElementById('gallery1-input').click()">+ 추가</button>
                            <button id="gallery1-clear" class="m-btn small secondary"
                                onclick="if(confirm('삭제?')) document.getElementById('gallery1').innerHTML=''">초기화</button>
                        </div>
                        <div id="gallery1" class="gallery-grid"></div>
                    </div>
                    <div>
                        <label class="font-bold text-sm block mb-2">관찰 내용</label>
                        <div class="editable-container">
                            <textarea id="observations" class="savable markdown-input"
                                placeholder="- 자유낙하와 달리 낙하 속도가 일정해지는 것을 발견함.&#10;- 추측: 공기저항 때문일 것임."></textarea>
                            <div class="markdown-preview"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Step 2: Modeling -->
            <section id="step2" class="m-card">
                <h2 class="text-xl font-bold mb-4">Step 2: 수학적 모델링</h2>

                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <strong class="text-sm block mb-1">모델 A: 자유낙하</strong>
                        $$ y(t) = \frac{1}{2}gt^2 $$
                        <span class="text-xs text-neutral-500">가정: 공기저항 무시, g 일정</span>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <strong class="text-sm block mb-1">모델 B: 공기저항 (셔틀콕)</strong>
                        $$ ma = mg - kv^2 $$
                        $$ v_T = \sqrt{g/k} $$
                        <span class="text-xs text-neutral-500">가정: 저항력은 속력의 제곱에 비례</span>
                    </div>
                </div>

                <label class="font-bold text-sm block mb-2">유도 과정 서술</label>
                <div class="editable-container">
                    <textarea id="derivation" class="savable markdown-input"
                        placeholder="모델 B의 미분방정식을 풀면..."></textarea>
                    <div class="markdown-preview"></div>
                </div>
            </section>

            <!-- Step 3: Analysis -->
            <section id="step3" class="m-card">
                <h2 class="text-xl font-bold mb-4">Step 3: 데이터 분석</h2>

                <div class="m-grid" style="grid-template-columns: 1fr 2fr; gap: 2rem;">
                    <div class="flex flex-col gap-4">
                        <div class="space-y-2">
                            <label class="font-bold text-sm block">1. 데이터 업로드 (CSV)</label>
                            <input type="file" id="csvFile" accept=".csv" class="m-input text-sm">
                            <p class="text-xs text-muted">Tracker에서 내보낸 CSV 파일 (t, y 열 필수)</p>
                        </div>

                        <div class="space-y-2">
                            <label class="font-bold text-sm block">2. 분석 모델 선택</label>
                            <select id="fitMode" class="m-input">
                                <option value="freefall">자유낙하 (y ~ t²)</option>
                                <option value="shuttle">셔틀콕 (a ~ v²)</option>
                            </select>
                        </div>

                        <button id="runFit" class="m-btn primary w-full">분석 실행</button>

                        <div class="bg-gray-50 p-3 rounded border text-sm font-mono mt-2 min-h-[3rem]" id="fitResult">
                            결과 대기 중...
                        </div>
                    </div>

                    <div class="flex flex-col gap-4">
                        <div class="chart-container">
                            <canvas id="chart1"></canvas>
                        </div>
                        <div class="chart-container">
                            <canvas id="chart2"></canvas>
                        </div>
                    </div>
                </div>

                <div class="mt-4">
                    <label class="font-bold text-sm block mb-2">데이터 해석</label>
                    <div class="editable-container">
                        <textarea id="analysis-text" class="savable markdown-input"
                            placeholder="분석 결과, 종단 속도는 약 ... m/s로 측정되었다."></textarea>
                        <div class="markdown-preview"></div>
                    </div>
                </div>
            </section>

            <!-- Step 4: Simulation -->
            <section id="step4" class="m-card">
                <h2 class="text-xl font-bold mb-4">Step 4: 예측 및 시뮬레이션</h2>

                <div class="m-grid" style="grid-template-columns: 1fr 2fr; gap: 2rem;">
                    <div class="space-y-4">
                        <div>
                            <label class="font-bold text-sm block mb-1">저항 모델</label>
                            <select id="simModel" class="m-input">
                                <option value="quad">제곱 저항 (-kv²)</option>
                                <option value="none">무저항 (자유낙하)</option>
                            </select>
                        </div>
                        <div>
                            <label class="font-bold text-sm block mb-1">중력가속도 (g)</label>
                            <input type="number" id="simG" class="m-input savable" value="9.8" step="0.1">
                        </div>
                        <div>
                            <label class="font-bold text-sm block mb-1">저항계수 (k)</label>
                            <input type="number" id="simK" class="m-input savable" value="0.22" step="0.01">
                        </div>
                        <button id="runSim" class="m-btn secondary w-full">시뮬레이션 시작</button>
                        <div id="simSummary" class="text-xs font-mono text-muted"></div>
                    </div>

                    <div class="chart-container">
                        <canvas id="simChart"></canvas>
                    </div>
                </div>
            </section>

            <!-- Step 5: Advanced & Conclusion -->
            <section id="step5" class="m-card">
                <h2 class="text-xl font-bold mb-4">Step 5: 결론 및 심화 탐구</h2>
                <div class="space-y-4">
                    <div>
                        <label class="font-bold text-sm block mb-1">심화 탐구 주제</label>
                        <div class="editable-container">
                            <textarea id="inquiry-content" class="savable markdown-input"
                                placeholder="예: 셔틀콕의 회전이 낙하 속도에 미치는 영향은?"></textarea>
                            <div class="markdown-preview"></div>
                        </div>
                    </div>
                    <div>
                        <label class="font-bold text-sm block mb-1">결론</label>
                        <div class="editable-container">
                            <textarea id="inquiry-conclusion" class="savable markdown-input"
                                placeholder="실험과 모델링 결과를 종합하여 결론을 작성하세요."></textarea>
                            <div class="markdown-preview"></div>
                        </div>
                    </div>
                </div>
            </section>

        </main>

        <footer class="mt-8 text-center text-sm text-muted print-hidden">
            <div id="autosave-status" class="flex items-center justify-center gap-2 opacity-0 transition-opacity">
                <span id="autosave-icon-saving" class="hidden">💾 저장 중...</span>
                <span id="autosave-icon-saved" class="text-green-600 hidden">✅ 저장됨</span>
                <span id="autosave-text"></span>
            </div>
            <p class="mt-4">MathEdu Project 2025.</p>
        </footer>

    </div>

    <!-- Logic -->
    <script type="module" src="script.js"></script>

</body>

</html>