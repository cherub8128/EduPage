<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caustic Curve - Interactive Worksheet</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- KaTeX for math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" xintegrity="sha384-n8MVd4RsNIU0KOVEMcAgsUFkSSJGd6zwuTufMcmgNIEsheet" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" xintegrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG6U2dVYot" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" xintegrity="sha384-+VBxd3r6XgURPl3dqSdxDYfJnmbckUhrGNaLqLoJSEQMAQeh0uDxMLI" crossorigin="anonymous"></script>
    <!-- PrismJS for code highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />


    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            scroll-behavior: smooth;
        }
        .step-card {
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .step-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .interactive-canvas {
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            background-color: #f8fafc;
        }
        .slider-label {
            min-width: 120px;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #3b82f6;
            cursor: pointer;
            border-radius: 50%;
        }
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #3b82f6;
            cursor: pointer;
            border-radius: 50%;
        }
        /* Tab styles */
        .tab-button {
            transition: all 0.3s;
        }
        .tab-button.active {
            border-color: #3b82f6;
            color: #3b82f6;
            font-weight: 600;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        pre[class*="language-"] {
            border-radius: 0.5rem;
        }
        /* Inline code style */
        code:not(pre > code) {
            background-color: #eef2ff; /* indigo-50 */
            color: #3730a3; /* indigo-800 */
            padding: 0.125rem 0.375rem;
            border-radius: 0.25rem;
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-size: 0.9em;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>

    <!-- Header -->
    <header class="bg-white shadow-md sticky top-0 z-20">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <h1 class="text-2xl font-bold text-blue-600">☕ Caustic Curve 탐구 활동지</h1>
            <!-- Desktop Nav -->
            <nav class="hidden md:flex space-x-4">
                <a href="#step1" class="text-gray-600 hover:text-blue-500">Step 1: 관찰</a>
                <a href="#step2" class="text-gray-600 hover:text-blue-500">Step 2: 모델링</a>
                <a href="#step3" class="text-gray-600 hover:text-blue-500">Step 3: 에피사이클로이드</a>
                <a href="#step4" class="text-gray-600 hover:text-blue-500">Step 4: 시뮬레이션</a>
                <a href="#step5" class="text-gray-600 hover:text-blue-500">Step 5: 심화 탐구</a>
            </nav>
            <!-- Mobile Menu Button -->
            <div class="md:hidden">
                <button id="mobile-menu-button" class="text-gray-800 focus:outline-none">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
                    </svg>
                </button>
            </div>
        </div>
        <!-- Mobile Nav -->
        <nav id="mobile-menu" class="md:hidden hidden bg-white px-6 pt-2 pb-4">
            <a href="#step1" class="block py-2 text-gray-600 hover:text-blue-500">Step 1: 관찰</a>
            <a href="#step2" class="block py-2 text-gray-600 hover:text-blue-500">Step 2: 모델링</a>
            <a href="#step3" class="block py-2 text-gray-600 hover:text-blue-500">Step 3: 에피사이클로이드</a>
            <a href="#step4" class="block py-2 text-gray-600 hover:text-blue-500">Step 4: 시뮬레이션</a>
            <a href="#step5" class="block py-2 text-gray-600 hover:text-blue-500">Step 5: 심화 탐구</a>
        </nav>
    </header>

    <main class="container mx-auto px-6 py-12">
        <p class="text-center text-lg text-gray-600 mb-12">"수학은 보이지 않는 것을 보는 예술이다." - 이 수업을 통해 커피잔 속에서 아름다운 수학을 발견해 봅시다.</p>

        <!-- Step 1: Observation -->
        <section id="step1" class="mb-16">
            <div class="step-card bg-white p-8 rounded-xl shadow-lg">
                <h2 class="text-3xl font-bold mb-4 border-b-2 border-blue-200 pb-2">Step 1: 현상 관찰 및 문제 발견</h2>
                <p class="mb-6 text-gray-600">스마트폰 플래시를 이용해 커피잔 안쪽에 빛을 비추고, 바닥에 생기는 밝은 무늬(Caustic)를 관찰해 봅시다.</p>
                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <h3 class="block text-lg font-semibold mb-2">📸 관찰 예시 사진</h3>
                        <div class="mt-4 border rounded-lg p-4 bg-gray-50 min-h-[200px] flex items-center justify-center">
                            <img id="image-preview" src="images/cup0.jpg" alt="커피잔 속 Caustic 현상 예시" class="max-w-full max-h-64 rounded-md">
                        </div>
                    </div>
                    <div>
                        <label for="observations" class="block text-lg font-semibold mb-2">📝 관찰 내용 및 질문 기록하기</label>
                        <textarea id="observations" rows="10" class="w-full p-4 border rounded-lg focus:ring-2 focus:ring-blue-400 focus:outline-none" placeholder="예시)&#10;- 빛이 만드는 무늬는 하트 모양과 비슷하다.&#10;- 컵의 어느 부분에 빛을 비추느냐에 따라 모양이 약간씩 변한다.&#10;- 이 곡선의 뾰족한 부분은 왜 생길까?&#10;- 이 곡선을 수학식으로 표현할 수 있을까?"></textarea>
                    </div>
                </div>
            </div>
        </section>

        <!-- Step 2: Modeling -->
        <section id="step2" class="mb-16">
            <div class="step-card bg-white p-8 rounded-xl shadow-lg">
                <h2 class="text-3xl font-bold mb-4 border-b-2 border-green-200 pb-2">Step 2: 반사 광선 수학적 모델링</h2>
                <p class="mb-6 text-gray-600">3차원 현상을 2차원으로 단순화하여, 빛의 반사 법칙을 이용해 반사 광선을 수학적으로 표현해 봅시다.</p>
                <div class="flex flex-col lg:flex-row items-center gap-8">
                    <div class="w-full lg:w-1/2">
                        <canvas id="reflectionCanvas" width="400" height="400" class="interactive-canvas mx-auto"></canvas>
                    </div>
                    <div class="w-full lg:w-1/2 space-y-4">
                        <div class="flex items-center">
                             <label for="theta-slider" class="slider-label font-medium">반사점 각도 (\(\theta\)):</label>
                            <input type="range" id="theta-slider" min="0" max="180" value="135" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                            <span id="theta-value" class="ml-4 font-semibold w-16 text-center">45°</span>
                        </div>
                        <div class="bg-gray-100 p-4 rounded-lg">
                            <h4 class="font-semibold text-lg mb-2">주요 공식</h4>
                            <p>▪️ <strong class="font-semibold">반사점 P:</strong> \( P(\theta) = (R\cos\theta, R\sin\theta) \)</p>
                            <p>▪️ <strong class="font-semibold">반사 광선 방향 벡터:</strong> \( \vec{v} = (-\cos(2\theta), -\sin(2\theta)) \)</p>
                            <p>▪️ <strong class="font-semibold">반사 광선 \(L(\theta)\) 방정식:</strong> </p>
                            <div id="line-equation" class="text-sm pl-4"></div>
                        </div>
                         <div class="bg-blue-50 p-4 rounded-lg text-blue-800">
                             <p><strong class="font-bold">탐구:</strong> 슬라이더를 움직이며 \(\theta\)값이 변할 때 반사 광선이 어떻게 변하는지 관찰해 보세요. 이 광선들이 모여 어떤 모양을 만들어낼지 상상해 봅시다.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Step 3: Epicycloid -->
        <section id="step3" class="mb-16">
             <div class="step-card bg-white p-8 rounded-xl shadow-lg">
                <h2 class="text-3xl font-bold mb-4 border-b-2 border-purple-200 pb-2">Step 3: 포락선과 에피사이클로이드</h2>
                <p class="mb-6 text-gray-600">반사 광선들이 만드는 포락선(Caustic)은 사실 '에피사이클로이드'라는 특별한 곡선입니다. 슬라이더를 조절하며 다양한 에피사이클로이드를 관찰해 봅시다.</p>
                <div class="flex flex-col lg:flex-row items-center gap-8">
                     <div class="w-full lg:w-1/2">
                        <canvas id="epicycloidCanvas" width="400" height="400" class="interactive-canvas mx-auto"></canvas>
                    </div>
                    <div class="w-full lg:w-1/2 space-y-4">
                        <div class="flex items-center">
                             <label for="k-slider" class="slider-label font-medium">뾰족점 개수 (k):</label>
                            <input type="range" id="k-slider" min="1" max="10" value="2" step="1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                            <span id="k-value" class="ml-4 font-semibold w-16 text-center">2</span>
                        </div>
                         <div class="flex items-center">
                             <label for="size-slider" class="slider-label font-medium">크기 (r):</label>
                            <input type="range" id="size-slider" min="10" max="50" value="25" step="1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                            <span id="size-value" class="ml-4 font-semibold w-16 text-center">25</span>
                        </div>
                        <div class="flex items-center">
                             <label for="epicycloid-slider" class="slider-label font-medium">생성 각도:</label>
                            <input type="range" id="epicycloid-slider" min="0" max="360" value="360" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                            <span id="epicycloid-value" class="ml-4 font-semibold w-16 text-center">360°</span>
                        </div>
                        <div class="bg-gray-100 p-4 rounded-lg">
                            <h4 class="font-semibold text-lg mb-2">에피사이클로이드 방정식</h4>
                            <p>\( x(t) = r(k+1)\cos(t) - r\cos((k+1)t) \)</p>
                            <p>\( y(t) = r(k+1)\sin(t) - r\sin((k+1)t) \)</p>
                            <p class="text-sm mt-2">(이때, \(k = R/r\))</p>
                        </div>
                        <div class="bg-purple-50 p-4 rounded-lg text-purple-800">
                            <p><strong class="font-bold">탐구:</strong> 커피잔 속 무늬는 \(k=2\)일 때 나타납니다. \(k\)값을 바꾸면 어떤 모양이 나타나는지 관찰해 보세요.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Step 4: Simulation Tools -->
        <section id="step4" class="mb-16">
            <div class="step-card bg-white p-8 rounded-xl shadow-lg">
                <h2 class="text-3xl font-bold mb-4 border-b-2 border-teal-200 pb-2">Step 4: 공학 도구로 시뮬레이션하기</h2>
                <p class="mb-6 text-gray-600">GeoGebra, Python, MATLAB 등 다양한 공학 도구를 사용하여 우리가 유도한 Caustic Curve를 직접 그려보고 탐구해 봅시다.</p>
                
                <div class="mb-4 border-b border-gray-200">
                    <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                        <button class="tab-button active whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" data-tab="geogebra1">GeoGebra (도구)</button>
                        <button class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="geogebra2">GeoGebra (수식)</button>
                        <button class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="python">Python</button>
                        <button class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="matlab">MATLAB</button>
                    </nav>
                </div>

                <div>
                    <div id="geogebra1" class="tab-content active">
                        <h3 class="text-xl font-semibold mb-2">GeoGebra로 포락선 그리기 (도구 활용)</h3>
                        <p class="mb-4 text-gray-600">GeoGebra의 도구를 이용해 커피잔에서 반사되는 빛을 구현해 봅시다.</p>
                        <div class="grid md:grid-cols-2 gap-8">
                            <ol class="list-decimal list-inside space-y-2 bg-gray-50 p-4 rounded-md">
                                <li><strong class="font-semibold">도구 펼치기:</strong> <code>도구</code> ➡️ <code>펼치기</code> 버튼 클릭</li>
                                <li><strong class="font-semibold">원 그리기:</strong> <code>원:중심과 반지름</code> ➡️ 원점 클릭 후 (1,0) 클릭</li>
                                <li><strong class="font-semibold">원 위의 점 찍기:</strong> <code>대상 위의 점</code> ➡️ 원 위의 한 점 클릭 (점 A)</li>
                                <li><strong class="font-semibold">수평선 그리기:</strong> <code>평행선</code> ➡️ x축 클릭 ➡️ 점 A 클릭</li>
                                <li><strong class="font-semibold">접선 그리기:</strong> <code>접선</code> ➡️ 점 A 클릭 ➡️ 원 클릭</li>
                                <li><strong class="font-semibold">반사선 그리기:</strong> <code>직선에 대하여 대칭</code> ➡️ 수평선 클릭 ➡️ 접선 클릭</li>
                                <li><strong class="font-semibold">자취 보이기:</strong> 반사선 오른쪽 클릭 ➡️ <code>자취 보이기</code> 체크</li>
                                <li><strong class="font-semibold">애니메이션:</strong> 점 A 오른쪽 클릭 ➡️ <code>애니메이션</code> 실행</li>
                            </ol>
                            <div class="flex items-center justify-center">
                                <img src="images/geogebra1.png" alt="GeoGebra 자취 기능 예시" class="rounded-lg shadow-md">
                            </div>
                        </div>
                    </div>
                    <div id="geogebra2" class="tab-content">
                        <h3 class="text-xl font-semibold mb-2">GeoGebra로 포락선 그리기 (수식 활용)</h3>
                        <p class="mb-4 text-gray-600">GeoGebra의 자취 기능을 이용하면 반사 광선들이 만드는 포락선을 동적으로 확인할 수 있습니다.</p>
                        <ol class="list-decimal list-inside space-y-2 bg-gray-50 p-4 rounded-md">
                            <li><strong class="font-semibold">슬라이더 만들기:</strong> <code>슬라이더</code> 도구로 변수 \(\theta\)를 \(0\)에서 \(2\pi\) 범위로 만듭니다.</li>
                            <li><strong class="font-semibold">원과 반사점 생성:</strong> <code>x^2 + y^2 = 1</code>로 원을 그리고, <code>P = (cos(θ), sin(θ))</code>로 반사점을 만듭니다.</li>
                            <li><strong class="font-semibold">반사 광선 그리기:</strong> <code>y - sin(θ) = tan(2θ) * (x - cos(θ))</code>를 입력합니다.</li>
                            <li><strong class="font-semibold">자취 그리기:</strong> <code>자취</code> 도구를 선택 후, 반사 광선을 클릭하고 이어서 \(\theta\) 슬라이더를 클릭합니다. 슬라이더를 움직이면 Caustic Curve가 그려집니다.</li>
                        </ol>
                    </div>
                    <div id="python" class="tab-content">
                        <h3 class="text-xl font-semibold mb-2">Python으로 Caustic Curve 그리기</h3>
                        <p class="mb-4 text-gray-600">Matplotlib와 NumPy 라이브러리를 사용하여 Caustic Curve를 정교하게 시각화할 수 있습니다.</p>
<pre><code class="language-python">
import numpy as np
import matplotlib.pyplot as plt

# 각도 배열 생성
theta = np.linspace(0, 2 * np.pi, 400)

# 에피사이클로이드(Caustic) 방정식
x = 0.75 * np.cos(theta) - 0.25 * np.cos(3 * theta)
y = 0.75 * np.sin(theta) - 0.25 * np.sin(3 * theta)

# 원(커피잔) 그리기
circle_x = np.cos(theta)
circle_y = np.sin(theta)

# 시각화
plt.figure(figsize=(8, 8))
plt.plot(circle_x, circle_y, 'b--', label='Coffee Cup')
plt.plot(x, y, 'r-', linewidth=2, label='Caustic Curve')
plt.title('Caustic Curve Simulation')
plt.xlabel('x-axis')
plt.ylabel('y-axis')
plt.grid(True)
plt.legend()
plt.axis('equal')
plt.show()
</code></pre>
                    </div>
                    <div id="matlab" class="tab-content">
                        <h3 class="text-xl font-semibold mb-2">MATLAB으로 Caustic Curve 그리기</h3>
                        <p class="mb-4 text-gray-600">MATLAB은 공학 및 과학 계산에 널리 쓰이는 강력한 도구입니다.</p>
<pre><code class="language-matlab">
% 각도 벡터 생성
theta = linspace(0, 2*pi, 400);

% 에피사이클로이드(Caustic) 방정식
x = 0.75 * cos(theta) - 0.25 * cos(3 * theta);
y = 0.75 * sin(theta) - 0.25 * sin(3 * theta);

% 원(커피잔) 좌표 생성
circle_x = cos(theta);
circle_y = sin(theta);

% 그래프 그리기
figure;
hold on;
plot(circle_x, circle_y, '--b', 'DisplayName', 'Coffee Cup');
plot(x, y, '-r', 'LineWidth', 2, 'DisplayName', 'Caustic Curve');
title('Caustic Curve Simulation');
xlabel('x-axis');
ylabel('y-axis');
grid on;
axis equal;
legend('show');
hold off;
</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- Step 5: Deep Dive -->
        <section id="step5">
            <div class="step-card bg-white p-8 rounded-xl shadow-lg">
                <h2 class="text-3xl font-bold mb-4 border-b-2 border-yellow-200 pb-2">Step 5: 나만의 심화 탐구 설계하기</h2>
                <p class="mb-6 text-gray-600">지금까지의 탐구를 바탕으로, 여러분의 흥미와 진로에 맞춰 새로운 질문을 던지고 '나만의 탐구 프로젝트'를 설계해 봅시다.</p>
                <div class="bg-gray-50 p-6 rounded-lg">
                    <div class="mb-4">
                        <label for="project-title" class="block text-lg font-semibold mb-2">탐구 주제:</label>
                        <input type="text" id="project-title" class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-yellow-400 focus:outline-none" placeholder="예시) 포물선 거울이 만드는 포락선 분석">
                    </div>
                    <div class="mb-4">
                        <label for="project-question" class="block text-lg font-semibold mb-2">탐구 질문:</label>
                        <textarea id="project-question" rows="3" class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-yellow-400 focus:outline-none" placeholder="예시) 커피잔이 원이 아닌 포물선 모양이라면, 반사광의 포락선은 어떤 모양일까?"></textarea>
                    </div>
                    <div class="mb-4">
                        <label for="project-method" class="block text-lg font-semibold mb-2">탐구 방법:</label>
                        <textarea id="project-method" rows="4" class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-yellow-400 focus:outline-none" placeholder="예시)&#10;1. 포물선 y=x^2 위의 점에서의 법선 벡터를 구한다.&#10;2. 빛의 반사 법칙을 적용하여 반사 광선의 방정식을 유도한다.&#10;3. GeoGebra를 이용해 포락선을 시각화하고 특징을 분석한다."></textarea>
                    </div>
                     <button id="copy-plan" class="w-full bg-yellow-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-yellow-600 transition-colors">계획서 내용 복사하기</button>
                     <p id="copy-info" class="text-sm text-center mt-2 text-green-600 font-semibold hidden">✅ 클립보드에 복사되었습니다!</p>
                </div>
            </div>
        </section>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            renderMathInElement(document.body, {
                delimiters: [
                    {left: '$$', right: '$$', display: true},
                    {left: '$', right: '$', display: false},
                    {left: '\\(', right: '\\)', display: false},
                    {left: '\\[', right: '\\]', display: true}
                ]
            });
            Prism.highlightAll();
        });

        // Mobile menu toggle
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        mobileMenuButton.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });
        document.querySelectorAll('#mobile-menu a').forEach(link => {
            link.addEventListener('click', () => {
                mobileMenu.classList.add('hidden');
            });
        });

        // Copy plan to clipboard
        const copyBtn = document.getElementById('copy-plan');
        const copyInfo = document.getElementById('copy-info');
        copyBtn.addEventListener('click', () => {
            const title = document.getElementById('project-title').value;
            const question = document.getElementById('project-question').value;
            const method = document.getElementById('project-method').value;
            
            const textToCopy = `[미적분 탐구 계획서]\n\n1. 탐구 주제:\n${title}\n\n2. 탐구 질문:\n${question}\n\n3. 탐구 방법:\n${method}`;
            
            navigator.clipboard.writeText(textToCopy).then(() => {
                copyInfo.classList.remove('hidden');
                setTimeout(() => {
                    copyInfo.classList.add('hidden');
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy: ', err);
            });
        });


        // Canvas 1: Reflection Simulation
        const canvas1 = document.getElementById('reflectionCanvas');
        const ctx1 = canvas1.getContext('2d');
        const slider1 = document.getElementById('theta-slider');
        const value1 = document.getElementById('theta-value');
        const equationEl = document.getElementById('line-equation');

        function drawReflection() {
            const sliderValue = parseFloat(slider1.value);
            const angleDeg = sliderValue - 90;
            const angleRad = angleDeg * Math.PI / 180;
            
            const centerX = canvas1.width / 2;
            const centerY = canvas1.height / 2;
            const radius = 150;

            ctx1.clearRect(0, 0, canvas1.width, canvas1.height);

            ctx1.beginPath();
            ctx1.arc(centerX, centerY, radius, 0, 2 * Math.PI);
            ctx1.strokeStyle = '#9ca3af';
            ctx1.lineWidth = 2;
            ctx1.stroke();

            ctx1.beginPath();
            ctx1.moveTo(0, centerY);
            ctx1.lineTo(canvas1.width, centerY);
            ctx1.moveTo(centerX, 0);
            ctx1.lineTo(centerX, canvas1.height);
            ctx1.strokeStyle = '#d1d5db';
            ctx1.stroke();
            
            const px = centerX + radius * Math.cos(angleRad);
            const py = centerY - radius * Math.sin(angleRad);

            ctx1.beginPath();
            ctx1.moveTo(0, py);
            ctx1.lineTo(px, py);
            ctx1.strokeStyle = '#f59e0b';
            ctx1.lineWidth = 2;
            ctx1.stroke();
            
            const reflectedAngle = 2 * angleRad;
            const directionX = -Math.cos(reflectedAngle);
            const directionY = -Math.sin(reflectedAngle);

            ctx1.beginPath();
            ctx1.moveTo(px, py);
            ctx1.lineTo(px + 400 * directionX, py - 400 * directionY);
            ctx1.strokeStyle = '#10b981'; 
            ctx1.lineWidth = 2;
            ctx1.stroke();

            ctx1.beginPath();
            ctx1.arc(px, py, 5, 0, 2 * Math.PI);
            ctx1.fillStyle = '#ef4444'; 
            ctx1.fill();

            value1.textContent = `${angleDeg.toFixed(0)}°`;
            
            const displayAngle = (angleDeg < 0) ? angleDeg + 360 : angleDeg;
            equationEl.innerHTML = `\\( y - \\sin(${displayAngle.toFixed(1)}^\\circ) = \\tan(${(2*displayAngle).toFixed(1)}^\\circ)(x - \\cos(${displayAngle.toFixed(1)}^\\circ)) \\)`;
            renderMathInElement(equationEl);
        }
        slider1.addEventListener('input', drawReflection);
        drawReflection();


        // Canvas 2: Epicycloid Simulation
        const canvas2 = document.getElementById('epicycloidCanvas');
        const ctx2 = canvas2.getContext('2d');
        const kSlider = document.getElementById('k-slider');
        const kValue = document.getElementById('k-value');
        const sizeSlider = document.getElementById('size-slider');
        const sizeValue = document.getElementById('size-value');
        const epicycloidAngleSlider = document.getElementById('epicycloid-slider');
        const epicycloidAngleValue = document.getElementById('epicycloid-value');

        function drawEpicycloid() {
            const k = parseInt(kSlider.value);
            const r = parseInt(sizeSlider.value);
            const animationAngleDeg = parseFloat(epicycloidAngleSlider.value);
            const animationAngleRad = animationAngleDeg * Math.PI / 180;
            const centerX = canvas2.width / 2;
            const centerY = canvas2.height / 2;
            const R = k * r;

            ctx2.clearRect(0, 0, canvas2.width, canvas2.height);
            
            ctx2.beginPath();
            ctx2.arc(centerX, centerY, R, 0, 2 * Math.PI); 
            ctx2.strokeStyle = '#cbd5e1';
            ctx2.stroke();
            
            const t_anim = animationAngleRad;
            const movingCircleCenterX = centerX + (R + r) * Math.cos(t_anim);
            const movingCircleCenterY = centerY - (R + r) * Math.sin(t_anim);
            
            ctx2.beginPath();
            ctx2.arc(movingCircleCenterX, movingCircleCenterY, r, 0, 2 * Math.PI); 
            ctx2.strokeStyle = '#99f6e4';
            ctx2.stroke();

            ctx2.beginPath();
            ctx2.lineWidth = 2;
            ctx2.strokeStyle = '#a855f7';
            for (let t = 0; t <= 2 * Math.PI + 0.02; t += 0.01) {
                 const x = centerX + r * (k + 1) * Math.cos(t) - r * Math.cos((k + 1) * t);
                 const y = centerY - (r * (k + 1) * Math.sin(t) - r * Math.sin((k + 1) * t));
                 if (t === 0) ctx2.moveTo(x, y);
                 else ctx2.lineTo(x, y);
            }
            ctx2.stroke();
            
            ctx2.beginPath();
            ctx2.lineWidth = 3;
            ctx2.strokeStyle = '#ef4444';
            for (let t = 0; t <= t_anim; t += 0.01) {
                 const x = centerX + r * (k + 1) * Math.cos(t) - r * Math.cos((k + 1) * t);
                 const y = centerY - (r * (k + 1) * Math.sin(t) - r * Math.sin((k + 1) * t));
                 if (t === 0) ctx2.moveTo(x, y);
                 else ctx2.lineTo(x, y);
            }
            ctx2.stroke();
            
            const tracePointX = centerX + r * (k + 1) * Math.cos(t_anim) - r * Math.cos((k + 1) * t_anim);
            const tracePointY = centerY - (r * (k + 1) * Math.sin(t_anim) - r * Math.sin((k + 1) * t_anim));
            
            ctx2.beginPath();
            ctx2.moveTo(movingCircleCenterX, movingCircleCenterY);
            ctx2.lineTo(tracePointX, tracePointY);
            ctx2.strokeStyle = 'rgba(239, 68, 68, 0.5)';
            ctx2.stroke();

            ctx2.beginPath();
            ctx2.arc(tracePointX, tracePointY, 6, 0, 2 * Math.PI);
            ctx2.fillStyle = '#ef4444';
            ctx2.fill();

            kValue.textContent = k;
            sizeValue.textContent = r;
            epicycloidAngleValue.textContent = `${animationAngleDeg.toFixed(0)}°`;
        }
        
        [kSlider, sizeSlider, epicycloidAngleSlider].forEach(slider => {
            if(slider) slider.addEventListener('input', drawEpicycloid);
        });
        drawEpicycloid();

        // Tab functionality
        const tabs = document.querySelectorAll('.tab-button');
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const target = tab.dataset.tab;
                
                tabs.forEach(t => {
                    t.classList.remove('active', 'text-blue-600', 'border-blue-600');
                    t.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                });
                document.querySelectorAll('.tab-content').forEach(c => {
                    c.classList.remove('active');
                });

                tab.classList.add('active', 'text-blue-600', 'border-blue-600');
                tab.classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                document.getElementById(target).classList.add('active');
            });
        });
    </script>
</body>
</html>

