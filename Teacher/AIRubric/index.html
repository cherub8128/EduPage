<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>루브릭 평가 도우미</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://unpkg.com/pdfjs-dist@3.11.174/build/pdf.min.js"></script>
    <script>
      pdfjsLib.GlobalWorkerOptions.workerSrc =
        'https://unpkg.com/pdfjs-dist@3.11.174/build/pdf.worker.min.js';
    </script>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;500;600;700&display=swap');
      :root {
        --brand-color: #4f46e5;
        --brand-color-light: #e0e7ff;
        --brand-color-dark: #3730a3;
        --bg-light: #f9fafb;
        --border-color: #e5e7eb;
      }
      html,
      body {
        height: 100%;
        scroll-behavior: smooth;
      }
      body {
        font-family: 'Pretendard', sans-serif;
        background-color: var(--bg-light);
      }
      .card {
        background: white;
        border-radius: 1rem;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
        border: 1px solid var(--border-color);
      }
      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        font-weight: 600;
        transition: all 0.2s;
      }
      .btn-primary {
        background: var(--brand-color);
        color: white;
      }
      .btn-primary:hover {
        background: var(--brand-color-dark);
      }
      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      .btn-secondary {
        background: #e5e7eb;
        color: #374151;
      }
      .btn-secondary:hover {
        background: #d1d5db;
      }
      .sidebar {
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
      }
      .sidebar.open {
        transform: translateX(0);
      }
      .sidebar-overlay {
        transition: opacity 0.3s;
      }
      .mono {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
        background-color: #f3f4f6;
        padding: 0.1rem 0.3rem;
        border-radius: 0.25rem;
        font-size: 0.875em;
      }
      .selected-row {
        background-color: var(--brand-color-light) !important;
        color: var(--brand-color-dark);
      }
      .summary-table tbody tr {
        cursor: pointer;
      }
      .spin {
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        from {
          transform: rotate(0);
        }
        to {
          transform: rotate(360deg);
        }
      }
      input[type='text'],
      input[type='password'],
      input[type='number'],
      select,
      textarea {
        border-color: #d1d5db;
        transition: border-color 0.2s, box-shadow 0.2s;
      }
      input[type='text']:focus,
      input[type='password']:focus,
      input[type='number']:focus,
      select:focus,
      textarea:focus {
        border-color: var(--brand-color);
        box-shadow: 0 0 0 2px var(--brand-color-light);
        outline: none;
      }
      details summary {
        list-style: none;
        cursor: pointer;
      }
      details summary::-webkit-details-marker {
        display: none;
      }
      details[open] summary .details-arrow {
        transform: rotate(180deg);
      }
      .radio-group input:checked + label {
        background-color: var(--brand-color);
        color: white;
        border-color: var(--brand-color);
      }
      textarea {
        resize: none;
        overflow: hidden;
      }
    </style>
  </head>
  <body class="text-slate-800">
    <!-- 사이드바 (API 설정) -->
    <div id="sidebar-overlay" class="fixed inset-0 bg-black/50 z-30 hidden opacity-0"></div>
    <aside
      id="sidebar"
      class="fixed top-0 left-0 h-full w-full max-w-sm bg-white z-40 p-6 space-y-6 overflow-y-auto sidebar border-r"
    >
      <div class="flex items-center justify-between">
        <h2 class="text-2xl font-bold text-slate-900">설정</h2>
        <button id="closeSidebarBtn" class="p-1 rounded-full hover:bg-slate-100">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-6 h-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18L18 6M6 6l12 12"
            />
          </svg>
        </button>
      </div>

      <!-- API 설정 -->
      <details open class="space-y-4">
        <summary class="flex items-center justify-between py-2 font-semibold text-lg">
          <span>API 설정</span>
          <svg
            class="w-5 h-5 transition-transform transform details-arrow"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 20 20"
            fill="currentColor"
          >
            <path
              fill-rule="evenodd"
              d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
              clip-rule="evenodd"
            />
          </svg>
        </summary>
        <div class="space-y-4 pt-2">
          <label class="block"
            ><span class="text-sm font-medium">AI 제공자</span
            ><select id="provider" class="mt-1 w-full rounded-lg"></select
          ></label>
          <label class="block"
            ><span class="text-sm font-medium">API 키</span
            ><input
              id="apiKey"
              type="password"
              placeholder="API 키 입력"
              class="mt-1 w-full rounded-lg"
          /></label>
          <label class="block"
            ><span class="text-sm font-medium">모델명</span
            ><input id="model" type="text" class="mt-1 w-full rounded-lg"
          /></label>
          <label class="block"
            ><span class="text-sm font-medium">최대 분석 글자수</span
            ><input
              id="maxChars"
              type="number"
              min="500"
              step="250"
              value="8000"
              class="mt-1 w-full rounded-lg"
          /></label>
        </div>
      </details>
    </aside>

    <!-- 메인 콘텐츠 -->
    <div class="flex flex-col h-screen">
      <header class="p-4 bg-white/80 backdrop-blur-sm border-b sticky top-0 z-20">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
          <div class="flex items-center gap-3">
            <button id="openSidebarBtn" class="p-2 rounded-lg hover:bg-slate-100">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="w-6 h-6"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4 6h16M4 12h16M4 18h16"
                />
              </svg>
            </button>
            <h1 class="text-xl sm:text-2xl font-bold text-slate-900">루브릭 평가 도우미</h1>
          </div>
          <div class="flex items-center gap-2">
            <svg
              id="spinner"
              class="w-6 h-6 text-indigo-600 spin hidden"
              viewBox="0 0 24 24"
              fill="none"
            >
              <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" opacity=".2" />
              <path d="M22 12a10 10 0 0 1-10 10" stroke="currentColor" stroke-width="4" />
            </svg>
            <button id="startBtn" class="btn btn-primary">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 20 20"
                fill="currentColor"
                class="w-5 h-5"
              >
                <path
                  fill-rule="evenodd"
                  d="M2 10a8 8 0 1 1 16 0 8 8 0 0 1-16 0Zm6.39-2.908a.75.75 0 0 1 .94.312l2.5 4.5a.75.75 0 0 1-1.33.744L9.25 10.364l-1.64 2.953a.75.75 0 0 1-1.33-.744l2.5-4.5a.75.75 0 0 1 .56-.312Z"
                  clip-rule="evenodd"
                /></svg
              ><span>평가 시작</span>
            </button>
            <button id="stopBtn" class="btn btn-secondary">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 20 20"
                fill="currentColor"
                class="w-5 h-5"
              >
                <path
                  d="M5.25 3A2.25 2.25 0 0 0 3 5.25v9.5A2.25 2.25 0 0 0 5.25 17h9.5A2.25 2.25 0 0 0 17 14.75v-9.5A2.25 2.25 0 0 0 14.75 3h-9.5Z"
                /></svg
              ><span>중지</span>
            </button>
          </div>
        </div>
      </header>

      <main class="max-w-7xl mx-auto p-4 sm:p-6 w-full flex-grow overflow-y-auto">
        <div class="space-y-6">
          <details class="card" open>
            <summary class="p-5 flex items-center justify-between cursor-pointer">
              <h2 class="text-lg font-semibold">설정 관리 (가져오기/내보내기)</h2>
              <svg
                class="w-6 h-6 transition-transform transform details-arrow"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 20 20"
                fill="currentColor"
              >
                <path
                  fill-rule="evenodd"
                  d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                  clip-rule="evenodd"
                />
              </svg>
            </summary>
            <div class="p-5 border-t grid md:grid-cols-2 lg:grid-cols-3 gap-4">
              <div class="p-4 bg-slate-50 rounded-lg space-y-3 lg:col-span-1">
                <p class="text-sm font-semibold">프리셋/파일 불러오기</p>
                <select id="preset-select" class="w-full rounded-lg"></select>
                <div class="grid grid-cols-2 gap-2">
                  <label for="json-upload" class="btn btn-secondary text-sm w-full cursor-pointer"
                    >JSON</label
                  >
                  <input type="file" id="json-upload" class="hidden" accept=".json" />
                  <label for="csv-upload" class="btn btn-secondary text-sm w-full cursor-pointer"
                    >CSV</label
                  >
                  <input type="file" id="csv-upload" class="hidden" accept=".csv,text/csv" />
                </div>
              </div>
              <div class="p-4 bg-slate-50 rounded-lg space-y-3 lg:col-span-2">
                <p class="text-sm font-semibold">텍스트로 일괄 적용</p>
                <textarea
                  id="rubric-paste-area"
                  class="w-full rounded-lg text-sm mono"
                  rows="3"
                  placeholder="평가 계획서 전체 내용을 여기에 붙여넣으세요..."
                ></textarea>
                <button id="apply-pasted-rubric" class="btn btn-secondary text-sm w-full">
                  텍스트 적용
                </button>
              </div>
              <div class="p-4 bg-slate-50 rounded-lg space-y-3 lg:col-span-full">
                <p class="text-sm font-semibold">현재 설정 내보내기</p>
                <div class="grid grid-cols-2 gap-2">
                  <button id="json-save" class="btn btn-secondary text-sm w-full">
                    JSON으로 저장
                  </button>
                  <button id="csv-save" class="btn btn-secondary text-sm w-full">CSV로 저장</button>
                </div>
              </div>
            </div>
          </details>

          <details class="card" open>
            <summary class="p-5 flex items-center justify-between cursor-pointer">
              <h2 class="text-lg font-semibold">1. 평가 개요</h2>
              <svg
                class="w-6 h-6 transition-transform transform details-arrow"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 20 20"
                fill="currentColor"
              >
                <path
                  fill-rule="evenodd"
                  d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                  clip-rule="evenodd"
                />
              </svg>
            </summary>
            <div class="p-5 border-t space-y-4">
              <div>
                <label for="task-overview" class="font-semibold text-sm">수행 과제</label>
                <textarea
                  id="task-overview"
                  class="w-full rounded-lg text-sm mt-1"
                  rows="2"
                ></textarea>
              </div>
              <div>
                <label for="achievement-standards" class="font-semibold text-sm">성취기준</label>
                <textarea
                  id="achievement-standards"
                  class="w-full rounded-lg text-sm mt-1"
                  rows="2"
                ></textarea>
              </div>
              <div>
                <label for="core-ideas" class="font-semibold text-sm">핵심 아이디어</label>
                <textarea
                  id="core-ideas"
                  class="w-full rounded-lg text-sm mt-1"
                  rows="2"
                ></textarea>
              </div>
              <div>
                <div class="flex items-center justify-between mb-1">
                  <label class="font-semibold text-sm">종합 평가 기준</label>
                  <div
                    id="criteria-type-selector"
                    class="flex items-center text-xs p-0.5 bg-slate-100 rounded-md radio-group"
                  >
                    <!-- Radio buttons will be generated here by JS -->
                  </div>
                </div>
                <div id="evaluation-criteria-inputs" class="space-y-2">
                  <!-- Input fields (A, B, C...) will be generated here by JS -->
                </div>
              </div>
            </div>
          </details>

          <details class="card" open>
            <summary class="p-5 flex items-center justify-between cursor-pointer">
              <h2 class="text-lg font-semibold">2. 상세 루브릭 설정</h2>
              <svg
                class="w-6 h-6 transition-transform transform details-arrow"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 20 20"
                fill="currentColor"
              >
                <path
                  fill-rule="evenodd"
                  d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                  clip-rule="evenodd"
                />
              </svg>
            </summary>
            <div class="p-5 border-t space-y-4">
              <div id="rubric-accordion" class="space-y-2"></div>
              <button id="addRubricItem" class="btn btn-secondary w-full mt-2">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="w-5 h-5"
                  viewBox="0 0 20 20"
                  fill="currentColor"
                >
                  <path
                    fill-rule="evenodd"
                    d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110 -2h5V4a1 1 0 011-1z"
                    clip-rule="evenodd"
                  />
                </svg>
                <span>평가 항목 추가</span>
              </button>
            </div>
          </details>

          <div class="grid lg:grid-cols-2 gap-6">
            <section class="card p-5 space-y-4">
              <h2 class="text-lg font-semibold">3. PDF 파일 일괄 업로드</h2>
              <input
                id="fileInput"
                type="file"
                accept="application/pdf"
                multiple
                class="block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"
              />
              <p class="text-sm text-slate-500">
                권장 파일명: <code class="mono">학번_이름.pdf</code> (예:
                <code class="mono">11301_홍길동.pdf</code>)
              </p>
            </section>
            <section class="card p-5 space-y-4">
              <h2 class="text-lg font-semibold">4. 처리 로그</h2>
              <pre
                id="log"
                class="p-3 bg-slate-50 rounded-lg border text-sm overflow-auto"
                style="
                  min-height: 150px;
                  max-height: 300px;
                  white-space: pre-wrap;
                  word-break: break-all;
                "
              ></pre>
            </section>
          </div>

          <section class="card p-5 space-y-4">
            <div class="flex flex-wrap items-center justify-between gap-3">
              <h2 class="text-lg font-semibold">5. 결과 요약</h2>
              <div class="flex gap-2 flex-wrap">
                <button id="downloadCsv" class="btn btn-secondary text-sm">
                  결과 CSV 내보내기
                </button>
                <button id="clearBtn" class="btn btn-secondary text-sm">초기화</button>
              </div>
            </div>
            <div class="overflow-auto" style="max-height: 400px">
              <table class="min-w-full text-sm summary-table">
                <thead id="summaryHeader" class="sticky top-0 bg-slate-100 z-10"></thead>
                <tbody id="summaryBody"></tbody>
              </table>
            </div>
          </section>

          <section id="detailSection" class="hidden card p-5 space-y-6">
            <h2 class="text-lg font-semibold">6. 개별 상세 결과</h2>
            <div id="cards"></div>
          </section>
        </div>
      </main>
    </div>

    <script src="script.js" defer></script>
  </body>
</html>
