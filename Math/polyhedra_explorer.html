<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>유한 다면체 백과사전</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Google Model Viewer -->
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.4.0/model-viewer.min.js"></script>
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f8fafc; /* slate-50 */
        }
        .card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .modal-backdrop {
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }
        model-viewer {
            width: 100%;
            height: 100%;
            --poster-color: transparent;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div id="app" class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-cyan-600">인터랙티브 다면체 탐색기</h1>
            <p class="text-slate-500 mt-2 text-lg">알려진 모든 다면체를 검색하고 3D로 탐험하세요.</p>
        </header>

        <div class="mb-8 max-w-2xl mx-auto">
            <input type="text" id="search-input" placeholder="이름, 기호, 분류로 검색... (예: U75, J92, 균일)" class="w-full p-4 text-lg border-2 border-slate-200 rounded-full focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 outline-none transition duration-300 shadow-sm">
        </div>
        
        <div id="polyhedra-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
            <!-- Polyhedra cards will be dynamically generated here -->
        </div>
        <div id="no-results" class="text-center py-12 text-slate-500 text-xl hidden">
            검색 결과가 없습니다.
        </div>
    </div>

    <!-- Modal for details -->
    <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col md:flex-row overflow-hidden">
            <div id="modal-3d-container" class="w-full md:w-1/2 bg-slate-100 h-64 md:h-auto min-h-[300px] flex items-center justify-center">
                <model-viewer id="polyhedron-viewer" 
                    src="" 
                    alt="다면체 3D 모델"
                    camera-controls 
                    auto-rotate
                    disable-zoom
                    shadow-intensity="1.2"
                    shadow-softness="0.8"
                    skybox-color="#e6f0ff"
                    style="background-color: #f1f5f9;">
                </model-viewer>
            </div>
            <div id="modal-content" class="w-full md:w-1/2 p-6 overflow-y-auto">
                <div class="flex justify-between items-start">
                    <div>
                        <h2 id="modal-title" class="text-3xl font-bold text-cyan-600"></h2>
                        <p id="modal-en-title" class="text-slate-400 text-xl"></p>
                    </div>
                    <button id="close-modal" class="text-slate-400 hover:text-slate-800 text-4xl leading-none">&times;</button>
                </div>
                <div class="mt-4 space-y-3 text-base">
                    <p><strong>기호:</strong> <span id="modal-id" class="font-mono bg-slate-100 text-cyan-700 px-2 py-1 rounded"></span></p>
                    <p><strong>분류:</strong> <span id="modal-class"></span></p>
                    <p><strong>면 (Faces):</strong> <span id="modal-faces"></span></p>
                    <p><strong>모서리 (Edges):</strong> <span id="modal-edges"></span></p>
                    <p><strong>꼭짓점 (Vertices):</strong> <span id="modal-vertices"></span></p>
                    <p><strong>속성:</strong> <span id="modal-properties"></span></p>
                    <p><strong>Wythoff 기호:</strong> <span id="modal-wythoff" class="font-mono"></span></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const grid = document.getElementById('polyhedra-grid');
            const searchInput = document.getElementById('search-input');
            const modal = document.getElementById('modal');
            const closeModalBtn = document.getElementById('close-modal');
            const noResults = document.getElementById('no-results');
            const viewer = document.getElementById('polyhedron-viewer');

            let polyhedraData = [];

            async function loadData() {
                try {
                    const response = await fetch('./polyhedra_db.json');
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    const data = await response.json();
                    polyhedraData = data.polyhedra;
                    displayPolyhedra(polyhedraData);
                } catch (error) {
                    console.error("Failed to load polyhedra data:", error);
                    grid.innerHTML = `<p class="text-red-500 text-center col-span-full">데이터 로딩에 실패했습니다. 파일을 확인해주세요.</p>`;
                }
            }

            function displayPolyhedra(data) {
                grid.innerHTML = '';
                noResults.classList.toggle('hidden', data.length > 0);

                data.forEach(p => {
                    const card = document.createElement('div');
                    card.className = 'card bg-white p-4 rounded-xl shadow-md cursor-pointer border border-slate-200';
                    card.innerHTML = `
                        <h3 class="text-lg font-bold text-slate-800">${p.name}</h3>
                        <p class="text-sm text-slate-400">${p.en_name}</p>
                        <p class="text-xs font-mono bg-slate-100 text-cyan-700 inline-block px-2 py-1 rounded mt-2">${p.id}</p>
                    `;
                    card.addEventListener('click', () => showModal(p));
                    grid.appendChild(card);
                });
            }

            function showModal(polyhedron) {
                document.getElementById('modal-title').textContent = polyhedron.name;
                document.getElementById('modal-en-title').textContent = polyhedron.en_name;
                document.getElementById('modal-id').textContent = polyhedron.id;
                document.getElementById('modal-class').textContent = polyhedron.class;
                document.getElementById('modal-faces').textContent = polyhedron.faces;
                document.getElementById('modal-edges').textContent = polyhedron.edges;
                document.getElementById('modal-vertices').textContent = polyhedron.vertices;
                document.getElementById('modal-wythoff').textContent = polyhedron.wythoff;

                const propertiesContainer = document.getElementById('modal-properties');
                propertiesContainer.innerHTML = '';
                polyhedron.properties.forEach(prop => {
                    const badge = document.createElement('span');
                    const isInfinite = prop === '무한 계열';
                    badge.className = `text-sm font-medium mr-2 px-2.5 py-0.5 rounded-full ${isInfinite ? 'bg-amber-100 text-amber-800' : 'bg-cyan-100 text-cyan-800'}`;
                    badge.textContent = prop;
                    propertiesContainer.appendChild(badge);
                });
                
                // Assumes GLB files are in a directory named 'glb'
                viewer.src = `./glb/${polyhedron.glbFile}`;

                modal.classList.remove('hidden');
                modal.classList.add('flex');
            }

            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase().trim();
                const filteredData = polyhedraData.filter(p => 
                    p.name.toLowerCase().includes(searchTerm) ||
                    p.en_name.toLowerCase().includes(searchTerm) ||
                    p.id.toLowerCase().includes(searchTerm) ||
                    p.class.toLowerCase().includes(searchTerm) ||
                    p.properties.some(prop => prop.toLowerCase().includes(searchTerm))
                );
                displayPolyhedra(filteredData);
            });

            const hideModal = () => {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
                viewer.pause();
            };

            closeModalBtn.addEventListener('click', hideModal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    hideModal();
                }
            });

            loadData();
        });
    </script>
</body>
</html>

