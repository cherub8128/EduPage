<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 모델 탐사 보고서</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        @media print {
            body { background-color: white !important; }
            .no-print, header, footer { display: none !important; }
            #report-content {
                box-shadow: none;
                border: none;
                padding: 0; margin: 0;
            }
            .report-section {
                box-shadow: none;
                border: 1px solid #E5E7EB;
                page-break-inside: avoid;
                break-inside: avoid;
            }

            .report-section > div {
                break-inside: avoid; /* 최신 표준 속성 */
                page-break-inside: avoid; /* 하위 호환성을 위한 속성 */
            }

            input.savable, textarea.savable, select.savable, .no-print-content {
                display: none;
            }
            .printable-content {
                display: block !important;
                padding: 0.5rem 0;
                min-height: 1.5rem; /* Ensure empty fields still take up space */
                white-space: pre-wrap; /* Preserve line breaks from textareas */
                word-break: break-word;
                break-inside: avoid;
            }
             #printable-screenshot-container img {
                max-width: 100% !important;
                display: block !important;
                break-inside: avoid;
             }
        }
        body {
            font-family: 'Inter', 'Noto Sans KR', sans-serif;
            background-color: #F9FAFB;
        }
        .report-section {
            background-color: white;
            border: 1px solid #E5E7EB;
            border-radius: 0.75rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.05), 0 2px 4px -2px rgb(0 0 0 / 0.05);
        }
        .report-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #111827;
            border-bottom: 2px solid #D1D5DB;
            padding-bottom: 0.75rem;
            margin-bottom: 1.5rem;
        }
        label {
            display: block;
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.5rem;
        }
        input, textarea, select {
            width: 100%;
            padding: 0.875rem 1.25rem; 
            border: 1px solid #D1D5DB;
            border-radius: 0.5rem;
            background-color: #F9FAFB;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #3B82F6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }
        textarea { resize: vertical; min-height: 120px; }
        .action-button {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.2s ease-in-out;
            border: 1px solid transparent;
        }
        .printable-content { display: none; }
        .is-invalid { border-color: #EF4444 !important; }
    </style>
</head>
<body class="p-4 sm:p-8">
    <div class="max-w-4xl mx-auto">
        
        <header class="text-center mb-10 no-print">
            <div class="flex justify-center items-center gap-4 mb-4">
                 <i class="fas fa-rocket text-4xl text-blue-600"></i>
                <h1 class="text-4xl font-extrabold text-gray-800">AI 모델 탐사 보고서</h1>
            </div>
            <p class="text-gray-600">Hugging Face의 AI 모델을 탐험하고, 여러분의 분석과 창의적인 아이디어를 기록해보세요.</p>
        </header>

        <div id="report-content">
            <!-- Section 1: AI 모델 탐색 -->
            <section class="report-section">
                <h2 class="report-title">1. AI 모델 탐색</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                    <div><label for="student-name">이름</label><input type="text" id="student-name" placeholder="홍길동" class="savable"><div class="printable-content"></div></div>
                    <div><label for="student-info">학번</label><input type="text" id="student-info" placeholder="예: 20501" class="savable"><div class="printable-content"></div></div>
                </div>
                <div class="mt-6"><label for="model-name">탐색 모델명</label><input type="text" id="model-name" placeholder="예: google/gemma-3-1b-it" class="savable"><div class="printable-content"></div></div>
                <div class="mt-6"><label for="model-link">Hugging Face 모델 링크</label><input type="text" id="model-link" placeholder="예: https://huggingface.co/google/gemma-3-1b-it" class="savable"><div class="printable-content"></div></div>
                 <div class="mt-6"><label for="selection-reason">이 모델을 선택한 이유</label><textarea id="selection-reason" placeholder="모델의 특징, 최신 기술, 개인적인 흥미 등 선택하게 된 계기를 자유롭게 서술하세요." class="savable"></textarea><div class="printable-content prose max-w-none"></div></div>
            </section>
            
            <section class="report-section">
                <h2 class="report-title">2. 모델 테스트 및 분석</h2>
                <div class="mt-6">
                    <label for="model-type">모델 종류 (Task)</label>
                    <select id="model-type" class="savable">
                        <option value="text-generation">Text Generation (텍스트 생성)</option>
                        <option value="text-to-image">Text-to-Image (이미지 생성)</option>
                        <option value="image-to-text">Image-to-Text (이미지 설명)</option>
                        <option value="other">기타 (직접 입력)</option>
                    </select>
                    <div class="printable-content"></div>
                </div>
                <div class="mt-6">
                    <label>주요 파라미터 설정</label>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mt-2">
                        <div><label for="param-temperature" class="text-sm font-medium text-gray-500">Temperature</label><input type="number" id="param-temperature" step="0.1" placeholder="예: 0.7" class="mt-1 savable"><div class="printable-content"></div></div>
                        <div><label for="param-max-tokens" class="text-sm font-medium text-gray-500">Max New Tokens</label><input type="number" id="param-max-tokens" step="32" placeholder="예: 512" class="mt-1 savable"><div class="printable-content"></div></div>
                        <div><label for="param-top-p" class="text-sm font-medium text-gray-500">Top-P</label><input type="number" id="param-top-p" step="0.05" placeholder="예: 0.95" class="mt-1 savable"><div class="printable-content"></div></div>
                    </div>
                </div>
                <div class="mt-6"><label for="test-goal">테스트 목표</label><textarea id="test-goal" placeholder="이 모델의 어떤 성능을 확인하고 싶었나요?" class="savable"></textarea><div class="printable-content prose max-w-none"></div></div>
                <div class="mt-6"><label for="test-process">테스트 과정 및 결과</label><textarea id="test-process" placeholder="어떤 프롬프트를 사용했고, 그 결과 AI는 어떻게 반응했는지 구체적으로 작성하세요." class="savable"></textarea><div class="printable-content prose max-w-none"></div></div>
                <div class="mt-6">
                    <label for="screenshot-upload">실제 대화 캡쳐본</label>
                    <div class="mt-2 flex items-center justify-center w-full">
                        <label for="screenshot-file" class="flex flex-col items-center justify-center w-full min-h-64 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 no-print">
                            <div id="screenshot-preview-container" class="hidden p-4"><img id="screenshot-preview" src="#" alt="Screenshot Preview" class="max-h-56 rounded-lg"/></div>
                            <div id="screenshot-placeholder" class="flex flex-col items-center justify-center pt-5 pb-6"><i class="fas fa-cloud-upload-alt text-4xl text-gray-400"></i><p class="mb-2 text-sm text-gray-500"><span class="font-semibold">클릭하여 파일 업로드</span></p><p class="text-xs text-gray-500">PNG, JPG</p></div>
                            <input id="screenshot-file" type="file" class="hidden" accept="image/*" />
                        </label>
                    </div>
                    <div id="printable-screenshot-container" class="printable-content mt-4"></div>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 mt-6">
                    <div><label for="model-strengths">모델의 장점</label><textarea id="model-strengths" placeholder="테스트 결과, 이 모델이 특별히 잘하는 점은 무엇이었나요?" class="savable"></textarea><div class="printable-content prose max-w-none"></div></div>
                    <div><label for="model-weaknesses">모델의 단점 및 한계</label><textarea id="model-weaknesses" placeholder="테스트 결과, 아쉬웠던 점이나 개선이 필요하다고 생각되는 부분은 무엇이었나요?" class="savable"></textarea><div class="printable-content prose max-w-none"></div></div>
                </div>
            </section>
            
            <section class="report-section"><h2 class="report-title">3. AI 서비스 아이디어 제안</h2><div><label for="service-name">AI 서비스 이름</label><input type="text" id="service-name" placeholder="예: 코딩 질문 해결사 '코드버디'" class="savable"><div class="printable-content"></div></div><div class="mt-6"><label for="service-concept">핵심 컨셉 및 목표</label><textarea id="service-concept" placeholder="누구를 위한 서비스인가요? 어떤 문제를 해결해주나요?" class="savable"></textarea><div class="printable-content prose max-w-none"></div></div><div class="mt-6"><label for="service-working">작동 방식</label><textarea id="service-working" placeholder="분석한 AI 모델이 이 서비스에서 어떤 역할을 하나요?" class="savable"></textarea><div class="printable-content prose max-w-none"></div></div><div class="mt-6"><label for="service-impact">기대 효과</label><textarea id="service-impact" placeholder="이 서비스가 사회나 사용자에게 어떤 긍정적인 영향을 줄 수 있을까요?" class="savable"></textarea><div class="printable-content prose max-w-none"></div></div></section>
            <section class="report-section"><h2 class="report-title">4. 느낀점</h2><div><label for="reflections">활동을 통해 배우고 느낀 점</label><textarea id="reflections" placeholder="이번 활동을 통해 새롭게 알게 된 점, 느낀 점 등을 자유롭게 작성하세요." class="savable"></textarea><div class="printable-content prose max-w-none"></div></div></section>
        </div>

        <footer class="text-center mt-8 no-print">
             <div id="validation-message" class="text-red-600 font-semibold mb-4 h-6"></div>
             <div class="flex flex-wrap gap-4 justify-center items-center">
                <button id="print-report" class="action-button bg-blue-600 hover:bg-blue-700 text-white"><i class="fas fa-print mr-2"></i>보고서 출력 (PDF 저장)</button>
             </div>
        </footer>
    </div>
    
    <!-- Autosave Status Indicator -->
    <div id="autosave-status" class="no-print fixed bottom-6 right-6 flex items-center bg-slate-800 text-white py-2 px-4 rounded-lg shadow-lg opacity-0 transition-opacity duration-500 z-50">
        <svg id="autosave-icon-saving" class="animate-spin h-5 w-5 mr-3 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        <svg id="autosave-icon-saved" class="h-5 w-5 mr-3 hidden text-green-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
        </svg>
        <span id="autosave-text"></span>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const savableElements = document.querySelectorAll('.savable');
            const printBtn = document.getElementById('print-report');
            const screenshotInput = document.getElementById('screenshot-file');
            const screenshotPreview = document.getElementById('screenshot-preview');
            const screenshotPlaceholder = document.getElementById('screenshot-placeholder');
            const screenshotPreviewContainer = document.getElementById('screenshot-preview-container');
            const autosaveStatusEl = document.getElementById('autosave-status');
            let saveTimer;
            let statusTimer;

            function showSaveStatus(state) {
                if (!autosaveStatusEl) return;
                const textEl = document.getElementById('autosave-text');
                const iconSaving = document.getElementById('autosave-icon-saving');
                const iconSaved = document.getElementById('autosave-icon-saved');

                clearTimeout(statusTimer);
                autosaveStatusEl.classList.remove('opacity-0');

                if (state === 'saving') {
                    textEl.textContent = '저장 중...';
                    iconSaving.classList.remove('hidden');
                    iconSaved.classList.add('hidden');
                } else if (state === 'saved') {
                    textEl.textContent = '모든 변경사항이 저장되었습니다.';
                    iconSaving.classList.add('hidden');
                    iconSaved.classList.remove('hidden');
                    statusTimer = setTimeout(() => {
                        autosaveStatusEl.classList.add('opacity-0');
                    }, 2000);
                }
            }
            
            function saveContent(element) {
                clearTimeout(saveTimer);
                showSaveStatus('saving');
                saveTimer = setTimeout(() => {
                    const data = JSON.parse(localStorage.getItem('aiReportData')) || {};
                    if (element.id) {
                         data[element.id] = element.value;
                    }
                    localStorage.setItem('aiReportData', JSON.stringify(data));
                    showSaveStatus('saved');
                }, 1000);
            }

            function loadContent() {
                // Try loading from the new unified key first
                const newData = JSON.parse(localStorage.getItem('aiReportData'));
                if (newData) {
                    savableElements.forEach(field => {
                        if (newData.hasOwnProperty(field.id)) {
                            field.value = newData[field.id];
                        }
                    });
                    if (newData['screenshot-preview']) {
                        screenshotPreview.src = newData['screenshot-preview'];
                        screenshotPlaceholder.classList.add('hidden');
                        screenshotPreviewContainer.classList.remove('hidden');
                    }
                    return; // Exit if new data is loaded
                }

                // Fallback for old data (individual keys + separate image)
                let oldDataFound = false;
                savableElements.forEach(field => {
                    const savedValue = localStorage.getItem(field.id);
                    if (savedValue !== null) {
                        field.value = savedValue;
                        oldDataFound = true;
                    }
                });
                const savedImage = localStorage.getItem('screenshot-preview');
                if (savedImage) {
                    screenshotPreview.src = savedImage;
                    screenshotPlaceholder.classList.add('hidden');
                    screenshotPreviewContainer.classList.remove('hidden');
                    oldDataFound = true;
                }
                
                if (oldDataFound) {
                    alert('이전 버전에서 작성한 보고서 내용을 불러왔습니다. 다음에 저장될 때는 새로운 형식으로 통합 저장됩니다.');
                    // Immediately save in the new format to migrate
                    const data = {};
                    savableElements.forEach(el => { data[el.id] = el.value; });
                    if (savedImage) { data['screenshot-preview'] = savedImage; }
                    localStorage.setItem('aiReportData', JSON.stringify(data));
                }
            }

            function updatePrintableView() {
                savableElements.forEach(el => {
                    const printableEl = el.nextElementSibling;
                    if (printableEl && printableEl.classList.contains('printable-content')) {
                        let content = el.value.trim();
                        if (el.tagName === 'TEXTAREA') {
                             content = content.replace(/\n/g, '<br>');
                        }
                        printableEl.innerHTML = content;
                    }
                });
                const printableScreenshotContainer = document.getElementById('printable-screenshot-container');
                if (screenshotPreview.src && !screenshotPreview.src.endsWith('#')) {
                    printableScreenshotContainer.innerHTML = `<img src="${screenshotPreview.src}" style="max-width: 100%; border-radius: 0.5rem;" />`;
                } else {
                    printableScreenshotContainer.innerHTML = '';
                }
            }

            printBtn.addEventListener('click', () => {
                let allFilled = true;
                const validationMessage = document.getElementById('validation-message');
                validationMessage.textContent = '';
                
                savableElements.forEach(el => {
                    el.classList.remove('is-invalid');
                    if (!el.value.trim()) {
                        el.classList.add('is-invalid');
                        allFilled = false;
                    }
                });

                const screenshotLabel = screenshotInput.closest('label');
                screenshotLabel.classList.remove('is-invalid');
                if (!screenshotPreview.src || screenshotPreview.src.endsWith('#')) {
                     screenshotLabel.classList.add('is-invalid');
                     allFilled = false;
                }

                if (!allFilled) {
                    validationMessage.textContent = '모든 필수 항목을 작성하고 스크린샷을 첨부해주세요.';
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                    return;
                }
                
                updatePrintableView();
                
                const studentId = document.getElementById('student-info').value.trim() || '학번';
                const studentName = document.getElementById('student-name').value.trim() || '이름';
                const originalTitle = document.title;
                document.title = `AI모델탐사보고서_${studentId}_${studentName}`;

                setTimeout(() => {
                    window.print();
                    document.title = originalTitle;
                }, 100);
            });

            screenshotInput.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file && file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const base64Image = e.target.result;
                        screenshotPreview.src = base64Image;
                        screenshotPlaceholder.classList.add('hidden');
                        screenshotPreviewContainer.classList.remove('hidden');
                        
                        clearTimeout(saveTimer);
                        showSaveStatus('saving');
                        saveTimer = setTimeout(() => {
                            const data = JSON.parse(localStorage.getItem('aiReportData')) || {};
                            data['screenshot-preview'] = base64Image;
                            localStorage.setItem('aiReportData', JSON.stringify(data));
                            showSaveStatus('saved');
                        }, 1000);
                    };
                    reader.readAsDataURL(file);
                }
            });

            savableElements.forEach(el => {
                el.addEventListener('input', (e) => saveContent(e.target));
            });

            loadContent();
        });
    </script>
</body>
</html>

