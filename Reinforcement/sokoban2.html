<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì†Œì½”ë°˜ AI ì—…ê·¸ë ˆì´ë“œ: CNNê³¼ RND ì ìš©í•˜ê¸°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #282c34;
            color: #abb2bf;
        }
        .slide {
            display: none;
        }
        .slide.active {
            display: block;
        }
        .code-highlight {
            background-color: rgba(255, 255, 0, 0.15);
            display: block;
            margin: -0.25rem -0.5rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
        }
        pre[class*="language-"] {
            font-size: 0.9rem;
            line-height: 1.6;
            white-space: pre-wrap;
            word-break: break-all;
            overflow-x: auto;
        }
        .explanation-box {
            background-color: #21252b;
            border-left: 4px solid #61afef;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
        }
        /* CNN Animation Styles */
        .cnn-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-top: 20px;
            min-height: 200px;
            flex-wrap: wrap;
        }
        .grid-container {
            position: relative;
        }
        .cnn-grid {
            display: grid;
            border: 2px solid #61afef;
        }
        .input-grid {
            grid-template-columns: repeat(5, 30px);
            grid-template-rows: repeat(5, 30px);
        }
        .cell {
            width: 30px;
            height: 30px;
            border: 1px solid #4a5568;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 14px;
            font-weight: bold;
            color: #e5c07b;
        }
        .kernel {
            position: absolute;
            top: 0;
            left: 0;
            width: 90px;
            height: 90px;
            border: 2px solid #e5c07b;
            background-color: rgba(229, 192, 123, 0.2);
            animation: scanAnimation 9s infinite steps(1, end);
        }
        .output-grid {
            grid-template-columns: repeat(3, 30px);
            grid-template-rows: repeat(3, 30px);
        }
        .output-marker {
            position: absolute;
            top: 0;
            left: 0;
            width: 30px;
            height: 30px;
            background-color: rgba(97, 175, 239, 0.5);
            border: 2px solid #61afef;
            animation: outputAnimation 9s infinite steps(1, end);
        }

        @keyframes scanAnimation {
            0%      { transform: translate(0px, 0px); }
            11.1%   { transform: translate(30px, 0px); }
            22.2%   { transform: translate(60px, 0px); }
            33.3%   { transform: translate(0px, 30px); }
            44.4%   { transform: translate(30px, 30px); }
            55.5%   { transform: translate(60px, 30px); }
            66.6%   { transform: translate(0px, 60px); }
            77.7%   { transform: translate(30px, 60px); }
            88.8%   { transform: translate(60px, 60px); }
            100%    { transform: translate(60px, 60px); }
        }
        @keyframes outputAnimation {
            0%      { transform: translate(0px, 0px); }
            11.1%   { transform: translate(30px, 0px); }
            22.2%   { transform: translate(60px, 0px); }
            33.3%   { transform: translate(0px, 30px); }
            44.4%   { transform: translate(30px, 30px); }
            55.5%   { transform: translate(60px, 30px); }
            66.6%   { transform: translate(0px, 60px); }
            77.7%   { transform: translate(30px, 60px); }
            88.8%   { transform: translate(60px, 60px); }
            100%    { transform: translate(60px, 60px); }
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-7xl mx-auto bg-[#21252b] rounded-xl shadow-2xl overflow-hidden">
        <div class="p-8">
            <h1 class="text-3xl md:text-4xl font-bold text-white text-center">ì†Œì½”ë°˜ AI ì—…ê·¸ë ˆì´ë“œ: CNNê³¼ RND ì ìš©í•˜ê¸°</h1>
            <p class="text-center text-gray-400 mt-2">ë‹¨ìˆœí•œ ëª¨ë¸ì„ ë„˜ì–´, ìŠ¤ìŠ¤ë¡œ íƒí—˜í•˜ëŠ” ë˜‘ë˜‘í•œ AIë¥¼ ë§Œë“¤ì–´ë´…ë‹ˆë‹¤.</p>
        </div>

        <div id="slider-container" class="p-4 md:p-8 border-t border-gray-700 min-h-[500px]">
            <!-- Slides will be injected here by JS -->
        </div>

        <div class="bg-[#282c34] p-4 flex justify-between items-center">
            <button id="prevBtn" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed">ì´ì „</button>
            <div id="slide-counter" class="text-white text-lg font-semibold"></div>
            <button id="nextBtn" class="bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-2 px-4 rounded-lg transition duration-300">ë‹¤ìŒ</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        const slides = [
            {
                title: "1. ì™œ ì—…ê·¸ë ˆì´ë“œê°€ í•„ìš”í•œê°€ìš”?",
                explanation: `
                    <p>ì´ì „ ë²„ì „ì˜ AIëŠ” ê²Œì„ ìƒíƒœ(ìˆ«ì ê·¸ë¦¬ë“œ)ë¥¼ í•˜ë‚˜ì˜ ê¸´ ëª©ë¡ìœ¼ë¡œ ë³´ê³  í•™ìŠµí–ˆìŠµë‹ˆë‹¤. ì´ëŠ” <strong>'ì–´ë–¤ íƒ€ì¼ì´ ì–´ë””ì— ìˆëŠ”ì§€'</strong>ëŠ” ì•Œì§€ë§Œ, <strong>'ì–´ë–¤ íƒ€ì¼ì´ ì„œë¡œ ì´ì›ƒí•´ ìˆëŠ”ì§€'</strong>ì™€ ê°™ì€ ê³µê°„ì ì¸ ê´€ê³„ë¥¼ íŒŒì•…í•˜ê¸° ì–´ë µìŠµë‹ˆë‹¤.</p>
                    <p class="mt-2">ì†Œì½”ë°˜ì²˜ëŸ¼ ê°ì²´ë“¤ì˜ ìœ„ì¹˜ ê´€ê³„ê°€ ì¤‘ìš”í•œ ê²Œì„ì—ì„œëŠ” ì´ í•œê³„ê°€ ëª…í™•í•©ë‹ˆë‹¤. ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ë‘ ê°€ì§€ ê°•ë ¥í•œ ê¸°ìˆ ì„ ë„ì…í•©ë‹ˆë‹¤.</p>
                    <div class="explanation-box">
                        <p><strong>1. Custom CNN (Convolutional Neural Network):</strong> ì´ë¯¸ì§€ì²˜ëŸ¼ 2D ê³µê°„ ì •ë³´ë¥¼ ì˜ ì²˜ë¦¬í•˜ëŠ” 'ëˆˆ' ì—­í• ì„ í•˜ëŠ” ì‹ ê²½ë§ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>
                        <p class="mt-2"><strong>2. RND (Random Network Distillation):</strong> ë³´ìƒì´ ë“œë¬¸ ì†Œì½”ë°˜ ê²Œì„ì—ì„œ AIê°€ ì§€ë£¨í•´í•˜ì§€ ì•Šê³  ìŠ¤ìŠ¤ë¡œ 'í˜¸ê¸°ì‹¬'ì„ ê°–ê³  íƒí—˜í•˜ë„ë¡ ë§Œë“œëŠ” ê¸°ìˆ ì…ë‹ˆë‹¤.</p>
                    </div>
                `,
                code: ``
            },
            {
                title: "2. CNNì˜ ì›ë¦¬: ì„¸ìƒì„ ë³´ëŠ” ìƒˆë¡œìš´ ëˆˆ",
                explanation: `
                    <p>CNNì€ 'í•„í„°(ì»¤ë„)'ë¼ëŠ” ì‘ì€ ë‹ë³´ê¸°ë¥¼ ì‚¬ìš©í•´ ì´ë¯¸ì§€ì˜ íŠ¹ì§•ì„ ì°¾ì•„ëƒ…ë‹ˆë‹¤. ì´ ë‹ë³´ê¸°ë¥¼ ì´ë¯¸ì§€ ì „ì²´ì— í›‘ìœ¼ë©´ì„œ(Convolution), ì„ , ëª¨ì„œë¦¬, ì§ˆê° ê°™ì€ ê°„ë‹¨í•œ íŠ¹ì§•ë¶€í„° ì‹œì‘í•´ ì ì  ë” ë³µì¡í•œ í˜•íƒœë¥¼ ì¸ì‹í•˜ê²Œ ë©ë‹ˆë‹¤.</p>
                    <p class="mt-2">ì•„ë˜ ì• ë‹ˆë©”ì´ì…˜ì€ 3x3 í•„í„°(ë…¸ë€ìƒ‰)ê°€ 5x5 ì…ë ¥ ë°ì´í„°(ê²Œì„ ë§µ)ë¥¼ í›‘ìœ¼ë©° 3x3 íŠ¹ì§• ë§µ(ì˜¤ë¥¸ìª½)ì„ ë§Œë“¤ì–´ë‚´ëŠ” ê³¼ì •ì„ ì‹œê°í™”í•œ ê²ƒì…ë‹ˆë‹¤. ì¶œë ¥ ê·¸ë¦¬ë“œì˜ íŒŒë€ìƒ‰ í•˜ì´ë¼ì´íŠ¸ëŠ” í˜„ì¬ ê³„ì‚°ë˜ê³  ìˆëŠ” ìœ„ì¹˜ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.</p>
                    <div class="cnn-container">
                        <div class="grid-container">
                            <div class="cnn-grid input-grid">
                                ${Array.from({length: 25}).map((_, i) => `<div class="cell">${Math.floor(Math.random()*5)}</div>`).join('')}
                            </div>
                            <div class="kernel"></div>
                        </div>
                        <div class="text-4xl text-indigo-400">&rarr;</div>
                        <div class="grid-container">
                             <div class="cnn-grid output-grid">
                                ${Array.from({length: 9}).map(() => `<div class="cell">?</div>`).join('')}
                            </div>
                            <div class="output-marker"></div>
                        </div>
                    </div>
                `,
                code: ``
            },
            {
                title: "3. CNNì˜ ì ìš©ì„ ìœ„í•œ í™˜ê²½ ì½”ë“œ ìˆ˜ì •",
                explanation: `
                    <p>CNNì€ 'í•„í„°(ì»¤ë„)'ë¼ëŠ” ì‘ì€ ë‹ë³´ê¸°ë¥¼ ì‚¬ìš©í•´ ì´ë¯¸ì§€ì˜ íŠ¹ì§•ì„ ì°¾ì•„ëƒ…ë‹ˆë‹¤. ì´ ë‹ë³´ê¸°ë¥¼ ì´ë¯¸ì§€ ì „ì²´ì— í›‘ìœ¼ë©´ì„œ(Convolution), ì„ , ëª¨ì„œë¦¬, ì§ˆê° ê°™ì€ ê°„ë‹¨í•œ íŠ¹ì§•ë¶€í„° ì‹œì‘í•´ ì ì  ë” ë³µì¡í•œ í˜•íƒœë¥¼ ì¸ì‹í•˜ê²Œ ë©ë‹ˆë‹¤.</p>
                    <p class="mt-2">ì•„ë˜ ì• ë‹ˆë©”ì´ì…˜ì€ 3x3 í•„í„°(ë…¸ë€ìƒ‰)ê°€ 5x5 ì…ë ¥ ë°ì´í„°(ê²Œì„ ë§µ)ë¥¼ í›‘ìœ¼ë©° 3x3 íŠ¹ì§• ë§µ(ì˜¤ë¥¸ìª½)ì„ ë§Œë“¤ì–´ë‚´ëŠ” ê³¼ì •ì„ ì‹œê°í™”í•œ ê²ƒì…ë‹ˆë‹¤. ì¶œë ¥ ê·¸ë¦¬ë“œì˜ íŒŒë€ìƒ‰ í•˜ì´ë¼ì´íŠ¸ëŠ” í˜„ì¬ ê³„ì‚°ë˜ê³  ìˆëŠ” ìœ„ì¹˜ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.</p>
                    <div class="cnn-container">
                        <div class="grid-container">
                            <div class="cnn-grid input-grid">
                                ${Array.from({length: 25}).map((_, i) => `<div class="cell">${Math.floor(Math.random()*5)}</div>`).join('')}
                            </div>
                            <div class="kernel"></div>
                        </div>
                        <div class="text-4xl text-indigo-400">&rarr;</div>
                        <div class="grid-container">
                             <div class="cnn-grid output-grid">
                                ${Array.from({length: 9}).map(() => `<div class="cell">?</div>`).join('')}
                            </div>
                            <div class="output-marker"></div>
                        </div>
                    </div>
                `,
                code: `
# __init__ í•¨ìˆ˜ì— ìˆ˜ì •ëœ ë¶€ë¶„
self.observation_space = spaces.Box(
    low=0, high=4,
    shape=(1, self.game.map_height, self.game.map_width), # shape ë³€ê²½
    dtype=np.uint8
)

# step í•¨ìˆ˜ì— ìˆ˜ì •ëœ ë¶€ë¶„
obs_with_channel = np.expand_dims(obs, axis=0)
return obs_with_channel, reward, terminated, truncated, {}
`
            },
            {
                title: "4. Stable-Baselines3ë¥¼ ìœ„í•œ Custom CNN êµ¬í˜„",
                explanation: `
                    <p>Stable-Baselines3ëŠ” ê¸°ë³¸ CNN êµ¬ì¡°ë¥¼ ì œê³µí•˜ì§€ë§Œ, ìš°ë¦¬ë§Œì˜ ë§ì¶¤í˜• CNN êµ¬ì¡°ë¥¼ ë§Œë“¤ì–´ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <code class="bg-gray-700 p-1 rounded">BaseFeaturesExtractor</code>ë¥¼ ìƒì†ë°›ì•„ ê°„ë‹¨í•œ CNN í´ë˜ìŠ¤ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.</p>
                    <p class="mt-2">ì´ ì½”ë“œëŠ” 2ê°œì˜ í•©ì„±ê³± ë ˆì´ì–´(Conv2d)ì™€ 1ê°œì˜ ì™„ì „ ì—°ê²° ë ˆì´ì–´(Linear)ë¡œ êµ¬ì„±ëœ ê°„ë‹¨í•œ CNNì…ë‹ˆë‹¤. ì´ ë„¤íŠ¸ì›Œí¬ê°€ ê²Œì„ ê·¸ë¦¬ë“œë¥¼ ì…ë ¥ë°›ì•„ í•µì‹¬ íŠ¹ì§•ì„ ì¶”ì¶œí•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.</p>
                `,
                code: `
import torch
import torch.nn as nn
from gymnasium import spaces
from stable_baselines3.common.torch_layers import BaseFeaturesExtractor

class CustomCNN(BaseFeaturesExtractor):
    def __init__(self, observation_space: spaces.Box, features_dim: int = 128):
        super().__init__(observation_space, features_dim)
        # ê´€ì°° ê³µê°„ì˜ shapeëŠ” (height, width, channels) -> (H, W, C)
        # PyTorchì˜ Conv2dëŠ” (N, C, H, W)ë¥¼ ê¸°ëŒ€í•˜ë¯€ë¡œ ì±„ë„ ìˆ˜ë¥¼ ë§ˆì§€ë§‰ ì°¨ì›ì—ì„œ ê°€ì ¸ì˜µë‹ˆë‹¤.
        n_input_channels = observation_space.shape[2] 
        self.cnn = nn.Sequential(
            nn.Conv2d(n_input_channels, 32, kernel_size=3, stride=1, padding=1),
            nn.ReLU(),
            nn.Conv2d(32, 64, kernel_size=3, stride=1, padding=1),
            nn.ReLU(),
            nn.Flatten(),
        )
        # CNN ì¶œë ¥ í¬ê¸°ë¥¼ ê³„ì‚°í•˜ì—¬ Linear ë ˆì´ì–´ì— ì—°ê²°
        with torch.no_grad():
            # (H, W, C) -> (N, C, H, W) í˜•íƒœë¡œ ë³€í™˜í•˜ì—¬ í…ŒìŠ¤íŠ¸
            sample_input = torch.as_tensor(observation_space.sample()[None]).permute(0, 3, 1, 2).float()
            n_flatten = self.cnn(sample_input).shape[1]
        
        self.linear = nn.Sequential(nn.Linear(n_flatten, features_dim), nn.ReLU())

    def forward(self, observations: torch.Tensor) -> torch.Tensor:
        # (N, H, W, C) -> (N, C, H, W)
        observations = observations.permute(0, 3, 1, 2)
        return self.linear(self.cnn(observations))
                `
            },
            {
                title: "5. ë¬¸ì œì : í¬ì†Œí•œ ë³´ìƒ (Sparse Rewards)",
                explanation: `
                    <p>ì†Œì½”ë°˜ ê²Œì„ì€ 'ë°•ìŠ¤ë¥¼ ëª©í‘œ ì§€ì ì— ì •í™•íˆ ë°€ì–´ ë„£ì—ˆì„ ë•Œ'ë§Œ í° ë³´ìƒì„ ë°›ìŠµë‹ˆë‹¤. ê·¸ ì™¸ì˜ ìˆ˜ë§ì€ ì›€ì§ì„ì€ ë³´ìƒì´ ê±°ì˜ ì—†ê±°ë‚˜ ì‘ì€ í˜ë„í‹°ë§Œ ìˆì£ . ì´ëŸ° í™˜ê²½ì„ <strong>í¬ì†Œ ë³´ìƒ í™˜ê²½</strong>ì´ë¼ê³  í•©ë‹ˆë‹¤.</p>
                    <p class="mt-2">AIëŠ” ìš°ì—°íˆ ë°•ìŠ¤ë¥¼ ëª©í‘œì— ë°€ê¸° ì „ê¹Œì§€ëŠ” ì–´ë–¤ í–‰ë™ì´ ì¢‹ì€ì§€ ì „í˜€ ì•Œ ìˆ˜ ì—†ì–´, í•™ìŠµ ì´ˆê¸°ì— ê¸¸ì„ ìƒê³  í—¤ë§¤ê¸° ì‰½ìŠµë‹ˆë‹¤. ë§ˆì¹˜ ì–´ë‘ìš´ ë°©ì—ì„œ ì¶œêµ¬ë¥¼ ì°¾ëŠ” ê²ƒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>
                    <div class="explanation-box">
                        <p><strong>í•´ê²°ì±…: ë‚´ì¬ì  ë™ê¸°ë¶€ì—¬ (Intrinsic Motivation)</strong><br>
                        AIì—ê²Œ 'í˜¸ê¸°ì‹¬'ì´ë¼ëŠ” ë‚´ì¬ì  ë³´ìƒì„ ì£¼ì–´, ì™¸ë¶€ ë³´ìƒì´ ì—†ì–´ë„ ìŠ¤ìŠ¤ë¡œ ìƒˆë¡œìš´ ê²ƒì„ íƒí—˜í•˜ë„ë¡ ìœ ë„í•©ë‹ˆë‹¤.</p>
                    </div>
                `,
                code: ``
            },
            {
                title: "6. RND: 'ìƒˆë¡œì›€'ì„ ë³´ìƒìœ¼ë¡œ",
                explanation: `
                    <p><strong>Random Network Distillation (RND)</strong>ì€ AIì˜ í˜¸ê¸°ì‹¬ì„ êµ¬í˜„í•˜ëŠ” ëŒ€í‘œì ì¸ ë°©ë²•ì…ë‹ˆë‹¤.</p>
                    <p class="mt-2">ë‘ ê°œì˜ ì‹ ê²½ë§ì„ ì‚¬ìš©í•©ë‹ˆë‹¤:</p>
                    <ul class="list-disc list-inside space-y-2 mt-2">
                        <li><strong>ì„ ìƒë‹˜ ë§ (Target Network):</strong> ë¬´ì‘ìœ„ë¡œ ìƒì„±ë˜ì–´ ì ˆëŒ€ ë³€í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</li>
                        <li><strong>í•™ìƒ ë§ (Predictor Network):</strong> ì„ ìƒë‹˜ ë§ì˜ ì¶œë ¥ì„ ë”°ë¼í•˜ë„ë¡ í•™ìŠµí•©ë‹ˆë‹¤.</li>
                    </ul>
                    <p class="mt-2">AIê°€ <strong>ì´ë¯¸ ê°€ë³¸ ê³³(ìµìˆ™í•œ ìƒíƒœ)</strong>ì„ ì…ë ¥í•˜ë©´, í•™ìƒ ë§ì€ ì„ ìƒë‹˜ ë§ì˜ ì¶œë ¥ì„ ì‰½ê²Œ ì˜ˆì¸¡í•©ë‹ˆë‹¤ (ì˜¤ì°¨ ì‘ìŒ). í•˜ì§€ë§Œ <strong>ì²˜ìŒ ê°€ë³´ëŠ” ê³³(ìƒˆë¡œìš´ ìƒíƒœ)</strong>ì„ ì…ë ¥í•˜ë©´, ì˜ˆì¸¡ì„ ì˜ ëª»í•´ì„œ í° ì˜¤ì°¨ê°€ ë°œìƒí•©ë‹ˆë‹¤. <strong>ì´ ì˜ˆì¸¡ ì˜¤ì°¨(prediction error)ë¥¼ 'í˜¸ê¸°ì‹¬ ë³´ìƒ'ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.</strong></p>
                `,
                code: `
# RNDì˜ í•µì‹¬ ì›ë¦¬
# reward_intrinsic = || predictor_network(state) - target_network(state) ||Â²

# ì²˜ìŒ ë³´ëŠ” ìƒíƒœì¼ìˆ˜ë¡ ì˜ˆì¸¡ ì˜¤ì°¨ê°€ ì»¤ì ¸ì„œ ë³´ìƒì´ ë†’ì•„ì§
# -> AIëŠ” ë†’ì€ ë³´ìƒì„ ë°›ê¸° ìœ„í•´ ìƒˆë¡œìš´ ìƒíƒœë¥¼ ì°¾ì•„ë‹¤ë‹ˆê²Œ ë¨
                `
            },
            {
                title: "7. RND êµ¬í˜„í•˜ê¸° (sb3-contrib)",
                explanation: `
                    <p>RNDëŠ” ì§ì ‘ êµ¬í˜„ì´ í•„ìš”í•©ë‹ˆë‹¤. í˜„ì¬ì˜ ì§€ì‹ìœ¼ë¡œëŠ” ì§ì ‘ êµ¬í˜„ì´ ì–´ë ¤ìš°ë‹ˆ, ì´ë¯¸ êµ¬í˜„ëœ ì½”ë“œë¥¼ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.</p>
                    <p class="mt-2">ë§í¬ì˜ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ì—¬ ê°™ì€ í´ë”ì— ë„£ê³  ì„í¬íŠ¸í•˜ì—¬, ê¸°ì¡´ì— ë§Œë“¤ì—ˆë˜ PPO ëª¨ë¸ì„ <code class="bg-gray-700 p-1 rounded">RND</code> í´ë˜ìŠ¤ë¡œ í•œë²ˆ ê°ì‹¸ì£¼ê¸°ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤.</p>
                    <div class="my-4">
                        <a id="download-link" href="rnd_wrapper.py" download="rnd_wrapper.py" class="inline-block bg-teal-500 hover:bg-teal-400 text-white font-bold py-2 px-4 rounded-lg transition duration-300">
                            rnd_wrapper.py ë‹¤ìš´ë¡œë“œ
                        </a>
                    </div>
                `,
                code: `
# í™˜ê²½ ìƒì„±ì„ ìœ„í•œ í—¬í¼ í•¨ìˆ˜
def make_env(log_dir):
    def _init():
        env = SokobanEnv()
        # RND ë˜í¼ë¥¼ ì ìš©í•©ë‹ˆë‹¤.
        env = RNDRewardWrapper(env, lr=1e-4, feature_dim=128)
        env = Monitor(env, log_dir)
        return env
    return _init
                `
            },
            {
                title: "8. ìµœì¢… í•™ìŠµ ì½”ë“œ (sokoban_train_advanced.py)",
                explanation: `
                    <p>ì§€ê¸ˆê¹Œì§€ ë°°ìš´ Custom CNNê³¼ RNDë¥¼ ëª¨ë‘ ì ìš©í•œ ìµœì¢… í•™ìŠµ ìŠ¤í¬ë¦½íŠ¸ì…ë‹ˆë‹¤. ì´ ì½”ë“œë¥¼ Colabì— ë¶™ì—¬ë„£ê³  ì‹¤í–‰í•˜ë©´, ë˜‘ë˜‘í•´ì§„ ì†Œì½”ë°˜ AIì˜ í•™ìŠµì´ ì‹œì‘ë©ë‹ˆë‹¤.</p>
                    <div class="explanation-box">
                        <p><strong>ì£¼ìš” ë³€ê²½ì :</strong><br>
                        - í™˜ê²½ì˜ ê´€ì°°ì„ ì´ë¯¸ì§€ì— ë§ê²Œ ì±„ë„ ìš°ì„ (Channel-first)ìœ¼ë¡œ ë³€ê²½í•©ë‹ˆë‹¤.<br>
                        - PPO ëª¨ë¸ ìƒì„± ì‹œ <code class="bg-gray-700 p-1 rounded">policy_kwargs</code>ë¡œ CustomCNNì„ ì§€ì •í•©ë‹ˆë‹¤.<br>
                        - PPO ëª¨ë¸ì„ <code class="bg-gray-700 p-1 rounded">RND</code>ë¡œ ê°ì‹¸ì„œ ìµœì¢… ëª¨ë¸ì„ ë§Œë“­ë‹ˆë‹¤.<br>
                        - RNDëŠ” ë§ì€ íƒí—˜ì´ í•„ìš”í•˜ë¯€ë¡œ <code class="bg-gray-700 p-1 rounded">total_timesteps</code>ë¥¼ í¬ê²Œ ì„¤ì •í•©ë‹ˆë‹¤.
                        </p>
                    </div>
                    <div class="my-4">
                        <a id="download-link" href="sokoban_env.py" download="sokoban_env.py" class="inline-block bg-teal-500 hover:bg-teal-400 text-white font-bold py-2 px-4 rounded-lg transition duration-300">
                            sokoban_env.py ì™„ì„± íŒŒì¼ ë‹¤ìš´ë¡œë“œ
                        </a>
                    </div>
                `,
                code: `
import os
import torch
import torch.nn as nn
from gymnasium import spaces

from stable_baselines3 import PPO
from stable_baselines3.common.monitor import Monitor
from stable_baselines3.common.vec_env import DummyVecEnv
from stable_baselines3.common.torch_layers import BaseFeaturesExtractor
from stable_baselines3.common.callbacks import CheckpointCallback

from rnd_wrapper import RNDRewardWrapper 
from sokoban_env import SokobanEnv

class CustomCNN(BaseFeaturesExtractor):
    def __init__(self, observation_space: spaces.Box, features_dim: int = 128):
        super().__init__(observation_space, features_dim)
        n_input_channels = observation_space.shape[0]
        self.cnn = nn.Sequential(
            nn.Conv2d(n_input_channels, 32, kernel_size=3, stride=1, padding=1),
            nn.ReLU(),
            nn.Conv2d(32, 64, kernel_size=3, stride=1, padding=1),
            nn.ReLU(),
            nn.Flatten(),
        )
        with torch.no_grad():
            n_flatten = self.cnn(
                torch.as_tensor(observation_space.sample()[None]).float()
            ).shape[1]
        self.linear = nn.Sequential(nn.Linear(n_flatten, features_dim), nn.ReLU())

    def forward(self, observations: torch.Tensor) -> torch.Tensor:
        return self.linear(self.cnn(observations))


# í™˜ê²½ ìƒì„±ì„ ìœ„í•œ í—¬í¼ í•¨ìˆ˜
def make_env(log_dir):
    def _init():
        env = SokobanEnv()
        # RND ë˜í¼ë¥¼ ì ìš©í•©ë‹ˆë‹¤.
        env = RNDRewardWrapper(env, lr=1e-4, feature_dim=128)
        env = Monitor(env, log_dir)
        return env
    return _init

if __name__ == '__main__':
    log_dir = "sokoban_logs_rnd_manual/"
    tensorboard_log_dir = "sokoban_tensorboard_rnd_manual/"
    model_save_path = "sokoban_models_rnd_manual/"

    os.makedirs(log_dir, exist_ok=True)
    os.makedirs(tensorboard_log_dir, exist_ok=True)
    os.makedirs(model_save_path, exist_ok=True)

    env = DummyVecEnv([make_env(log_dir)])

    policy_kwargs = dict(
        features_extractor_class=CustomCNN,
        features_extractor_kwargs=dict(features_dim=128),
    )

    # RND ë˜í¼ê°€ ë³´ìƒì„ ì²˜ë¦¬í•´ì£¼ë¯€ë¡œ, ì¼ë°˜ PPO ëª¨ë¸ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
    model = PPO(
        "CnnPolicy",
        env,
        policy_kwargs=policy_kwargs,
        verbose=1,
        tensorboard_log=tensorboard_log_dir,
        learning_rate=3e-4,
        n_steps=2048,
        batch_size=128, # RND ì‚¬ìš© ì‹œ ë°°ì¹˜ ì‚¬ì´ì¦ˆë¥¼ ëŠ˜ë¦¬ë©´ ì•ˆì •ì ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        n_epochs=10,
        gamma=0.99,
        ent_coef=0.01,
    )
    
    checkpoint_callback = CheckpointCallback(
        save_freq=50000,
        save_path=model_save_path,
        name_prefix="sokoban_rnd_manual_model"
    )

    print("--- ì§ì ‘ êµ¬í˜„í•œ RNDë¥¼ ì‚¬ìš©í•œ í•™ìŠµ ì‹œì‘ ---")
    model.learn(
        total_timesteps=1_000_000,
        callback=checkpoint_callback,
        progress_bar=True
    )

    final_model_path = os.path.join(model_save_path, "sokoban_rnd_manual_final")
    model.save(final_model_path)
    
    env.close()

    print("\n" + "="*50)
    print("ğŸ‰ í•™ìŠµì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!")
    print(f"ìµœì¢… ëª¨ë¸ì€ '{final_model_path}.zip'ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.")
    print("í•™ìŠµ ê³¼ì •ì„ í™•ì¸í•˜ë ¤ë©´ ì•„ë˜ ëª…ë ¹ì–´ë¥¼ í„°ë¯¸ë„ì— ì…ë ¥í•˜ì„¸ìš”:")
    print(f"tensorboard --logdir={tensorboard_log_dir}")
    print("="*50)
                `
            }
        ];

        let currentSlide = 0;
        const sliderContainer = document.getElementById('slider-container');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const slideCounter = document.getElementById('slide-counter');

        function createSlide(slideData, index) {
            const slideElement = document.createElement('div');
            slideElement.className = 'slide p-4';
            slideElement.dataset.index = index;

            let codeHtml = '';
            if (slideData.code) {
                // To prevent Prism from misinterpreting the HTML-like syntax in the code,
                // we replace angle brackets with their HTML entities before passing to Prism.
                const escapedCode = slideData.code.trim()
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;');
                
                // Then, we replace our custom highlight tags with actual span tags.
                const finalCode = escapedCode
                    .replace(/\[\[HIGHLIGHT_START\]\]/g, '<span class="code-highlight">')
                    .replace(/\[\[HIGHLIGHT_END\]\]/g, '</span>');

                codeHtml = `<div class="mt-6 bg-[#282c34] rounded-lg overflow-hidden border border-gray-700"><pre class="language-python !text-sm !leading-relaxed"><code>${finalCode}</code></pre></div>`;
            }

            slideElement.innerHTML = `<div class="grid grid-cols-1 ${slideData.code ? 'md:grid-cols-2' : ''} gap-8 items-start"><div class="max-w-none prose prose-invert"><h2 class="text-2xl font-bold text-indigo-400 mb-4">${slideData.title}</h2><div class="text-gray-300 leading-relaxed space-y-2">${slideData.explanation}</div></div>${slideData.code ? `<div>${codeHtml}</div>` : ''}</div>`;
            return slideElement;
        }

        function updateSlider() {
            document.querySelectorAll('.slide').forEach((slide, index) => {
                slide.classList.toggle('active', index === currentSlide);
            });
            slideCounter.textContent = `${currentSlide + 1} / ${slides.length}`;
            prevBtn.disabled = currentSlide === 0;
            nextBtn.disabled = currentSlide === slides.length - 1;
            Prism.highlightAll();
        }

        prevBtn.addEventListener('click', () => { if (currentSlide > 0) { currentSlide--; updateSlider(); } });
        nextBtn.addEventListener('click', () => { if (currentSlide < slides.length - 1) { currentSlide++; updateSlider(); } });
        
        slides.forEach((slideData, index) => { sliderContainer.appendChild(createSlide(slideData, index)); });
        updateSlider();
    </script>
</body>
</html>
