<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë²”ìš© JS/AI ê²Œì„ ì œì‘ ê°€ì´ë“œ (v3.6)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        .step { scroll-margin-top: 80px; }
        .prompt-block, .code-block-provided { position: relative; }
        .copy-button { position: absolute; top: 0.8rem; right: 0.8rem; background-color: #4A5568; color: white; padding: 0.25rem 0.6rem; border-radius: 0.375rem; font-size: 0.8rem; cursor: pointer; transition: background-color 0.2s; }
        .copy-button:hover { background-color: #2D3748; }
        .copy-button.copied { background-color: #2F855A; }
        .user-input { background-color: #FEF3C7; border: 1px dashed #FBBF24; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem; }
        .workflow-guide { background-color: #E6FFFA; border: 1px solid #38B2AC; padding: 1.5rem; border-radius: 0.5rem; margin-top: 1.5rem; }
        .config-guide { background-color: #FFFBEB; border: 1px solid #F6E05E; padding: 1.5rem; border-radius: 0.5rem; margin-top: 1.5rem; }
        .modal-card { transition: transform 0.2s, box-shadow 0.2s; }
        .modal-card:hover { transform: translateY(-4px); box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); }
        .tab-button { padding: 0.5rem 1rem; cursor: pointer; border-bottom: 2px solid transparent; transition: all 0.2s; color: #4A5568; }
        .tab-button.active { border-color: #F59E0B; color: #1E293B; font-weight: 600; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div id="theme-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col">
            <div class="p-5 border-b flex justify-between items-center sticky top-0 bg-white rounded-t-2xl">
                <h2 class="text-xl font-bold text-slate-800">ì¶”ì²œ ê²Œì„ ì£¼ì œ</h2>
                <button id="close-modal-btn" class="text-3xl font-light text-slate-500 hover:text-slate-800">&times;</button>
            </div>
            <div id="theme-grid" class="p-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5 overflow-y-auto"></div>
        </div>
    </div>

    <div class="container mx-auto p-4 sm:p-6 md:p-8 max-w-4xl">
        <header class="text-center my-8 md:my-12">
            <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold text-slate-900">ë²”ìš© JS/AI ê²Œì„ ì œì‘ ê°€ì´ë“œ (v3.6)</h1>
            <p class="mt-4 text-base sm:text-lg text-slate-600">ì´ˆë³´ìë¶€í„° ì „ë¬¸ê°€ê¹Œì§€, ìì‹ ë§Œì˜ AI ê²Œì„ì„ ë§Œë“¤ ìˆ˜ ìˆëŠ” ìµœì¢… ì›Œí¬í”Œë¡œìš°</p>
        </header>
        
        <section class="step bg-white p-6 sm:p-8 rounded-2xl shadow-lg border border-slate-200 mb-10">
            <h2 class="text-2xl font-bold mb-4 border-b pb-3 text-slate-900">ì „ì²´ í”„ë¡œì„¸ìŠ¤ ê°œìš”</h2>
            <ol class="list-decimal list-inside space-y-3 text-slate-700">
                <li><strong class="font-semibold text-slate-800">ê²Œì„ ì•„ì´ë””ì–´ êµ¬ì²´í™”:</strong> ë§Œë“¤ê³  ì‹¶ì€ ê²Œì„ì˜ ìƒì„¸ ê¸°íšì•ˆ ì‘ì„±</li>
                <li><strong class="font-semibold text-slate-800">í†µí•© AI ì›¹ ê²Œì„ ì œì‘:</strong> AI í•™ìŠµê³¼ í”Œë ˆì´ê°€ ëª¨ë‘ ê°€ëŠ¥í•œ JS ê²Œì„ ë¡œì§ ê°œë°œ</li>
                <li><strong class="font-semibold text-slate-800">Python WebSocket í™˜ê²½ ì„¤ì •:</strong> JS ê²Œì„ì„ ì œì–´í•˜ëŠ” Gymnasium í˜¸í™˜ RL í™˜ê²½ ì„¤ì •</li>
                <li><strong class="font-semibold text-slate-800">AI ëª¨ë¸ í•™ìŠµ ë° ë³€í™˜:</strong> ê²Œì„ ì¢…ë¥˜ì— ë§ëŠ” ë°©ì‹ìœ¼ë¡œ AI ëª¨ë¸ì„ í•™ìŠµí•˜ê³  ONNX íŒŒì¼ë¡œ ìë™ ë³€í™˜</li>
                <li><strong class="font-semibold text-slate-800">ìµœì¢… AI ê²Œì„ í…ŒìŠ¤íŠ¸:</strong> ë¡œì»¬ ì„œë²„ë¡œ ì™„ì„±ëœ ê²Œì„ í…ŒìŠ¤íŠ¸</li>
                <li><strong class="font-semibold text-slate-800">GitHub Pages ë°°í¬:</strong> ì™„ì„±ëœ AI ì›¹ ê²Œì„ì„ ì „ ì„¸ê³„ì— ë¬´ë£Œë¡œ ë°°í¬</li>
            </ol>
        </section>

        <section id="step1" class="step bg-white p-6 sm:p-8 rounded-2xl shadow-lg border border-slate-200 mb-10">
            <h2 class="text-2xl font-bold mb-4 border-b pb-3 text-slate-900">ë‹¨ê³„ 1: ê²Œì„ ì•„ì´ë””ì–´ êµ¬ì²´í™”í•˜ê¸°</h2>
            <p class="mb-4 text-slate-700">'ì¶”ì²œ ì£¼ì œ ë³´ê¸°' ë²„íŠ¼ì„ ëˆŒëŸ¬ ì˜ê°ì„ ì–»ê³ , ìƒì„¸ ê¸°íšì•ˆì„ ìš”ì²­í•˜ëŠ” í”„ë¡¬í”„íŠ¸ë¥¼ ë³µì‚¬í•˜ì„¸ìš”.</p>
            <button id="open-modal-btn" class="mb-6 bg-amber-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-amber-600 transition-colors">ğŸ® ì¶”ì²œ ì£¼ì œ ë³´ê¸° & ì˜ê° ì–»ê¸°</button>
            <div class="prompt-block">
                <button class="copy-button">ë³µì‚¬</button>
                <pre class="bg-slate-100 text-slate-800 p-4 rounded-lg overflow-x-auto text-sm"><code id="step1-prompt-code" class="language-text">You are a creative game designer. Based on the theme "[ì—¬ê¸°ì— ì„ íƒí•œ ê²Œì„ ì£¼ì œì™€ ê°„ë‹¨í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”.]", please develop a detailed and engaging game plan with these four sections: Game Concept, Player Objective, Controls, Win/Loss Conditions. Write in Korean.</code></pre>
            </div>
        </section>

        <section id="step2" class="step bg-white p-6 sm:p-8 rounded-2xl shadow-lg border border-slate-200 mb-10">
            <h2 class="text-2xl font-bold mb-4 border-b pb-3 text-slate-900">ë‹¨ê³„ 2: í†µí•© AI ì›¹ ê²Œì„ ì œì‘</h2>
            <div class="user-input mb-6">
                <h3 class="font-semibold text-lg text-slate-800 mb-2">íŒŒì¼ ìƒì„± ì•ˆë‚´</h3>
                <ol class="list-decimal list-inside space-y-2 text-sm text-slate-700">
                    <li>í”„ë¡œì íŠ¸ í´ë”(ì˜ˆ: `my-ai-game`)ë¥¼ ë§Œë“¤ê³  ì½”ë“œ ì—ë””í„°ë¡œ ì—½ë‹ˆë‹¤.</li>
                    <li>í´ë” ì•ˆì— `index.html`ì´ë¼ëŠ” ë¹ˆ íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤.</li>
                    <li>ì•„ë˜ íƒ­ì—ì„œ ì›í•˜ëŠ” ì‘ì—…ì„ ì„ íƒí•˜ê³  í”„ë¡¬í”„íŠ¸ë¥¼ ë³µì‚¬í•˜ì—¬ AIì—ê²Œ ìš”ì²­í•œ ë’¤, ìƒì„±ëœ ì „ì²´ ì½”ë“œë¥¼ `index.html` íŒŒì¼ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.</li>
                </ol>
            </div>
            <div class="border-b border-slate-200"><nav class="flex -mb-px" aria-label="Tabs">
                <button class="tab-button active" data-tab="new-game">ìƒˆ ê²Œì„ ìƒì„±</button>
                <button class="tab-button" data-tab="modify-game">ê¸°ì¡´ ê²Œì„ ìˆ˜ì •</button>
            </nav></div>

            <div id="tab-new-game" class="tab-content active mt-6">
                <div class="prompt-block">
                    <button class="copy-button">ë³µì‚¬</button>
                    <pre class="bg-slate-100 text-slate-800 p-4 rounded-lg overflow-x-auto text-sm"><code id="step2-new-game-prompt" class="language-text">You are an elite game developer, a master of Matter.js, and an expert in creating robust, AI-ready web games. Your task is to write the complete code for a single, self-contained `index.html` file based on the provided game plan.

**Game Logic Plan:**

[ì—¬ê¸°ì— 1ë‹¨ê³„ì—ì„œ ìƒì„±ëœ ê²Œì„ ê¸°íšì•ˆì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.]

**CRITICAL JavaScript Implementation Requirements:**

1.  **Game Modes & State:** Must support `USER`, `AI`, `TRAINING` modes. Use `sessionStorage` to remember the current mode after a refresh, automatically re-entering `TRAINING` mode if it was active.

2.  **Reinforcement Learning Deadlock Prevention:**
    * In `USER` and `AI` modes, the Matter.js `Runner` must be enabled (`runner.enabled = true`) for smooth, real-time gameplay.
    * **Crucially, upon entering `TRAINING` mode, the automatic `Runner` MUST be disabled (`runner.enabled = false`).**
    * In `TRAINING` mode, the physics simulation must only advance a single step via a manual call to `Engine.update(engine, 1000 / 60)` from within the `stepGameForTraining` function. This gives the Python RL agent absolute control over the game loop and prevents race conditions or deadlocks.

3.  **WebSocket Interface & RL Protocol:**
    * Implement `connectWebSocket()` to connect to `ws://localhost:8765`.
    * The interface must handle a `reset` command (which triggers `resetForTraining`) and an `action` command (which triggers `stepGameForTraining`).
    * The `stepGameForTraining(action)` function must be designed to accept a **continuous floating-point value** (e.g., from -1.0 to 1.0) and translate that into a proportionally scaled force or velocity within the game.
    * **Strict RL Protocol:**
        * The `resetForTraining()` function must ONLY send back the initial observation packet: `{observation: getObservation()}`.
        * The `stepGameForTraining(action)` function must send the complete data packet: `{observation, reward, done}`.

4.  **Robust Physics & World Design:**
    * Use Matter.js collision categories to prevent unintended physical interactions.
    * Game resets must be stable. Use a state flag (e.g., `isRoundOver`) to prevent multiple simultaneous resets.
    * The game world (e.g., the ground or play area) must be significantly larger than the visible screen area.
    * The game viewport must smoothly track the primary player-controlled object to allow for unrestricted movement.

5.  **Core RL Functions & State Management:**
    * Implement the core functions: `getObservation()`, `resetForTraining()`, and `stepGameForTraining(action)`.
    * **Meaningful Resets:** The `resetGame()` function must always initialize the environment in a **non-trivial, randomized state** that requires immediate and skillful action from the player or agent. Avoid starting in a perfectly stable "solved" state.
    * **High-Throughput Training:** In `TRAINING` mode, reaching a terminal state (`done: true`) must trigger an **immediate** call to `resetForTraining()` to maximize training speed, bypassing any delays used for visual effect in other modes.

// --- For 2-Player / Self-Play Games ONLY ---
/*
6.  **Dual ONNX Model Support:**
    * The game must load `model.onnx` and `opponent.onnx`. Use a cache-busting query (`?v=` + Date.now()) when loading `opponent.onnx`.
    * In `TRAINING` mode, the opponent character must be controlled by the `opponent.onnx` model. Decouple the AI's async decision-making from the synchronous physics loop (e.g., using `setInterval` for decisions and applying the latest decision in the main loop).
*/
</code></pre>
                </div>
            </div>
            <div id="tab-modify-game" class="tab-content mt-6">
                 <div class="prompt-block">
                    <button class="copy-button">ë³µì‚¬</button>
                    <pre class="bg-slate-100 text-slate-800 p-4 rounded-lg overflow-x-auto text-sm"><code id="step2-modify-game-prompt" class="language-text">You are an expert reinforcement learning engineer. Your task is to modify the provided HTML game code to make it compatible with a Python-based training environment. You MUST inject the following features without breaking the original game's functionality.

You are an expert AI integration specialist and a master of JavaScript game engineering. Your task is to intelligently modify an existing single-file HTML game to make it a robust environment for reinforcement learning. You must analyze the provided game code and inject the necessary logic without breaking the original gameplay.

**CRITICAL Integration Requirements:**

1.  **Inject Game Modes & State Management:**
    * Introduce UI elements (e.g., a modal on startup) and the underlying logic to switch between three distinct modes: `USER` (original human play), `AI` (inference with a model), and `TRAINING` (for the RL agent).
    * Use `sessionStorage` to persist the current mode across page refreshes, automatically re-entering `TRAINING` mode if it was the last active state.

2.  **Implement Reinforcement Learning Deadlock Prevention:**
    * Analyze the game's main loop (e.g., `requestAnimationFrame`, `setInterval`, or a physics engine's `Runner`).
    * In `USER` and `AI` modes, this main loop must run in real-time as originally intended.
    * **Crucially, upon entering `TRAINING` mode, the game's automatic, real-time loop MUST be stopped or disabled.**
    * The game's state should only advance when a manual `step` command is received from the training agent.

3.  **Inject WebSocket Interface & Strict RL Protocol:**
    * Implement a `connectWebSocket()` function to establish a connection with the Python training server at `ws://localhost:8765`.
    * The WebSocket listener must correctly handle two primary commands from the server: `reset` (which triggers the `resetForTraining` function) and `action` (which triggers the `stepGameForTraining` function).
    * **Adhere to the standard RL communication protocol:**
        * The `resetForTraining()` function's ONLY responsibility is to reset the environment and send back the initial observation packet: `{observation: getObservation()}`.
        * The `stepGameForTraining(action)` function must execute the action, advance the game state by a single discrete step (e.g., one physics tick or one frame), and then send back the complete data packet: `{observation: getObservation(), reward: calculatedReward, done: isDone}`.

4.  **Create and Adapt Core RL Functions:**
    * Analyze the existing game variables to create a `getObservation()` function that returns a meaningful, numeric state representation (e.g., positions, velocities, angles) as an array.
    * Create a `stepGameForTraining(action)` function. This function must:
        a.  Accept an `action` (ideally a continuous floating-point value for versatility).
        b.  Translate this action into a force, velocity, or other control input in the game.
        c.  Manually advance the game simulation by exactly one tick/frame.
        d.  Calculate the `reward` and the `done` status based on the new game state.
        e.  Send the complete data packet back via WebSocket.
    * Create a `resetForTraining()` function that resets the game to a **non-trivial, randomized starting state** to ensure effective learning.
    * **High-Throughput Training:** In `TRAINING` mode, when a `done` state is reached, the environment must trigger an **immediate** reset to maximize training episodes, bypassing any animations or delays used in other modes.

5.  **Inject ONNX Model Support (for AI Mode):**
    * Add the necessary scripts (e.g., `onnxruntime-web`) to load an ONNX model.
    * Implement logic to load `model.onnx`.
    * In `AI` mode, the game loop should continuously:
        a.  Get the current observation using `getObservation()`.
        b.  Feed the observation into the loaded ONNX model to get an action.
        c.  Apply the action to control the player character.

// --- For 2-Player / Self-Play Games ONLY ---
/*
6.  **Inject Dual ONNX Support:**
    * In addition to `model.onnx`, load an `opponent.onnx` model. Use a cache-busting query string (e.g., `?v=${Date.now()}`) when fetching `opponent.onnx` to ensure the latest version is always loaded during self-play training.
    * In `TRAINING` mode, the opponent entity must be controlled by the `opponent.onnx` model.
*/

**Original Game Code:**

[ì—¬ê¸°ì— ì‚¬ìš©ìì˜ ê¸°ì¡´ ê²Œì„ ì½”ë“œë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.]
</code></pre>
                </div>
            </div>
        </section>

        <section id="step3" class="step bg-white p-6 sm:p-8 rounded-2xl shadow-lg border border-slate-200 mb-10">
            <h2 class="text-2xl font-bold mb-4 border-b pb-3 text-slate-900">ë‹¨ê³„ 3: Python WebSocket ê°•í™”í•™ìŠµ í™˜ê²½ ì„¤ì •</h2>
            <div class="user-input mb-6">
                <h3 class="font-semibold text-lg text-slate-800 mb-2">íŒŒì¼ ìƒì„± ë° ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜</h3>
                <ol class="list-decimal list-inside space-y-2 text-sm text-slate-700">
                    <li>í”„ë¡œì íŠ¸ í´ë”ì— `websocket_env.py` íŒŒì¼ì„ ìƒì„±í•˜ê³  ì•„ë˜ ì½”ë“œë¥¼ ë¶™ì—¬ë„£ìŠµë‹ˆë‹¤.</li>
                    <li>í„°ë¯¸ë„ì„ ì—´ê³  `pip install gymnasium numpy websockets` ëª…ë ¹ì–´ë¡œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.</li>
                </ol>
            </div>
             <div class="code-block-provided">
                <button class="copy-button">ë³µì‚¬</button>
                <pre class="bg-slate-100 text-slate-800 p-4 rounded-lg overflow-x-auto text-sm"><code class="language-python">import gymnasium as gym
from gymnasium import spaces
import numpy as np
import asyncio
import websockets
import json
import logging
import threading
import queue

# Websockets ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ìƒì„¸ ë¡œê·¸ ë¹„í™œì„±í™”
logging.getLogger("websockets").setLevel(logging.ERROR)
logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(message)s')

class ServerThread(threading.Thread):
    """
    ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì›¹ì†Œì¼“ ì„œë²„ë¥¼ ì‹¤í–‰í•˜ê³  ë©”ì¸ ìŠ¤ë ˆë“œì™€ íë¥¼ í†µí•´ í†µì‹ í•˜ëŠ”
    ë…ë¦½ì ì¸ ìŠ¤ë ˆë“œì…ë‹ˆë‹¤.
    """
    def __init__(self):
        super().__init__()
        self.loop = asyncio.new_event_loop()
        self.command_queue = queue.Queue()
        self.observation_queue = queue.Queue()
        self.daemon = True # ë©”ì¸ ìŠ¤ë ˆë“œê°€ ì¢…ë£Œë˜ë©´ í•¨ê»˜ ì¢…ë£Œ

    async def handler(self, websocket, path):
        logging.info(f"ìƒˆë¡œìš´ í´ë¼ì´ì–¸íŠ¸ ì—°ê²°ë¨: {websocket.remote_address}")
        consumer_task = asyncio.ensure_future(self.consumer(websocket))
        producer_task = asyncio.ensure_future(self.producer(websocket))
        done, pending = await asyncio.wait([consumer_task, producer_task], return_when=asyncio.FIRST_COMPLETED)
        for task in pending: task.cancel()
        logging.info(f"í´ë¼ì´ì–¸íŠ¸ ì—°ê²° ì¢…ë£Œ: {websocket.remote_address}")

    async def consumer(self, websocket):
        """ë©”ì¸ ìŠ¤ë ˆë“œë¡œë¶€í„° ëª…ë ¹ì„ ë°›ì•„ í´ë¼ì´ì–¸íŠ¸ë¡œ ì „ì†¡"""
        while True:
            try:
                command = await self.loop.run_in_executor(None, self.command_queue.get)
                await websocket.send(json.dumps(command))
            except websockets.exceptions.ConnectionClosed: break

    async def producer(self, websocket):
        """í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ê´€ì¸¡ ë°ì´í„°ë¥¼ ë°›ì•„ ë©”ì¸ ìŠ¤ë ˆë“œë¡œ ì „ì†¡"""
        while True:
            try:
                message = await websocket.recv()
                data = json.loads(message)
                # BUG FIX: CartPoleì˜ reset ë¡œì§ì€ observationë§Œ ë³´ë‚´ë¯€ë¡œ, reward/doneì´ ì—†ì–´ë„ ì²˜ë¦¬
                if "observation" in data:
                    obs = np.array(data["observation"], dtype=np.float32)
                    reward = data.get("reward", 0) # rewardê°€ ì—†ìœ¼ë©´ 0ìœ¼ë¡œ ì²˜ë¦¬
                    done = data.get("done", False) # doneì´ ì—†ìœ¼ë©´ Falseë¡œ ì²˜ë¦¬
                    self.observation_queue.put((obs, reward, done))
            except websockets.exceptions.ConnectionClosed: break

    def run(self):
        asyncio.set_event_loop(self.loop)
        start_server = websockets.serve(self.handler, "localhost", 8765)
        self.loop.run_until_complete(start_server)
        logging.info("ì›¹ì†Œì¼“ ì„œë²„ê°€ 8765 í¬íŠ¸ì—ì„œ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.")
        self.loop.run_forever()

    def stop(self):
        if self.loop.is_running(): self.loop.call_soon_threadsafe(self.loop.stop)

class WebSocketEnv(gym.Env):
    def __init__(self, observation_shape, action_space_config):
        super(WebSocketEnv, self).__init__()
        self.observation_space = spaces.Box(low=-np.inf, high=np.inf, shape=observation_shape, dtype=np.float32)
        if action_space_config['type'] == 'discrete': self.action_space = spaces.Discrete(action_space_config['n'])
        elif action_space_config['type'] == 'continuous': self.action_space = spaces.Box(low=np.array(action_space_config['low']), high=np.array(action_space_config['high']), dtype=np.float32)
        self.server_thread = ServerThread()
        self.server_thread.start()
        print("ì²« í´ë¼ì´ì–¸íŠ¸ì˜ ì—°ê²° ë° ë°ì´í„° ìˆ˜ì‹ ì„ ê¸°ë‹¤ë¦½ë‹ˆë‹¤...")

    def reset(self, seed=None, options=None):
        super().reset(seed=seed)
        
        # --- BUG FIX: íë¥¼ ë¹„ì›Œ ì´ì „ ì„¸ì…˜ì˜ 'ìœ ë ¹ ë°ì´í„°'ë¥¼ ì œê±°í•©ë‹ˆë‹¤ ---
        with self.server_thread.observation_queue.mutex:
            self.server_thread.observation_queue.queue.clear()
            
        self.server_thread.command_queue.put({"command": "reset"})
        obs, _, _ = self.server_thread.observation_queue.get() # ë¸”ë¡œí‚¹ í˜¸ì¶œë¡œ ìƒˆ ë°ì´í„°ë¥¼ ê¸°ë‹¤ë¦¼
        
        # print("í™˜ê²½ ë¦¬ì…‹ ì™„ë£Œ. ë‹¤ìŒ ì„¸ëŒ€ í•™ìŠµì„ ì‹œì‘í•©ë‹ˆë‹¤.")
        return obs, {}

    def step(self, action):
        action_to_send = action.tolist() if isinstance(action, np.ndarray) else float(action) # ì—°ì† í–‰ë™ì€ float
        self.server_thread.command_queue.put({"command": "action", "action": action_to_send})
        obs, reward, done = self.server_thread.observation_queue.get() # ë¸”ë¡œí‚¹ í˜¸ì¶œ
        return obs, reward, done, False, {}

    def render(self, mode='human'): pass
    
    def close(self):
        self.server_thread.stop()
        print("ì›¹ì†Œì¼“ ì„œë²„ê°€ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.")
</code></pre>
            </div>
        </section>
        
        <section id="step4" class="step bg-white p-6 sm:p-8 rounded-2xl shadow-lg border border-slate-200 mb-10">
            <h2 class="text-2xl font-bold mb-4 border-b pb-3 text-slate-900">ë‹¨ê³„ 4: AI ëª¨ë¸ í•™ìŠµ ë° ONNX ë³€í™˜</h2>
            <div class="user-input mb-6">
                <h3 class="font-semibold text-lg text-slate-800 mb-2">íŒŒì¼ ìƒì„± ë° ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜</h3>
                <ol class="list-decimal list-inside space-y-2 text-sm text-slate-700">
                    <li>ì•„ë˜ íƒ­ì—ì„œ ìì‹ ì˜ ê²Œì„ ì¢…ë¥˜ì— ë§ëŠ” ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œë¥¼ ë³µì‚¬í•˜ê³  í”„ë¡œì íŠ¸ í´ë”ì— íŒŒì¼ë¡œ ì €ì¥í•©ë‹ˆë‹¤.</li>
                    <li>í„°ë¯¸ë„ì—ì„œ `pip install stable-baselines3[extra] torch onnx onnxruntime tensorboard` ëª…ë ¹ì–´ë¡œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.</li>
                </ol>
            </div>
            <div class="border-b border-slate-200"><nav class="flex -mb-px" aria-label="Tabs">
                <button class="tab-button active" data-tab="simple">ê¸°ë³¸ í•™ìŠµ (1ì¸ìš©)</button>
                <button class="tab-button" data-tab="selfplay">ì…€í”„ í”Œë ˆì´ í•™ìŠµ (2ì¸ìš©)</button>
            </nav></div>
            <div id="tab-simple" class="tab-content active mt-6">
                <div class="code-block-provided">
                    <button class="copy-button">ë³µì‚¬</button>
                    <pre class="bg-slate-100 text-slate-800 p-4 rounded-lg overflow-x-auto text-sm"><code class="language-python"># train_simple.py
import os, time, torch, webbrowser, threading
import http.server, socketserver
from stable_baselines3 import PPO
from stable_baselines3.common.callbacks import CheckpointCallback, ProgressBarCallback, CallbackList
from stable_baselines3.common.logger import configure
from websocket_env import WebSocketEnv

# --- ì¤‘ìš” ì„¤ì • ---
# 1. ê´€ì°° ê³µê°„ (Observation Space) - AIì˜ 'ëˆˆ'
OBSERVATION_SHAPE = (4,)
# OBSERVATION_SHAPE = (1, 84, 84) # CnnPolicyë¥¼ ìœ„í•œ ì´ë¯¸ì§€ ê´€ì°° ì˜ˆì‹œ
# 2. í–‰ë™ ê³µê°„ (Action Space) - AIì˜ 'ì†'
ACTION_SPACE_CONFIG = {'type': 'discrete', 'n': 5}
# ACTION_SPACE_CONFIG = {'type': 'continuous', 'low': [-2.0], 'high': [2.0]} # 1ì°¨ì› ì—°ì† í–‰ë™ ì˜ˆì‹œ
# ACTION_SPACE_CONFIG = {'type': 'continuous', 'low': [-1.0, -3.0], 'high': [1.0, 3.0]} # 2ì°¨ì› ì—°ì† í–‰ë™ ì˜ˆì‹œ

# -----------------
LOG_DIR, TOTAL_TIMESTEPS, PORT = "training_logs", 1_000_000, 8000
os.makedirs(LOG_DIR, exist_ok=True)

class WebServerThread(threading.Thread):
    def __init__(self, port): super().__init__(); self.port, self.server, self.daemon = port, None, True
    def run(self): self.server = socketserver.TCPServer(("", self.port), http.server.SimpleHTTPRequestHandler); self.server.serve_forever()
    def stop(self):
        if self.server: self.server.shutdown()

class OnnxablePolicy(torch.nn.Module):
    def __init__(self, policy): super().__init__(); self.policy = policy
    def forward(self, observation):
        action, _ = self.policy.predict(observation.cpu().numpy(), deterministic=True)
        return torch.from_numpy(action).to(observation.device)

def export_to_onnx(model_path, onnx_path):
    print(f"\nëª¨ë¸ {model_path}ë¥¼ ONNX í˜•ì‹({onnx_path})ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤...")
    model = PPO.load(model_path, device='cpu')
    onnxable_model = OnnxablePolicy(model.policy)
    dummy_input = torch.randn(1, *OBSERVATION_SHAPE)
    torch.onnx.export(onnxable_model, dummy_input, onnx_path, opset_version=12, input_names=["observation"], output_names=["action"])
    print("ONNX ë³€í™˜ ì™„ë£Œ.")

def find_latest_run_and_checkpoint():
    if not os.path.isdir(LOG_DIR): return None, None
    runs = sorted([d for d in os.listdir(LOG_DIR) if os.path.isdir(os.path.join(LOG_DIR, d))], reverse=True)
    for run in runs:
        run_path = os.path.join(LOG_DIR, run)
        checkpoints_path = os.path.join(run_path, "checkpoints")
        if not os.path.isdir(checkpoints_path): continue
        checkpoints = [f for f in os.listdir(checkpoints_path) if f.startswith("rl_model_") and f.endswith(".zip")]
        if checkpoints:
            latest_checkpoint = max(checkpoints, key=lambda f: int(f.split("_")[2].replace(".zip", "")))
            return run, os.path.join(checkpoints_path, latest_checkpoint)
    return None, None

def main():
    web_server = WebServerThread(PORT)
    web_server.start()
    time.sleep(1)
    webbrowser.open(f'http://localhost:{PORT}')
    
    latest_run_name, latest_checkpoint = find_latest_run_and_checkpoint()
    
    TENSORBOARD_LOG_NAME = latest_run_name if latest_run_name else f"PPO_{int(time.time())}"
    run_path = os.path.join(LOG_DIR, TENSORBOARD_LOG_NAME)
    
    checkpoint_path = os.path.join(run_path, "checkpoints")
    os.makedirs(checkpoint_path, exist_ok=True)
    
    env = WebSocketEnv(observation_shape=OBSERVATION_SHAPE, action_space_config=ACTION_SPACE_CONFIG)
    custom_logger = configure(run_path, ["stdout", "tensorboard"])
    
    checkpoint_callback = CheckpointCallback(save_freq=20000, save_path=checkpoint_path, name_prefix="rl_model")
    progress_callback = ProgressBarCallback()
    callback_list = CallbackList([checkpoint_callback, progress_callback])
    
    policy_type = "CnnPolicy" if len(OBSERVATION_SHAPE) == 3 else "MlpPolicy"
    
    if latest_checkpoint:
        print(f"ì²´í¬í¬ì¸íŠ¸ì—ì„œ í•™ìŠµì„ ì¬ê°œí•©ë‹ˆë‹¤: {latest_checkpoint}")
        model = PPO.load(latest_checkpoint, env=env, device='auto')
    else:
        print(f"{policy_type} ì •ì±…ìœ¼ë¡œ ìƒˆë¡œìš´ í•™ìŠµ ì„¸ì…˜ì„ ì‹œì‘í•©ë‹ˆë‹¤.")
        model = PPO(policy_type, env, verbose=0, device='auto') # verbose=0 for clean progress bar
        
    model.set_logger(custom_logger)
    final_model_path = ""
    try:
        model.learn(total_timesteps=TOTAL_TIMESTEPS, callback=callback_list, reset_num_timesteps=not bool(latest_checkpoint))
        final_model_path = os.path.join(run_path, "final_model.zip")
        model.save(final_model_path)
        print(f"\nìµœì¢… ëª¨ë¸ ì €ì¥ ì™„ë£Œ: {final_model_path}")
    finally:
        env.close()
        web_server.stop()

    if os.path.exists(final_model_path):
        export_to_onnx(final_model_path, "model.onnx")

if __name__ == '__main__':
    main()
</code></pre>
                </div>
            </div>

            <div id="tab-selfplay" class="tab-content mt-6">
                 <div class="code-block-provided">
                    <button class="copy-button">ë³µì‚¬</button>
                    <pre class="bg-slate-100 text-slate-800 p-4 rounded-lg overflow-x-auto text-sm"><code class="language-python"># train_selfplay.py
import os, time, torch, webbrowser, threading
import http.server, socketserver
from stable_baselines3 import PPO
from stable_baselines3.common.callbacks import CheckpointCallback, ProgressBarCallback, CallbackList
from stable_baselines3.common.logger import configure
from websocket_env import WebSocketEnv

# --- ì¤‘ìš” ì„¤ì • ---
# 1. ê´€ì°° ê³µê°„ (Observation Space) - AIì˜ 'ëˆˆ'
OBSERVATION_SHAPE = (8,)
# OBSERVATION_SHAPE = (1, 84, 84) # CnnPolicyë¥¼ ìœ„í•œ ì´ë¯¸ì§€ ê´€ì°° ì˜ˆì‹œ
# 2. í–‰ë™ ê³µê°„ (Action Space) - AIì˜ 'ì†'
ACTION_SPACE_CONFIG = {'type': 'discrete', 'n': 5}
# ACTION_SPACE_CONFIG = {'type': 'continuous', 'low': [-2.0], 'high': [2.0]} # 1ì°¨ì› ì—°ì† í–‰ë™ ì˜ˆì‹œ
# ACTION_SPACE_CONFIG = {'type': 'continuous', 'low': [-1.0, -3.0], 'high': [1.0, 3.0]} # 2ì°¨ì› ì—°ì† í–‰ë™ ì˜ˆì‹œ
# -----------------
TOTAL_TRAINING_STEPS, STEPS_PER_ITERATION = 1_000_000, 50_000
MODEL_DIR, LOG_DIR, PORT = "models", "training_logs", 8000
os.makedirs(MODEL_DIR, exist_ok=True)
os.makedirs(LOG_DIR, exist_ok=True)

class WebServerThread(threading.Thread):
    def __init__(self, port): super().__init__(); self.port, self.server, self.daemon = port, None, True
    def run(self): self.server = socketserver.TCPServer(("", self.port), http.server.SimpleHTTPRequestHandler); self.server.serve_forever()
    def stop(self):
        if self.server: self.server.shutdown()

class OnnxablePolicy(torch.nn.Module):
    def __init__(self, policy): super().__init__(); self.policy = policy
    def forward(self, observation):
        action, _ = self.policy.predict(observation.cpu().numpy(), deterministic=True)
        return torch.from_numpy(action).to(observation.device)

def export_to_onnx(model_path, onnx_path):
    print(f"\nëª¨ë¸ {model_path}ë¥¼ ONNX í˜•ì‹({onnx_path})ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤...")
    model = PPO.load(model_path, device='cpu')
    onnxable_model = OnnxablePolicy(model.policy)
    dummy_input = torch.randn(1, *OBSERVATION_SHAPE)
    torch.onnx.export(onnxable_model, dummy_input, onnx_path, opset_version=12, input_names=["observation"], output_names=["action"])
    print("ONNX ë³€í™˜ ì™„ë£Œ.")

def find_latest_log_dir():
    if not os.path.isdir(LOG_DIR): return None
    runs = [d for d in os.listdir(LOG_DIR) if os.path.isdir(os.path.join(LOG_DIR, d)) and d.startswith("PPO_SelfPlay")]
    if not runs: return None
    # ì‹œê°„ìˆœìœ¼ë¡œ ê°€ì¥ ìµœì‹  í´ë” ì°¾ê¸°
    latest_run = max(runs, key=lambda d: os.path.getmtime(os.path.join(LOG_DIR, d)))
    return latest_run

def main():
    web_server = WebServerThread(PORT)
    web_server.start()
    time.sleep(1)
    webbrowser.open(f'http://localhost:{PORT}')
    
    env = WebSocketEnv(observation_shape=OBSERVATION_SHAPE, action_space_config=ACTION_SPACE_CONFIG)
    
    latest_model_path = os.path.join(MODEL_DIR, "latest_model.zip")
    
    # TensorBoard ë¡œê¹… ì—°ì†ì„±ì„ ìœ„í•œ ë¡œê·¸ ë””ë ‰í† ë¦¬ ì„¤ì •
    latest_run_name = find_latest_log_dir()
    TENSORBOARD_LOG_NAME = latest_run_name if os.path.exists(latest_model_path) and latest_run_name else f"PPO_SelfPlay_{int(time.time())}"
    run_path = os.path.join(LOG_DIR, TENSORBOARD_LOG_NAME)
    
    custom_logger = configure(run_path, ["stdout", "tensorboard"])
    
    # ì²´í¬í¬ì¸íŠ¸ì™€ í”„ë¡œê·¸ë ˆìŠ¤ ë°”ë¥¼ ìœ„í•œ ì½œë°± ë¦¬ìŠ¤íŠ¸ ì„¤ì •
    checkpoint_path = os.path.join(run_path, "checkpoints")
    os.makedirs(checkpoint_path, exist_ok=True)
    checkpoint_callback = CheckpointCallback(save_freq=20000, save_path=checkpoint_path, name_prefix="rl_model")
    callback_list = CallbackList([checkpoint_callback, ProgressBarCallback()])
    
    policy_type = "CnnPolicy" if len(OBSERVATION_SHAPE) == 3 else "MlpPolicy"

    if os.path.exists(latest_model_path):
        print(f"ì €ì¥ëœ ëª¨ë¸ {latest_model_path}ì—ì„œ í•™ìŠµì„ ì¬ê°œí•©ë‹ˆë‹¤.")
        model = PPO.load(latest_model_path, env=env, device='auto') 
    else:
        print(f"{policy_type} ì •ì±…ìœ¼ë¡œ ìƒˆë¡œìš´ í•™ìŠµì„ ì‹œì‘í•©ë‹ˆë‹¤.")
        model = PPO(policy_type, env, verbose=0, device='auto')
        
    model.set_logger(custom_logger)
    
    if not os.path.exists("opponent.onnx"):
        print("'opponent.onnx' íŒŒì¼ì´ ì—†ì–´ í˜„ì¬ ì—ì´ì „íŠ¸ë¡œ ì´ˆê¸° ìƒëŒ€ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.")
        model.save(os.path.join(MODEL_DIR, "initial_model.zip"))
        export_to_onnx(os.path.join(MODEL_DIR, "initial_model.zip"), "opponent.onnx")
    else:
        print("ê¸°ì¡´ 'opponent.onnx' íŒŒì¼ì„ ì´ˆê¸° ìƒëŒ€ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.")
    
    try:
        total_steps_done = model.num_timesteps
        while total_steps_done < TOTAL_TRAINING_STEPS:
            model.learn(total_timesteps=total_steps_done + STEPS_PER_ITERATION, callback=callback_list, reset_num_timesteps=False)
            total_steps_done = model.num_timesteps
            model.save(latest_model_path)
            export_to_onnx(latest_model_path, "opponent.onnx")
            if total_steps_done < TOTAL_TRAINING_STEPS:
                input(f"--- CHECKPOINT ({total_steps_done}/{TOTAL_TRAINING_STEPS} steps) ---\n"
                      f">>> ìƒëŒ€ë°© ëª¨ë¸ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì €ë¥¼ ìƒˆë¡œê³ ì¹¨(F5)í•œ ë’¤, ì—¬ê¸°ì„œ Enterë¥¼ ëˆ„ë¥´ì„¸ìš”...")
    finally:
        env.close()
        web_server.stop()
    
    export_to_onnx(latest_model_path, "model.onnx")

if __name__ == '__main__':
    main()
</code></pre>
                </div>
            </div>
            <div class="config-guide">
                <h4 class="text-lg font-bold">AI ì„¤ì • ê°€ì´ë“œ</h4>
                <div class="mt-4">
                    <h5 class="font-semibold">ê´€ì°° ê³µê°„(Observation Space) - AIì˜ 'ëˆˆ'</h5>
                    <ul class="list-disc pl-5 mt-2 space-y-2 text-sm">
                        <li><strong>ë²¡í„° ê´€ì°°:</strong> `(ìˆ«ì,)` í˜•íƒœ (ì˜ˆ: `(8,)`). AIëŠ” `[ì¢Œí‘œ, ì†ë„]` ë“± ìˆ«ì ë¦¬ìŠ¤íŠ¸ë¡œ ìƒíƒœë¥¼ ì¸ì‹í•©ë‹ˆë‹¤. ì´ë•Œ SB3ëŠ” ìë™ìœ¼ë¡œ **MlpPolicy**ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</li>
                        <li><strong>ì´ë¯¸ì§€ ê´€ì°°:</strong> `(ì±„ë„, ë†’ì´, ë„ˆë¹„)` í˜•íƒœ (ì˜ˆ: `(1, 84, 84)`). AIëŠ” ê²Œì„ í™”ë©´ í”½ì…€ ìì²´ë¥¼ ë³´ê³  í•™ìŠµí•©ë‹ˆë‹¤. ì´ë•Œ SB3ëŠ” ìë™ìœ¼ë¡œ **CnnPolicy**ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</li>
                    </ul>
                </div>
                <div class="mt-4">
                    <h5 class="font-semibold">í–‰ë™ ê³µê°„(Action Space) - AIì˜ 'ì†'</h5>
                    <ul class="list-disc pl-5 mt-2 space-y-2 text-sm">
                        <li><strong>ì´ì‚°(Discrete) í–‰ë™:</strong> "ì í”„", "ì™¼ìª½" ê°™ì´ ë²„íŠ¼ì²˜ëŸ¼ ë”±ë”± ëŠì–´ì§€ëŠ” í–‰ë™ì…ë‹ˆë‹¤. JSì˜ `applyAction`ì€ ì •ìˆ˜(`0, 1, 2...`)ë¥¼ ë°›ìŠµë‹ˆë‹¤.</li>
                        <li><strong>ì—°ì†(Continuous) í–‰ë™:</strong> ë¡œì¼“ ì¶”ì§„ë ¥(-1.0 ~ 1.0)ì²˜ëŸ¼ ì„¸ë°€í•˜ê³  ì—°ì†ì ì¸ ê°’ìœ¼ë¡œ ì¡°ì‘í•©ë‹ˆë‹¤. JSì˜ `applyAction`ì€ ìˆ«ì ë°°ì—´(`[-0.5, 0.88]`)ì„ ë°›ìŠµë‹ˆë‹¤.</li>
                    </ul>
                </div>
            </div>
        </section>

        <section id="step5" class="step bg-white p-6 sm:p-8 rounded-2xl shadow-lg border border-slate-200 mb-10">
            <h2 class="text-2xl font-bold mb-4 border-b pb-3 text-slate-900">ë‹¨ê³„ 5: ìµœì¢… AI ê²Œì„ í…ŒìŠ¤íŠ¸</h2>
             <div class="workflow-guide">
                <h4 class="text-lg">AI í”Œë ˆì´ ê°ìƒí•˜ê¸°</h4>
                <p class="mt-2 text-sm text-slate-700">ì´ì œ ëª¨ë“  ì¤€ë¹„ê°€ ëë‚¬ìŠµë‹ˆë‹¤. í•™ìŠµì˜ ìµœì¢… ê²°ê³¼ë¬¼ì¸ `model.onnx`ê°€ ì–¼ë§ˆë‚˜ ë˜‘ë˜‘í•´ì¡ŒëŠ”ì§€ í™•ì¸í•´ë³¼ ì‹œê°„ì…ë‹ˆë‹¤.</p>
                <ol class="list-decimal list-inside space-y-2 text-sm text-slate-700 mt-3">
                    <li>í”„ë¡œì íŠ¸ í´ë”ì—ì„œ í„°ë¯¸ë„ì„ ì—´ê³  <code>python -m http.server</code> ëª…ë ¹ì–´ë¡œ ë¡œì»¬ ì„œë²„ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.</li>
                     <li>ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ <a href="http://localhost:8000" target="_blank" class="text-teal-600 underline">http://localhost:8000</a> ìœ¼ë¡œ ì ‘ì†í•©ë‹ˆë‹¤.</li>
                     <li>ê²Œì„ì´ ë¡œë“œë˜ë©´, **'AI ëª¨ë“œ'** ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ í•™ìŠµëœ ëª¨ë¸ì˜ í”Œë ˆì´ë¥¼ ê°ìƒí•˜ì„¸ìš”!</li>
                </ol>
            </div>
        </section>

        <section id="step6" class="step bg-white p-6 sm:p-8 rounded-2xl shadow-lg border border-slate-200 mb-10">
            <h2 class="text-2xl font-bold mb-4 border-b pb-3 text-slate-900">ë‹¨ê³„ 6: GitHub Pages ë°°í¬</h2>
            <p class="mb-6 text-slate-700">ìµœì¢… ë‹¨ê³„ì…ë‹ˆë‹¤. ì™„ì„±ëœ í”„ë¡œì íŠ¸ë¥¼ VS Codeì—ì„œ ë°”ë¡œ GitHubì— ì˜¬ë¦¬ê³ , GitHub Pagesë¥¼ í†µí•´ ì „ ì„¸ê³„ì— ë°°í¬í•©ë‹ˆë‹¤.</p>
            <div class="space-y-6 text-slate-700">
                <div>
                    <h3 class="font-semibold text-lg text-slate-800">1. ì‚¬ì „ ì¤€ë¹„: Git ì„¤ì¹˜ ë° ì„¤ì •</h3>
                    <p class="mt-1 ml-2">Gitì´ ì„¤ì¹˜ë˜ì–´ ìˆì§€ ì•Šë‹¤ë©´ <a href="https://git-scm.com/" target="_blank" class="text-teal-600 underline">git-scm.com</a>ì—ì„œ ë‹¤ìš´ë¡œë“œí•˜ì—¬ ì„¤ì¹˜í•©ë‹ˆë‹¤. ì„¤ì¹˜ í›„, í„°ë¯¸ë„ì„ ì—´ì–´ ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ì—¬ ì‚¬ìš©ì ì •ë³´ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤ (ìµœì´ˆ í•œ ë²ˆë§Œ í•„ìš”).</p>
                    <pre class="bg-slate-100 text-slate-800 p-2 mt-1 rounded-md text-sm"><code>git config --global user.name "Your Name"
git config --global user.email "you@example.com"</code></pre>
                </div>
                <div>
                    <h3 class="font-semibold text-lg text-slate-800">2. VS Codeì—ì„œ GitHub ê³„ì • ì—°ë™</h3>
                    <p class="mt-1 ml-2">VS Code ì™¼ìª½ í•˜ë‹¨ì˜ ì‚¬ëŒ ëª¨ì–‘ ì•„ì´ì½˜(ê³„ì •)ì„ í´ë¦­í•˜ê³ , 'GitHubìœ¼ë¡œ ë¡œê·¸ì¸(Sign in with GitHub)'ì„ ì„ íƒí•˜ì—¬ ë¸Œë¼ìš°ì €ì˜ ì•ˆë‚´ì— ë”°ë¼ ê³„ì •ì„ ì—°ë™í•©ë‹ˆë‹¤.</p>
                </div>
                <div>
                    <h3 class="font-semibold text-lg text-slate-800">3. Git ì €ì¥ì†Œ ì´ˆê¸°í™” ë° ì²« ì»¤ë°‹</h3>
                    <p class="mt-1 ml-2">VS Code ì™¼ìª½ì˜ 'ì†ŒìŠ¤ ì œì–´' íƒ­(ê°€ì§€ ëª¨ì–‘ ì•„ì´ì½˜)ìœ¼ë¡œ ì´ë™í•˜ì—¬ 'ë¦¬í¬ì§€í† ë¦¬ ì´ˆê¸°í™”(Initialize Repository)' ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤. ê·¸ í›„, ìƒë‹¨ì˜ ë©”ì‹œì§€ ì…ë ¥ë€ì— "Initial commit"ê³¼ ê°™ì€ ì²« ì»¤ë°‹ ë©”ì‹œì§€ë¥¼ ì‘ì„±í•œ í›„ âœ“ ì»¤ë°‹ ë²„íŠ¼ì„ ëˆŒëŸ¬ í”„ë¡œì íŠ¸ íŒŒì¼(`index.html`, `model.onnx` ë“±)ì„ ì»¤ë°‹í•©ë‹ˆë‹¤.</p>
                </div>
                <div>
                    <h3 class="font-semibold text-lg text-slate-800">4. GitHubì— ê²Œì‹œí•˜ê¸°</h3>
                    <p class="mt-1 ml-2">'ì†ŒìŠ¤ ì œì–´' íƒ­ì— ë‚˜íƒ€ë‚˜ëŠ” 'GitHubì— ê²Œì‹œ(Publish to GitHub)' ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤. VS Codeê°€ GitHubì— ì €ì¥ì†Œë¥¼ ë§Œë“œëŠ” ê³¼ì •ì„ ì•ˆë‚´í•©ë‹ˆë‹¤. ì €ì¥ì†Œ ì´ë¦„ì„ ì •í•˜ê³ , <strong>ë°˜ë“œì‹œ 'ê³µê°œ(Public)' ì €ì¥ì†Œë¡œ ì„¤ì •</strong>í•´ì•¼ GitHub Pagesë¥¼ ë¬´ë£Œë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                </div>
                <div>
                    <h3 class="font-semibold text-lg text-slate-800">5. GitHub Pages í™œì„±í™”</h3>
                    <p class="mt-1 ml-2">ê²Œì‹œê°€ ì™„ë£Œë˜ë©´ GitHub ì‚¬ì´íŠ¸ì—ì„œ ë°©ê¸ˆ ìƒì„±í•œ ì €ì¥ì†Œë¡œ ì´ë™í•©ë‹ˆë‹¤. 'Settings' &rarr; 'Pages' íƒ­ìœ¼ë¡œ ì´ë™í•˜ì—¬ 'Source'ë¥¼ 'Deploy from a branch'ë¡œ, ë¸Œëœì¹˜ë¥¼ 'main' (ë˜ëŠ” 'master')ìœ¼ë¡œ ì„ íƒí•˜ê³  'Save'ë¥¼ í´ë¦­í•©ë‹ˆë‹¤.</p>
                </div>
                <div>
                    <h3 class="font-semibold text-lg text-slate-800">6. ë°°í¬ í™•ì¸ ë° ê³µìœ </h3>
                    <p class="mt-1 ml-2">ì ì‹œ í›„ í˜ì´ì§€ ìƒë‹¨ì— ë…¹ìƒ‰ìœ¼ë¡œ ê²Œì‹œ ì£¼ì†Œ(<code class="text-sm">https://&lt;ì‚¬ìš©ìëª…&gt;.github.io/&lt;ì €ì¥ì†Œëª…&gt;/</code>)ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤. ì´ ì£¼ì†Œë¡œ ì ‘ì†í•˜ì—¬ ê²Œì„ì„ í™•ì¸í•˜ê³  ì „ ì„¸ê³„ì™€ ê³µìœ í•˜ì„¸ìš”!</p>
                </div>
            </div>
        </section>

        <section id="step7-download" class="step bg-white p-6 sm:p-8 rounded-2xl shadow-lg border border-slate-200 mb-10">
            <h2 class="text-2xl font-bold mb-4 border-b pb-3 text-slate-900">ë‹¨ê³„ 7: ì˜ˆì œ íŒŒì¼ ë‹¤ìš´ë¡œë“œ (CartPole)</h2>
            <p class="mb-6 text-slate-700">ì´ ê°€ì´ë“œë¥¼ í†µí•´ ìµœì¢…ì ìœ¼ë¡œ ì™„ì„±ëœ CartPole ê²Œì„ì˜ `index.html` íŒŒì¼ì…ë‹ˆë‹¤. ì „ì²´ ì½”ë“œë¥¼ ì§ì ‘ í™•ì¸í•˜ê³  ì‹¶ê±°ë‚˜, ìì‹ ì˜ í”„ë¡œì íŠ¸ì™€ ë¹„êµí•˜ë©° ì°¸ê³ í•˜ê³  ì‹¶ì„ ë•Œ ì•„ë˜ ë²„íŠ¼ì„ í†µí•´ ë‹¤ìš´ë¡œë“œí•˜ì„¸ìš”.</p>
            
            <div class="workflow-guide">
                <h4 class="text-lg">ì‚¬ìš© ì•ˆë‚´</h4>
                <p class="mt-2 text-sm text-slate-700">ì´ ì˜ˆì œ íŒŒì¼ì„ í•™ìŠµì‹œí‚¤ë ¤ë©´, 4ë‹¨ê³„ ê°€ì´ë“œì—ì„œ ì œê³µí•˜ëŠ” Python ìŠ¤í¬ë¦½íŠ¸(`train_simple.py`)ì˜ `OBSERVATION_SHAPE`ì„ `(4,)`ë¡œ, `ACTION_SPACE_CONFIG`ì„ `{'type': 'continuous', 'low': [-2.0], 'high': [2.0]}`ìœ¼ë¡œ ìˆ˜ì •í•œ ë’¤ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤.</p>
            </div>

            <div class="mt-8 text-center">
                <a href="/Reinforcement/Source/CartPole.zip" download="CartPole.zip" 
                class="inline-block bg-teal-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-teal-600 transition-colors no-underline text-base shadow-md hover:shadow-lg transform hover:-translate-y-1">
                    ğŸ“‚ CartPole ì˜ˆì œ ë‹¤ìš´ë¡œë“œ
                </a>
            </div>
        </section>


    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const copyButtons = document.querySelectorAll('.copy-button');
            copyButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const code = button.parentElement.querySelector('code').innerText;
                    navigator.clipboard.writeText(code).then(() => {
                        button.textContent = 'ë³µì‚¬ ì™„ë£Œ!';
                        button.classList.add('copied');
                        setTimeout(() => { button.textContent = 'ë³µì‚¬'; button.classList.remove('copied'); }, 2000);
                    });
                });
            });

            const gameLogicTextarea = document.getElementById('game-logic-textarea');
            const step2NewGamePrompt = document.getElementById('step2-new-game-prompt');
            if (gameLogicTextarea && step2NewGamePrompt) {
                const base = step2NewGamePrompt.innerText;
                gameLogicTextarea.addEventListener('input', () => {
                    const userInput = gameLogicTextarea.value;
                    const placeholder = "[ì—¬ê¸°ì— 1ë‹¨ê³„ì—ì„œ ìƒì„±ëœ ê²Œì„ ê¸°íšì•ˆì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.]";
                    step2NewGamePrompt.innerText = userInput.trim() !== '' ? base.replace(placeholder, userInput) : base;
                });
            }

            const existingGameTextarea = document.getElementById('existing-game-textarea');
            const step2ModifyGamePrompt = document.getElementById('step2-modify-game-prompt');
            if (existingGameTextarea && step2ModifyGamePrompt) {
                const base = step2ModifyGamePrompt.innerText;
                existingGameTextarea.addEventListener('input', () => {
                    const userInput = existingGameTextarea.value;
                    const placeholder = "[ì—¬ê¸°ì— ì‚¬ìš©ìì˜ ê¸°ì¡´ ê²Œì„ ì½”ë“œë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.]";
                    step2ModifyGamePrompt.innerText = userInput.trim() !== '' ? base.replace(placeholder, userInput) : base;
                });
            }

            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    const tabId = button.getAttribute('data-tab');
                    tabContents.forEach(content => {
                        content.classList.toggle('active', content.id === `tab-${tabId}`);
                    });
                });
            });

            const modal = document.getElementById('theme-modal');
            const openModalBtn = document.getElementById('open-modal-btn');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const themeGrid = document.getElementById('theme-grid');
            const step1PromptCodeElement = document.getElementById('step1-prompt-code');

            async function loadThemes() {
                try {
                    // In a real environment, you would fetch a themes.json file.
                    // For this example, we'll use a static array.
                    const response = await fetch('themes.json');
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const themesData = await response.json();
                    
                    themeGrid.innerHTML = '';
                    themesData.sort((a, b) => a.title.localeCompare(b.title, 'ko')).forEach(theme => {
                        const card = document.createElement('div');
                        card.className = 'modal-card bg-slate-50 p-4 rounded-lg cursor-pointer border hover:border-amber-500 hover:bg-amber-50';
                        card.innerHTML = `<div class="text-3xl mb-2">${theme.emoji}</div><h3 class="font-bold text-slate-800">${theme.title}</h3><p class="text-sm text-slate-600 mt-1">${theme.description}</p>`;
                        card.addEventListener('click', () => {
                            const basePrompt = `You are a creative game designer. Based on the theme "[THEME_PLACEHOLDER]", please develop a detailed and engaging game plan...`;
                            const promptToCopy = basePrompt.replace('[THEME_PLACEHOLDER]', `"${theme.rl_concept}"`);
                            if(step1PromptCodeElement) step1PromptCodeElement.textContent = promptToCopy;
                            navigator.clipboard.writeText(promptToCopy).then(() => {
                                 alert(`'${theme.title}' ì£¼ì œì˜ í”„ë¡¬í”„íŠ¸ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                            });
                            if(modal) modal.classList.add('hidden');
                        });
                        themeGrid.appendChild(card);
                    });
                } catch (error) { 
                    console.error("Could not load themes.json:", error); 
                    if(themeGrid) themeGrid.innerHTML = '<p class="text-red-500 col-span-3">themes.json íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
                }
            }

            if(modal && openModalBtn && closeModalBtn) {
                 openModalBtn.addEventListener('click', () => modal.classList.remove('hidden'));
                 closeModalBtn.addEventListener('click', () => modal.classList.add('hidden'));
                 modal.addEventListener('click', (e) => { if (e.target.id === 'theme-modal') modal.classList.add('hidden'); });
                loadThemes();
            }
        });
    </script>
</body>
</html>

