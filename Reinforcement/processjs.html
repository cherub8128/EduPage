<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JS/WebSocket ê¸°ë°˜ AI ê²Œì„ ì œì‘ ê°€ì´ë“œ (ë‹¤ì¤‘ íŒŒì¼)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        .step { scroll-margin-top: 80px; }
        .prompt-block, .code-block-provided { position: relative; }
        .copy-button { position: absolute; top: 0.8rem; right: 0.8rem; background-color: #4A5568; color: white; padding: 0.25rem 0.6rem; border-radius: 0.375rem; font-size: 0.8rem; cursor: pointer; transition: background-color 0.2s; }
        .copy-button:hover { background-color: #2D3748; }
        .copy-button.copied { background-color: #2F855A; }
        .user-input { background-color: #FEF3C7; border: 1px dashed #FBBF24; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem; }
        .download-section { background-color: #F0F9FF; border: 1px solid #BAE6FD; padding: 1.5rem; border-radius: 0.5rem; margin-top: 1rem; }
        .download-btn { background-color: #0284C7; color: white; font-weight: bold; padding: 0.5rem 1rem; border-radius: 0.375rem; transition: background-color 0.2s; text-decoration: none; display: inline-block; }
        .download-btn:hover { background-color: #0369A1; }
        .modal-card { transition: transform 0.2s, box-shadow 0.2s; }
        .modal-card:hover { transform: translateY(-4px); box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); }
        .tab-button { padding: 0.5rem 1rem; cursor: pointer; border-bottom: 2px solid transparent; transition: all 0.2s; }
        .tab-button.active { border-color: #F59E0B; color: #1E293B; font-weight: 600; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div id="theme-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col">
            <div class="p-5 border-b flex justify-between items-center sticky top-0 bg-white rounded-t-2xl">
                <h2 class="text-xl font-bold text-slate-800">ì¶”ì²œ ê²Œì„ ì£¼ì œ (í•˜ë‚˜ë¥¼ ì„ íƒí•˜ì—¬ í”„ë¡¬í”„íŠ¸ë¥¼ ë³µì‚¬í•˜ì„¸ìš”)</h2>
                <button id="close-modal-btn" class="text-3xl font-light text-slate-500 hover:text-slate-800">&times;</button>
            </div>
            <div id="theme-grid" class="p-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5 overflow-y-auto">
                <!-- Modal content is loaded dynamically -->
            </div>
        </div>
    </div>

    <div class="container mx-auto p-4 sm:p-6 md:p-8 max-w-4xl">
        <header class="text-center my-8 md:my-12">
            <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold text-slate-900">JS/WebSocket ê¸°ë°˜ AI ê²Œì„ ì œì‘ ê°€ì´ë“œ</h1>
            <p class="mt-4 text-base sm:text-lg text-slate-600">Matter.js ì›¹ ê²Œì„ì„ WebSocketìœ¼ë¡œ Python(SB3/TorchRL)ì— ì—°ê²°í•˜ì—¬ AIë¥¼ í•™ìŠµì‹œí‚¤ëŠ” í˜„ëŒ€ì ì¸ ë°©ë²•</p>
        </header>
        
        <section class="step bg-white p-6 sm:p-8 rounded-2xl shadow-lg border border-slate-200 mb-10">
            <h2 class="text-2xl font-bold mb-4 border-b pb-3 text-slate-900">ì „ì²´ í”„ë¡œì„¸ìŠ¤ ê°œìš”</h2>
            <ol class="list-decimal list-inside space-y-3 text-slate-700">
                <li><strong class="font-semibold text-slate-800">ê²Œì„ ì•„ì´ë””ì–´ êµ¬ì²´í™”:</strong> ë§Œë“¤ê³  ì‹¶ì€ ê²Œì„ì˜ ìƒì„¸ ê¸°íšì•ˆ ì‘ì„±</li>
                <li><strong class="font-semibold text-slate-800">í”„ë¡œì íŠ¸ ì„¤ì • ë° í†µí•© ì›¹ ê²Œì„ ì œì‘:</strong> í•™ìŠµê³¼ í”Œë ˆì´ê°€ ëª¨ë‘ ê°€ëŠ¥í•œ ìµœì¢… JS ê²Œì„ ë¡œì§ ê°œë°œ</li>
                <li><strong class="font-semibold text-slate-800">Python WebSocket í™˜ê²½ ì„¤ì •:</strong> JS ê²Œì„ì„ ì œì–´í•˜ëŠ” Gymnasium í˜¸í™˜ RL í™˜ê²½(ê³µí†µ ì½”ë“œ) ì„¤ì •</li>
                <li><strong class="font-semibold text-slate-800">AI ëª¨ë¸ í•™ìŠµ (SB3 / TorchRL):</strong> WebSocket í™˜ê²½ì„ í†µí•´ JS ê²Œì„ì„ ì œì–´í•˜ë©° AI ëª¨ë¸ í•™ìŠµ</li>
                <li><strong class="font-semibold text-slate-800">ONNX ëª¨ë¸ ë³€í™˜:</strong> í•™ìŠµëœ ëª¨ë¸ì„ ì›¹ í™˜ê²½ì— ì§ì ‘ í†µí•©í•˜ê¸° ìœ„í•œ ONNX í˜•ì‹ìœ¼ë¡œ ë³€í™˜</li>
                <li><strong class="font-semibold text-slate-800">ìµœì¢… AI ê²Œì„ í…ŒìŠ¤íŠ¸:</strong> ë¡œì»¬ ì„œë²„ë¡œ ONNX ëª¨ë¸ì´ íƒ‘ì¬ëœ ìµœì¢… ê²Œì„ì„ í™•ì¸</li>
                <li><strong class="font-semibold text-slate-800">GitHub Pages ë°°í¬:</strong> ì™„ì„±ëœ AI ì›¹ ê²Œì„ì„ ì „ ì„¸ê³„ì— ë¬´ë£Œë¡œ ë°°í¬</li>
            </ol>
        </section>

        <section id="step1" class="step bg-white p-6 sm:p-8 rounded-2xl shadow-lg border border-slate-200 mb-10">
            <h2 class="text-2xl font-bold mb-4 border-b pb-3 text-slate-900">ë‹¨ê³„ 1: ê²Œì„ ì•„ì´ë””ì–´ êµ¬ì²´í™”í•˜ê¸°</h2>
            <p class="mb-4 text-slate-700">'ì¶”ì²œ ì£¼ì œ ë³´ê¸°' ë²„íŠ¼ì„ ëˆŒëŸ¬ ì˜ê°ì„ ì–»ê³ , ë§ˆìŒì— ë“œëŠ” ì£¼ì œë¥¼ ì„ íƒí•˜ì—¬ ìƒì„¸ ê¸°íšì•ˆì„ ìš”ì²­í•˜ëŠ” í”„ë¡¬í”„íŠ¸ë¥¼ ë³µì‚¬í•˜ì„¸ìš”.</p>
            <button id="open-modal-btn" class="mb-6 bg-amber-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-amber-600 transition-colors">ğŸ® ì¶”ì²œ ì£¼ì œ ë³´ê¸° & ì˜ê° ì–»ê¸°</button>
            <div class="prompt-block">
                <button class="copy-button">ë³µì‚¬</button>
                <pre class="bg-slate-100 text-slate-800 p-4 rounded-lg overflow-x-auto text-sm"><code id="step1-prompt-code" class="language-text">You are a creative game designer. Based on the theme "[ì—¬ê¸°ì— ì„ íƒí•œ ê²Œì„ ì£¼ì œì™€ ê°„ë‹¨í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”. ì˜ˆ: ë¡œì¼“ ì°©ë¥™ì‹œí‚¤ê¸°: ì¢Œìš° ë° ë©”ì¸ ì¶”ë ¥ì„ ì‚¬ìš©í•´, í™”ë©´ ìƒë‹¨ì—ì„œ ë–¨ì–´ì§€ëŠ” ë¡œì¼“ì´ ì •í•´ì§„ ì°©ë¥™ ì§€ì ì— ë¶€ë“œëŸ½ê²Œ ì°©ë¥™í•˜ëŠ” ê²Œì„]", please develop a detailed and engaging game plan.

The plan must be structured with the following four sections:

1.  **Game Concept:** A brief, exciting one-paragraph summary of the game.
2.  **Player Objective:** A clear description of what the player needs to accomplish.
3.  **Controls:** A simple and intuitive control scheme.
4.  **Win/Loss Conditions:** Specific, measurable conditions for success and failure.

Write the plan in Korean.</code></pre>
            </div>
        </section>

        <section id="step2" class="step bg-white p-6 sm:p-8 rounded-2xl shadow-lg border border-slate-200 mb-10">
            <h2 class="text-2xl font-bold mb-4 border-b pb-3 text-slate-900">ë‹¨ê³„ 2: í”„ë¡œì íŠ¸ ì„¤ì • ë° í†µí•© ì›¹ ê²Œì„ ì œì‘</h2>
            <p class="mb-6 text-slate-700">ì´ì œ ì‹¤ì œ ê²Œì„ ê°œë°œì„ ì‹œì‘í•©ë‹ˆë‹¤. ì•„ë˜ ì•ˆë‚´ì— ë”°ë¼ í”„ë¡œì íŠ¸ í´ë”ì™€ íŒŒì¼ë“¤ì„ ì¤€ë¹„í•˜ì„¸ìš”.</p>
            
            <div class="user-input">
                <h3 class="font-semibold text-lg text-slate-800 mb-2">í”„ë¡œì íŠ¸ í´ë” ë° íŒŒì¼ ìƒì„± (VS Code)</h3>
                <ol class="list-decimal list-inside space-y-2 text-sm text-slate-700">
                    <li>ì»´í“¨í„°ì— `ai-game`ê³¼ ê°™ì€ ì´ë¦„ìœ¼ë¡œ ìƒˆ í´ë”ë¥¼ ë§Œë“­ë‹ˆë‹¤.</li>
                    <li>Visual Studio Codeë¥¼ ì—´ê³ , `íŒŒì¼ > í´ë” ì—´ê¸°`ë¥¼ í†µí•´ ë°©ê¸ˆ ë§Œë“  í´ë”ë¥¼ ì—½ë‹ˆë‹¤.</li>
                    <li>VS Codeì˜ íƒìƒ‰ê¸° íŒ¨ë„ì—ì„œ ë‹¤ìŒ 4ê°œì˜ ë¹ˆ íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤:
                        <ul class="list-disc list-inside ml-4 mt-1">
                            <li><code>index.html</code></li>
                            <li><code>style.css</code></li>
                            <li><code>main.js</code></li>
                        </ul>
                    </li>
                    <li>ì•„ë˜ì˜ ì½”ë“œ ë¸”ë¡ ë‚´ìš©ì„ ê° íŒŒì¼ì— ë³µì‚¬í•˜ì—¬ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.</li>
                </ol>
            </div>

            <div class="code-block-provided mt-6">
                <h3 class="font-semibold text-lg text-slate-800 mb-2">1. `index.html` íŒŒì¼ ë‚´ìš©</h3>
                <div class="prompt-block">
                    <button class="copy-button">ë³µì‚¬</button>
                    <pre class="bg-slate-100 text-slate-800 p-4 rounded-lg overflow-x-auto text-sm"><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang="ko"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;AI Game&lt;/title&gt;
    &lt;link rel="stylesheet" href="style.css"&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div id="game-container"&gt;
        &lt;!-- Matter.js Canvas will be created here by main.js --&gt;
    &lt;/div&gt;
    &lt;div id="ui-container"&gt;
        &lt;div id="score"&gt;SCORE: 0&lt;/div&gt;
        &lt;div class="toggle-container"&gt;
            &lt;span class="mode-text"&gt;USER&lt;/span&gt;
            &lt;label class="toggle-label"&gt;
                &lt;input type="checkbox" id="ai-toggle" disabled&gt;
                &lt;span class="slider"&gt;&lt;/span&gt;
            &lt;/label&gt;
            &lt;span class="mode-text"&gt;AI&lt;/span&gt;
        &lt;/div&gt;
    &lt;/div&gt;

    &lt;script src="https://cdn.jsdelivr.net/npm/onnxruntime-web/dist/ort.min.js"&gt;&lt;/script&gt;
    &lt;script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"&gt;&lt;/script&gt;
    &lt;script src="main.js"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
                </div>
            </div>

            <div class="code-block-provided mt-6">
                <h3 class="font-semibold text-lg text-slate-800 mb-2">2. `style.css` íŒŒì¼ ë‚´ìš©</h3>
                <div class="prompt-block">
                    <button class="copy-button">ë³µì‚¬</button>
                    <pre class="bg-slate-100 text-slate-800 p-4 rounded-lg overflow-x-auto text-sm"><code class="language-css">/* General Body Styles */
body {
    margin: 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    height: 100vh;
    background-color: #f0f4f8; /* Soft blue-gray background */
    font-family: 'Noto Sans KR', sans-serif;
    overflow: hidden;
}

/* Game and UI Container Styles */
#game-container {
    position: relative;
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 10px 20px rgba(0,0,0,0.1), 0 6px 6px rgba(0,0,0,0.1);
}

canvas {
    display: block;
    background-color: #ffffff;
}

#ui-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 800px; /* Should match canvas width */
    margin-top: 20px;
    padding: 0 10px;
    box-sizing: border-box;
}

#score {
    font-size: 28px;
    font-weight: 700;
    color: #334155; /* Cool gray */
    letter-spacing: 1px;
}

/* Toggle Switch Styles */
.toggle-container {
    display: flex;
    align-items: center;
    gap: 12px;
}

.mode-text {
    font-weight: 600;
    font-size: 16px;
    color: #64748b; /* Lighter gray */
}

.toggle-label {
    position: relative;
    display: inline-block;
    width: 60px;
    height: 34px;
}

.toggle-label input {
    opacity: 0;
    width: 0;
    height: 0;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: .4s;
    border-radius: 34px;
}

.slider:before {
    position: absolute;
    content: "";
    height: 26px;
    width: 26px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
}

input:checked + .slider {
    background-color: #2563eb; /* A vibrant blue */
}

input:disabled + .slider {
    background-color: #94a3b8;
    cursor: not-allowed;
}


input:checked + .slider:before {
    transform: translateX(26px);
}
</code></pre>
                </div>
            </div>
            <div class="code-block-provided mt-6">
                <h3 class="font-semibold text-lg text-slate-800 mb-2">`main.js` í…œí”Œë¦¿ ë‚´ìš©</h3>
                <p class="text-sm text-slate-600 mb-4">ë‹¤ìš´ë¡œë“œí•œ `main.js` íŒŒì¼ì—ëŠ” AI í†µì‹ ì„ ìœ„í•œ ì•„ë˜ì˜ í•„ìˆ˜ í•¨ìˆ˜ë“¤ì´ ë¯¸ë¦¬ ì •ì˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤. GeminiëŠ” ì´ êµ¬ì¡° ì•ˆì—ì„œ ê²Œì„ ë¡œì§ì„ êµ¬í˜„í•˜ê²Œ ë©ë‹ˆë‹¤.</p>
                <div class="prompt-block">
                    <button class="copy-button">ë³µì‚¬</button>
                    <pre class="bg-slate-100 text-slate-800 p-4 rounded-lg overflow-x-auto text-sm"><code class="language-javascript">// main.js Template

// --- Matter.js Modules ---
// ... (Modules will be defined here) ...

// --- Game & UI Elements ---
// ... (DOM elements will be selected here) ...

// --- Game State & Parameters ---
// ... (Game variables will be defined here) ...

// =================================================================================
// ESSENTIAL INTERFACE FUNCTIONS FOR AI
// Gemini will implement the logic inside these functions.
// =================================================================================

/**
 * Sets up the initial game state, objects, and physics engine.
 */
function setupGame() {
    // TODO: Create Matter.js engine, renderer, and game objects.
}

/**
 * Resets the game to its starting state for a new episode.
 * @returns {Array<number>} The initial observation array.
 */
function resetGame() {
    // TODO: Reset positions and velocities of all dynamic bodies.
    return getObservation();
}

/**
 * Gathers the current state of the game into a numerical array for the AI.
 * @returns {Array<number>} The observation array.
 */
function getObservation() {
    // TODO: Collect all relevant data (positions, velocities, etc.).
    // IMPORTANT: The order and normalization must be consistent.
    return []; // Placeholder
}

/**
 * Applies an action received from the AI or user to the game.
 * @param {number} action - The integer action.
 */
function applyAction(action) {
    // TODO: Map the action integer to a game mechanic.
}

// ... The rest of the template includes WebSocket/ONNX/User control logic ...
</code></pre>
                </div>
            </div>

            <p class="mt-6 mb-6 text-slate-700">**ì¤‘ìš”:** 1ë‹¨ê³„ì—ì„œ ìƒì„±ëœ ê¸°íšì•ˆì„ ì•„ë˜ ì…ë ¥ë€ì— ë¶™ì—¬ë„£ìœ¼ë©´, `main.js` ìƒì„±ì„ ìœ„í•œ í”„ë¡¬í”„íŠ¸ê°€ ìë™ìœ¼ë¡œ ì™„ì„±ë©ë‹ˆë‹¤.</p>
            <div class="user-input">
                <h3 class="font-semibold text-lg text-slate-800 mb-2">ê²Œì„ ë¡œì§ ê¸°íš</h3>
                <textarea id="game-logic-textarea" rows="8" class="w-full p-2 border border-amber-300 rounded-md bg-white text-sm" placeholder="ì´ê³³ì— 1ë‹¨ê³„ì—ì„œ ìƒì„±ëœ ê²Œì„ ê¸°íšì•ˆ(ì½˜ì…‰íŠ¸, ëª©í‘œ, ì¡°ì‘ë²•, ì„±ê³µ/ì‹¤íŒ¨ ì¡°ê±´)ì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”."></textarea>
            </div>
            <div class="prompt-block">
                <button class="copy-button">ë³µì‚¬</button>
                <pre class="bg-slate-100 text-slate-800 p-4 rounded-lg overflow-x-auto text-sm"><code id="step2-prompt-code" class="language-text">You are an expert front-end developer and a top-tier visual designer, specializing in creating high-quality, physics-based web games with Matter.js.

I am attaching the `index.html` and `style.css` files that will be used. Your task is to write the complete JavaScript code for a file named `main.js`, which will be loaded by the `index.html`.

### Game Logic Plan:
[ì—¬ê¸°ì— 1ë‹¨ê³„ì—ì„œ ìƒì„±ëœ ê²Œì„ ê¸°íšì•ˆì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.]

### Visual & Quality Requirements (CRITICAL):
1.  **Masterful Design:** The game must be designed by a highly skilled professional visual designer with an excellent sense of color. The result should be a high-quality, superior game with impeccable polish.
2.  **Aesthetics:** Aim for a minimalist, clean, and visually satisfying hyper-casual style, consistent with the provided CSS.
3.  **Game Juice:** Animations must be smooth and satisfying. Implement "juice" like bouncy effects or small 'pop' animations for feedback.

### User Controls & Input Handling (CRITICAL):
1.  **Intelligent Input Design:** Based on the game concept, intelligently determine the best primary input method (keyboard or mouse/touch).
2.  **Keyboard:** If keyboard-based, implement smooth, responsive controls using `keydown` and `keyup` events to handle continuous presses correctly. Crucially, use `event.preventDefault()` for arrow and space keys to prevent browser scrolling.
3.  **Mouse/Touch:** If mouse-based, ensure controls are intuitive.

### DUAL MODE IMPLEMENTATION (CRITICAL):
The game must seamlessly switch between three modes: USER, AI (ONNX), and TRAINING (WebSocket).

1.  **Default Mode (USER):** The game must be playable by a human user from the start. The reward should be displayed as a "SCORE".
2.  **AI (ONNX) Mode:**
    * Attempt to load `model.onnx` using `onnxruntime-web`.
    * If successful, enable the `#ai-toggle` switch.
    * When the toggle is active, the game loop should get observations, run inference, and apply actions from the ONNX model.
3.  **Training (WebSocket) Mode:**
    * Attempt to connect to `ws://localhost:8765`.
    * If the connection is successful, the game should cede control to the WebSocket server, responding to `reset` and `action` commands.

The final code must be robust, handling all three modes gracefully.</code></pre>
            </div>
        </section>

        <section id="step3" class="step bg-white p-6 sm:p-8 rounded-2xl shadow-lg border border-slate-200 mb-10">
            <h2 class="text-2xl font-bold mb-4 border-b pb-3 text-slate-900">ë‹¨ê³„ 3: Python WebSocket ê°•í™”í•™ìŠµ í™˜ê²½ ì„¤ì •</h2>
            <p class="mb-6 text-slate-700">í”„ë¡œì íŠ¸ í´ë”ì— `websocket_env.py` íŒŒì¼ì„ ìƒì„±í•˜ê³  ì•„ë˜ ì½”ë“œë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”. ì´ ì½”ë“œëŠ” JS ê²Œì„ì„ Gymnasium í˜¸í™˜ í™˜ê²½ìœ¼ë¡œ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.</p>
            <div class="prompt-block">
                <button class="copy-button">ë³µì‚¬</button>
                <pre class="bg-slate-100 text-slate-800 p-4 rounded-lg overflow-x-auto text-sm"><code class="language-python">import gymnasium as gym
from gymnasium import spaces
import numpy as np
import asyncio
import websockets
import json
import logging

logging.basicConfig(level=logging.INFO)

class WebSocketEnv(gym.Env):
    def __init__(self, observation_shape, action_n):
        super(WebSocketEnv, self).__init__()
        self.websocket = None
        self.loop = asyncio.get_event_loop()
        self.action_space = spaces.Discrete(action_n)
        self.observation_space = spaces.Box(low=-np.inf, high=np.inf, shape=observation_shape, dtype=np.float32)

        print("Waiting for JavaScript client to connect...")
        self.server = self.loop.run_until_complete(websockets.serve(self._handler, "localhost", 8765))
        self.loop.run_until_complete(self._wait_for_connection())
        print("Client connected!")

    async def _handler(self, websocket, path):
        self.websocket = websocket
        await self._keep_alive()

    async def _keep_alive(self):
        try:
            while self.websocket.open:
                await asyncio.sleep(1)
        except websockets.exceptions.ConnectionClosed:
            pass

    async def _wait_for_connection(self):
        while self.websocket is None:
            await asyncio.sleep(0.1)

    async def _send_command(self, command):
        await self.websocket.send(json.dumps(command))

    async def _receive_observation(self):
        message = await self.websocket.recv()
        data = json.loads(message)
        if data.get("type") == "observation":
            obs = np.array(data["observation"], dtype=np.float32)
            reward = data["reward"]
            done = data["done"]
            return obs, reward, done
        return None, None, None

    def reset(self, seed=None, options=None):
        super().reset(seed=seed)
        command = {"command": "reset"}
        self.loop.run_until_complete(self._send_command(command))
        obs, _, _ = self.loop.run_until_complete(self._receive_observation())
        return obs, {}

    def step(self, action):
        command = {"command": "action", "action": int(action)}
        self.loop.run_until_complete(self._send_command(command))
        obs, reward, done = self.loop.run_until_complete(self._receive_observation())
        return obs, reward, done, False, {}

    def render(self, mode='human'):
        pass

    def close(self):
        if self.server:
            self.server.close()
            self.loop.run_until_complete(self.server.wait_closed())
        print("WebSocket server closed.")
</code></pre>
            </div>
        </section>

        <section id="step4" class="step bg-white p-6 sm:p-8 rounded-2xl shadow-lg border border-slate-200 mb-10">
            <h2 class="text-2xl font-bold mb-4 border-b pb-3 text-slate-900">ë‹¨ê³„ 4: AI ëª¨ë¸ í•™ìŠµ (SB3 / TorchRL)</h2>
            <p class="mb-4 text-slate-700">ì„ í˜¸í•˜ëŠ” ê°•í™”í•™ìŠµ í”„ë ˆì„ì›Œí¬ë¥¼ ì„ íƒí•˜ì—¬ AI ì—ì´ì „íŠ¸ë¥¼ í•™ìŠµì‹œí‚µë‹ˆë‹¤. í•™ìŠµ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ë©´ **ë¸Œë¼ìš°ì €ê°€ ìë™ìœ¼ë¡œ ì—´ë¦½ë‹ˆë‹¤.**</p>
            <div class="border-b border-slate-200"><nav class="flex -mb-px" aria-label="Tabs"><button class="tab-button active" data-tab="sb3">Stable-Baselines3</button><button class="tab-button" data-tab="torchrl">TorchRL</button></nav></div>
            <div id="tab-sb3" class="tab-content active mt-6">
                <p class="mb-4 text-slate-700">ì•„ë˜ ì½”ë“œë¥¼ ë³µì‚¬í•˜ì—¬ `train_sb3.py` íŒŒì¼ë¡œ ì €ì¥í•˜ê³  ì‹¤í–‰í•˜ì„¸ìš”.</p>
                <div class="prompt-block">
                    <button class="copy-button">ë³µì‚¬</button>
                    <pre class="bg-slate-100 text-slate-800 p-4 rounded-lg overflow-x-auto text-sm"><code class="language-python"># train_sb3.py
import os, time, webbrowser
from stable_baselines3 import PPO
from stable_baselines3.common.callbacks import CheckpointCallback
from stable_baselines3.common.logger import configure
from websocket_env import WebSocketEnv

# --- CONFIGURATION ---
OBSERVATION_SHAPE = (8,) # IMPORTANT: Match this to your JS game's observation array length
ACTION_N = 4             # IMPORTANT: Match this to your JS game's number of actions

LOG_DIR = "training_logs"
TENSORBOARD_LOG_NAME = f"PPO_{int(time.time())}"
TOTAL_TIMESTEPS = 1_000_000
CHECKPOINT_FREQ = 10_000
# ---------------------

def find_latest_run_and_checkpoint():
    if not os.path.isdir(LOG_DIR):
        return None, None
    runs = sorted([d for d in os.listdir(LOG_DIR) if os.path.isdir(os.path.join(LOG_DIR, d))], reverse=True)
    for run in runs:
        run_path = os.path.join(LOG_DIR, run)
        checkpoints_path = os.path.join(run_path, "checkpoints")
        if not os.path.isdir(checkpoints_path):
            continue
        checkpoints = [f for f in os.listdir(checkpoints_path) if f.startswith("rl_model_") and f.endswith(".zip")]
        if checkpoints:
            latest_checkpoint = max(checkpoints, key=lambda f: int(f.split("_")[2].replace(".zip", "")))
            return run, os.path.join(checkpoints_path, latest_checkpoint)
    return None, None

def main():
    latest_run, latest_checkpoint = find_latest_run_and_checkpoint()

    if latest_run:
        run_path = os.path.join(LOG_DIR, latest_run)
        print(f"Found existing run: {latest_run}")
    else:
        run_path = os.path.join(LOG_DIR, TENSORBOARD_LOG_NAME)
        print(f"No existing run found. Starting a new one: {TENSORBOARD_LOG_NAME}")
    
    checkpoint_path = os.path.join(run_path, "checkpoints")
    os.makedirs(checkpoint_path, exist_ok=True)
    
    print(f"Log path: {run_path}")

    webbrowser.open(f'file://{os.path.realpath("index.html")}')

    env = WebSocketEnv(observation_shape=OBSERVATION_SHAPE, action_n=ACTION_N)
    
    custom_logger = configure(run_path, ["stdout", "tensorboard"])
    checkpoint_callback = CheckpointCallback(save_freq=CHECKPOINT_FREQ, save_path=checkpoint_path, name_prefix="rl_model")

    if latest_checkpoint:
        print(f"Resuming training from: {latest_checkpoint}")
        model = PPO.load(latest_checkpoint, env=env)
        model.set_logger(custom_logger)
    else:
        print("Starting new training session.")
        policy = "MlpPolicy" if len(OBSERVATION_SHAPE) == 1 else "CnnPolicy"
        model = PPO(policy, env, verbose=1)
        model.set_logger(custom_logger)

    try:
        model.learn(total_timesteps=TOTAL_TIMESTEPS, callback=checkpoint_callback, reset_num_timesteps=False)
        model.save(os.path.join(run_path, "final_model.zip"))
        print(f"Training finished. Model saved to {os.path.join(run_path, 'final_model.zip')}")
    finally:
        env.close()

if __name__ == '__main__':
    main()
</code></pre>
                </div>
            </div>
            <div id="tab-torchrl" class="tab-content mt-6">
                <p class="mb-4 text-slate-700">ì•„ë˜ ì½”ë“œë¥¼ ë³µì‚¬í•˜ì—¬ `train_torchrl.py` íŒŒì¼ë¡œ ì €ì¥í•˜ê³  ì‹¤í–‰í•˜ì„¸ìš”.</p>
                 <div class="prompt-block">
                    <button class="copy-button">ë³µì‚¬</button>
                    <pre class="bg-slate-100 text-slate-800 p-4 rounded-lg overflow-x-auto text-sm"><code class="language-python">import torch
import webbrowser
import os
import time
from torchrl.envs.libs.gym import GymWrapper
from torchrl.collectors import SyncDataCollector
from torchrl.data import TensorDictReplayBuffer, LazyMemmapStorage
from torchrl.modules import ProbabilisticActor, TanhNormal, ValueOperator, MLP
from torchrl.objectives import ClipPPOLoss
from torchrl.objectives.value import GAE
from torchrl.record import TensorBoardLogger
from websocket_env import WebSocketEnv

# --- CONFIGURATION ---
OBSERVATION_SHAPE = (8,) 
ACTION_N = 4
DEVICE = "cuda" if torch.cuda.is_available() else "cpu"

FRAMES_PER_BATCH = 1024
TOTAL_FRAMES = 1_000_000
PPO_EPOCHS = 10
MINI_BATCH_SIZE = 64
# ---------------------

def main():
    webbrowser.open(f'file://{os.path.realpath("index.html")}')
    env = GymWrapper(WebSocketEnv(observation_shape=OBSERVATION_SHAPE, action_n=ACTION_N), device=DEVICE)

    actor_net = MLP(in_features=OBSERVATION_SHAPE[0], out_features=2 * ACTION_N, num_cells=[64, 64], activation_class=torch.nn.Tanh)
    policy_module = ProbabilisticActor(module=actor_net, in_keys=["observation"], out_keys=["loc", "scale"], distribution_class=TanhNormal)
    value_net = MLP(in_features=OBSERVATION_SHAPE[0], out_features=1, num_cells=[64, 64], activation_class=torch.nn.Tanh)
    value_module = ValueOperator(module=value_net, in_keys=["observation"])

    collector = SyncDataCollector(
        env,
        policy_module,
        frames_per_batch=FRAMES_PER_BATCH,
        total_frames=TOTAL_FRAMES,
        device=DEVICE,
    )

    replay_buffer = TensorDictReplayBuffer(storage=LazyMemmapStorage(FRAMES_PER_BATCH))
    advantage_module = GAE(gamma=0.99, lmbda=0.95, value_network=value_module, average_gae=True)
    loss_module = ClipPPOLoss(actor=policy_module, critic=value_module, clip_epsilon=0.2, entropy_coef=0.01)
    optimizer = torch.optim.Adam(loss_module.parameters(), lr=3e-4)
    
    logger = TensorBoardLogger(log_dir="training_logs", exp_name=f"TorchRL_PPO_{int(time.time())}")
    
    total_frames_collected = 0
    print("Starting training...")
    for i, tensordict_data in enumerate(collector):
        total_frames_collected += tensordict_data.numel()
        
        with torch.no_grad():
            advantage_module(tensordict_data)
        
        data_view = tensordict_data.reshape(-1)
        replay_buffer.extend(data_view)
        
        for _ in range(PPO_EPOCHS):
            for subdata in replay_buffer.sample(MINI_BATCH_SIZE):
                loss_vals = loss_module(subdata)
                loss_value = sum(loss for key, loss in loss_vals.items() if key.startswith("loss_"))

                optimizer.zero_grad()
                loss_value.backward()
                optimizer.step()

        if i % 10 == 0: # Log every 10 batches
            print(f"Step {total_frames_collected}: loss={loss_value.item()}")
            for key, value in loss_vals.items():
                logger.log_scalar(key.replace("loss_", ""), value.item(), step=total_frames_collected)
        
        if i % 50 == 0:
            torch.save(policy_module.state_dict(), "model_torchrl.pth")

    print("Training finished.")
    collector.shutdown()
    torch.save(policy_module.state_dict(), "model_torchrl.pth")

if __name__ == "__main__":
    main()
</code></pre>
                </div>
            </div>
             <div class="user-input mt-6">
                <h3 class="font-semibold text-lg text-slate-800 mb-2">ë‹¤ìŒ ë‹¨ê³„: ONNX ë³€í™˜</h3>
                <p class="text-sm text-slate-600">í•™ìŠµì´ ì™„ë£Œë˜ë©´ `final_model.zip`(SB3) ë˜ëŠ” `model_torchrl.pth` íŒŒì¼ì´ ìƒì„±ë©ë‹ˆë‹¤. ë‹¤ìŒ ë‹¨ê³„ì—ì„œëŠ” ì´ ëª¨ë¸ì„ ì›¹ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ONNX í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.</p>
            </div>
        </section>
        
        <section id="step5" class="step bg-white p-6 sm:p-8 rounded-2xl shadow-lg border border-slate-200 mb-10">
            <h2 class="text-2xl font-bold mb-4 border-b pb-3 text-slate-900">ë‹¨ê³„ 5: ONNX ëª¨ë¸ ë³€í™˜</h2>
            <p class="mb-4 text-slate-700">í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤:</p>
            <pre class="bg-slate-100 text-slate-800 p-2 rounded-md text-sm"><code>pip install stable-baselines3==2.2.0 onnx onnxruntime torch</code></pre>
            <p class="mt-4 mb-4 text-slate-700">ì•„ë˜ ì½”ë“œë¥¼ `convert_onnx.py`ë¡œ ì €ì¥í•˜ê³  ì‹¤í–‰í•˜ì—¬ SB3 ëª¨ë¸ì„ ONNX í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•˜ì„¸ìš”.</p>
            <div class="prompt-block">
                    <button class="copy-button">ë³µì‚¬</button>
                    <pre class="bg-slate-100 text-slate-800 p-4 rounded-lg overflow-x-auto text-sm"><code class="language-python">import torch
import numpy as np
import onnxruntime as ort
from stable_baselines3 import PPO
import os

# --- CONFIGURATION ---
OBSERVATION_SHAPE = (8,) 
# Find the latest model file to convert
try:
    latest_run = max([d for d in os.listdir("training_logs") if os.path.isdir(os.path.join("training_logs", d))], key=lambda d: os.path.getmtime(os.path.join("training_logs", d)))
    MODEL_PATH = os.path.join("training_logs", latest_run, "final_model.zip")
except (FileNotFoundError, ValueError):
    MODEL_PATH = "final_model.zip" # Fallback
    
ONNX_PATH = "model.onnx"
# ---------------------

class OnnxablePolicy(torch.nn.Module):
    def __init__(self, policy):
        super().__init__()
        self.policy = policy

    def forward(self, observation):
        action, _ = self.policy.predict(observation, deterministic=True)
        return torch.from_numpy(action)

if not os.path.exists(MODEL_PATH):
    print(f"Error: Model file not found at {MODEL_PATH}")
    exit()

print(f"Loading model from {MODEL_PATH}...")
model = PPO.load(MODEL_PATH, device='cpu')
onnxable_model = OnnxablePolicy(model.policy)

dummy_input = torch.randn(1, *OBSERVATION_SHAPE)

print(f"Exporting to {ONNX_PATH}...")
torch.onnx.export(
    onnxable_model,
    dummy_input,
    ONNX_PATH,
    opset_version=12,
    input_names=["observation"],
    output_names=["action"],
)
print("Export complete.")

print("\n--- Verification ---")
dummy_observation_np = dummy_input.numpy().astype(np.float32)
ort_session = ort.InferenceSession(ONNX_PATH)
input_name = ort_session.get_inputs()[0].name
output_name = ort_session.get_outputs()[0].name

print(f"Running inference with dummy input...")
result = ort_session.run([output_name], {input_name: dummy_observation_np})
print("Inference successful!")
print(f"Output: {result[0]}")
print("\nONNX model conversion and verification complete.")
</code></pre>
            </div>
        </section>
        
        <section id="step6" class="step bg-white p-6 sm:p-8 rounded-2xl shadow-lg border border-slate-200 mb-10">
            <h2 class="text-2xl font-bold mb-4 border-b pb-3 text-slate-900">ë‹¨ê³„ 6: ìµœì¢… AI ê²Œì„ í…ŒìŠ¤íŠ¸</h2>
            <p class="mb-6 text-slate-700">ì´ì œ ìµœì¢… ë‹¨ê³„ì…ë‹ˆë‹¤! `model.onnx` íŒŒì¼ì´ `index.html`ê³¼ ê°™ì€ í´ë”ì— ìˆëŠ”ì§€ í™•ì¸í•˜ê³ , ì•„ë˜ ëª…ë ¹ì–´ë¡œ ë¡œì»¬ ì„œë²„ë¥¼ ì‹¤í–‰í•˜ì—¬ ë¸Œë¼ìš°ì €ì—ì„œ ìµœì¢… ê²°ê³¼ë¬¼ì„ í™•ì¸í•˜ì„¸ìš”.</p>
             <div class="space-y-4 text-slate-700">
                <div>
                    <h3 class="font-semibold text-lg text-slate-800">1. ë¡œì»¬ ì„œë²„ ì‹¤í–‰</h3>
                    <p class="mt-1 ml-2">í”„ë¡œì íŠ¸ í´ë”ì—ì„œ í„°ë¯¸ë„ì„ ì—´ê³  ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.</p>
                    <pre class="bg-slate-100 text-slate-800 p-2 mt-1 rounded-md text-sm"><code>python -m http.server</code></pre>
                </div>
                <div>
                    <h3 class="font-semibold text-lg text-slate-800">2. ë¸Œë¼ìš°ì €ì—ì„œ í™•ì¸</h3>
                    <p class="mt-1 ml-2">ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ <a href="http://localhost:8000" target="_blank" class="text-amber-600 underline">http://localhost:8000</a> ìœ¼ë¡œ ì ‘ì†í•©ë‹ˆë‹¤. ê²Œì„ì´ ë¡œë“œë˜ë©´, í™œì„±í™”ëœ AI/USER í† ê¸€ì„ 'AI'ë¡œ ë³€ê²½í•˜ì—¬ í•™ìŠµëœ ëª¨ë¸ì˜ í”Œë ˆì´ë¥¼ ê°ìƒí•˜ì„¸ìš”!</p>
                </div>
            </div>
        </section>

        <section id="step7" class="step bg-white p-6 sm:p-8 rounded-2xl shadow-lg border border-slate-200 mb-10">
            <h2 class="text-2xl font-bold mb-4 border-b pb-3 text-slate-900">ë‹¨ê³„ 7: GitHub Pagesë¡œ ì›¹ì— ë°°í¬í•˜ê¸°</h2>
            <p class="mb-6 text-slate-700">ì™„ì„±ëœ AI ì›¹ ê²Œì„(`index.html`, `style.css`, `main.js`, `model.onnx`)ì„ GitHub Pagesë¥¼ í†µí•´ ë¬´ë£Œë¡œ ë°°í¬í•©ë‹ˆë‹¤.</p>
            <div class="space-y-4 text-slate-700">
                <p>Public ì €ì¥ì†Œë¥¼ ë§Œë“¤ê³ , ëª¨ë“  íŒŒì¼ì„ ì—…ë¡œë“œí•œ ë’¤, ì €ì¥ì†Œ Settings &rarr; Pagesì—ì„œ 'main' ë¸Œëœì¹˜ë¥¼ ì†ŒìŠ¤ë¡œ ì„ íƒí•˜ì—¬ í™œì„±í™”í•˜ë©´ ë©ë‹ˆë‹¤.</p>
            </div>
        </section>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- ê³µí†µ UI ë¡œì§ (ë³µì‚¬ ë²„íŠ¼, íƒ­ ë²„íŠ¼ ë“±) ---
            const copyButtons = document.querySelectorAll('.copy-button');
            copyButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const codeBlock = button.nextElementSibling.querySelector('code');
                    const codeText = codeBlock.innerText;
                    navigator.clipboard.writeText(codeText).then(() => {
                        button.textContent = 'ë³µì‚¬ ì™„ë£Œ!';
                        button.classList.add('copied');
                        setTimeout(() => {
                            button.textContent = 'ë³µì‚¬';
                            button.classList.remove('copied');
                        }, 2000);
                    }).catch(err => console.error('Copy failed', err));
                });
            });

            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    const tabId = button.getAttribute('data-tab');
                    tabContents.forEach(content => {
                        content.classList.remove('active');
                        if (content.id === `tab-${tabId}`) {
                            content.classList.add('active');
                        }
                    });
                });
            });

            // --- í…Œë§ˆ ëª¨ë‹¬ ê´€ë ¨ ë¡œì§ ---
            const modal = document.getElementById('theme-modal');
            const openModalBtn = document.getElementById('open-modal-btn');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const themeGrid = document.getElementById('theme-grid');
            const step1PromptCodeElement = document.getElementById('step1-prompt-code');

            // 1. ì™¸ë¶€ JSON íŒŒì¼ì„ ë¹„ë™ê¸°ì ìœ¼ë¡œ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
            async function loadThemes() {
                try {
                    const response = await fetch('themes.json'); // themes.json íŒŒì¼ ìš”ì²­
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const themesData = await response.json(); // ì‘ë‹µì„ JSONìœ¼ë¡œ íŒŒì‹±

                    // 2. ê°€ì ¸ì˜¨ ë°ì´í„°ë¡œ ë™ì ìœ¼ë¡œ í…Œë§ˆ ì¹´ë“œ ìƒì„±
                    themeGrid.innerHTML = ''; // ê¸°ì¡´ ì½˜í…ì¸  ì´ˆê¸°í™”
                    themesData.sort((a, b) => a.title.localeCompare(b.title, 'ko')).forEach(theme => {
                        const card = document.createElement('div');
                        card.className = 'modal-card bg-slate-50 p-4 rounded-lg cursor-pointer border hover:border-amber-500 hover:bg-amber-50';
                        card.innerHTML = `
                            <div class="text-3xl mb-2">${theme.emoji}</div>
                            <h3 class="font-bold text-slate-800">${theme.title}</h3>
                            <p class="text-sm text-slate-600 mt-1">${theme.description}</p>
                        `;
                        card.addEventListener('click', () => {
                            const basePrompt = `You are a creative game designer. Based on the theme "[THEME_PLACEHOLDER]", please develop a detailed and engaging game plan.\n\nThe plan must be structured with the following four sections:\n\n1.  **Game Concept:** A brief, exciting one-paragraph summary of the game.\n2.  **Player Objective:** A clear description of what the player needs to accomplish.\n3.  **Controls:** A simple and intuitive control scheme.\n4.  **Win/Loss Conditions:** Specific, measurable conditions for success and failure.\n\nWrite the plan in Korean.`;
                            const promptToCopy = basePrompt.replace('[THEME_PLACEHOLDER]', `"${theme.rl_concept}"`);
                            
                            if (step1PromptCodeElement) {
                                step1PromptCodeElement.textContent = basePrompt.replace(
                                    `[ì—¬ê¸°ì— ì„ íƒí•œ ê²Œì„ ì£¼ì œì™€ ê°„ë‹¨í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”. ì˜ˆ: ë¡œì¼“ ì°©ë¥™ì‹œí‚¤ê¸°: ì¢Œìš° ë° ë©”ì¸ ì¶”ë ¥ì„ ì‚¬ìš©í•´, í™”ë©´ ìƒë‹¨ì—ì„œ ë–¨ì–´ì§€ëŠ” ë¡œì¼“ì´ ì •í•´ì§„ ì°©ë¥™ ì§€ì ì— ë¶€ë“œëŸ½ê²Œ ì°©ë¥™í•˜ëŠ” ê²Œì„]`,
                                    `[${theme.rl_concept}]`
                                );
                            }

                            navigator.clipboard.writeText(promptToCopy).then(() => {
                                 alert(`'${theme.title}' ì£¼ì œì˜ ìƒì„¸ í”„ë¡¬í”„íŠ¸ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤. Geminiì—ê²Œ ë°”ë¡œ ë¶™ì—¬ë„£ì–´ ì‚¬ìš©í•˜ì„¸ìš”!`);
                            });

                            if (modal) modal.classList.add('hidden');
                        });
                        if (themeGrid) themeGrid.appendChild(card);
                    });

                } catch (error) {
                    console.error("Could not load themes:", error);
                    if (themeGrid) themeGrid.innerHTML = '<p class="text-red-500">í…Œë§ˆë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. themes.json íŒŒì¼ì´ ì˜¬ë°”ë¥¸ ìœ„ì¹˜ì— ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.</p>';
                }
            }

            // 3. ëª¨ë‹¬ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            if (openModalBtn) openModalBtn.addEventListener('click', () => modal.classList.remove('hidden'));
            if (closeModalBtn) closeModalBtn.addEventListener('click', () => modal.classList.add('hidden'));
            if (modal) modal.addEventListener('click', (e) => {
                if (e.target.id === 'theme-modal') {
                    modal.classList.add('hidden');
                }
            });

            // --- í”„ë¡¬í”„íŠ¸ ìë™ ì—…ë°ì´íŠ¸ ë¡œì§ ---
            const gameLogicTextarea = document.getElementById('game-logic-textarea');
            const step2PromptCodeElement = document.getElementById('step2-prompt-code');
            if (gameLogicTextarea && step2PromptCodeElement) {
                const baseStep2Prompt = step2PromptCodeElement.innerText;
                gameLogicTextarea.addEventListener('input', () => {
                    const userInput = gameLogicTextarea.value;
                    if (userInput.trim() !== '') {
                        step2PromptCodeElement.innerText = baseStep2Prompt.replace("[ì—¬ê¸°ì— 1ë‹¨ê³„ì—ì„œ ìƒì„±ëœ ê²Œì„ ê¸°íšì•ˆì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.]", userInput);
                    } else {
                        step2PromptCodeElement.innerText = baseStep2Prompt;
                    }
                });
            }

            // í˜ì´ì§€ ë¡œë“œ ì‹œ í…Œë§ˆ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤í–‰
            loadThemes();
        });
    </script>
</body>
</html>

