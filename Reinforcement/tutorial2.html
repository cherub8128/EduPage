<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¸°ì¡´ Pygame ê²Œì„ìœ¼ë¡œ RL í™˜ê²½ ë§Œë“¤ê¸° (ì†Œì½”ë°˜ ver.)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #282c34;
            color: #abb2bf;
        }
        .slide {
            display: none;
        }
        .slide.active {
            display: block;
        }
        .code-highlight {
            background-color: rgba(255, 255, 0, 0.15);
            display: block;
            margin: -0.25rem -0.5rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
        }
        pre[class*="language-"] {
            font-size: 0.9rem;
            line-height: 1.6;
        }
        .explanation-box {
            background-color: #21252b;
            border-left: 4px solid #61afef;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-7xl mx-auto bg-[#21252b] rounded-xl shadow-2xl overflow-hidden">
        <div class="p-8">
            <h1 class="text-3xl md:text-4xl font-bold text-white text-center">ê¸°ì¡´ Pygame ê²Œì„ìœ¼ë¡œ RL í™˜ê²½ ë§Œë“¤ê¸° (ì†Œì½”ë°˜í¸)</h1>
            <p class="text-center text-gray-400 mt-2">ì£¼ì–´ì§„ `sokoban.py` íŒŒì¼ì„ AIì˜ ë†€ì´í„°ë¡œ ê°œì¡°í•´ë´…ì‹œë‹¤!</p>
        </div>

        <div id="slider-container" class="p-4 md:p-8 border-t border-gray-700 min-h-[500px]">
            <!-- Slides will be injected here by JS -->
        </div>

        <div class="bg-[#282c34] p-4 flex justify-between items-center">
            <button id="prevBtn" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed">ì´ì „</button>
            <div id="slide-counter" class="text-white text-lg font-semibold"></div>
            <button id="nextBtn" class="bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-2 px-4 rounded-lg transition duration-300">ë‹¤ìŒ</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        const slides = [
            {
                title: "1. ìš°ë¦¬ì˜ ëª©í‘œ: ê²Œì„ê³¼ í™˜ê²½ì˜ ë¶„ë¦¬",
                explanation: `
                    <p>ë¨¼ì €, íŠœí† ë¦¬ì–¼ì˜ ê¸°ë°˜ì´ ë˜ëŠ” ì›ë³¸ Pygame ì†Œì½”ë°˜ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ì„¸ìš”. ì´ íŒŒì¼ì„ ì„¸ ê°œì˜ íŒŒì¼ë¡œ ë¶„ë¦¬í•˜ì—¬ ì—­í• ì„ ëª…í™•í•˜ê²Œ ë‚˜ëˆŒ ê²ƒì…ë‹ˆë‹¤.</p>
                    <div class="my-4">
                        <a id="download-link" href="#" download="sokoban.py" class="inline-block bg-teal-500 hover:bg-teal-400 text-white font-bold py-2 px-4 rounded-lg transition duration-300">
                            sokoban.py ì›ë³¸ íŒŒì¼ ë‹¤ìš´ë¡œë“œ
                        </a>
                    </div>
                    <div class="grid grid-cols-3 gap-4 mt-4 text-center">
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <p class="text-2xl">ğŸ•¹ï¸</p>
                            <p class="font-bold text-white">sokoban_game.py</p>
                            <p class="text-sm text-gray-400">ìˆœìˆ˜ ê²Œì„ ë¡œì§</p>
                        </div>
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <p class="text-2xl">ğŸ”Œ</p>
                            <p class="font-bold text-white">sokoban_env.py</p>
                            <p class="text-sm text-gray-400">AIì™€ì˜ í†µì—­ì‚¬</p>
                        </div>
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <p class="text-2xl">ğŸ§ </p>
                            <p class="font-bold text-white">train.py</p>
                            <p class="text-sm text-gray-400">AI í•™ìŠµ ì‹¤í–‰</p>
                        </div>
                    </div>
                    <p class="mt-4">ì´ ìŠ¬ë¼ì´ë“œì—ì„œëŠ” ë¨¼ì € ë‹¤ìš´ë¡œë“œí•œ <code class="bg-gray-700 p-1 rounded">sokoban.py</code>ë¥¼ AIê°€ ì œì–´í•  ìˆ˜ ìˆëŠ” <code class="bg-gray-700 p-1 rounded">sokoban_game.py</code>ë¡œ ìˆ˜ì •í•˜ëŠ” ê³¼ì •ì— ì§‘ì¤‘í•©ë‹ˆë‹¤.</p>
                `,
                code: ``
            },
            {
                title: "2. `sokoban.py` ìˆ˜ì • (1): í´ë˜ìŠ¤ ì´ë¦„ ë³€ê²½",
                explanation: `
                    <p>ë¨¼ì €, ê¸°ì¡´ <code class="bg-gray-700 p-1 rounded">Game</code> í´ë˜ìŠ¤ì˜ ì´ë¦„ì„ <code class="bg-gray-700 p-1 rounded">SokobanGame</code>ìœ¼ë¡œ ë³€ê²½í•˜ì—¬ ì—­í• ì„ ë” ëª…í™•í•˜ê²Œ ë§Œë“­ë‹ˆë‹¤.</p>
                    <p class="mt-2">ê·¸ë¦¬ê³  AIê°€ ê²Œì„ì„ ì œì–´í•  ê²ƒì´ë¯€ë¡œ, ì‚¬ëŒì˜ í”Œë ˆì´ë¥¼ ìœ„í•œ ë©”ì¸ ë£¨í”„(<code class="bg-gray-700 p-1 rounded">run</code> í•¨ìˆ˜)ëŠ” ë‚˜ì¤‘ì— ë”°ë¡œ ë¶„ë¦¬í•  ê²ƒì…ë‹ˆë‹¤.</p>
                `,
                code: `
# ê¸°ì¡´ sokoban.py íŒŒì¼ì˜ ì¼ë¶€...

# --- ë©”ì¸ ê²Œì„ í´ë˜ìŠ¤ ---
<span class="code-highlight">class SokobanGame: # 'Game' -> 'SokobanGame'</span>
    pass  # ì„¸ë¶€ ì´ˆê¸°í™”ëŠ” run_for_human()ì—ì„œ pygame ë””ìŠ¤í”Œë ˆì´ë¥¼ ì—´ ë•Œ ì²˜ë¦¬
                `
            },
            {
                title: "3. `sokoban.py` ìˆ˜ì • (2): AIìš© step í•¨ìˆ˜ ì¶”ê°€",
                explanation: `
                    <p>AIëŠ” 'ìœ„ë¡œ ê°€' ê°™ì€ ëª…ë ¹ì„ ë‚´ë¦½ë‹ˆë‹¤. ì´ ëª…ë ¹ì„ ë°›ì•„ ê²Œì„ì„ í•œ í”„ë ˆì„ ì§„í–‰ì‹œí‚¤ê³ , ê·¸ ê²°ê³¼ë¥¼(ë‹¤ìŒ í™”ë©´, ë³´ìƒ, ì¢…ë£Œ ì—¬ë¶€) ì•Œë ¤ì£¼ëŠ” í•¨ìˆ˜ê°€ í•„ìš”í•©ë‹ˆë‹¤. ì´ í•¨ìˆ˜ë¥¼ <code class="bg-gray-700 p-1 rounded">step(action)</code>ì´ë¼ê³  ë¶€ë¦…ë‹ˆë‹¤.</p>
                    <p class="mt-2">ì´ í•¨ìˆ˜ëŠ” AIì™€ì˜ í•µì‹¬ ì†Œí†µ ì°½êµ¬ì…ë‹ˆë‹¤.</p>
                `,
                code: `
class SokobanGame:
    # ... (ì´ì „ ì½”ë“œ) ...

<span class="code-highlight">    def step(self, action):</span>
<span class="code-highlight">        """AIì˜ í–‰ë™(action)ì„ ë°›ì•„ ê²Œì„ì„ í•œ ë‹¨ê³„ ì§„í–‰ì‹œí‚¤ê³  ê²°ê³¼ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤."""</span>
<span class="code-highlight">        move_map = {0: (0, -1), 1: (0, 1), 2: (-1, 0), 3: (1, 0)} # ìƒ, í•˜, ì¢Œ, ìš°</span>
<span class="code-highlight">        dx, dy = move_map[action]</span>
<span class="code-highlight"></span>
<span class="code-highlight">        boxes_on_target_before = len(self.box_positions.intersection(self.target_positions))</span>
<span class="code-highlight">        self._move_player(dx, dy) # ê¸°ì¡´ ì´ë™ í•¨ìˆ˜ ì¬ì‚¬ìš©</span>
<span class="code-highlight">        boxes_on_target_after = len(self.box_positions.intersection(self.target_positions))</span>
<span class="code-highlight"></span>
<span class="code-highlight">        reward = self._calculate_reward(boxes_on_target_before, boxes_on_target_after)</span>
<span class="code-highlight">        done = self._check_win_condition()</span>
<span class="code-highlight"></span>
<span class="code-highlight">        return self.get_observation(), reward, done</span>
                `
            },
            {
                title: "4. `sokoban.py` ìˆ˜ì • (3): ë³´ìƒ ë¡œì§ ì„¤ê³„",
                explanation: `
                    <p>AIë¥¼ ë˜‘ë˜‘í•˜ê²Œ ë§Œë“œëŠ” ê°€ì¥ ì¤‘ìš”í•œ ë¶€ë¶„, ë°”ë¡œ 'ë³´ìƒ'ì…ë‹ˆë‹¤. ì–´ë–¤ í–‰ë™ì— ì ìˆ˜ë¥¼ ì¤„ì§€ ì •í•˜ëŠ” ê·œì¹™ì„ ë§Œë“­ë‹ˆë‹¤.</p>
                    <div class="explanation-box">
                        <p><strong>ë³´ìƒ ê·œì¹™:</strong><br>
                        - ë°•ìŠ¤ë¥¼ ëª©í‘œì— ì˜¬ë¦¬ë©´: <strong>+10ì </strong><br>
                        - ë°•ìŠ¤ë¥¼ ëª©í‘œì—ì„œ ë¹¼ë©´: <strong>-10ì </strong><br>
                        - ê²Œì„ì„ í´ë¦¬ì–´í•˜ë©´: <strong>+100ì </strong><br>
                        - ê·¸ëƒ¥ ì›€ì§ì´ë©´: <strong>-0.01ì </strong> (ìµœë‹¨ ê²½ë¡œë¥¼ ì°¾ë„ë¡ ìœ ë„)
                        </p>
                    </div>
                `,
                code: `
class SokobanGame:
    # ... (ì´ì „ ì½”ë“œ) ...
<span class="code-highlight">    def _calculate_reward(self, before, after):</span>
<span class="code-highlight">        reward = -0.01 # ì›€ì§ì„ í˜ë„í‹°</span>
<span class="code-highlight">        if after > before:</span>
<span class="code-highlight">            reward += 10</span>
<span class="code-highlight">        elif after < before:</span>
<span class="code-highlight">            reward -= 10</span>
<span class="code-highlight"></span>
<span class="code-highlight">        if self._check_win_condition():</span>
<span class="code-highlight">            reward += 100</span>
<span class="code-highlight">        return reward</span>
                `
            },
            {
                title: "5. `sokoban.py` ìˆ˜ì • (4): ê´€ì°°(Observation) ìƒì„±",
                explanation: `
                    <p>AIëŠ” ì‚¬ëŒì²˜ëŸ¼ í™”ë©´ í”½ì…€ì„ ë³´ê³  ì´í•´í•˜ê¸° ì–´ë µìŠµë‹ˆë‹¤. ëŒ€ì‹ , ê²Œì„ ìƒí™©ì„ ìˆ«ìë¡œ ëœ ì§€ë„(ê·¸ë¦¬ë“œ)ë¡œ ë³€í™˜í•´ì„œ ë³´ì—¬ì£¼ëŠ” ê²ƒì´ í›¨ì”¬ íš¨ìœ¨ì ì…ë‹ˆë‹¤.</p>
                    <div class="explanation-box">
                     <p><strong>ìˆ«ì ì§€ë„ ê·œì¹™:</strong><br>
                        - 1: í”Œë ˆì´ì–´, 2: ë°•ìŠ¤, 3: ëª©í‘œ, 4: ëª©í‘œ ìœ„ì˜ ë°•ìŠ¤
                     </p>
                    </div>
                `,
                code: `
class SokobanGame:
    # ... (ì´ì „ ì½”ë“œ) ...
<span class="code-highlight">    def get_observation(self):</span>
<span class="code-highlight">        """AIë¥¼ ìœ„í•œ ìˆ«ì ê·¸ë¦¬ë“œ ê´€ì°°(observation)ì„ ìƒì„±í•©ë‹ˆë‹¤."""</span>
<span class="code-highlight">        grid = np.zeros((self.map_height, self.map_width), dtype=np.uint8)</span>
<span class="code-highlight">        for r in range(self.map_height):</span>
<span class="code-highlight">            for c in range(self.map_width):</span>
<span class="code-highlight">                pos = (c, r)</span>
<span class="code-highlight">                if pos in self.target_positions: grid[r, c] = 3</span>
<span class="code-highlight">                if pos in self.box_positions: grid[r, c] = 2</span>
<span class="code-highlight">                if pos in self.target_positions and pos in self.box_positions: grid[r, c] = 4</span>
<span class="code-highlight">        player_r, player_c = self.player_pos[1], self.player_pos[0]</span>
<span class="code-highlight">        grid[player_r, player_c] = 1</span>
<span class="code-highlight">        return grid</span>
                `
            },
            {
                title: "6. `sokoban.py` ìˆ˜ì • (5): ì‚¬ëŒ í”Œë ˆì´ìš© ì½”ë“œ ë¶„ë¦¬",
                explanation: `
                    <p>ê¸°ì¡´ì˜ <code class="bg-gray-700 p-1 rounded">run</code>, <code class="bg-gray-700 p-1 rounded">events</code>, <code class="bg-gray-700 p-1 rounded">draw</code> í•¨ìˆ˜ ë“±ì€ ì‚¬ëŒì´ ì§ì ‘ í”Œë ˆì´í•  ë•Œë§Œ í•„ìš”í•©ë‹ˆë‹¤. ì´ë“¤ì„ <code class="bg-gray-700 p-1 rounded">run_for_human()</code>ì´ë¼ëŠ” í•¨ìˆ˜ë¡œ ë¬¶ì–´ì¤ë‹ˆë‹¤.</p>
                    <p class="mt-2">ì´ë ‡ê²Œ í•˜ë©´ <code class="bg-gray-700 p-1 rounded">sokoban_game.py</code> íŒŒì¼ì„ ì§ì ‘ ì‹¤í–‰í•˜ë©´ ì‚¬ëŒì´ ê²Œì„ì„ í•  ìˆ˜ ìˆê³ , ë‹¤ë¥¸ íŒŒì¼ì—ì„œ importí•˜ë©´ ìˆœìˆ˜ ê²Œì„ ë¡œì§ë§Œ ê°€ì ¸ë‹¤ ì“¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                `,
                code: `
class SokobanGame:
    # ... (ì´ì „ ì½”ë“œ) ...

<span class="code-highlight">def run_for_human(self):</span>
<span class="code-highlight">    # ê¸°ì¡´ì˜ run(), events(), draw() ë¡œì§ì„ ì´ê³³ìœ¼ë¡œ ì˜®ê¹ë‹ˆë‹¤.</span>
<span class="code-highlight">    # ...</span>

<span class="code-highlight"># ì´ íŒŒì¼ì„ ì§ì ‘ ì‹¤í–‰í•˜ë©´ ì‚¬ëŒì´ í”Œë ˆì´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span>
<span class="code-highlight">if __name__ == '__main__':</span>
<span class="code-highlight">    game = SokobanGame()</span>
<span class="code-highlight">    game.run_for_human()</span>
                `
            },
            {
                title: "7. `sokoban_env.py` ë§Œë“¤ê¸°",
                explanation: `
                    <p>ì´ì œ AIì™€ì˜ í†µì—­ì‚¬, <code class="bg-gray-700 p-1 rounded">sokoban_env.py</code> íŒŒì¼ì„ ë§Œë“¤ ì°¨ë¡€ì…ë‹ˆë‹¤. ì´ íŒŒì¼ì€ ìš°ë¦¬ê°€ ìˆ˜ì •í•œ <code class="bg-gray-700 p-1 rounded">SokobanGame</code>ì„ ë¶ˆëŸ¬ì™€ Gymnasium ê·œì¹™ì— ë§ê²Œ í¬ì¥í•©ë‹ˆë‹¤.</p>
                    <p class="mt-2">ì´ì „ íŠœí† ë¦¬ì–¼ì—ì„œ ë°°ìš´ ë‚´ìš©ê³¼ ê±°ì˜ ë™ì¼í•©ë‹ˆë‹¤. ë‚´ë¶€ì ìœ¼ë¡œ <code class="bg-gray-700 p-1 rounded">SokobanGame</code> ê°ì²´ë¥¼ ê°€ì§€ê³ , AIì˜ ìš”ì²­ì„ ê²Œì„ ê°ì²´ì— ì „ë‹¬í•˜ëŠ” ì—­í• ë§Œ í•©ë‹ˆë‹¤.</p>
                `,
                code: `
# sokoban_env.py
import gymnasium as gym
from gymnasium import spaces
import numpy as np
<span class="code-highlight">from sokoban_game import SokobanGame # ìˆ˜ì •í•œ ê²Œì„ í´ë˜ìŠ¤ import</span>

class SokobanEnv(gym.Env):
    def __init__(self, render_mode=None):
        super().__init__()
<span class="code-highlight">        self.game = SokobanGame() # ê²Œì„ ê°ì²´ë¥¼ ë‚´ë¶€ì— ìƒì„±</span>
        self.render_mode = render_mode
        self.steps_taken = 0

        self.action_space = spaces.Discrete(4)
        self.observation_space = spaces.Box(
            low=0, high=4,
            shape=(self.game.map_height, self.game.map_width), dtype=np.uint8
        )

    def step(self, action):
<span class="code-highlight">        obs, reward, terminated = self.game.step(action) # ê²Œì„ ê°ì²´ì— ëª…ë ¹ ì „ë‹¬</span>
        self.steps_taken += 1
        truncated = self.steps_taken >= 200 # íƒ€ì„ìŠ¤í… ì œí•œ
        if self.render_mode == "human":
            self.game.render(self._surface) if hasattr(self, "_surface") else None
        return obs, reward, terminated, truncated, {}

    def reset(self, *, seed=None, options=None):
        super().reset(seed=seed)
        self.steps_taken = 0
        obs = self.game.reset()
        return obs, {}

    def render(self):
        if self.render_mode == "human":
            if not hasattr(self, "_surface"):
                import pygame
                pygame.init()
                self._surface = pygame.display.set_mode((800, 600))
            self.game.render(self._surface)

    def close(self):
        try:
            import pygame
            pygame.quit()
        except:
            pass
                `
            },
            {
                title: "8. `train.py`ë¡œ í•™ìŠµ ì‹¤í–‰í•˜ê¸°",
                explanation: `
                    <p>ë§ˆì§€ë§‰ìœ¼ë¡œ, AI í•™ìŠµì„ ì‹œì‘í•˜ëŠ” <code class="bg-gray-700 p-1 rounded">train.py</code> íŒŒì¼ì„ ë§Œë“­ë‹ˆë‹¤.</p>
                    <p class="mt-2">ì´ íŒŒì¼ì€ ìš°ë¦¬ê°€ ë§Œë“  <code class="bg-gray-700 p-1 rounded">SokobanEnv</code>ë¥¼ ë¶ˆëŸ¬ì™€ Stable-Baselines3 ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ PPO ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ í•™ìŠµì„ ì§„í–‰í•©ë‹ˆë‹¤.</p>
                `,
                code: `
# train.py
<span class="code-highlight">from sokoban_env import SokobanEnv # ìš°ë¦¬ê°€ ë§Œë“  í™˜ê²½ import</span>
from stable_baselines3 import PPO
from stable_baselines3.common.env_checker import check_env

# 1. í™˜ê²½ ìœ íš¨ì„± ê²€ì‚¬
env = SokobanEnv()
check_env(env)

# 2. ëª¨ë¸ ìƒì„± ë° í•™ìŠµ
env = SokobanEnv()
<span class="code-highlight">model = PPO("MlpPolicy", env, verbose=1)</span>
<span class="code-highlight">model.learn(total_timesteps=100000)</span>
model.save("ppo_sokoban")

# 3. í•™ìŠµëœ ëª¨ë¸ í…ŒìŠ¤íŠ¸
model = PPO.load("ppo_sokoban")
obs, info = env.reset()
for _ in range(500):
    action, _ = model.predict(obs, deterministic=True)
    obs, reward, terminated, truncated, info = env.step(action)
    env.render()
    if terminated or truncated:
        obs, info = env.reset()
                `
            },
            {
                title: "9. ìµœì¢… ì •ë¦¬",
                explanation: `
                    <p>ì¶•í•˜í•©ë‹ˆë‹¤! ì´ì œ ì—¬ëŸ¬ë¶„ì€ ê¸°ì¡´ Pygame ê²Œì„ì„ ìˆ˜ì •í•˜ì—¬ AIë¥¼ í•™ìŠµì‹œí‚¬ ìˆ˜ ìˆëŠ” ì™„ì „í•œ RL í”„ë¡œì íŠ¸ êµ¬ì¡°ë¥¼ ê°–ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                     <div class="explanation-box">
                        <p><strong>í•µì‹¬ ìš”ì•½:</strong><br>
                        1. <strong>ê²Œì„ ë¡œì§ ìˆ˜ì •:</strong> ê¸°ì¡´ ê²Œì„ ì½”ë“œì— AIê°€ ì œì–´í•  ìˆ˜ ìˆëŠ” <code class="bg-gray-700 p-1 rounded">step</code>, <code class="bg-gray-700 p-1 rounded">reset</code>, <code class="bg-gray-700 p-1 rounded">get_observation</code> í•¨ìˆ˜ë¥¼ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.<br>
                        2. <strong>í™˜ê²½ ë˜í¼ ìƒì„±:</strong> ìˆ˜ì •ëœ ê²Œì„ì„ Gymnasium ê·œì¹™ì— ë§ê²Œ ê°ì‹¸ëŠ” <code class="bg-gray-700 p-1 rounded">SokobanEnv</code>ë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.<br>
                        3. <strong>í•™ìŠµ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±:</strong> ë§Œë“¤ì–´ì§„ í™˜ê²½ì„ ì´ìš©í•´ ì‹¤ì œ AI ëª¨ë¸ì„ í•™ìŠµì‹œí‚¤ëŠ” ì½”ë“œë¥¼ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.
                        </p>
                    </div>
                `,
                code: ``
            }
        ];

        const sokobanFileContent = `
import pygame
import sys
import random
import numpy as np
from pygame import gfxdraw  # ì•ˆí‹°ì•¨ë¦¬ì–´ì‹± ì› ê·¸ë¦¬ê¸°ìš©

# --- ìƒìˆ˜ ì •ì˜ ---
SCREEN_WIDTH = 800
SCREEN_HEIGHT = 600
TILE_SIZE = 60
WALL_THICKNESS = 10
AA_SCALE = 4  # ìŠˆí¼ìƒ˜í”Œë§ ë°°ìœ¨

# ìƒ‰ìƒ íŒ”ë ˆíŠ¸
COLOR_BACKGROUND = (240, 235, 220)
COLOR_WALL = (60, 70, 80)
COLOR_PLAYER = (230, 80, 80)
COLOR_BOX = (20, 140, 200)
COLOR_TARGET = (220, 170, 20)
COLOR_BOX_ON_TARGET = (60, 200, 100)
COLOR_TEXT = (50, 50, 50)

# --- ì»¤ìŠ¤í…€ ì´ë²¤íŠ¸ ---
SUBSCRIBE_EVENT = pygame.USEREVENT + 1
NEXT_LEVEL_EVENT = pygame.USEREVENT + 2
NEXT_LEVEL_DELAY_MS = 1500

def make_aa_rounded_rect(size, color, radius, aa_scale=AA_SCALE):
    \"\"\"ìŠˆí¼ìƒ˜í”Œë§ìœ¼ë¡œ ê°€ì¥ìë¦¬ê°€ ë§¤ëˆí•œ ë‘¥ê·¼ ì‚¬ê°í˜• Surface ìƒì„±\"\"\"
    w, h = size
    big = pygame.Surface((w * aa_scale, h * aa_scale), pygame.SRCALPHA)
    pygame.draw.rect(
        big, color, pygame.Rect(0, 0, w * aa_scale, h * aa_scale),
        border_radius=radius * aa_scale
    )
    small = pygame.transform.smoothscale(big, (w, h))
    return small

def draw_aa_circle(surface, x, y, r, color):
    \"\"\"ì•ˆí‹°ì•¨ë¦¬ì–´ì‹± ì›(í”Œë ˆì´ì–´)\"\"\"
    gfxdraw.filled_circle(surface, x, y, r, color)
    gfxdraw.aacircle(surface, x, y, r, color)

class SokobanGame:
    def __init__(self):
        # ë§µ/ìƒíƒœ
        self.map_width = 6
        self.map_height = 6
        self.num_boxes = 2
        self.box_spawn_margin = 1  # ê°€ì¥ìë¦¬ ìŠ¤í° ë°©ì§€

        # ë Œë” ë¦¬ì†ŒìŠ¤
        self.screen = None
        self.clock = None
        self.font_small = None

        # ìƒíƒœ í”Œë˜ê·¸
        self._surface_cache = {}
        self.game_state = "playing"
        self.win_event_fired = False
        self.show_subscribe_prompt = False

        self.reset()

    def on_subscribe(self):
        \"\"\"êµ¬ë… ë²„íŠ¼/í‚¤ ì…ë ¥ ì‹œ í˜¸ì¶œë˜ëŠ” ì½œë°±\"\"\"
        print("[Sokoban] User subscribed!")

    # --------- RL API ---------
    def reset(self):
        \"\"\"ê²Œì„ì„ ì´ˆê¸° ìƒíƒœë¡œ ë¦¬ì…‹í•˜ê³  ê´€ì°°ì„ ë°˜í™˜\"\"\"
        level_data = self._generate_random_level_data()
        self._load_level_from_data(level_data)
        self.game_state = "playing"
        self.win_event_fired = False
        self.show_subscribe_prompt = False
        self._surface_cache.clear()
        return self.get_observation()

    def step(self, action):
        \"\"\"AI í–‰ë™ì„ ì ìš©í•˜ê³  (obs, reward, done) ë°˜í™˜\"\"\"
        move_map = {0: (0, -1), 1: (0, 1), 2: (-1, 0), 3: (1, 0)}  # ìƒí•˜ì¢Œìš°
        dx, dy = move_map[action]

        before = len(self.box_positions.intersection(self.target_positions))
        self._move_player(dx, dy)
        after = len(self.box_positions.intersection(self.target_positions))

        reward = self._calculate_reward(before, after)
        done = self._check_win_condition()

        return self.get_observation(), reward, done

    def get_observation(self):
        \"\"\"ê²©ì ê¸°ë°˜ ê´€ì°° í–‰ë ¬ ë°˜í™˜\"\"\"
        grid = np.zeros((self.map_height, self.map_width), dtype=np.uint8)
        for r in range(self.map_height):
            for c in range(self.map_width):
                pos = (c, r)
                if pos in self.target_positions:
                    grid[r, c] = 3
                if pos in self.box_positions:
                    grid[r, c] = 2
                if pos in self.target_positions and pos in self.box_positions:
                    grid[r, c] = 4
        pr, pc = self.player_pos[1], self.player_pos[0]
        grid[pr, pc] = 1
        return grid

    # --------- ë‚´ë¶€ ë¡œì§ ---------
    def _generate_random_level_data(self):
        # ë°•ìŠ¤ëŠ” ê°€ì¥ìë¦¬ í•œ ì¹¸ ë§ì„ í”¼í•´ì„œ ìƒì„±
        all_coords = [(c, r) for c in range(self.map_width) for r in range(self.map_height)]
        inner_coords = [
            (c, r)
            for c in range(self.box_spawn_margin, self.map_width - self.box_spawn_margin)
            for r in range(self.box_spawn_margin, self.map_height - self.box_spawn_margin)
        ]
        random.shuffle(inner_coords)
        box_positions = set(inner_coords[:self.num_boxes])

        remaining = [p for p in all_coords if p not in box_positions]
        random.shuffle(remaining)
        player_pos = remaining.pop()
        target_positions = set(remaining[:self.num_boxes])

        return {"player": player_pos, "boxes": box_positions, "targets": target_positions}

    def _load_level_from_data(self, level_data):
        self.player_pos = level_data["player"]
        self.box_positions = set(level_data["boxes"])
        self.target_positions = set(level_data["targets"])

    def _move_player(self, dx, dy):
        px, py = self.player_pos
        npos = (px + dx, py + dy)

        if not (0 <= npos[0] < self.map_width and 0 <= npos[1] < self.map_height):
            return

        if npos in self.box_positions:
            nb = (npos[0] + dx, npos[1] + dy)
            if not (0 <= nb[0] < self.map_width and 0 <= nb[1] < self.map_height) or nb in self.box_positions:
                return
            self.box_positions.remove(npos)
            self.box_positions.add(nb)

        self.player_pos = npos

    def _check_win_condition(self):
        return self.box_positions == self.target_positions

    def _calculate_reward(self, before, after):
        reward = -0.01
        if after > before:
            reward += 10
        elif after < before:
            reward -= 10
        if self._check_win_condition():
            reward += 100
        return reward

    # --------- ë Œë”ë§ ---------
    def _cached_tile(self, key, color, radius):
        if key not in self._surface_cache:
            surf = make_aa_rounded_rect((TILE_SIZE, TILE_SIZE), color, radius)
            if pygame.get_init() and pygame.display.get_init():
                surf = surf.convert_alpha()
            self._surface_cache[key] = surf
        return self._surface_cache[key]

    def render(self, surface):
        surface.fill(COLOR_BACKGROUND)
        map_w_px = self.map_width * TILE_SIZE
        map_h_px = self.map_height * TILE_SIZE
        offset_x = (SCREEN_WIDTH - map_w_px) // 2
        offset_y = (SCREEN_HEIGHT - map_h_px) // 2

        # ì™¸ê³½ ë²½ í”„ë ˆì„
        wall_frame_rect = pygame.Rect(offset_x, offset_y, map_w_px, map_h_px).inflate(WALL_THICKNESS + 10, WALL_THICKNESS + 10)
        pygame.draw.rect(surface, COLOR_WALL, wall_frame_rect, width=WALL_THICKNESS, border_radius=15)

        def to_px(pos):
            return (offset_x + pos[0] * TILE_SIZE, offset_y + pos[1] * TILE_SIZE)

        rr = max(8, TILE_SIZE // 6)
        target_tile = self._cached_tile(("target", TILE_SIZE), COLOR_TARGET, rr)
        box_tile = self._cached_tile(("box", TILE_SIZE), COLOR_BOX, rr)
        box_on_target_tile = self._cached_tile(("box_on_target", TILE_SIZE), COLOR_BOX_ON_TARGET, rr)

        # íƒ€ê²Ÿ â†’ ë°•ìŠ¤
        for pos in self.target_positions:
            px, py = to_px(pos)
            surface.blit(target_tile, (px, py))

        for pos in self.box_positions:
            px, py = to_px(pos)
            tile = box_on_target_tile if pos in self.target_positions else box_tile
            surface.blit(tile, (px, py))

        # í”Œë ˆì´ì–´ (AA ì›)
        px, py = to_px(self.player_pos)
        cx = px + TILE_SIZE // 2
        cy = py + TILE_SIZE // 2
        pr = TILE_SIZE // 2 - 5
        draw_aa_circle(surface, cx, cy, pr, COLOR_PLAYER)

        # ì˜¤ë²„ë ˆì´
        if self.show_subscribe_prompt and self.font_small:
            msg1 = self.font_small.render("LEVEL CLEAR!", True, (0, 150, 0))
            msg2 = self.font_small.render("Press S to Subscribe", True, COLOR_TEXT)
            surface.blit(msg1, (SCREEN_WIDTH // 2 - msg1.get_width() // 2, 20))
            surface.blit(msg2, (SCREEN_WIDTH // 2 - msg2.get_width() // 2, 60))
        elif self._check_win_condition() and self.font_small:
            msg = self.font_small.render("LEVEL CLEAR!", True, (0, 150, 0))
            surface.blit(msg, (SCREEN_WIDTH // 2 - msg.get_width() // 2, 20))

    # --------- ì‚¬ëŒ í”Œë ˆì´ ë£¨í”„ ---------
    def run_for_human(self):
        pygame.init()
        self.screen = pygame.display.set_mode((SCREEN_WIDTH, SCREEN_HEIGHT))
        pygame.display.set_caption("Sokoban (Rounded + AA + Subscribe)")
        self.clock = pygame.time.Clock()
        self.font_small = pygame.font.Font(None, 36)

        while True:
            for event in pygame.event.get():
                if event.type == pygame.QUIT:
                    pygame.quit()
                    sys.exit()

                if event.type == SUBSCRIBE_EVENT:
                    self.show_subscribe_prompt = True
                    pygame.time.set_timer(NEXT_LEVEL_EVENT, NEXT_LEVEL_DELAY_MS, True)

                if event.type == NEXT_LEVEL_EVENT:
                    self.reset()
                    pygame.time.set_timer(NEXT_LEVEL_EVENT, 0)

                if event.type == pygame.KEYDOWN:
                    dx, dy = 0, 0
                    if event.key == pygame.K_UP: dx, dy = 0, -1
                    elif event.key == pygame.K_DOWN: dx, dy = 0, 1
                    elif event.key == pygame.K_LEFT: dx, dy = -1, 0
                    elif event.key == pygame.K_RIGHT: dx, dy = 1, 0
                    elif event.key == pygame.K_r: self.reset()
                    elif event.key == pygame.K_s and self.show_subscribe_prompt:
                        self.on_subscribe()

                    if dx != 0 or dy != 0:
                        self._move_player(dx, dy)

            # ë Œë”
            self.render(self.screen)

            # ìŠ¹ë¦¬ ê°ì§€ â†’ êµ¬ë… ì´ë²¤íŠ¸ 1íšŒ ë°œí–‰
            if self._check_win_condition() and not self.win_event_fired:
                self.win_event_fired = True
                pygame.event.post(pygame.event.Event(SUBSCRIBE_EVENT))

            pygame.display.flip()
            self.clock.tick(30)

# ë‹¨ë… ì‹¤í–‰ ì‹œ
if __name__ == '__main__':
    game = SokobanGame()
    game.run_for_human()
`;

        let currentSlide = 0;
        const sliderContainer = document.getElementById('slider-container');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const slideCounter = document.getElementById('slide-counter');

        function createSlide(slideData, index) {
            const slideElement = document.createElement('div');
            slideElement.className = 'slide p-4';
            slideElement.dataset.index = index;

            let codeHtml = '';
            if (slideData.code) {
                const tempDiv = document.createElement('div');
                const codeWithPlaceholders = slideData.code.trim()
                    .replace(/<span class="code-highlight">/g, '[[HIGHLIGHT_START]]')
                    .replace(/<\/span>/g, '[[HIGHLIGHT_END]]');

                tempDiv.textContent = codeWithPlaceholders;
                
                const finalCode = tempDiv.innerHTML
                    .replace(/\[\[HIGHLIGHT_START\]\]/g, '<span class="code-highlight">')
                    .replace(/\[\[HIGHLIGHT_END\]\]/g, '</span>');

                codeHtml = `
                    <div class="mt-6 bg-[#282c34] rounded-lg overflow-hidden border border-gray-700">
                        <pre class="language-python !text-sm !leading-relaxed"><code>${finalCode}</code></pre>
                    </div>
                `;
            }

            slideElement.innerHTML = `
                <div class="grid grid-cols-1 ${slideData.code ? 'md:grid-cols-2' : ''} gap-8 items-start">
                    <div class="prose prose-invert max-w-none">
                        <h2 class="text-2xl font-bold text-indigo-400 mb-4">${slideData.title}</h2>
                        <div class="text-gray-300 leading-relaxed space-y-2">${slideData.explanation}</div>
                    </div>
                    ${slideData.code ? `<div>${codeHtml}</div>` : ''}
                </div>
            `;
            return slideElement;
        }
        
        function setupDownloadLink() {
            const link = document.getElementById('download-link');
            if (link) {
                const encodedContent = encodeURIComponent(sokobanFileContent.trim());
                link.href = 'data:text/plain;charset=utf-8,' + encodedContent;
            }
        }

        function updateSlider() {
            document.querySelectorAll('.slide').forEach((slide, index) => {
                slide.classList.toggle('active', index === currentSlide);
            });
            slideCounter.textContent = `${currentSlide + 1} / ${slides.length}`;
            prevBtn.disabled = currentSlide === 0;
            nextBtn.disabled = currentSlide === slides.length - 1;
            
            if (currentSlide === 0) {
                setupDownloadLink();
            }
            
            Prism.highlightAll();
        }

        prevBtn.addEventListener('click', () => {
            if (currentSlide > 0) {
                currentSlide--;
                updateSlider();
            }
        });

        nextBtn.addEventListener('click', () => {
            if (currentSlide < slides.length - 1) {
                currentSlide++;
                updateSlider();
            }
        });
        
        // Initialize slider
        slides.forEach((slideData, index) => {
            sliderContainer.appendChild(createSlide(slideData, index));
        });
        updateSlider();
    </script>
</body>
</html>
