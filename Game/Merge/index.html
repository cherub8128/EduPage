<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>벡터 머지: 차원 이동</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <link rel="stylesheet" href="styles.css">
</head>
<body class="p-4">

    <div id="theme-toggle" class="absolute top-4 right-4 cursor-pointer z-50">
        <svg id="theme-toggle-dark-icon" class="w-6 h-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
        <svg id="theme-toggle-light-icon" class="w-6 h-6 text-yellow-500 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
    </div>
    
    <main class="w-full flex flex-col items-center justify-center">
        <h1 class="text-4xl font-bold text-main mb-2 mt-4 lg:mt-0">VECTOR MERGE</h1>
        <p class="text-sub mb-6 flex items-center">
            정확한 벡터로 차원을 도약하세요.
            <button id="help-btn" class="ml-2 w-6 h-6 rounded-full bg-sub text-main font-bold text-sm flex items-center justify-center hover:bg-main">?</button>
        </p>

        <div id="desktop-parent-container" class="flex flex-col lg:flex-row gap-8 w-full max-w-7xl">
            <!-- 왼쪽: 맵 & 정보 -->
            <div id="map-panel" class="bg-main p-6 rounded-2xl border-2 border-main flex flex-col gap-4 lg:w-1/3 w-full">
                <div class="flex flex-col gap-4">
                    <h2 class="text-2xl font-bold text-center mb-0 lg:block hidden text-main">MAP</h2>
                    <div class="bg-sub p-4 rounded-lg">
                        <div class="flex items-center justify-center gap-4 text-center">
                            <div>
                                <span class="text-lg">STAGE</span>
                                <span id="stage-counter" class="text-2xl font-bold text-green-400">1</span>
                            </div>
                            <div id="heart-container" class="flex gap-1 items-center"></div>
                        </div>
                    </div>
                    <div id="map-container" class="relative w-full max-w-sm mx-auto aspect-square mb-4">
                        <div id="map-coords-y" class="absolute -left-6 top-0 h-full flex flex-col items-center justify-around"></div>
                        <div id="map-grid" class="game-grid w-full h-full rounded-lg"></div>
                        <div id="map-items-container"></div>
                        <div id="player">
                            <svg class="w-3/4 h-3/4 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>
                        </div>
                        <div id="target">
                            <svg class="w-full h-full text-yellow-400" viewBox="0 0 100 100">
                                <defs>
                                    <linearGradient id="portalGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" style="stop-color: #A855F7;" />
                                        <stop offset="100%" style="stop-color: #60A5FA;" />
                                    </linearGradient>
                                </defs>
                                <circle cx="50" cy="50" r="48" fill="none" stroke="url(#portalGradient)" stroke-width="4" />
                                <path d="M 50,50 m -40,0 a 40,40 0 1,0 80,0 a 40,40 0 1,0 -80,0"
                                      fill="none" stroke="currentColor" stroke-width="2" stroke-dasharray="5 10">
                                    <animateTransform attributeName="transform" type="rotate" from="0 50 50" to="360 50 50" dur="10s" repeatCount="indefinite" />
                                </path>
                                <path d="M 50,50 m -25,0 a 25,25 0 1,1 50,0 a 25,25 0 1,1 -50,0"
                                      fill="none" stroke="currentColor" stroke-width="3">
                                     <animateTransform attributeName="transform" type="rotate" from="360 50 50" to="0 50 50" dur="5s" repeatCount="indefinite" />
                                </path>
                            </svg>
                        </div>
                        <div id="map-coords-x" class="absolute -bottom-6 left-0 w-full flex justify-around items-center"></div>
                    </div>
                </div>

                <div id="legend-panel" class="bg-sub p-4 rounded-lg mt-6">
                    <div class="text-left text-sm space-y-3">
                        <h3 class="text-lg font-bold text-center mb-2">MAP LEGEND</h3>
                        <div class="grid grid-cols-2 gap-x-4 gap-y-2">
                             <div class="flex items-center gap-3"><div class="w-8 h-8 flex-shrink-0 flex items-center justify-center bg-blue-500 rounded-full border-2 border-blue-300"><svg class="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg></div><span>플레이어</span></div>
                            <div class="flex items-center gap-3"><div class="w-8 h-8 flex-shrink-0 flex items-center justify-center" title="포털">
                                <svg class="w-full h-full text-yellow-400" viewBox="0 0 100 100">
                                    <defs>
                                        <linearGradient id="portalGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                            <stop offset="0%" style="stop-color: #A855F7;"></stop>
                                            <stop offset="100%" style="stop-color: #60A5FA;"></stop>
                                        </linearGradient>
                                    </defs>
                                    <circle cx="50" cy="50" r="48" fill="none" stroke="url(#portalGradient)" stroke-width="8"></circle>
                                    <path d="M 50,50 m -35,0 a 35,35 0 1,0 70,0 a 35,35 0 1,0 -70,0" fill="none" stroke="currentColor" stroke-width="4" stroke-dasharray="4 8"><animateTransform attributeName="transform" type="rotate" from="0 50 50" to="360 50 50" dur="10s" repeatCount="indefinite"></animateTransform></path>
                                </svg>
                            </div><span title="포털">포털</span></div>
                            <div class="flex items-center gap-3"><div class="w-8 h-8 flex-shrink-0 flex items-center justify-center"><div class="w-full h-full rounded-md flex items-center justify-center" style="background-color: hsl(90, 80%, 55%); border: 2px solid hsl(90, 80%, 70%);"><svg class="w-5 h-5 text-white" style="transform: rotate(90deg);" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg></div></div><span title="벡터">벡터</span></div>
                            <div class="flex items-center gap-3"><div class="w-8 h-8 flex-shrink-0 flex items-center justify-center"><svg class="w-full h-full text-purple-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M5 21v-4M3 19h4m14-14v4m-2-2h4m-2 14v-4m-2 2h4M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div><span title="소환진">소환진</span></div>
                             <div class="flex items-center gap-3"><div class="w-8 h-8 flex-shrink-0 flex items-center justify-center"> <div id="gem-legend-icon"></div> </div><span title="보석">보석</span></div>
                             <div class="flex items-center gap-3"><div class="w-8 h-8 flex-shrink-0 flex items-center justify-center"><div class="w-full h-full text-blue-300 animate-pulse font-bold text-2xl flex items-center justify-center">?</div></div><span title="랜덤 아이템">랜덤 아이템</span></div>
                        </div>
                         <div class="flex items-start gap-3 pt-2 border-t border-main mt-2">
                             <div class="w-8 h-8 flex-shrink-0 flex items-center justify-center"><div class="w-full h-full rounded-md flex items-center justify-center bg-gray-500 border-2 border-gray-400"><svg class="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg></div></div>
                            <span class="text-xs pt-1">방해물: 인접한 곳에서 같은 색 벡터를 합성하여 제거합니다.</span>
                         </div>
                         <div class="flex items-start gap-3 pt-2 border-t border-main">
                            <div class="w-8 h-8 flex-shrink-0 flex items-center justify-center"><svg class="w-full h-full text-green-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h5M20 20v-5h-5M4 20L9 15M20 4l-5 5"></path></svg></div>
                            <div class="flex flex-col text-xs pt-1">
                                <span>재활용기: 같은 레벨끼리 합쳐 성장합니다.</span>
                                <div id="remover-legend-colors" class="flex items-center gap-1 mt-1 flex-wrap"></div>
                            </div>
                         </div>
                         <div class="flex items-start gap-3 pt-2 border-t border-main">
                            <div class="w-8 h-8 flex-shrink-0 flex items-center justify-center bg-gray-800 border-2 border-gray-600 rounded-md"><svg class="w-5 h-5 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></div>
                            <span class="text-xs pt-1">잔여물: 같은 레벨끼리 합치면 성장하며, 재활용기로 소환진으로 바꿀 수 있습니다. (예: Lv.1→소멸, Lv.2→<svg class="inline-block w-3 h-3 text-purple-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 3v4M3 5h4M5 21v-4M3 19h4m14-14v4m-2-2h4m-2 14v-4m-2 2h4M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>1개, Lv.3→2개, Lv.4→4개...)</span>
                         </div>
                    </div>
                </div>
                <div id="gem-collection-panel" class="bg-sub p-4 rounded-lg mt-6 lg:mt-auto">
                    <h3 class="text-lg font-bold text-center mb-3">GEM COLLECTION</h3>
                    <div id="gem-collection-container" class="grid grid-cols-6 gap-2"></div>
                    <button id="full-reset-btn" class="w-full mt-3 bg-red-900 hover:bg-red-800 text-white text-xs py-2 px-2 rounded-lg">모든 진행 초기화</button>
                </div>
            </div>

            <!-- 오른쪽: 작업 공간 -->
            <div id="workbench-panel" class="bg-main p-6 rounded-2xl border-2 border-main flex-col lg:w-2/3 hidden lg:flex w-full">
                <div id="game-board" class="grid grid-cols-4 gap-3 mb-3">
                     <div class="slot board-slot" data-index="0"></div><div class="slot board-slot" data-index="1"></div><div class="slot board-slot" data-index="2"></div><div class="slot board-slot" data-index="3"></div>
                    <div class="slot board-slot" data-index="4"></div><div class="slot board-slot" data-index="5"></div><div class="slot board-slot" data-index="6"></div><div class="slot board-slot" data-index="7"></div>
                    <div class="slot board-slot" data-index="8"></div><div class="slot board-slot" data-index="9"></div><div class="slot board-slot" data-index="10"></div><div class="slot board-slot" data-index="11"></div>
                    <div class="slot board-slot" data-index="12"></div><div class="slot board-slot" data-index="13"></div><div class="slot board-slot" data-index="14"></div><div class="slot board-slot" data-index="15"></div>
                </div>
                <h2 class="text-xl font-bold text-center mt-2 text-main">아공간 보관함</h2>
                <div id="inventory-bay" class="grid grid-cols-4 sm:grid-cols-5 gap-3 mt-1 mb-5">
                    <!-- 10 slots for inventory -->
                     <div class="slot inventory-slot"></div><div class="slot inventory-slot"></div><div class="slot inventory-slot"></div><div class="slot inventory-slot"></div><div class="slot inventory-slot hidden"></div>
                     <div class="slot inventory-slot hidden"></div><div class="slot inventory-slot hidden"></div><div class="slot inventory-slot hidden"></div><div class="slot inventory-slot hidden"></div><div class="slot inventory-slot hidden"></div>
                </div>
                <button id="reset-stage-btn" class="w-full mt-2 bg-red-800 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-lg transition-opacity">
                    현재 맵 초기화
                </button>
        </div>
    </main>
    <footer class="w-full text-center p-4 text-xs text-muted">
        <p>v1.5.2 | © 2025 pi-dimension</p>
    </footer>

    <div id="message-box" class="message-box p-3 rounded-lg text-white font-bold shadow-lg"></div>
    
    <div id="help-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50 invisible opacity-0">
        <div class="bg-main border-2 border-main rounded-2xl p-6 text-left shadow-2xl max-w-lg w-full max-h-[80vh] overflow-y-auto relative">
            <h2 class="text-2xl font-bold text-center mb-4">게임 규칙</h2>
            <button id="close-help-btn" class="absolute top-4 right-4 text-sub hover:text-main text-2xl">&times;</button>
            <div class="space-y-4 text-sm text-sub">
                <div>
                    <h3 class="font-bold text-main mb-1">게임 목표</h3>
                    <p>작업대에서 벡터를 조합하여 플레이어(<span class="inline-block w-4 h-4 rounded-full bg-blue-500"></span>)를 포털(<span class="inline-block w-4 h-4 text-yellow-400"><svg class="w-full h-full" fill="currentColor" viewBox="0 0 20 20"><path d="M10 15a5 5 0 100-10 5 5 0 000 10zm0-1.5a3.5 3.5 0 100-7 3.5 3.5 0 000 7z"/></svg></span>) 지점으로 이동시키는 것입니다. 맵에 있는 아이템 지점으로 이동하여 도움을 받을 수도 있습니다.</p>
                </div>
                <div>
                    <h3 class="font-bold text-main mb-1">벡터 사용</h3>
                    <p>벡터는 현재 위치에서 목표 지점(포털, 아이템, 보석)까지 정확히 도달할 수 있는 벡터만 사용할 수 있습니다. 벡터를 클릭하여 사용해 보세요.</p>
                </div>
                 <div>
                    <h3 class="font-bold text-main mb-1">벡터 조합과 잔여물</h3>
                    <p>작업대 위에서 두 벡터를 합치면 두 벡터의 x, y 성분이 더해진 새로운 벡터가 생성됩니다. 단, 영벡터(0,0)가 아닐 경우, 드래그를 시작한 위치에 '잔여물'이 남습니다.</p>
                </div>
                <div>
                    <h3 class="font-bold text-main mb-1">아이템 종류</h3>
                    <ul class="list-disc list-inside space-y-2">
                        <li><b>소환진:</b> 작업대 위에서 클릭하면 빈 공간에 랜덤 아이템(기본 벡터, 1레벨 재활용기, 스칼라)을 소환합니다.</li>
                        <li><b>랜덤 아이템(?):</b> 맵에 나타나는 특별 지점입니다. 획득 시 기본 벡터 또는 1레벨 재활용기 중 하나를 무작위로 얻습니다.</li>
                        <li><b>잔여물:</b> 벡터 합성 시 발생하는 방해물입니다. 같은 레벨끼리 합치면 성장하며, 재활용기로 소환진으로 바꿀 수 있습니다. (Lv.1→소멸, Lv.2→<svg class="inline-block w-3 h-3 text-purple-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 3v4M3 5h4M5 21v-4M3 19h4m14-14v4m-2-2h4m-2 14v-4m-2 2h4M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>1개, Lv.3→2개...)</li>
                        <li><b>재활용기:</b> 잔여물 위로 드래그하여 제거/재활용할 수 있습니다. 자신보다 같거나 낮은 레벨의 잔여물만 처리 가능하며, 같은 레벨끼리 합치면 성장합니다.</li>
                        <li><b>방해물:</b> 작업대를 가리는 블록입니다. 인접한 칸에서 방해물과 같은 색의 벡터를 합성하면 사라지며, 밑에 숨겨진 아이템이 나타납니다. (스테이지 10 이상에서는 영벡터로도 제거 가능)</li>
                        <li><b>보석:</b> 맵에 나타나는 특별 아이템입니다. 획득하면 아공간이 영구적으로 1칸 확장됩니다. (최대 10칸)</li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-bold text-main mb-1">하트와 초기화</h3>
                    <p>하트는 '맵 초기화'에 사용되는 체력입니다. 맵 초기화 시 1개씩 소모되며, 스테이지 클리어 시 1개씩 회복됩니다. 하트가 0개일 때 초기화를 시도하면, 모든 진행상황(보석, 스테이지)을 초기화하고 처음부터 다시 시작할지 선택할 수 있습니다.</p>
                </div>
            </div>
        </div>
    </div>

    <div id="gameover-popup" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center invisible opacity-0">
        <div class="bg-main border-2 border-red-500 rounded-2xl p-8 text-center shadow-2xl transform scale-95 transition-transform duration-300">
            <h2 class="text-4xl font-bold text-red-400 mb-4">OUT OF RESETS</h2>
            <p class="text-lg text-sub mb-6">맵 초기화 횟수를 모두 사용했습니다.<br>모든 진행 상황을 초기화하고 다시 시작하시겠습니까?</p>
            <div class="flex justify-center gap-4">
                <button id="cancel-reset-btn" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg text-lg">취소</button>
                <button id="confirm-full-reset-btn" class="bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-6 rounded-lg text-lg">전체 초기화</button>
            </div>
        </div>
    </div>
    <div id="confirm-reset-popup" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center invisible opacity-0 z-50">
        <div class="bg-main border-2 border-yellow-500 rounded-2xl p-8 text-center shadow-2xl">
            <h2 class="text-2xl font-bold text-yellow-400 mb-4">전체 초기화 확인</h2>
            <p class="text-lg text-sub mb-6">모든 진행 상황(보석, 스테이지, 하트)이 사라집니다. 정말 초기화하시겠습니까?</p>
            <div class="flex justify-center gap-4">
                <button id="cancel-full-reset-btn" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg text-lg">취소</button>
                <button id="confirm-final-reset-btn" class="bg-yellow-500 hover:bg-yellow-600 text-gray-900 font-bold py-3 px-6 rounded-lg text-lg">확인</button>
            </div>
        </div>
    </div>
    <div id="ending-popup" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center invisible opacity-0">
        <div class="bg-main border-2 border-yellow-400 rounded-2xl p-8 text-center shadow-2xl transform scale-95 transition-transform duration-300">
            <h2 class="text-4xl font-bold text-yellow-300 mb-4">CONGRATULATIONS!</h2>
            <p class="text-lg text-sub mb-6">모든 차원의 보석을 모았습니다! <br> 당신은 진정한 벡터 마스터입니다.</p>
            <div id="final-gem-collection" class="grid grid-cols-6 gap-4 mb-8"></div>
            <button id="restart-game-btn" class="bg-yellow-500 hover:bg-yellow-600 text-gray-900 font-bold py-3 px-6 rounded-lg text-lg transition-transform hover:scale-105">새로운 차원 탐사하기</button>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>